<?xml version="1.0"?>
<!DOCTYPE modification SYSTEM "http://www.elkarte.net/site/modification">
<modification xmlns="http://www.elkarte.net/site/modification" xmlns:elk="http://www.elkarte.net/">

	<id>Elkarte Contributors:ElkArte_101_patch</id>
	<version>1.0</version>
	<file name="BOARDDIR/SSI.php">
		<operation>
			<search position="replace"><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0
 *
 */
]]></search>
			<add><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0.1
 *
 */
]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[
	echo '
		<form action="', $scripturl, '?action=search;sa=results" method="post" accept-charset="UTF-8">
			<input type="hidden" name="advanced" value="0" /><input type="text" name="ssi_search" size="30" class="input_text" /> <input type="submit" value="', $txt['search'], '" class="button_submit" />
		</form>';
}
]]></search>
			<add><![CDATA[
	echo '
		<form action="', $scripturl, '?action=search;sa=results" method="post" accept-charset="UTF-8">
			<input type="hidden" name="advanced" value="0" /><input type="text" name="search" size="30" class="input_text" /> <input type="submit" value="', $txt['search'], '" class="button_submit" />
		</form>';
}
]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[			$preview = 'first';

		$row['body'] = $row[$preview . '_body'];
		$row['id_msg'] = $row['id_' . $preview . '_msg'];
		$row['icon'] = $row[$preview . '_icon'];
		$row['id_member'] = $row[$preview . '_id_member'];]]></search>
			<add><![CDATA[			$preview = 'first';

		$row['body'] = $row[$preview . '_body'];
		$row['subject'] = $row[$preview . '_body'];
		$row['id_msg'] = $row['id_' . $preview . '_msg'];
		$row['icon'] = $row[$preview . '_icon'];
		$row['id_member'] = $row[$preview . '_id_member'];]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[			</tr>';
	echo '
		</table>';
}]]></search>
			<add><![CDATA[			</tr>';
	echo '
		</table>';
}]]></add>
		</operation>
	</file>
	<file name="BOARDDIR/index.php">
		<operation>
			<search position="replace"><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0
 *
 */

$forum_version = 'ElkArte 1.0';

// First things first, but not necessarily in that order.
define('ELK', 1);]]></search>
			<add><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0.1
 *
 */

$forum_version = 'ElkArte 1.0.1';

// First things first, but not necessarily in that order.
define('ELK', 1);]]></add>
		</operation>
	</file>
	<file name="SOURCEDIR/Load.php">
		<operation>
			<search position="replace"><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0
 *
 */
]]></search>
			<add><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0.1
 *
 */
]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[	$context['session_var'] = $_SESSION['session_var'];
	$context['session_id'] = $_SESSION['session_value'];
	$context['forum_name'] = $mbname;
	$context['forum_name_html_safe'] = Util::htmlspecialchars($context['forum_name']);
	$context['current_action'] = isset($_REQUEST['action']) ? $_REQUEST['action'] : null;
	$context['current_subaction'] = isset($_REQUEST['sa']) ? $_REQUEST['sa'] : null;
	$context['can_register'] = empty($modSettings['registration_method']) || $modSettings['registration_method'] != 3;]]></search>
			<add><![CDATA[	$context['session_var'] = $_SESSION['session_var'];
	$context['session_id'] = $_SESSION['session_value'];
	$context['forum_name'] = $mbname;
	$context['forum_name_html_safe'] = $context['forum_name'];
	$context['current_action'] = isset($_REQUEST['action']) ? $_REQUEST['action'] : null;
	$context['current_subaction'] = isset($_REQUEST['sa']) ? $_REQUEST['sa'] : null;
	$context['can_register'] = empty($modSettings['registration_method']) || $modSettings['registration_method'] != 3;]]></add>
		</operation>
	</file>
	<file name="SOURCEDIR/Session.php">
		<operation>
			<search position="replace"><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0
 *
 */
]]></search>
			<add><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0.1
 *
 */
]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[ */
function loadSession()
{
	global $modSettings, $boardurl, $sc, $cache_accelerator;

	// Attempt to change a few PHP settings.
	@ini_set('session.use_cookies', true);]]></search>
			<add><![CDATA[ */
function loadSession()
{
	global $modSettings, $boardurl, $sc;

	// Attempt to change a few PHP settings.
	@ini_set('session.use_cookies', true);]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[		// APC destroys static class members before sessions can be written.  To work around this we
		// explicitly call session_write_close on script end/exit bugs.php.net/bug.php?id=60657
		if (!empty($modSettings['cache_enable']) && $cache_accelerator === 'apc')
			register_shutdown_function('session_write_close');

		// Change it so the cache settings are a little looser than default.]]></search>
			<add><![CDATA[		// APC destroys static class members before sessions can be written.  To work around this we
		// explicitly call session_write_close on script end/exit bugs.php.net/bug.php?id=60657
		if (extension_loaded('apc') && ini_get('apc.enabled') && !extension_loaded('apcu'))
			register_shutdown_function('session_write_close');

		// Change it so the cache settings are a little looser than default.]]></add>
		</operation>
	</file>
	<file name="SOURCEDIR/Subs.php">
		<operation>
			<search position="replace"><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0
 *
 */
]]></search>
			<add><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0.1
 *
 */
]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[	global $txt, $scripturl, $context, $modSettings, $user_info;

	static $bbc_codes = array(), $itemcodes = array(), $no_autolink_tags = array();
	static $disabled;

	// Don't waste cycles
	if ($message === '')]]></search>
			<add><![CDATA[	global $txt, $scripturl, $context, $modSettings, $user_info;

	static $bbc_codes = array(), $itemcodes = array(), $no_autolink_tags = array();
	static $disabled, $default_disabled, $parse_tag_cache;

	// Don't waste cycles
	if ($message === '')]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[		return $message;
	}

	// If we are not doing every tag then we don't cache this run.
	if (!empty($parse_tags) && !empty($bbc_codes))
	{
		$temp_bbc = $bbc_codes;
		$bbc_codes = array();
	}

	// Allow addons access before entering the main parse_bbc loop
	call_integration_hook('integrate_pre_parsebbc', array(&$message, &$smileys, &$cache_id, &$parse_tags));

	// Sift out the bbc for a performance improvement.
	if (empty($bbc_codes) || $message === false || !empty($parse_tags))
	{
		if (!empty($modSettings['disabledBBC']))
		{]]></search>
			<add><![CDATA[		return $message;
	}

	// Allow addons access before entering the main parse_bbc loop
	call_integration_hook('integrate_pre_parsebbc', array(&$message, &$smileys, &$cache_id, &$parse_tags));

	// Sift out the bbc for a performance improvement.
	if (empty($bbc_codes) || $message === false)
	{
		if (!empty($modSettings['disabledBBC']))
		{]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[				'disabled_after' => ' ($1)',
			),
			array(
				'tag' => 'html',
				'type' => 'unparsed_content',
				'content' => '$1',
				'block_level' => true,
				'disabled_content' => '$1',
			),
			array(
				'tag' => 'hr',
				'type' => 'closed',
				'content' => '<hr />',]]></search>
			<add><![CDATA[				'disabled_after' => ' ($1)',
			),
			array(
				'tag' => 'hr',
				'type' => 'closed',
				'content' => '<hr />',]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[				'type' => 'unparsed_content',
				'parameters' => array(
					'alt' => array('optional' => true),
					'width' => array('optional' => true, 'value' => '$1px;', 'match' => '(\d+)'),
					'height' => array('optional' => true, 'value' => '$1px;', 'match' => '(\d+)'),
				),
				'content' => '<img src="$1" alt="{alt}" style="width:{width};height:{height}" class="bbc_img resized" />',
				'validate' => create_function('&$tag, &$data, $disabled', '
					$data = strtr($data, array(\'<br />\' => \'\'));
					if (strpos($data, \'http://\') !== 0 && strpos($data, \'https://\') !== 0)]]></search>
			<add><![CDATA[				'type' => 'unparsed_content',
				'parameters' => array(
					'alt' => array('optional' => true),
					'width' => array('optional' => true, 'value' => 'width:100%;max-width:$1px;', 'match' => '(\d+)'),
					'height' => array('optional' => true, 'value' => 'max-height:$1px;', 'match' => '(\d+)'),
				),
				'content' => '<img src="$1" alt="{alt}" style="{width}{height}" class="bbc_img resized" />',
				'validate' => create_function('&$tag, &$data, $disabled', '
					$data = strtr($data, array(\'<br />\' => \'\'));
					if (strpos($data, \'http://\') !== 0 && strpos($data, \'https://\') !== 0)]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[		}

		foreach ($codes as $code)
		{
			// If we are not doing every tag only do ones we are interested in.
			if (empty($parse_tags) || in_array($code['tag'], $parse_tags))
				$bbc_codes[substr($code['tag'], 0, 1)][] = $code;
		}
	}

	// Shall we take the time to cache this?
	if ($cache_id != '' && !empty($modSettings['cache_enable']) && (($modSettings['cache_enable'] >= 2 && isset($message[1000])) || isset($message[2400])) && empty($parse_tags))]]></search>
			<add><![CDATA[		}

		foreach ($codes as $code)
			$bbc_codes[substr($code['tag'], 0, 1)][] = $code;
	}

	// If we are not doing every enabled tag then create a cache for this parsing group.
	if ($parse_tags !== array() && is_array($parse_tags))
	{
		$temp_bbc = $bbc_codes;
		$tags_cache_id = implode(',', $parse_tags);

		if (!isset($default_disabled))
			$default_disabled = isset($disabled) ? $disabled : array();

		// Already cached, use it, otherwise create it
		if (isset($parse_tag_cache[$tags_cache_id]))
			list ($bbc_codes, $disabled) = $parse_tag_cache[$tags_cache_id];
		else
		{
			foreach ($bbc_codes as $key_bbc => $bbc)
			{
				foreach ($bbc as $key_code => $code)
				{
					if (!in_array($code['tag'], $parse_tags))
					{
						$disabled[$code['tag']] = true;
						unset($bbc_codes[$key_bbc][$key_code]);
					}
				}
			}

			$parse_tag_cache[$tags_cache_id] = array($bbc_codes, $disabled);
		}
	}
	elseif (isset($default_disabled))
		$disabled = $default_disabled;

	// Shall we take the time to cache this?
	if ($cache_id != '' && !empty($modSettings['cache_enable']) && (($modSettings['cache_enable'] >= 2 && isset($message[1000])) || isset($message[2400])) && empty($parse_tags))]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[		$find = array(
			'{forum_name}',
			'{forum_name_html_safe}',
			'{script_url}',
			'{board_url}',
			'{login_url}',]]></search>
			<add><![CDATA[		$find = array(
			'{forum_name}',
			'{forum_name_html_safe}',
			'{forum_name_html_unsafe}',
			'{script_url}',
			'{board_url}',
			'{login_url}',]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[		$replace = array(
			$context['forum_name'],
			$context['forum_name_html_safe'],
			$scripturl,
			$boardurl,
			$scripturl . '?action=login',]]></search>
			<add><![CDATA[		$replace = array(
			$context['forum_name'],
			$context['forum_name_html_safe'],
			un_htmlspecialchars($context['forum_name_html_safe']),
			$scripturl,
			$boardurl,
			$scripturl . '?action=login',]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[	}

	return $response_prefix;
}]]></search>
			<add><![CDATA[	}

	return $response_prefix;
}

/**
 * A very simple function to determine if an email address is "valid" for Elkarte.
 * A valid email for ElkArte is something that resebles an email (filter_var) and
 * is less than 255 characters (for database limits)
 *
 * @param string $value - The string to evaluate as valid email
 * @return bool|string - The email if valid, false if not a valid email
 */
function isValidEmail($value)
{
	$value = trim($value);
	if (filter_var($value, FILTER_VALIDATE_EMAIL) && Util::strlen($value) < 255)
		return $value;
	else
		return false;
}]]></add>
		</operation>
	</file>
	<file name="ADMINDIR/ManageBoards.controller.php">
		<operation>
			<search position="replace"><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0
 *
 */
]]></search>
			<add><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0.1
 *
 */
]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[		// If they want to delete - first give them confirmation.
		elseif (isset($_POST['delete']) && !isset($_POST['confirmation']) && !isset($_POST['empty']))
		{
			// We need a new token.
			validateToken('admin-bc-' . $_REQUEST['cat']);

			$this->action_cat();
			return;
		}]]></search>
			<add><![CDATA[		// If they want to delete - first give them confirmation.
		elseif (isset($_POST['delete']) && !isset($_POST['confirmation']) && !isset($_POST['empty']))
		{
			$this->action_cat();
			return;
		}]]></add>
		</operation>
	</file>
	<file name="ADMINDIR/ManageCalendar.controller.php">
		<operation>
			<search position="replace"><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0
 *
 */
]]></search>
			<add><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0.1
 *
 */
]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[
		// Get the final touches in place.
		$context['post_url'] = $scripturl . '?action=admin;area=managecalendar;save;sa=settings';

		// Saving the settings?
		if (isset($_GET['save']))]]></search>
			<add><![CDATA[
		// Get the final touches in place.
		$context['post_url'] = $scripturl . '?action=admin;area=managecalendar;save;sa=settings';
		$context[$context['admin_menu_name']]['current_subsection'] = 'settings';

		// Saving the settings?
		if (isset($_GET['save']))]]></add>
		</operation>
	</file>
	<file name="ADMINDIR/ManageNews.controller.php">
		<operation>
			<search position="replace"><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0
 *
 */
]]></search>
			<add><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0.1
 *
 */
]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[		// Setup the template!
		$context['page_title'] = $txt['admin_newsletters'];
		$context['sub_template'] = 'email_members_compose';
		$context['subject'] = !empty($_POST['subject']) ? $_POST['subject'] : htmlspecialchars($context['forum_name'] . ': ' . $txt['subject'], ENT_COMPAT, 'UTF-8');
		$context['message'] = !empty($_POST['message']) ? $_POST['message'] : htmlspecialchars($txt['message'] . "\n\n" . replaceBasicActionUrl($txt['regards_team']) . "\n\n" . '{$board_url}', ENT_COMPAT, 'UTF-8');

		// Needed for the WYSIWYG editor.]]></search>
			<add><![CDATA[		// Setup the template!
		$context['page_title'] = $txt['admin_newsletters'];
		$context['sub_template'] = 'email_members_compose';
		$context['subject'] = !empty($_POST['subject']) ? $_POST['subject'] : $context['forum_name'] . ': ' . htmlspecialchars($txt['subject'], ENT_COMPAT, 'UTF-8');
		$context['message'] = !empty($_POST['message']) ? $_POST['message'] : htmlspecialchars($txt['message'] . "\n\n" . replaceBasicActionUrl($txt['regards_team']) . "\n\n" . '{$board_url}', ENT_COMPAT, 'UTF-8');

		// Needed for the WYSIWYG editor.]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[			foreach ($mods as $row)
			{
				if (in_array(3, $context['recipients']))
					$context['recipients']['exclude_members'][] = $row['identifier'];
				else
					$context['recipients']['members'][] = $row['identifier'];
			}
		}
]]></search>
			<add><![CDATA[			foreach ($mods as $row)
			{
				if (in_array(3, $context['recipients']))
					$context['recipients']['exclude_members'][] = $row;
				else
					$context['recipients']['members'][] = $row;
			}
		}
]]></add>
		</operation>
	</file>
	<file name="ADMINDIR/ManagePermissions.controller.php">
		<operation>
			<search position="replace"><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0
 *
 */
]]></search>
			<add><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0.1
 *
 */
]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[				'name' => array(
					'header' => array(
						'value' => $txt['membergroups_name'],
					),
					'data' => array(
						'function' => create_function('$rowData', ']]></search>
			<add><![CDATA[				'name' => array(
					'header' => array(
						'value' => $txt['membergroups_name'],
						'class' => 'grid50',
					),
					'data' => array(
						'function' => create_function('$rowData', ']]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[				'members' => array(
					'header' => array(
						'value' => $txt['membergroups_members_top'],
						'style' => 'width:10%;',
					),
					'data' => array(
						'function' => create_function('$rowData', ']]></search>
			<add><![CDATA[				'members' => array(
					'header' => array(
						'value' => $txt['membergroups_members_top'],
						'class' => 'grid10',
					),
					'data' => array(
						'function' => create_function('$rowData', ']]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[				'permissions_allowed' => array(
					'header' => array(
						'value' => empty($modSettings['permission_enable_deny']) ? $txt['membergroups_permissions'] : $txt['permissions_allowed'],
						'style' => 'width:8%;',
					),
					'data' => array(
						'function' => create_function('$rowData', ']]></search>
			<add><![CDATA[				'permissions_allowed' => array(
					'header' => array(
						'value' => empty($modSettings['permission_enable_deny']) ? $txt['membergroups_permissions'] : $txt['permissions_allowed'],
						'class' => 'grid8',
					),
					'data' => array(
						'function' => create_function('$rowData', ']]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[					'evaluate' => !empty($modSettings['permission_enable_deny']),
					'header' => array(
						'value' => $txt['permissions_denied'],
						'style' => 'width:8%;',
					),
					'data' => array(
						'function' => create_function('$rowData', ']]></search>
			<add><![CDATA[					'evaluate' => !empty($modSettings['permission_enable_deny']),
					'header' => array(
						'value' => $txt['permissions_denied'],
						'class' => 'grid8',
					),
					'data' => array(
						'function' => create_function('$rowData', ']]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[				'modify' => array(
					'header' => array(
						'value' => $context['can_modify'] ? $txt['permissions_modify'] : $txt['permissions_view'],
						'style' => 'width:8%;',
					),
					'data' => array(
						'function' => create_function('$rowData', ']]></search>
			<add><![CDATA[				'modify' => array(
					'header' => array(
						'value' => $context['can_modify'] ? $txt['permissions_modify'] : $txt['permissions_view'],
						'class' => 'grid17',
					),
					'data' => array(
						'function' => create_function('$rowData', ']]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[					'name' => array(
						'header' => array(
							'value' => $txt['membergroups_name'],
						),
						'data' => array(
							'function' => create_function('$rowData', ']]></search>
			<add><![CDATA[					'name' => array(
						'header' => array(
							'value' => $txt['membergroups_name'],
							'class' => 'grid25',
						),
						'data' => array(
							'function' => create_function('$rowData', ']]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[					'required_posts' => array(
						'header' => array(
							'value' => $txt['membergroups_min_posts'],
						),
						'data' => array(
							'db' => 'min_posts',]]></search>
			<add><![CDATA[					'required_posts' => array(
						'header' => array(
							'value' => $txt['membergroups_min_posts'],
							'class' => 'grid25',
						),
						'data' => array(
							'db' => 'min_posts',]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[					'members' => array(
						'header' => array(
							'value' => $txt['membergroups_members_top'],
							'style' => 'width:10%;',
						),
						'data' => array(
							'function' => create_function('$rowData', ']]></search>
			<add><![CDATA[					'members' => array(
						'header' => array(
							'value' => $txt['membergroups_members_top'],
							'class' => 'grid10',
						),
						'data' => array(
							'function' => create_function('$rowData', ']]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[					'permissions_allowed' => array(
						'header' => array(
							'value' => empty($modSettings['permission_enable_deny']) ? $txt['membergroups_permissions'] : $txt['permissions_allowed'],
							'style' => 'width:8%;',
						),
						'data' => array(
							'function' => create_function('$rowData', ']]></search>
			<add><![CDATA[					'permissions_allowed' => array(
						'header' => array(
							'value' => empty($modSettings['permission_enable_deny']) ? $txt['membergroups_permissions'] : $txt['permissions_allowed'],
							'class' => 'grid8',
						),
						'data' => array(
							'function' => create_function('$rowData', ']]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[						'evaluate' => !empty($modSettings['permission_enable_deny']),
						'header' => array(
							'value' => $txt['permissions_denied'],
							'style' => 'width:8%;',
						),
						'data' => array(
							'function' => create_function('$rowData', ']]></search>
			<add><![CDATA[						'evaluate' => !empty($modSettings['permission_enable_deny']),
						'header' => array(
							'value' => $txt['permissions_denied'],
							'class' => 'grid8',
						),
						'data' => array(
							'function' => create_function('$rowData', ']]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[					'modify' => array(
						'header' => array(
							'value' => $txt['modify'],
							'style' => 'width:8%;',
						),
						'data' => array(
							'sprintf' => array(
								'format' => '<a href="' . $scripturl . '?action=admin;area=permissions;sa=modify;group=%1$d' . (isset($_REQUEST['pid']) ? ';pid=' . $_REQUEST['pid'] : '') . '">' . $txt['membergroups_modify'] . '</a>',
								'params' => array(
									'id_group' => false,
								),
							),
						),
					),
					'check' => array(]]></search>
			<add><![CDATA[					'modify' => array(
						'header' => array(
							'value' => $txt['modify'],
							'class' => 'grid17',
						),
						'data' => array(
							'function' => create_function('$rowData', '
								global $scripturl, $txt;

								if ($rowData[\'id_parent\'] == -2)
										return \'<a href="\' . $scripturl . \'?action=admin;area=permissions;sa=modify;group=\' . $rowData[\'id_group\'] . (isset($_REQUEST[\'pid\']) ? \';pid=\' . $_REQUEST[\'pid\'] : \'\') . \'">\' . $txt[\'membergroups_modify\'] . \'</a>\';
									else
										return \'<span class="smalltext">\' . $txt[\'permissions_includes_inherited_from\'] . \'&quot;\' .  $rowData[\'parent_name\'] . \'&quot;\' . \'</span><br /><a href="\' . $scripturl . \'?action=admin;area=permissions;sa=modify;group=\' . $rowData[\'id_parent\'] . (isset($_REQUEST[\'pid\']) ? \';pid=\' . $_REQUEST[\'pid\'] : \'\') . \'">\' . $txt[\'membergroups_modify_parent\'] . \'</a>\';
							'),
						),
					),
					'check' => array(]]></add>
		</operation>
	</file>
	<file name="ADMINDIR/ManageThemes.controller.php">
		<operation>
			<search position="replace"><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0
 *
 *
 * @todo Update this for the new package manager?]]></search>
			<add><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0.1
 *
 *
 * @todo Update this for the new package manager?]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[				elseif ($_POST['default_options_master'][$opt] == 1)
				{
					// Delete then insert for ease of database compatibility!
					removeThemeOptions('default', 'guests', $opt);
					addThemeOptions(1, $opt, $val);

					$old_settings[] = $opt;]]></search>
			<add><![CDATA[				elseif ($_POST['default_options_master'][$opt] == 1)
				{
					// Delete then insert for ease of database compatibility!
					removeThemeOptions('default', 'members', $opt);
					addThemeOptions(1, $opt, $val);

					$old_settings[] = $opt;]]></add>
		</operation>
	</file>
	<file name="ADMINDIR/PackageServers.controller.php">
		<operation>
			<search position="replace"><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0
 *
 */
]]></search>
			<add><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0.1
 *
 */
]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[						if (!empty($package['author']['email']))
						{
							// Only put the "mailto:" if it looks like a valid email address.  Some may wish to put a link to an IM Form or other web mail form.
							$package['author']['href'] = preg_match('~^[\w\.\-]+@[\w][\w\-\.]+[\w]$~', $package['author']['email']) != 0 ? 'mailto:' . $package['author']['email'] : $package['author']['email'];
							$package['author']['link'] = '<a href="' . $package['author']['href'] . '">' . $package['author']['name'] . '</a>';
						}
					}]]></search>
			<add><![CDATA[						if (!empty($package['author']['email']))
						{
							// Only put the "mailto:" if it looks like a valid email address.  Some may wish to put a link to an IM Form or other web mail form.
							$package['author']['href'] = filter_var($package['author']['email'], FILTER_VALIDATE_EMAIL) ? 'mailto:' . $package['author']['email'] : $package['author']['email'];
							$package['author']['link'] = '<a href="' . $package['author']['href'] . '">' . $package['author']['name'] . '</a>';
						}
					}]]></add>
		</operation>
	</file>
	<file name="CONTROLLERDIR/Post.controller.php">
		<operation>
			<search position="replace"><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0
 *
 */
]]></search>
			<add><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0.1
 *
 */
]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[		{
			$context['icons'][count($context['icons']) - 1]['is_last'] = true;
			$context['icons'][0]['selected'] = true;
			$context['icon'] = $context['icons'][0]['value'];
			$context['icon_url'] = $context['icons'][0]['url'];
		}

		// Are we starting a poll? if set the poll icon as selected if its available]]></search>
			<add><![CDATA[		{
			$context['icons'][count($context['icons']) - 1]['is_last'] = true;
			$context['icons'][0]['selected'] = true;
			// $context['icon'] is set when editing a message
			if (!isset($context['icon']))
				$context['icon'] = $context['icons'][0]['value'];
			$found = false;
			foreach ($context['icons'] as $icon)
			{
				if ($icon['value'] === $context['icon'])
				{
					$found = true;
					$context['icon_url'] = $icon['url'];
					break;
				}
			}
			// Failsafe
			if (!$found)
			{
				$context['icon'] = $context['icons'][0]['value'];
				$context['icon_url'] = $context['icons'][0]['url'];
			}
		}

		// Are we starting a poll? if set the poll icon as selected if its available]]></add>
		</operation>
	</file>
	<file name="CONTROLLERDIR/Register.controller.php">
		<operation>
			<search position="replace"><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0
 *
 */
]]></search>
			<add><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0.1
 *
 */
]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[				if ($row['type'] == 'text' && !empty($row['mask']) && $row['mask'] != 'none')
				{
					// @todo We never error on this - just ignore it at the moment...
					if ($row['mask'] == 'email' && (preg_match('~^[0-9A-Za-z=_+\-/][0-9A-Za-z=_\'+\-/\.]*@[\w\-]+(\.[\w\-]+)*(\.[\w]{2,6})$~', $value) === 0 || strlen($value) > 255))
						$reg_errors->addError(array('custom_field_invalid_email', array($row['name'])));
					elseif ($row['mask'] == 'number' && preg_match('~[^\d]~', $value))
						$reg_errors->addError(array('custom_field_not_number', array($row['name'])));]]></search>
			<add><![CDATA[				if ($row['type'] == 'text' && !empty($row['mask']) && $row['mask'] != 'none')
				{
					// @todo We never error on this - just ignore it at the moment...
					if ($row['mask'] == 'email' && !isValidEmail($value))
						$reg_errors->addError(array('custom_field_invalid_email', array($row['name'])));
					elseif ($row['mask'] == 'number' && preg_match('~[^\d]~', $value))
						$reg_errors->addError(array('custom_field_not_number', array($row['name'])));]]></add>
		</operation>
	</file>
	<file name="CONTROLLERDIR/SplitTopics.controller.php">
		<operation>
			<search position="replace"><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0
 *
 * Original module by Mach8 - We'll never forget you.
 */]]></search>
			<add><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0.1
 *
 * Original module by Mach8 - We'll never forget you.
 */]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[		$context['old_topic'] = $topic;
		$context['new_topic'] = splitTopic($topic, $_SESSION['split_selection'][$topic], $this->_new_topic_subject);
		$context['page_title'] = $txt['split_topic'];

		splitAttemptMove($boards, $context['new_topic']);
	}]]></search>
			<add><![CDATA[		$context['old_topic'] = $topic;
		$context['new_topic'] = splitTopic($topic, $_SESSION['split_selection'][$topic], $this->_new_topic_subject);
		$context['page_title'] = $txt['split_topic'];
		$context['sub_template'] = 'split_successful';

		splitAttemptMove($boards, $context['new_topic']);
	}]]></add>
		</operation>
	</file>
	<file name="SUBSDIR/Likes.subs.php">
		<operation>
			<search position="replace"><![CDATA[ * @copyright ElkArte Forum contributors
 * @license   BSD http://opensource.org/licenses/BSD-3-Clause
 *
 * @version 1.0
 *
 */
]]></search>
			<add><![CDATA[ * @copyright ElkArte Forum contributors
 * @license   BSD http://opensource.org/licenses/BSD-3-Clause
 *
 * @version 1.0.1
 *
 */
]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[	{
		$db->insert('',
			'{db_prefix}message_likes',
			array('id_member' => 'int', 'id_msg' => 'int', 'id_poster' => 'int'),
			array($id_liker, $liked_message['id_msg'], $liked_message['id_member']),
			array('id_msg', 'id_member', 'id_poster')
		);
]]></search>
			<add><![CDATA[	{
		$db->insert('',
			'{db_prefix}message_likes',
			array('id_member' => 'int', 'id_msg' => 'int', 'id_poster' => 'int', 'like_timestamp' => 'int',),
			array($id_liker, $liked_message['id_msg'], $liked_message['id_member'], time()),
			array('id_msg', 'id_member', 'id_poster')
		);
]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[	$db->free_result($request);

	return (int) $total;
}]]></search>
			<add><![CDATA[	$db->free_result($request);

	return (int) $total;
}]]></add>
		</operation>
	</file>
	<file name="SUBSDIR/Mail.subs.php">
		<operation>
			<search position="replace"><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:  	BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0
 *
 */
]]></search>
			<add><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:  	BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0.1
 *
 */
]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[	// Add our email back to the queue, manually.
	$db->insert('insert',
		'{db_prefix}mail_queue',
		array('time_sent' => 'int', 'recipient' => 'string', 'body' => 'string', 'subject' => 'string', 'headers' => 'string', 'send_html' => 'int', 'priority' => 'int', 'private' => 'int', 'message_id' => 'int'),
		$failed_emails,
		array('id_mail')
	);]]></search>
			<add><![CDATA[	// Add our email back to the queue, manually.
	$db->insert('insert',
		'{db_prefix}mail_queue',
		array('time_sent' => 'int', 'recipient' => 'string', 'body' => 'string', 'subject' => 'string', 'headers' => 'string', 'send_html' => 'int', 'priority' => 'int', 'private' => 'int', 'message_id' => 'string-255'),
		$failed_emails,
		array('id_mail')
	);]]></add>
		</operation>
	</file>
	<file name="SUBSDIR/Membergroups.subs.php">
		<operation>
			<search position="replace"><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:  	BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0
 *
 */
]]></search>
			<add><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:  	BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0.1
 *
 */
]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[	// Start collecting the data.
	$groups = array();
	$group_ids = array();

	if ($membergroup_type === 'all')
	{]]></search>
			<add><![CDATA[	// Start collecting the data.
	$groups = array();
	$group_ids = array();
	$parent_groups = array();

	if ($membergroup_type === 'all')
	{]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[				'num_members' => $txt['membergroups_guests_na'],
				'icons' => '',
				'can_search' => false,
				'num_permissions' => array(
					'allowed' => 0,
					'denied' => 0,]]></search>
			<add><![CDATA[				'num_members' => $txt['membergroups_guests_na'],
				'icons' => '',
				'can_search' => false,
				'id_parent' => -2,
				'num_permissions' => array(
					'allowed' => 0,
					'denied' => 0,]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[				'num_members' => $num_members,
				'icons' => '',
				'can_search' => true,
				'num_permissions' => array(
					'allowed' => 0,
					'denied' => 0,]]></search>
			<add><![CDATA[				'num_members' => $num_members,
				'icons' => '',
				'can_search' => true,
				'id_parent' => -2,
				'num_permissions' => array(
					'allowed' => 0,
					'denied' => 0,]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[		if ($row['hidden'] && !$row['can_moderate'] && !$include_hidden)
			continue;

		// If it's inherited, just add it as a child.
		if ($aggregate && $row['id_parent'] != -2)
		{]]></search>
			<add><![CDATA[		if ($row['hidden'] && !$row['can_moderate'] && !$include_hidden)
			continue;

		if ($row['id_parent'] != -2)
			$parent_groups[] = $row['id_parent'];

		// If it's inherited, just add it as a child.
		if ($aggregate && $row['id_parent'] != -2)
		{]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[			'moderators' => array(),
			'icons' => $row['icons'],
			'can_search' => $row['id_group'] != 3,
		);

		if ($count_permissions)]]></search>
			<add><![CDATA[			'moderators' => array(),
			'icons' => $row['icons'],
			'can_search' => $row['id_group'] != 3,
			'id_parent' => $row['id_parent'],
		);

		if ($count_permissions)]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[		$db->free_result($query);
	}

	// Apply manual sorting if the 'number of members' column is selected.
	if (substr($sort, 0, 1) == '1' || strpos($sort, ', 1') !== false)
	{]]></search>
			<add><![CDATA[		$db->free_result($query);
	}

	if (!empty($parent_groups))
	{
		$all_group_names = array(
			-1 => $txt['membergroups_guests'],
			0 => $txt['membergroups_members']
		);
		$request = $db->query('', '
			SELECT id_group, group_name
			FROM {db_prefix}membergroups
			WHERE id_group IN ({array_int:groups})',
			array(
				'groups' => $parent_groups,
			)
		);
		while ($row = $db->fetch_assoc($request))
			$all_group_names[$row['id_group']] = $row['group_name'];
	}
	foreach ($groups as $key => $group)
	{
		if ($group['id_parent'] != -2)
		{
			$groups[$key]['parent_name'] = $all_group_names[$group['id_parent']];
		}
	}

	// Apply manual sorting if the 'number of members' column is selected.
	if (substr($sort, 0, 1) == '1' || strpos($sort, ', 1') !== false)
	{]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[			switch ($known_properties[$name]['type'])
			{
				case 'string':
					$values['subs_' . $name] = Util::htmlspecialchars($value);
					break;
				default:
					$values['subs_' . $name] = (int) $value;]]></search>
			<add><![CDATA[			switch ($known_properties[$name]['type'])
			{
				case 'string':
					$values['subs_' . $name] = Util::htmlspecialchars((string) $value);
					break;
				default:
					$values['subs_' . $name] = (int) $value;]]></add>
		</operation>
	</file>
	<file name="SUBSDIR/Post.subs.php">
		<operation>
			<search position="replace"><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:  	BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0
 *
 */
]]></search>
			<add><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:  	BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0.1
 *
 */
]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[				$parts[$i] = preg_replace('~(\[footnote\])/me(?: |&nbsp;)([^\n]*?)(\[\/footnote\])~i', '$1[me=' . $user_info['name'] . ']$2[/me]$3', $parts[$i]);
			}

			if (!$previewing && strpos($parts[$i], '[html]') !== false)
			{
				if (allowedTo('admin_forum'))
					$parts[$i] = preg_replace_callback('~\[html\](.+?)\[/html\]~is', 'preparsecode_html_callback', $parts[$i]);
				// We should edit them out, or else if an admin edits the message they will get shown...
				else
				{
					while (strpos($parts[$i], '[html]') !== false)
						$parts[$i] = preg_replace('~\[[/]?html\]~i', '', $parts[$i]);
				}
			}

			// Make sure all tags are lowercase.
			$parts[$i] = preg_replace_callback('~\[([/]?)(list|li|table|tr|td|th)((\s[^\]]+)*)\]~i', 'preparsecode_lowertags_callback', $parts[$i]);
]]></search>
			<add><![CDATA[				$parts[$i] = preg_replace('~(\[footnote\])/me(?: |&nbsp;)([^\n]*?)(\[\/footnote\])~i', '$1[me=' . $user_info['name'] . ']$2[/me]$3', $parts[$i]);
			}

			// Make sure all tags are lowercase.
			$parts[$i] = preg_replace_callback('~\[([/]?)(list|li|table|tr|td|th)((\s[^\]]+)*)\]~i', 'preparsecode_lowertags_callback', $parts[$i]);
]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[}

/**
 * Prepares text inside of html tags to make them safe for display and prevent bbc rendering
 *
 * @package Posts
 * @param string[] $matches
 */
function preparsecode_html_callback($matches)
{
	return '[html]' . strtr(un_htmlspecialchars($matches[1]), array("\n" => '&#13;', '  ' => ' &#32;', '[' => '&#91;', ']' => '&#93;')) . '[/html]';
}

/**
 * Takes a tag and lowercases it
 *
 * @package Posts]]></search>
			<add><![CDATA[}

/**
 * Takes a tag and lowercases it
 *
 * @package Posts]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[	// We're going to unparse only the stuff outside [code]...
	for ($i = 0, $n = count($parts); $i < $n; $i++)
	{
		// If $i is a multiple of four (0, 4, 8, ...) then it's not a code section...
		if ($i % 4 == 0)
			$parts[$i] = preg_replace_callback('~\[html\](.+?)\[/html\]~i', 'preparsecode_unhtml_callback', $parts[$i]);

		call_integration_hook('integrate_unpreparse_code', array(&$message, &$parts, &$i));
	}
]]></search>
			<add><![CDATA[	// We're going to unparse only the stuff outside [code]...
	for ($i = 0, $n = count($parts); $i < $n; $i++)
	{
		call_integration_hook('integrate_unpreparse_code', array(&$message, &$parts, &$i));
	}
]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[}

/**
 * Reverses what was done by preparsecode to html tags
 *
 * @package Posts
 * @param string[] $matches
 */
function preparsecode_unhtml_callback($matches)
{
	return '[html]' . strtr(htmlspecialchars($matches[1], ENT_QUOTES, 'UTF-8'), array('\\&quot;' => '&quot;', '&amp;#13;' => '<br />', '&amp;#32;' => ' ', '&amp;#91;' => '[', '&amp;#93;' => ']')) . '[/html]';
}

/**
 * Fix any URLs posted - ie. remove 'javascript:'.
 *
 * - Used by preparsecode, fixes links in message and returns nothing.]]></search>
			<add><![CDATA[}

/**
 * Fix any URLs posted - ie. remove 'javascript:'.
 *
 * - Used by preparsecode, fixes links in message and returns nothing.]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[}

/**
 * Converts br's to entity safe versions <br /> => $lt;br /&gt;<br /> so messages
 * with bbc html tags can be edited
 *
 * @package Posts
 * @param string[] $matches
 */
function getFormMsgSubject_br_callback($matches)
{
	return '[html]' . preg_replace('~<br\s?/?' . '>~i', '&lt;br /&gt;<br />', $matches[1]) . '[/html]';
}

/**
 * Update topic subject.
 *
 * - If $all is true, for all messages in the topic, otherwise only the first message.]]></search>
			<add><![CDATA[}

/**
 * Update topic subject.
 *
 * - If $all is true, for all messages in the topic, otherwise only the first message.]]></add>
		</operation>
	</file>
	<file name="SUBSDIR/Profile.subs.php">
		<operation>
			<search position="replace"><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:  	BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0
 *
 */
]]></search>
			<add><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:  	BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0.1
 *
 */
]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[			if ($row['field_type'] == 'text' && !empty($row['mask']) && $row['mask'] != 'none')
			{
				// @todo We never error on this - just ignore it at the moment...
				if ($row['mask'] == 'email' && (preg_match('~^[0-9A-Za-z=_+\-/][0-9A-Za-z=_\'+\-/\.]*@[\w\-]+(\.[\w\-]+)*(\.[\w]{2,6})$~', $value) === 0 || strlen($value) > 255))
					$value = '';
				elseif ($row['mask'] == 'number')
					$value = (int) $value;]]></search>
			<add><![CDATA[			if ($row['field_type'] == 'text' && !empty($row['mask']) && $row['mask'] != 'none')
			{
				// @todo We never error on this - just ignore it at the moment...
				if ($row['mask'] == 'email' && !isValidEmail($value))
					$value = '';
				elseif ($row['mask'] == 'number')
					$value = (int) $value;]]></add>
		</operation>
	</file>
	<file name="SUBSDIR/ScheduledTask.class.php">
		<operation>
			<search position="replace"><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:  	BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0
 *
 */
]]></search>
			<add><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:  	BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0.1
 *
 */
]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[					SELECT id_report
					FROM {db_prefix}log_reported
					WHERE time_started < {int:time_started}
						AND closed = {int:not_closed}
						AND ignore_all = {int:not_ignored}',
					array(
						'time_started' => $t,
						'not_closed' => 0,
						'not_ignored' => 0,
					)
				);
				while ($row = $db->fetch_row($result))]]></search>
			<add><![CDATA[					SELECT id_report
					FROM {db_prefix}log_reported
					WHERE time_started < {int:time_started}
						AND closed = {int:closed}',
					array(
						'time_started' => $t,
						'closed' => 1,
					)
				);
				while ($row = $db->fetch_row($result))]]></add>
		</operation>
	</file>
	<file name="SUBSDIR/SettingsForm.class.php">
		<operation>
			<search position="replace"><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:  	BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0
 *
 *
 * Adding options to one of the setting screens isn't hard.]]></search>
			<add><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:  	BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0.1
 *
 *
 * Adding options to one of the setting screens isn't hard.]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[			'cachedir',
		);

		foreach ($this->_config_vars as $identifier => $config_var)
		{
			if (!is_array($config_var) || !isset($config_var[1]))]]></search>
			<add><![CDATA[			'cachedir',
		);

		$safe_strings = array(
			'mtitle', 'mmessage', 'mbname',
		);

		foreach ($this->_config_vars as $identifier => $config_var)
		{
			if (!is_array($config_var) || !isset($config_var[1]))]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[					$config_var[1] = substr($config_var[1], 0, $divPos);
				}

				$context['config_vars'][$config_var[0]] = array(
					'label' => $config_var[1],
					'help' => isset($config_var[5]) ? $config_var[5] : '',]]></search>
			<add><![CDATA[					$config_var[1] = substr($config_var[1], 0, $divPos);
				}

				if ($config_var[2] == 'file')
				{
					$value = in_array($varname, $defines) ? constant(strtoupper($varname)) : htmlspecialchars($$varname, ENT_COMPAT, 'UTF-8');
					if (in_array($varname, $safe_strings))
						$value = htmlspecialchars_decode($value, ENT_NOQUOTES);
				}
				else
					$value = isset($modSettings[$config_var[0]]) ? htmlspecialchars($modSettings[$config_var[0]], ENT_COMPAT, 'UTF-8') : (in_array($config_var[3], array('int', 'float')) ? 0 : '');

				$context['config_vars'][$config_var[0]] = array(
					'label' => $config_var[1],
					'help' => isset($config_var[5]) ? $config_var[5] : '',]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[					'size' => empty($config_var[4]) ? 0 : $config_var[4],
					'data' => isset($config_var[4]) && is_array($config_var[4]) && $config_var[3] != 'select' ? $config_var[4] : array(),
					'name' => $config_var[0],
					'value' => $config_var[2] == 'file' ? (in_array($varname, $defines) ? constant(strtoupper($varname)) : htmlspecialchars($$varname, ENT_COMPAT, 'UTF-8')) : (isset($modSettings[$config_var[0]]) ? htmlspecialchars($modSettings[$config_var[0]], ENT_COMPAT, 'UTF-8') : (in_array($config_var[3], array('int', 'float')) ? 0 : '')),
					'disabled' => !empty($context['settings_not_writable']) || !empty($config_var['disabled']),
					'invalid' => false,
					'subtext' => !empty($config_var['subtext']) ? $config_var['subtext'] : $subtext,]]></search>
			<add><![CDATA[					'size' => empty($config_var[4]) ? 0 : $config_var[4],
					'data' => isset($config_var[4]) && is_array($config_var[4]) && $config_var[3] != 'select' ? $config_var[4] : array(),
					'name' => $config_var[0],
					'value' => $value,
					'disabled' => !empty($context['settings_not_writable']) || !empty($config_var['disabled']),
					'invalid' => false,
					'subtext' => !empty($config_var['subtext']) ? $config_var['subtext'] : $subtext,]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[					if ($config_var[0] == 'select' && !empty($config_var['multiple']))
					{
						$context['config_vars'][$config_var[1]]['name'] .= '[]';
						$context['config_vars'][$config_var[1]]['value'] = unserialize($context['config_vars'][$config_var[1]]['value']);
					}

					// If it's associative]]></search>
			<add><![CDATA[					if ($config_var[0] == 'select' && !empty($config_var['multiple']))
					{
						$context['config_vars'][$config_var[1]]['name'] .= '[]';
						$context['config_vars'][$config_var[1]]['value'] = !empty($context['config_vars'][$config_var[1]]['value']) ? unserialize($context['config_vars'][$config_var[1]]['value']) : array();
					}

					// If it's associative]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[			'cache_accelerator', 'cache_memcached', 'cache_uid',
		);

		// All the numeric variables.
		$config_ints = array(
			'cache_enable',]]></search>
			<add><![CDATA[			'cache_accelerator', 'cache_memcached', 'cache_uid',
		);

		$safe_strings = array(
			'mtitle', 'mmessage', 'mbname',
		);

		// All the numeric variables.
		$config_ints = array(
			'cache_enable',]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[		foreach ($config_strs as $config_var)
		{
			if (isset($_POST[$config_var]))
				$new_settings[$config_var] = '\'' . addcslashes($_POST[$config_var], '\'\\') . '\'';
		}

		foreach ($config_ints as $config_var)]]></search>
			<add><![CDATA[		foreach ($config_strs as $config_var)
		{
			if (isset($_POST[$config_var]))
			{
				if (in_array($config_var, $safe_strings))
					$new_settings[$config_var] = '\'' . addcslashes(Util::htmlspecialchars($_POST[$config_var], ENT_QUOTES), '\'\\') . '\'';
				else
					$new_settings[$config_var] = '\'' . addcslashes($_POST[$config_var], '\'\\') . '\'';
			}
		}

		foreach ($config_ints as $config_var)]]></add>
		</operation>
	</file>
	<file name="SUBSDIR/Themes.subs.php">
		<operation>
			<search position="replace"><![CDATA[ * @copyright ElkArte Forum contributors
 * @license   BSD http://opensource.org/licenses/BSD-3-Clause
 *
 * @version 1.0
 *
 */
]]></search>
			<add><![CDATA[ * @copyright ElkArte Forum contributors
 * @license   BSD http://opensource.org/licenses/BSD-3-Clause
 *
 * @version 1.0.1
 *
 */
]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[{
	$db = database();

	// The default theme is 1 (id_theme = 1)
	if ($theme === 'default')
		$query_param = array('theme_operator' => '=', 'theme' => 1);]]></search>
			<add><![CDATA[{
	$db = database();

	$query_param = array();

	// The default theme is 1 (id_theme = 1)
	if ($theme === 'default')
		$query_param = array('theme_operator' => '=', 'theme' => 1);]]></add>
		</operation>
	</file>
	<file name="THEMEDIR/Display.template.php">
		<operation>
			<search position="replace"><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:  	BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0
 *
 */
]]></search>
			<add><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:  	BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0.1
 *
 */
]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[		// Maybe they can modify the post (this is the more button)
		if ($message['can_modify'] || ($context['can_report_moderator']))
			echo '
							<li class="listlevel1 subsections" aria-haspopup="true"><a href="#" onclick="event.stopPropagation();return false;" class="linklevel1 post_options">', $txt['post_options'], '</a>';

		if ($message['can_modify'] || $message['can_remove'] || $context['can_follow_up'] || ($context['can_split'] && !empty($context['real_num_replies'])) || $context['can_restore_msg'] || $message['can_approve'] || $message['can_unapprove'] || $context['can_report_moderator'])
		{]]></search>
			<add><![CDATA[		// Maybe they can modify the post (this is the more button)
		if ($message['can_modify'] || ($context['can_report_moderator']))
			echo '
							<li class="listlevel1 subsections" aria-haspopup="true"><a href="#" ', !empty($options['use_click_menu']) ? '' : 'onclick="event.stopPropagation();return false;" ', 'class="linklevel1 post_options">', $txt['post_options'], '</a>';

		if ($message['can_modify'] || $message['can_remove'] || $context['can_follow_up'] || ($context['can_split'] && !empty($context['real_num_replies'])) || $context['can_restore_msg'] || $message['can_approve'] || $message['can_unapprove'] || $context['can_report_moderator'])
		{]]></add>
		</operation>
	</file>
	<file name="THEMEDIR/ManageBoards.template.php">
		<operation>
			<search position="replace"><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:  	BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0
 *
 */
]]></search>
			<add><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:  	BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0.1
 *
 */
]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[	else
		echo '
						<input type="submit" name="edit" value="', $txt['modify'], '" onclick="return !isEmptyText(this.form.cat_name);" tabindex="', $context['tabindex']++, '" class="button_submit" />
						<input type="submit" name="delete" value="', $txt['mboards_delete_cat'], '" onclick="return confirm(\'', $txt['catConfirm'], '\');" class="button_submit" />';

	echo '
						<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />';]]></search>
			<add><![CDATA[	else
		echo '
						<input type="submit" name="edit" value="', $txt['modify'], '" onclick="return !isEmptyText(this.form.cat_name);" tabindex="', $context['tabindex']++, '" class="button_submit" />
						<input type="submit" name="delete" value="', $txt['mboards_delete_cat'], '" class="button_submit" />';

	echo '
						<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />';]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[	echo '
						</select>
					</p>
					<input type="submit" name="delete" value="', $txt['mboards_delete_confirm'], '" class="button_submit" />
					<input type="submit" name="cancel" value="', $txt['mboards_delete_cancel'], '" class="button_submit" />
					<input type="hidden" name="confirmation" value="1" />
					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
				</div>
			</div>
		</form>]]></search>
			<add><![CDATA[	echo '
						</select>
					</p>
					<input type="submit" name="delete" value="', $txt['mboards_delete_confirm'], '" class="button_submit" onclick="return confirm(\'', $txt['catConfirm'], '\');" />
					<input type="submit" name="cancel" value="', $txt['mboards_delete_cancel'], '" class="button_submit" />
					<input type="hidden" name="confirmation" value="1" />
					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />';

		if (!empty($context['token_check']))
		echo '
					<input type="hidden" name="', $context[$context['token_check'] . '_token_var'], '" value="', $context[$context['token_check'] . '_token'], '" />';

	echo '
				</div>
			</div>
		</form>]]></add>
		</operation>
	</file>
	<file name="THEMEDIR/MessageIndex.template.php">
		<operation>
			<search position="replace"><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:  	BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0
 *
 */
]]></search>
			<add><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:  	BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0.1
 *
 */
]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[						echo '<a class="topicicon img_remove" href="', $scripturl, '?action=quickmod;board=', $context['current_board'], '.', $context['start'], ';actions%5B', $topic['id'], '%5D=remove;', $context['session_var'], '=', $context['session_id'], '" onclick="return confirm(\'', $txt['quickmod_confirm'], '\');" title="', $txt['remove_topic'], '"></a>';

					if ($topic['quick_mod']['lock'])
						echo '<a class="topicicon img_locked" href="', $scripturl, '?action=quickmod;board=', $context['current_board'], '.', $context['start'], ';actions%5B', $topic['id'], '%5D=lock;', $context['session_var'], '=', $context['session_id'], '" onclick="return confirm(\'', $txt['quickmod_confirm'], '\');" title="', $txt['set_lock'], '"></a>';

					if ($topic['quick_mod']['lock'] || $topic['quick_mod']['remove'])
						echo '<br />';

					if ($topic['quick_mod']['sticky'])
						echo '<a class="topicicon img_sticky" href="', $scripturl, '?action=quickmod;board=', $context['current_board'], '.', $context['start'], ';actions%5B', $topic['id'], '%5D=sticky;', $context['session_var'], '=', $context['session_id'], '" onclick="return confirm(\'', $txt['quickmod_confirm'], '\');" title="', $txt['set_sticky'], '"></a>';

					if ($topic['quick_mod']['move'])
						echo '<a class="topicicon img_move" href="', $scripturl, '?action=movetopic;current_board=', $context['current_board'], ';board=', $context['current_board'], '.', $context['start'], ';topic=', $topic['id'], '.0" title="', $txt['move_topic'], '"></a>';]]></search>
			<add><![CDATA[						echo '<a class="topicicon img_remove" href="', $scripturl, '?action=quickmod;board=', $context['current_board'], '.', $context['start'], ';actions%5B', $topic['id'], '%5D=remove;', $context['session_var'], '=', $context['session_id'], '" onclick="return confirm(\'', $txt['quickmod_confirm'], '\');" title="', $txt['remove_topic'], '"></a>';

					if ($topic['quick_mod']['lock'])
						echo '<a class="topicicon img_locked" href="', $scripturl, '?action=quickmod;board=', $context['current_board'], '.', $context['start'], ';actions%5B', $topic['id'], '%5D=lock;', $context['session_var'], '=', $context['session_id'], '" onclick="return confirm(\'', $txt['quickmod_confirm'], '\');" title="', $txt[$topic['is_locked'] ? 'set_unlock' : 'set_lock'], '"></a>';

					if ($topic['quick_mod']['lock'] || $topic['quick_mod']['remove'])
						echo '<br />';

					if ($topic['quick_mod']['sticky'])
						echo '<a class="topicicon img_sticky" href="', $scripturl, '?action=quickmod;board=', $context['current_board'], '.', $context['start'], ';actions%5B', $topic['id'], '%5D=sticky;', $context['session_var'], '=', $context['session_id'], '" onclick="return confirm(\'', $txt['quickmod_confirm'], '\');" title="', $txt[$topic['is_sticky'] ? 'set_nonsticky' : 'set_sticky'], '"></a>';

					if ($topic['quick_mod']['move'])
						echo '<a class="topicicon img_move" href="', $scripturl, '?action=movetopic;current_board=', $context['current_board'], ';board=', $context['current_board'], '.', $context['start'], ';topic=', $topic['id'], '.0" title="', $txt['move_topic'], '"></a>';]]></add>
		</operation>
	</file>
	<file name="THEMEDIR/Search.template.php">
		<operation>
			<search position="replace"><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:  	BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0
 *
 */
]]></search>
			<add><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:  	BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0.1
 *
 */
]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[
					if ($topic['quick_mod']['lock'])
						echo '
							<a href="', $scripturl, '?action=quickmod;actions%5B', $topic['id'], '%5D=lock;', $context['session_var'], '=', $context['session_id'], '" onclick="return confirm(\'', $txt['quickmod_confirm'], '\');"><img src="', $settings['images_url'], '/icons/quick_lock.png" style="width: 16px;" alt="', $txt['set_lock'], '" title="', $txt['set_lock'], '" /></a>';

					if ($topic['quick_mod']['lock'] || $topic['quick_mod']['remove'])
						echo ']]></search>
			<add><![CDATA[
					if ($topic['quick_mod']['lock'])
						echo '
							<a href="', $scripturl, '?action=quickmod;actions%5B', $topic['id'], '%5D=lock;', $context['session_var'], '=', $context['session_id'], '" onclick="return confirm(\'', $txt['quickmod_confirm'], '\');"><img src="', $settings['images_url'], '/icons/quick_lock.png" style="width: 16px;" alt="', $txt[$topic['is_locked'] ? 'set_unlock' : 'set_lock'], '" title="', $txt[$topic['is_locked'] ? 'set_unlock' : 'set_lock'], '" /></a>';

					if ($topic['quick_mod']['lock'] || $topic['quick_mod']['remove'])
						echo ']]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[
					if ($topic['quick_mod']['sticky'])
						echo '
							<a href="', $scripturl, '?action=quickmod;actions%5B', $topic['id'], '%5D=sticky;', $context['session_var'], '=', $context['session_id'], '" onclick="return confirm(\'', $txt['quickmod_confirm'], '\');"><img src="', $settings['images_url'], '/icons/quick_sticky.png" style="width: 16px;" alt="', $txt['set_sticky'], '" title="', $txt['set_sticky'], '" /></a>';

					if ($topic['quick_mod']['move'])
						echo ']]></search>
			<add><![CDATA[
					if ($topic['quick_mod']['sticky'])
						echo '
							<a href="', $scripturl, '?action=quickmod;actions%5B', $topic['id'], '%5D=sticky;', $context['session_var'], '=', $context['session_id'], '" onclick="return confirm(\'', $txt['quickmod_confirm'], '\');"><img src="', $settings['images_url'], '/icons/quick_sticky.png" style="width: 16px;" alt="', $txt[$topic['is_sticky'] ? 'set_nonsticky' : 'set_sticky'], '" title="', $txt[$topic['is_sticky'] ? 'set_nonsticky' : 'set_sticky'], '" /></a>';

					if ($topic['quick_mod']['move'])
						echo ']]></add>
		</operation>
	</file>
	<file name="THEMEDIR/css/index.css">
		<operation>
			<search position="replace"><![CDATA[	overflow: auto;
}
#post_confirm_buttons {
	padding: 0 0 1px 0;
}

/* @todo - Test this out some more. */]]></search>
			<add><![CDATA[	overflow: auto;
}
#post_confirm_buttons {
	padding: 0 1px 1px 0;
}

/* @todo - Test this out some more. */]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[}
.top_button {
	line-height: 1.286em;
	padding: 2px;
	margin-left: 1px;
	vertical-align: top;]]></search>
			<add><![CDATA[}
.top_button {
	line-height: 1.286em;
	max-height: 1.357em;
	padding: 2px;
	margin-left: 1px;
	vertical-align: top;]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[	border: none;
	white-space: nowrap;
}

/* Nifty indicators. */
.linktree:after {]]></search>
			<add><![CDATA[	border: none;
	white-space: nowrap;
}
.linktree:last-child {
	max-width: 25em;
}
.linktree a {
	display: block;
	overflow: hidden;
	text-overflow: ellipsis;
}

/* Nifty indicators. */
.linktree:after {]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[	padding: 2px 4px;
	vertical-align: top;
	text-align: left;
}
.recentpost {
	width: 40%;]]></search>
			<add><![CDATA[	padding: 2px 4px;
	vertical-align: top;
	text-align: left;
	overflow: hidden;
	text-overflow: ellipsis;
	max-width: 40em;
}
.recentpost {
	width: 40%;]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[#unread_header {
	margin-top: 0.5em;
}
/* The board description and who-is-viewing stuff. */
#description_board {
	margin: 10px 0 0 0;]]></search>
			<add><![CDATA[#unread_header {
	margin-top: 0.5em;
}

/* The header abover the posts */
#forumposts .category_header {
	overflow: hidden;
	text-overflow: ellipsis;
}

/* The board description and who-is-viewing stuff. */
#description_board {
	margin: 10px 0 0 0;]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[	line-height: 1.429em;
	display: inline-block;
	padding-right: 30px;
}
.topic_name h4 a {
	font-weight: bold;]]></search>
			<add><![CDATA[	line-height: 1.429em;
	display: inline-block;
	padding-right: 30px;
	word-break: break-all;
    word-wrap: break-word;
}
.topic_name h4 a {
	font-weight: bold;]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[		min-width: 300px;
	}
	#main_content_section {
		padding: 1px 2px 16px 3px;
	}
	#search_form .input_text {
		width: 7em;]]></search>
			<add><![CDATA[		min-width: 300px;
	}
	#main_content_section {
		padding: 1px 1px 16px 0;
	}
	#search_form .input_text {
		width: 7em;]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[	}
	#gobottom, #gotop {
		padding-right: 0.25em;
	}
	#message_index_jump_to {
		display: block;]]></search>
			<add><![CDATA[	}
	#gobottom, #gotop {
		padding-right: 0.25em;
		display: none;
	}
	#message_index_jump_to {
		display: block;]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[	.pm_icon, .pm_quickmod, .label_pms {
		display: none;
	}
	.popup_window {
		width: 95%;
	}
	.poster .menulevel2 {]]></search>
			<add><![CDATA[	.pm_icon, .pm_quickmod, .label_pms {
		display: none;
	}
	.popup_container .popup_window {
		width: 95%;
	}
	.poster .menulevel2 {]]></add>
		</operation>
	</file>
	<file name="LANGUAGEDIR/english/ManageMembers.english.php">
		<operation>
			<search position="replace"><![CDATA[$txt['membergroups_title'] = 'Manage Membergroups';
$txt['membergroups_description'] = 'Membergroups are groups of members that have similar permission settings, appearance, or access rights. Some membergroups are based on the amount of posts a user has made. You can assign someone to a membergroup by selecting their profile and changing their account settings.';
$txt['membergroups_modify'] = 'Modify';

$txt['membergroups_add_group'] = 'Add group';
$txt['membergroups_regular'] = 'Regular groups';]]></search>
			<add><![CDATA[$txt['membergroups_title'] = 'Manage Membergroups';
$txt['membergroups_description'] = 'Membergroups are groups of members that have similar permission settings, appearance, or access rights. Some membergroups are based on the amount of posts a user has made. You can assign someone to a membergroup by selecting their profile and changing their account settings.';
$txt['membergroups_modify'] = 'Modify';
$txt['membergroups_modify_parent'] = 'Modify parent group';

$txt['membergroups_add_group'] = 'Add group';
$txt['membergroups_regular'] = 'Regular groups';]]></add>
		</operation>
	</file>
	<file name="LANGUAGEDIR/english/ManagePermissions.english.php">
		<operation>
			<search position="replace"><![CDATA[$txt['permissions_profile_copy_from'] = 'Copy Permissions From';

$txt['permissions_includes_inherited'] = 'Inherited Groups';

$txt['permissions_all'] = 'all';
$txt['permissions_none'] = 'none';]]></search>
			<add><![CDATA[$txt['permissions_profile_copy_from'] = 'Copy Permissions From';

$txt['permissions_includes_inherited'] = 'Inherited Groups';
$txt['permissions_includes_inherited_from'] = 'Inherited from: ';

$txt['permissions_all'] = 'all';
$txt['permissions_none'] = 'none';]]></add>
		</operation>
	</file>
	<file name="LANGUAGEDIR/english/ManageThemes.english.php">
		<operation>
			<search position="replace"><![CDATA[$txt['actual_theme_dir'] = 'This theme\'s directory: ';
$txt['actual_theme_url'] = 'This theme\'s URL: ';
$txt['actual_images_url'] = 'This theme\'s images URL: ';
$txt['current_theme_style'] = 'This theme\'s style: ';

$txt['theme_variants_default'] = 'Default theme variant:';
$txt['theme_variants_user_disable'] = 'Disable user variant selection.';]]></search>
			<add><![CDATA[$txt['actual_theme_dir'] = 'This theme\'s directory: ';
$txt['actual_theme_url'] = 'This theme\'s URL: ';
$txt['actual_images_url'] = 'This theme\'s images URL: ';

$txt['theme_variants_default'] = 'Default theme variant:';
$txt['theme_variants_user_disable'] = 'Disable user variant selection.';]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[$txt['who_display_viewing_off'] = 'Don\'t show';
$txt['who_display_viewing_numbers'] = 'Show only numbers';
$txt['who_display_viewing_names'] = 'Show member names';
$txt['disable_recent_posts'] = 'Disable recent posts';
$txt['enable_single_post'] = 'Enable single post';
$txt['enable_multiple_posts'] = 'Enable multiple posts';
$txt['show_stats_index'] = 'Show statistics on board index.';
$txt['latest_members'] = 'Show latest member on board index.';
$txt['last_modification'] = 'Show last modification date on modified posts.';]]></search>
			<add><![CDATA[$txt['who_display_viewing_off'] = 'Don\'t show';
$txt['who_display_viewing_numbers'] = 'Show only numbers';
$txt['who_display_viewing_names'] = 'Show member names';
$txt['show_stats_index'] = 'Show statistics on board index.';
$txt['latest_members'] = 'Show latest member on board index.';
$txt['last_modification'] = 'Show last modification date on modified posts.';]]></add>
		</operation>
	</file>
	<file name="LANGUAGEDIR/english/Packages.english.php">
		<operation>
			<search position="replace"><![CDATA[// Version: 1.0; Packages

$txt['package_proceed'] = 'Proceed';
$txt['php_script'] = 'The addon archive was extracted, but this addon also comes with a PHP script which should be executed before it will work';
$txt['package_run'] = 'Run';
$txt['package_id'] = 'ID';
$txt['package_read'] = 'Read';
$txt['script_output'] = 'Script output:';
$txt['additional_notes'] = 'Additional notes';
$txt['notes_file'] = 'Instruction/Additional notes file';
$txt['list_file'] = 'List files in package';
$txt['files_archive'] = 'Files in archive';
$txt['package_get'] = 'Package Get';
$txt['package_browse'] = 'Browse';
$txt['add_server'] = 'Add server';
$txt['server_name'] = 'Server name';]]></search>
			<add><![CDATA[// Version: 1.0; Packages

$txt['package_proceed'] = 'Proceed';
$txt['package_id'] = 'ID';
$txt['list_file'] = 'List files in package';
$txt['files_archive'] = 'Files in archive';
$txt['package_browse'] = 'Browse';
$txt['add_server'] = 'Add server';
$txt['server_name'] = 'Server name';]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[$txt['package_manager'] = 'Package Manager';
$txt['install_mod'] = 'Install Add-on';
$txt['uninstall_mod'] = 'Uninstall Add-on';
$txt['sql_file'] = 'The addon archive has been extracted.  This addon also comes with a database file containing changes the database needs.  You will need to execute this file for the addon to function properly.';
$txt['sql_queries'] = 'SQL Queries';
$txt['no_adds_installed'] = 'No addons currently installed';
$txt['browse_installed'] = 'Browse installed addons';
$txt['uninstall'] = 'Uninstall';
$txt['delete_list'] = 'Delete Add-on List';
$txt['package_delete_list_warning'] = 'Are you sure you wish to clear the installed addons list?';
$txt['php_safe_mode'] = 'Sorry, your server currently has PHP set to run in SAFE MODE.  This feature is not compatible with SAFE MODE.';
$txt['lets_try_anyway'] = 'Let me try anyway.';

$txt['package_manager_desc'] = 'From this easy to use interface, you can download and install addons for use on your forum.';
$txt['installed_packages_desc'] = 'You can use the interface below to view those packages currently installed on the forum, and remove the ones you no longer require.';]]></search>
			<add><![CDATA[$txt['package_manager'] = 'Package Manager';
$txt['install_mod'] = 'Install Add-on';
$txt['uninstall_mod'] = 'Uninstall Add-on';
$txt['no_adds_installed'] = 'No addons currently installed';
$txt['uninstall'] = 'Uninstall';
$txt['delete_list'] = 'Delete Add-on List';
$txt['package_delete_list_warning'] = 'Are you sure you wish to clear the installed addons list?';

$txt['package_manager_desc'] = 'From this easy to use interface, you can download and install addons for use on your forum.';
$txt['installed_packages_desc'] = 'You can use the interface below to view those packages currently installed on the forum, and remove the ones you no longer require.';]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[$txt['package_servers_desc'] = 'From this easy to use interface, you can manage your package servers and download addon archives on your forum.';
$txt['upload_packages_desc'] = 'From this section you can upload a package file from your local computer directly to the forum.';

$txt['create_package'] = 'Create a new Package';
$txt['download_new_package'] = 'Download new packages';
$txt['upload_new_package'] = 'Upload new package';
$txt['view_and_remove'] = 'View and remove installed packages';
$txt['modification_package'] = 'Add-on packages';]]></search>
			<add><![CDATA[$txt['package_servers_desc'] = 'From this easy to use interface, you can manage your package servers and download addon archives on your forum.';
$txt['upload_packages_desc'] = 'From this section you can upload a package file from your local computer directly to the forum.';

$txt['upload_new_package'] = 'Upload new package';
$txt['view_and_remove'] = 'View and remove installed packages';
$txt['modification_package'] = 'Add-on packages';]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[$txt['add_languages'] = 'Add Language';
$txt['list_files'] = 'List Files';
$txt['package_type'] = 'Package Type';
$txt['archiving'] = 'Archiving';
$txt['extracting'] = 'Extracting';
$txt['avatars_extracted'] = 'The avatars have been installed, you should now be able to use them.';
$txt['language_extracted'] = 'The language pack has been installed, you can now enable its use in the language settings area of your admin control panel.';]]></search>
			<add><![CDATA[$txt['add_languages'] = 'Add Language';
$txt['list_files'] = 'List Files';
$txt['package_type'] = 'Package Type';
$txt['extracting'] = 'Extracting';
$txt['avatars_extracted'] = 'The avatars have been installed, you should now be able to use them.';
$txt['language_extracted'] = 'The language pack has been installed, you can now enable its use in the language settings area of your admin control panel.';]]></add>
		</operation>
	</file>
	<file name="LANGUAGEDIR/english/Who.english.php">
		<operation>
			<search position="replace"><![CDATA[$txt['whoall_login2'] = 'Viewing the login page.';
$txt['whoall_logout'] = 'Logging out of the forum.';
$txt['whoall_markasread'] = 'Marking topics read or unread.';
$txt['whoall_modifykarma_applaud'] = 'Applauding a member.';
$txt['whoall_modifykarma_smite'] = 'Smiting a member.';
$txt['whoall_news'] = 'Viewing the news.';]]></search>
			<add><![CDATA[$txt['whoall_login2'] = 'Viewing the login page.';
$txt['whoall_logout'] = 'Logging out of the forum.';
$txt['whoall_markasread'] = 'Marking topics read or unread.';
$txt['whoall_mentions'] = 'Viewing their mentions list.';
$txt['whoall_modifykarma_applaud'] = 'Applauding a member.';
$txt['whoall_modifykarma_smite'] = 'Smiting a member.';
$txt['whoall_news'] = 'Viewing the news.';]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[$txt['whotopic_editpoll'] = 'Editing the poll in &quot;<a href="%1$s">%2$s</a>&quot;.';
$txt['whotopic_editpoll2'] = 'Editing the poll in &quot;<a href="%1$s">%2$s</a>&quot;.';
$txt['whotopic_jsmodify'] = 'Modifying a post in &quot;<a href="%1$s">%2$s</a>&quot;.';
$txt['whotopic_lock'] = 'Locking the topic &quot;<a href="%1$s">%2$s</a>&quot;.';
$txt['whotopic_lockvoting'] = 'Locking the poll in &quot;<a href="%1$s">%2$s</a>&quot;.';
$txt['whotopic_mergetopics'] = 'Merging the topic &quot;<a href="%1$s">%2$s</a>&quot; with another topic.';]]></search>
			<add><![CDATA[$txt['whotopic_editpoll'] = 'Editing the poll in &quot;<a href="%1$s">%2$s</a>&quot;.';
$txt['whotopic_editpoll2'] = 'Editing the poll in &quot;<a href="%1$s">%2$s</a>&quot;.';
$txt['whotopic_jsmodify'] = 'Modifying a post in &quot;<a href="%1$s">%2$s</a>&quot;.';
$txt['whotopic_likes'] = 'Liking a message in the topic &quot;<a href="%1$s">%2$s</a>&quot;.';
$txt['whotopic_lock'] = 'Locking the topic &quot;<a href="%1$s">%2$s</a>&quot;.';
$txt['whotopic_lockvoting'] = 'Locking the poll in &quot;<a href="%1$s">%2$s</a>&quot;.';
$txt['whotopic_mergetopics'] = 'Merging the topic &quot;<a href="%1$s">%2$s</a>&quot; with another topic.';]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[$txt['whotopic_sendtopic'] = 'Sending the topic &quot;<a href="%1$s">%2$s</a>&quot; to a friend.';
$txt['whotopic_splittopics'] = 'Splitting the topic &quot;<a href="%1$s">%2$s</a>&quot; into two topics.';
$txt['whotopic_sticky'] = 'Pinned the topic &quot;<a href="%1$s">%2$s</a>&quot;.';
$txt['whotopic_vote'] = 'Voting in <a href="%1$s">%2$s</a>.';
$txt['whotopic_watch'] = 'Started watching a topic.';
$txt['whotopic_unwatch'] = 'Stopped watching a topic.';

$txt['whopost_quotefast'] = 'Quoting a post from &quot;<a href="%1$s">%2$s</a>&quot;.';
]]></search>
			<add><![CDATA[$txt['whotopic_sendtopic'] = 'Sending the topic &quot;<a href="%1$s">%2$s</a>&quot; to a friend.';
$txt['whotopic_splittopics'] = 'Splitting the topic &quot;<a href="%1$s">%2$s</a>&quot; into two topics.';
$txt['whotopic_sticky'] = 'Pinned the topic &quot;<a href="%1$s">%2$s</a>&quot;.';
$txt['whotopic_unwatch'] = 'Stopped watching a topic.';
$txt['whotopic_vote'] = 'Voting in <a href="%1$s">%2$s</a>.';
$txt['whotopic_watch'] = 'Started watching a topic.';

$txt['whopost_quotefast'] = 'Quoting a post from &quot;<a href="%1$s">%2$s</a>&quot;.';
]]></add>
		</operation>
	</file>
	<file name="LANGUAGEDIR/english/index.english.php">
		<operation>
			<search position="replace"><![CDATA[$txt['unnotify'] = 'Unnotify';
$txt['notify_request'] = 'Do you want a notification email if someone replies to this topic?';
// Use numeric entities in the below string.
$txt['regards_team'] = "Regards,\nThe {forum_name} Team.";
$txt['notify_replies'] = 'Notify of replies';
$txt['move_topic'] = 'Move';
$txt['move_to'] = 'Move to';]]></search>
			<add><![CDATA[$txt['unnotify'] = 'Unnotify';
$txt['notify_request'] = 'Do you want a notification email if someone replies to this topic?';
// Use numeric entities in the below string.
$txt['regards_team'] = "Regards,\nThe {forum_name_html_unsafe} Team.";
$txt['notify_replies'] = 'Notify of replies';
$txt['move_topic'] = 'Move';
$txt['move_to'] = 'Move to';]]></add>
		</operation>
	</file>
	<file name="THEMEDIR/scripts/jquery.sceditor.elkarte.js">
		<operation>
			<search position="replace"><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0
 * Extension functions to provide ElkArte compatibility with sceditor
 */
]]></search>
			<add><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0.1
 * Extension functions to provide ElkArte compatibility with sceditor
 */
]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[		}
	})
	.set('spoiler', {
		exec: function () {
			this.insert('[spoiler]', '[/spoiler]');
		},]]></search>
			<add><![CDATA[		}
	})
	.set('spoiler', {
		state: function() {
			var currentNode = this.currentNode(),
				currentRange = this.getRangeHelper();

			// We don't have a node since we don't render the tag in the wizzy editor
			// however we can spot check to see if the cursor is inside the tags.
			if (currentRange.selectedRange())
			{
				var end = currentRange.selectedRange().startOffset,
					text = $(currentNode).text();

				// Left and right text from the cursor positon and tag positions
				var	left = text.substr(0, end),
					right = text.substr(end),
					l1 = left.lastIndexOf("[spoiler]"),
					l2 = left.lastIndexOf("[/spoiler]"),
					r1 = right.indexOf("[spoiler]"),
					r2 = right.indexOf("[/spoiler]");

				// Inside spoiler tags
				if ((l1 > -1 && l1 > l2) || (r2 > -1 && (r1 === -1 || (r1 > r2))))
					return 1;
			}

			return 0;
		},
		exec: function () {
			this.insert('[spoiler]', '[/spoiler]');
		},]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[	})
	.set('footnote', {
		state: function() {
			var currentNode = this.currentNode();

			return $(currentNode).is('aside') || $(currentNode).parents('aside').length > 0 ? 1 : 0;
		},
		exec: function () {
			this.insert('[footnote] ', '[/footnote]', false);
		},
		txtExec: ['[footnote]', '[/footnote]'],
		tooltip: 'Insert Footnote']]></search>
			<add><![CDATA[	})
	.set('footnote', {
		state: function() {
			var currentNode = this.currentNode(),
				currentRange = this.getRangeHelper();

			// We don't have an html node since we don't render the tag in the editor
			// but we can do a spot check to see if the cursor is placed bewtwee plain tags.  This
			// will miss with nested tags but its nicer than nothing.
			if (currentRange.selectedRange())
			{
				var end = currentRange.selectedRange().startOffset,
					text = $(currentNode).text();

				// Left and right text from the cursor positon and tag positions
				var	left = text.substr(0, end),
					right = text.substr(end),
					l1 = left.lastIndexOf("[footnote]"),
					l2 = left.lastIndexOf("[/footnote]"),
					r1 = right.indexOf("[footnote]"),
					r2 = right.indexOf("[/footnote]");

				// Inside footnote tags
				if ((l1 > -1 && l1 > l2) || (r2 > -1 && (r1 === -1 || (r1 > r2))))
					return 1;
			}

			return 0;
		},
		exec: function () {
			this.insert('[footnote] ', '[/footnote]');
		},
		txtExec: ['[footnote]', '[/footnote]'],
		tooltip: 'Insert Footnote']]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[		format: '[pre]{0}[/pre]',
		html: '<pre>{0}</pre>'
	})
	.set('footnote', {
		tags: {
			aside: null
		},
		format: '[footnote]{0}[/footnote]',
		html: '<aside>{0}</aside>'
	})
	/*
	 * ElkArte modified tags, modified so they support the existing paradigm
	 *]]></search>
			<add><![CDATA[		format: '[pre]{0}[/pre]',
		html: '<pre>{0}</pre>'
	})
	/*
	 * ElkArte modified tags, modified so they support the existing paradigm
	 *]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[			var author = '',
				date = '',
				link = '',
				$elm  = $(element);

			if (element[0].tagName.toLowerCase() === 'cite')
				return '';]]></search>
			<add><![CDATA[			var author = '',
				date = '',
				link = '',
				$elm = $(element);

			if (element[0].tagName.toLowerCase() === 'cite')
				return '';]]></add>
		</operation>
	</file>
	<file name="THEMEDIR/scripts/script.js">
		<operation>
			<search position="replace"><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0
 *
 * This file contains javascript utility functions
 */]]></search>
			<add><![CDATA[ * copyright:	2011 Simple Machines (http://www.simplemachines.org)
 * license:		BSD, See included LICENSE.TXT for terms and conditions.
 *
 * @version 1.0.1
 *
 * This file contains javascript utility functions
 */]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[ */
function elk_setThemeOption(option, value, theme, additional_vars)
{
	if (additional_vars === null)
		additional_vars = '';

	var tempImage = new Image();]]></search>
			<add><![CDATA[ */
function elk_setThemeOption(option, value, theme, additional_vars)
{
	if (additional_vars === null || typeof(additional_vars) === 'undefined')
		additional_vars = '';

	var tempImage = new Image();]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[	this.showSelect();
}

// Show the initial select box (onload). Method of the JumpTo class.
JumpTo.prototype.showSelect = function ()
{]]></search>
			<add><![CDATA[	this.showSelect();
}

// Remove all the options in the select. Method of the JumpTo class.
JumpTo.prototype.removeAll = function ()
{
//	var dropdownList = document.getElementById(this.opt.sContainerId + '_select');
for (var i = this.dropdownList.options.length; i > 0; i--)
		this.dropdownList.remove(i - 1);
}

// Show the initial select box (onload). Method of the JumpTo class.
JumpTo.prototype.showSelect = function ()
{]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[// Fill the jump to box with entries. Method of the JumpTo class.
JumpTo.prototype.fillSelect = function (aBoardsAndCategories)
{
	if ('onbeforeactivate' in document)
		this.dropdownList.onbeforeactivate = null;
	else]]></search>
			<add><![CDATA[// Fill the jump to box with entries. Method of the JumpTo class.
JumpTo.prototype.fillSelect = function (aBoardsAndCategories)
{
	this.removeAll();
	if ('onbeforeactivate' in document)
		this.dropdownList.onbeforeactivate = null;
	else]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[			oOption,
			oText;

		// If we've reached the currently selected board add all items so far.
		if (!aBoardsAndCategories[i].isCategory && aBoardsAndCategories[i].id === this.opt.iCurBoardId)
		{
				this.dropdownList.insertBefore(oOptgroupFragment, this.dropdownList.options[0]);
				continue;
		}

		if (aBoardsAndCategories[i].isCategory)
		{
			oOptgroupFragment = document.createElement('optgroup');]]></search>
			<add><![CDATA[			oOption,
			oText;

		if (aBoardsAndCategories[i].isCategory)
		{
			oOptgroupFragment = document.createElement('optgroup');]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[		if (aBoardsAndCategories[i].isCategory && this.opt.sCatClass)
			oOption.className = this.opt.sCatClass;

		oOption.appendChild(oText);

		if (!this.opt.bNoRedirect)]]></search>
			<add><![CDATA[		if (aBoardsAndCategories[i].isCategory && this.opt.sCatClass)
			oOption.className = this.opt.sCatClass;

		if (!aBoardsAndCategories[i].isCategory && aBoardsAndCategories[i].id === this.opt.iCurBoardId)
			oOption.selected = 'selected';

		oOption.appendChild(oText);

		if (!this.opt.bNoRedirect)]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[	countdown--;

	setTimeout(function() {doAutoSubmit(countdown, txt_message, formID);}, 1000);
}]]></search>
			<add><![CDATA[	countdown--;

	setTimeout(function() {doAutoSubmit(countdown, txt_message, formID);}, 1000);
}]]></add>
		</operation>
	</file>
	<file name="THEMEDIR/scripts/script_elk.js">
		<operation>
			<search position="replace"><![CDATA[ * @copyright ElkArte Forum contributors
 * @license   BSD http://opensource.org/licenses/BSD-3-Clause
 *
 * @version 1.0
 *
 * This file contains javascript utility functions specific to ElkArte
 */]]></search>
			<add><![CDATA[ * @copyright ElkArte Forum contributors
 * @license   BSD http://opensource.org/licenses/BSD-3-Clause
 *
 * @version 1.0.1
 *
 * This file contains javascript utility functions specific to ElkArte
 */]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[ *
 * @param {string} btn string representing this, generally the anchor link tag <a class="" href="" onclick="">
 * @param {string} confirmation_msg_variable var name of the text sting to display in the "are you sure" box
 */
function toggleButtonAJAX(btn, confirmation_msg_variable)
{
	$.ajax({
		type: 'GET',]]></search>
			<add><![CDATA[ *
 * @param {string} btn string representing this, generally the anchor link tag <a class="" href="" onclick="">
 * @param {string} confirmation_msg_variable var name of the text sting to display in the "are you sure" box
 * @param {function} onSuccessCallback optional, a callback executed on successfully execute the AJAX call
 */
function toggleButtonAJAX(btn, confirmation_msg_variable, onSuccessCallback)
{
	$.ajax({
		type: 'GET',]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[			if (oElement.getElementsByTagName('url').length !== 0)
				window.location.href = oElement.getElementsByTagName('url')[0].firstChild.nodeValue;
		}
	})
	.fail(function() {
		// ajax failure code]]></search>
			<add><![CDATA[			if (oElement.getElementsByTagName('url').length !== 0)
				window.location.href = oElement.getElementsByTagName('url')[0].firstChild.nodeValue;
		}

		if (typeof (onSuccessCallback) !== 'undefined')
			onSuccessCallback(btn, request, oElement.getElementsByTagName('error'));
	})
	.fail(function() {
		// ajax failure code]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[	if (typeof (notification_topic_notice) !== 'undefined' && !confirm(notification_topic_notice))
		return false;

	return toggleButtonAJAX(btn, 'notification_topic_notice');
}

/**]]></search>
			<add><![CDATA[	if (typeof (notification_topic_notice) !== 'undefined' && !confirm(notification_topic_notice))
		return false;

	return toggleButtonAJAX(btn, 'notification_topic_notice', function(btn, request, errors) {
		var toggle = 0;

		if (errors.length > 0)
			return;

		// This is a "turn notifications on"
		if (btn.href.indexOf('sa=on') !== -1)
			toggle = 1;
		else
			toggle = 0;

		$("input[name='notify']").val(toggle);
	});
}

/**]]></add>
		</operation>
	</file>
</modification>