/* SCEditor v1.5.3 | (C) 2017, Sam Clarke | sceditor.com/license */

!function(e){"use strict";e.sceditor.plugins.undo=function(){var e,t,o=this,r=0,n=50,u=-1,c=[],a=!1,d=function(o){a=!0,t=o.value,e.sourceMode(o.sourceMode),e.val(o.value,!1),e.focus(),o.sourceMode?e.sourceEditorCaret(o.caret):e.getRangeHelper().restoreRange(),a=!1},s=function(e,t){var o,r,n,u,c=e.length,a=t.length,d=Math.max(c,a);for(o=0;o<d&&e.charAt(o)===t.charAt(o);o++);for(n=c<a?a-c:0,u=a<c?c-a:0,r=d-1;r>=0&&e.charAt(r-n)===t.charAt(r-u);r--);return r-o+1},i=function(e,t){for(;t<c.length-1;)c.pop();c.push(e),u=t+1};o.init=function(){n=(e=this).undoLimit||n,e.addShortcut("ctrl+z",o.undo),e.addShortcut("ctrl+shift+z",o.redo),e.addShortcut("ctrl+y",o.redo),e.commands.undo||(e.commands.undo={txtExec:o.undo,exec:o.undo,tooltip:"Undo"},e.commands.redo={txtExec:o.redo,exec:o.redo,tooltip:"Redo"})},o.undo=function(){var t=e.val(null,!1);return-1!==u&&(u===c.length-1&&i({caret:e.sourceEditorCaret(),sourceMode:e.sourceMode(),value:t},u),u=Math.max(0,u-1),d(c[u]),!1)},o.redo=function(){return u!==c.length-1&&(u+=1,d(c[u]),!1)},o.signalReady=function(){var o,r=e.val(null,!1);o=""===r?{end:0,start:0}:this.sourceEditorCaret(),t=r,i({caret:o,sourceMode:this.sourceMode(),value:r},u)},o.signalValuechangedEvent=function(o){var d=o.rawValue;n>0&&c.length>n&&c.shift(),a||void 0===t||t===d||(r+=s(t,d))<20||r<50&&!/\s$/g.test(o.rawValue)||(i({caret:e.sourceEditorCaret(),sourceMode:e.sourceMode(),value:d},u),r=0,t=d)}}}(jQuery);