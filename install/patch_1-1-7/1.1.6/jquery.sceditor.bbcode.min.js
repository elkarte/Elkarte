/* SCEditor v1.5.3 | (C) 2017, Sam Clarke | sceditor.com/license */

!function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={exports:{},id:o,loaded:!1};return e[o].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var o;void 0!==(o=function(e){"use strict";var t=n(1),o=n(2),i=n(3),r=n(7),a=n(6);t.sceditor=o,o.commands=n(9),o.defaultOptions=n(10),o.RangeHelper=n(4),o.dom=n(5),o.ie=r.ie,o.ios=r.ios,o.isWysiwygSupported=r.isWysiwygSupported,o.regexEscape=a.regex,o.escapeEntities=a.entities,o.escapeUriScheme=a.uriScheme,o.PluginManager=i,o.plugins=i.plugins,t.fn.sceditor=function(e){var n,i,a=[];if((e=e||{}).runWithoutWysiwygSupport||r.isWysiwygSupported)return this.each(function(){n=this.jquery?this:t(this),i=n.data("sceditor"),n.parents(".sceditor-container").length>0||("state"===e?a.push(!!i):"instance"===e?a.push(i):i||new o(this,e))}),a.length?1===a.length?a[0]:t(a):this}}.call(t,n,t,e))&&(e.exports=o)},function(e,t){e.exports=jQuery},function(e,t,n){var o;void 0!==(o=function(e){"use strict";function t(e,t){var n;a.traverse(e,function(e){a.isInline(e,!0)?(n||(n=t[0].createElement("p"),e.insertBefore(n)),3===e.nodeType&&""===e.nodeValue||e.appendChild(n)):n=null},!1,!0)}var o=n(1),i=n(3),r=n(4),a=n(5),s=n(6),l=n(7),c=n(8),u=window,d=document,f=o(u),p=o(d),h=l.ie,m=h&&h<11,g=/^image\/(p?jpe?g|gif|png|bmp)$/i,v=function(e,n){var b,y,x,w,C,E,k,S,T,N,D,B,O,M,I,R,H,F,z,L,A,W,_,P,j,q,V,$,Q,U,Y,K,X,G,J,Z,ee,te,ne,oe,ie,re,ae,se,le,ce,ue,de,fe,pe,he,me,ge,ve,be,ye,xe,we,Ce,Ee,ke,Se,Te,Ne=this,De=e.get?e.get(0):e,Be=o(De),Oe=[],Me=[],Ie={},Re=[],He={};Ne.commands=o.extend(!0,{},n.commands||v.commands),Ne.opts=n=o.extend({},v.defaultOptions,n),q=function(){Be.data("sceditor",Ne),o.each(n,function(e,t){o.isPlainObject(t)&&(n[e]=o.extend(!0,{},t))}),n.locale&&"en"!==n.locale&&K(),b=o('<div class="sceditor-container" />').insertAfter(Be).css("z-index",n.zIndex),h&&b.addClass("ie ie"+h),L=!!Be.attr("required"),Be.prop("required",!1),Y(),ee(),X(),U(!!n.startInSourceMode),G(),J(),l.isWysiwygSupported||Ne.toggleSourceMode(),pe();var e=function(){f.off("load",e),n.autofocus&&be(),Te(),me(),de(),I.call("ready")};f.on("load",e),d.readyState&&"complete"===d.readyState&&e()},Y=function(){var e=n.plugins;e=e?e.toString().split(","):[],I=new i(Ne),o.each(e,function(e,t){I.register(o.trim(t))})},K=function(){var e;(O=v.locale[n.locale])||(e=n.locale.split("-"),O=v.locale[e[0]]),O&&O.dateFormat&&(n.dateFormat=O.dateFormat)},U=function(e){var t;k=o("<textarea></textarea>"),x=o('<iframe frameborder="0" allowfullscreen="true"></iframe>'),e?(b.addClass("sourceMode"),x.hide()):(b.addClass("wysiwygMode"),k.hide()),n.spellcheck||k.attr("spellcheck","false"),"https:"===u.location.protocol&&x.attr("src","javascript:false"),b.append(x).append(k),w=x[0],S=k[0],Ne.dimensions(n.width||Be.width(),n.height||Be.height()),(t=w.contentDocument).open(),t.write(c("html",{attrs:h?' class="ie ie'+h+'"':"",spellcheck:n.spellcheck?"":'spellcheck="false"',charset:n.charset,style:n.style})),t.close(),E=o(t),C=o(t.body),Ne.readOnly(!!n.readOnly),(l.ios||l.edge||h)&&(C.height("100%"),h||C.on("touchend",Ne.focus));var i=Be.attr("tabindex");k.attr("tabindex",i),x.attr("tabindex",i),M=new r(w.contentWindow),Ne.val(Be.hide().val());var a=n.placeholder||Be.attr("placeholder");a&&(k.placeholder=a,C.attr("placeholder",a))},G=function(){n.autoUpdate&&(C.on("blur",Se),k.on("blur",Se)),null===n.rtl&&(n.rtl="rtl"===k.css("direction")),Ne.rtl(!!n.rtl),n.autoExpand&&(C[0].addEventListener("load",Te,!0),E.on("input keyup",Te)),n.resizeEnabled&&Z(),b.attr("id",n.id),Ne.emoticons(n.emoticonsEnabled)},J=function(){var e="onselectionchange"in E?"selectionchange":"keyup focus blur contextmenu mouseup touchend click";p.click(ue),o(De.form).on("reset",ae).submit(Ne.updateOriginal),f.on("resize orientationChanged",de),C.keypress(re).keydown(oe).keydown(ie).keyup(me).blur(Ee).keyup(ke).on("paste",te).on("compositionstart compositionend",le).on(e,ge).on("keydown keyup keypress focus blur contextmenu",ce),n.emoticonsCompat&&u.getSelection&&C.keyup(xe),C.on("blur",function(){Ne.val()||C.addClass("placeholder")}),C.on("focus",function(){C.removeClass("placeholder")}),k.blur(Ee).keyup(ke).keydown(oe).on("compositionstart compositionend",le).on("keydown keyup keypress focus blur contextmenu",ce),E.mousedown(se).on(e,ge).on("beforedeactivate keyup mouseup",Q).keyup(me).focus(function(){N=null}),b.on("selectionchanged",ve).on("selectionchanged",pe).on("selectionchanged valuechanged nodechanged",ce)},X=function(){var e,t=Ne.commands,i=(n.toolbarExclude||"").split(","),r=n.toolbar.split("|");y=o('<div class="sceditor-toolbar" unselectable="on" />'),o.each(r,function(n,r){e=o('<div class="sceditor-group" />'),o.each(r.split(","),function(n,r){var a,s,l=t[r];!l||o.inArray(r,i)>-1||(s=l.shortcut,(a=c("toolbarButton",{name:r,dispName:Ne._(l.name||l.tooltip||r)},!0)).data("sceditor-txtmode",!!l.txtExec).data("sceditor-wysiwygmode",!!l.exec).toggleClass("disabled",!l.exec).on("mousedown",function(e){var t=o(this);return t.hasClass("disabled")||1!==e.which||$(t,l),pe(),!1}),l.tooltip&&a.attr("title",Ne._(l.tooltip)+(s?" ("+s+")":"")),s&&Ne.addShortcut(s,r),l.state?Me.push({name:r,state:l.state}):"string"==typeof l.exec&&Me.push({name:r,state:l.exec}),e.append(a),He[r]=a)}),e[0].firstChild&&y.append(e)}),o(n.toolbarContainer||b).append(y)},Z=function(){var e,t,i,r,a,s,l=o('<div class="sceditor-grip" />'),c=o('<div class="sceditor-resize-cover" />'),d="touchcancel touchend mouseup",f=0,m=0,g=0,v=0,y=0,x=0,w=b.width(),C=b.height(),E=!1,k=Ne.rtl();e=n.resizeMinHeight||C/1.5,t=n.resizeMaxHeight||2.5*C,i=n.resizeMinWidth||w/1.25,r=n.resizeMaxWidth||1.25*w,a=function(o){"touchmove"===o.type?(o=u.event,g=o.changedTouches[0].pageX,v=o.changedTouches[0].pageY):(g=o.pageX,v=o.pageY);var a=x+(v-m),s=k?y-(g-f):y+(g-f);r>0&&s>r&&(s=r),i>0&&s<i&&(s=i),n.resizeWidth||(s=!1),t>0&&a>t&&(a=t),e>0&&a<e&&(a=e),n.resizeHeight||(a=!1),(s||a)&&(Ne.dimensions(s,a),h<7&&b.height(a)),o.preventDefault()},s=function(e){E&&(E=!1,c.hide(),b.removeClass("resizing").height("auto"),p.off("touchmove mousemove",a),p.off(d,s),e.preventDefault())},b.append(l),b.append(c.hide()),l.on("touchstart mousedown",function(e){"touchstart"===e.type?(e=u.event,f=e.touches[0].pageX,m=e.touches[0].pageY):(f=e.pageX,m=e.pageY),y=b.width(),x=b.height(),E=!0,b.addClass("resizing"),c.show(),p.on("touchmove mousemove",a),p.on(d,s),h<7&&b.height(x),e.preventDefault()})},ee=function(){var e,t=n.emoticons,i=n.emoticonsRoot;o.isPlainObject(t)&&n.emoticonsEnabled&&o.each(t,function(n,r){o.each(r,function(o,r){i&&(r={url:i+(r.url||r),tooltip:r.tooltip||o},t[n][o]=r),(e=d.createElement("img")).src=r.url||r,Oe.push(e)})})},be=function(){var e,t,i=E[0],r=C[0],s=r.firstChild,l=!!n.autofocusEnd;if(b.is(":visible")){if(Ne.sourceMode())return t=l?S.value.length:0,void(S.setSelectionRange?S.setSelectionRange(t,t):((e=S.createTextRange()).moveEnd("character",t),e.collapse(!1),e.select()));if(a.removeWhiteSpace(r),l)for((s=r.lastChild)||(s=i.createElement("p"),C.append(s));s.lastChild;)s=s.lastChild,!m&&o(s).is("br")&&s.previousSibling&&(s=s.previousSibling);i.createRange?(e=i.createRange(),a.canHaveChildren(s)?e.selectNodeContents(s):(e.setStartBefore(s),l&&e.setStartAfter(s))):(e=r.createTextRange()).moveToElementText(3!==s.nodeType?s:s.parentNode),e.collapse(!l),M.selectRange(e),F=e,l&&(E.scrollTop(r.scrollHeight),C.scrollTop(r.scrollHeight)),Ne.focus()}},Ne.readOnly=function(e){return"boolean"!=typeof e?"readonly"===k.attr("readonly"):(C[0].contentEditable=!e,e?k.attr("readonly","readonly"):k.prop("readonly",!1),fe(e),Ne)},Ne.rtl=function(e){var t=e?"rtl":"ltr";return"boolean"!=typeof e?"rtl"===k.attr("dir"):(C.attr("dir",t),k.attr("dir",t),b.removeClass("rtl").removeClass("ltr").addClass(t),Ne)},fe=function(e){var t=Ne.inSourceMode()?"txtmode":"wysiwygmode";o.each(He,function(n,o){!0!==e&&o.data("sceditor-"+t)?o.removeClass("disabled"):o.addClass("disabled")})},Ne.width=function(e,t){return e||0===e?(Ne.dimensions(e,null,t),Ne):b.width()},Ne.dimensions=function(e,t,o){var i=h<8||d.documentMode<8?2:0;return e=!(!e&&0!==e)&&e,t=!(!t&&0!==t)&&t,!1===e&&!1===t?{width:Ne.width(),height:Ne.height()}:(void 0===x.data("outerWidthOffset")&&Ne.updateStyleCache(),!1!==e&&(!1!==o&&(n.width=e),!1===t&&(t=b.height(),o=!1),b.width(e),e&&e.toString().indexOf("%")>-1&&(e=b.width()),x.width(e-x.data("outerWidthOffset")),k.width(e-k.data("outerWidthOffset")),l.ios&&C&&C.width(e-x.data("outerWidthOffset")-(C.outerWidth(!0)-C.width()))),!1!==t&&(!1!==o&&(n.height=t),t&&t.toString().indexOf("%")>-1&&(t=b.height(t).height(),b.height("auto")),t-=n.toolbarContainer?0:y.outerHeight(!0),x.height(t-x.data("outerHeightOffset")),k.height(t-i-k.data("outerHeightOffset"))),Ne)},Ne.updateStyleCache=function(){x.data("outerWidthOffset",x.outerWidth(!0)-x.width()),k.data("outerWidthOffset",k.outerWidth(!0)-k.width()),x.data("outerHeightOffset",x.outerHeight(!0)-x.height()),k.data("outerHeightOffset",k.outerHeight(!0)-k.height())},Ne.height=function(e,t){return e||0===e?(Ne.dimensions(null,e,t),Ne):b.height()},Ne.maximize=function(e){return void 0===e?b.is(".sceditor-maximize"):((e=!!e)&&(P=f.scrollTop()),o("html, body").toggleClass("sceditor-maximize",e),b.toggleClass("sceditor-maximize",e),Ne.width(e?"100%":n.width,!1),Ne.height(e?"100%":n.height,!1),e||f.scrollTop(P),Te(),Ne)},Te=function(){n.autoExpand&&!_&&setTimeout(Ne.expandToContent,200)},Ne.expandToContent=function(e){if(!Ne.maximize()){if(_=!1,!W){var t=n.resizeMinHeight||n.height||Be.height();W={min:t,max:n.resizeMaxHeight||2*t}}var o=document.createRange();o.selectNodeContents(C[0]);var i=o.getBoundingClientRect(),r=E[0].documentElement.clientHeight,a=i.bottom-i.top,s=Ne.height()+(a-r);e||-1===W.max||(s=Math.min(s,W.max)),Ne.height(Math.ceil(Math.max(s,W.min)))}},Ne.destroy=function(){I&&(I.destroy(),M=null,N=null,I=null,T&&T.off().remove(),p.off("click",ue),f.off("resize orientationChanged",de),o(De.form).off("reset",ae).off("submit",Ne.updateOriginal),C.off(),E.off().find("*").remove(),k.off().remove(),y.remove(),b.off().find("*").off().remove(),b.remove(),Be.removeData("sceditor").removeData("sceditorbbcode").show(),L&&Be.attr("required","required"))},Ne.createDropDown=function(e,t,i,r){var a,s="sceditor-"+t,l=T&&T.is("."+s);Ne.closeDropDown(!0),l||(!1!==r&&o(i).find(":not(input,textarea)").filter(function(){return 1===this.nodeType}).attr("unselectable","on"),a={top:e.offset().top,left:e.offset().left,marginTop:e.outerHeight()},o.extend(a,n.dropDownCss),T=o('<div class="sceditor-dropdown '+s+'" />').css(a).append(i).appendTo(o("body")).on("click focusin",function(e){e.stopPropagation()}),setTimeout(function(){T&&T.find("input,textarea").first().focus()}))},ue=function(e){3!==e.which&&T&&(Se(),void 0===o(e.target).parent().data("sceditorCommand")&&Ne.closeDropDown())},te=function(e){var t=h||l.edge,n=C[0],o=e.originalEvent.clipboardData;if(o&&!t){var i={},r=o.types,a=o.items;e.preventDefault();for(var s=0;s<r.length;s++){if(window.FileReader&&a&&g.test(a[s].type))return function(e){var t=new FileReader;t.onload=function(e){ne({html:'<img src="'+e.target.result+'" />'})},t.readAsDataURL(e)}(o.items[s].getAsFile());i[r[s]]=o.getData(r[s])}i.text=i["text/plain"],i.html=i["text/html"],ne(i)}else if(!j){var c=n.scrollTop;for(M.saveRange(),j=document.createDocumentFragment();n.firstChild;)j.appendChild(n.firstChild);setTimeout(function(){var e=n.innerHTML;n.innerHTML="",n.appendChild(j),n.scrollTop=c,j=!1,M.restoreRange(),ne({html:e})},0)}},ne=function(e){var t=E[0].createElement("div");I.call("pasteRaw",e),e.html?(t.innerHTML=e.html,a.fixNesting(t)):t.innerHTML=s.entities(e.text||"");var n={val:t.innerHTML};I.hasHandler("toSource")&&(C.append(t),n.val=I.callOnlyFirst("toSource",n.val,o(t)),o(t).remove()),I.call("paste",n),I.hasHandler("toWysiwyg")&&(n.val=I.callOnlyFirst("toWysiwyg",n.val,!0)),I.call("pasteHtml",n),Ne.wysiwygEditorInsertHtml(n.val,null,!0)},Ne.closeDropDown=function(e){T&&(T.off().remove(),T=null),!0===e&&Ne.focus()},Ne.wysiwygEditorInsertHtml=function(e,t,n){var i,r,s,l=x.height();Ne.focus(),(n||!o(H).is("code")&&0===o(H).parents("code").length)&&(M.insertHTML(e,t),M.saveRange(),V(C[0]),i=C.find("#sceditor-end-marker").show(),r=C.scrollTop()||E.scrollTop(),s=a.getOffset(i[0]).top+1.5*i.outerHeight(!0)-l,i.hide(),(s>r||s+l<r)&&(C.scrollTop(s),E.scrollTop(s)),Ce(!1),M.restoreRange(),me())},Ne.wysiwygEditorInsertText=function(e,t){Ne.wysiwygEditorInsertHtml(s.entities(e),s.entities(t))},Ne.insertText=function(e,t){return Ne.inSourceMode()?Ne.sourceEditorInsertText(e,t):Ne.wysiwygEditorInsertText(e,t),Ne},Ne.sourceEditorInsertText=function(e,t){var n,o,i,r=S.selectionStart,a=S.selectionEnd;o=S.scrollTop,S.focus(),void 0!==r?(i=S.value,t&&(e+=i.substring(r,a)+t),S.value=i.substring(0,r)+e+i.substring(a,i.length),S.selectionStart=r+e.length-(t?t.length:0),S.selectionEnd=S.selectionStart):(n=d.selection.createRange(),t&&(e+=n.text+t),n.text=e,t&&n.moveEnd("character",0-t.length),n.moveStart("character",n.End-n.Start),n.select()),S.scrollTop=o,S.focus(),Ce()},Ne.getRangeHelper=function(){return M},Ne.sourceEditorCaret=function(e){var t={};return S.focus(),e?(S.selectionStart=e.start,S.selectionEnd=e.end):(t.start=S.selectionStart,t.end=S.selectionEnd),e?this:t},Ne.val=function(e,t){return"string"!=typeof e?Ne.inSourceMode()?Ne.getSourceEditorValue(!1):Ne.getWysiwygEditorValue(t):(Ne.inSourceMode()?Ne.setSourceEditorValue(e):(!1!==t&&I.hasHandler("toWysiwyg")&&(e=I.callOnlyFirst("toWysiwyg",e)),Ne.setWysiwygEditorValue(e)),Ne)},Ne.insert=function(e,t,n,i,r){if(Ne.inSourceMode())return Ne.sourceEditorInsertText(e,t),Ne;if(t){var a=M.selectedHtml(),s=o("<div>").appendTo(o("body")).hide().html(a);!1!==n&&I.hasHandler("toSource")&&(a=I.callOnlyFirst("toSource",a,s)),s.remove(),e+=a+t}return!1!==n&&I.hasHandler("toWysiwyg")&&(e=I.callOnlyFirst("toWysiwyg",e,!0)),!1!==n&&!0===r&&(e=e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")),Ne.wysiwygEditorInsertHtml(e),Ne},Ne.getWysiwygEditorValue=function(e){var t,n=o("<div>",E[0]).append(o(C[0].childNodes).clone()).appendTo(C);return a.fixNesting(n[0]),t=n.html(),!1!==e&&I.hasHandler("toSource")&&(t=I.callOnlyFirst("toSource",t,n)),n.remove(),t},Ne.getBody=function(){return C},Ne.getContentAreaContainer=function(){return x},Ne.getSourceEditorValue=function(e){var t=k.val();return!1!==e&&I.hasHandler("toWysiwyg")&&(t=I.callOnlyFirst("toWysiwyg",t)),t},Ne.setWysiwygEditorValue=function(e){e||(e="<p>"+(h?"":"<br />")+"</p>"),C[0].innerHTML=e,V(C[0]),me(),Ce(),Te()},Ne.setSourceEditorValue=function(e){k.val(e),Ce()},Ne.updateOriginal=function(){Be.val(Ne.val())},V=function(e){if(n.emoticonsEnabled&&!o(e).parents("code").length){var t=e.ownerDocument,i=[],r={},l=o.extend({},n.emoticons.more,n.emoticons.dropdown,n.emoticons.hidden);o.each(l,function(e){n.emoticonsCompat&&(r[e]=new RegExp("(>|^|\\s| | | | |&nbsp;)"+s.regex(e)+"($|<|\\s| | | | |&nbsp;)")),i.push(e)}),i.sort(function(e,t){return e.length-t.length});var u=function(e){for(e=e.firstChild;e;){var s,d,f,p,h,m,g,v=e.parentNode,b=e.nodeValue;if(3!==e.nodeType)o(e).is("code")||u(e);else if(b)for(h=i.length;h--;)d=i[h],(g=n.emoticonsCompat?b.search(r[d]):b.indexOf(d))>-1&&(m=e.nextSibling,f=l[d],s=b.substr(g).split(d),b=b.substr(0,g)+s.shift(),e.nodeValue=b,p=a.parseHTML(c("emoticon",{key:d,url:f.url||f,tooltip:f.tooltip||d}),t),v.insertBefore(p[0],m),v.insertBefore(t.createTextNode(s.join(d)),m));e=e.nextSibling}};u(e),n.emoticonsCompat&&(Re=C.find("img[data-sceditor-emoticon]"))}},Ne.inSourceMode=function(){return b.hasClass("sourceMode")},Ne.sourceMode=function(e){var t=Ne.inSourceMode();return"boolean"!=typeof e?t:((t&&!e||!t&&e)&&Ne.toggleSourceMode(),Ne)},Ne.toggleSourceMode=function(){var e=Ne.inSourceMode();!l.isWysiwygSupported&&e||(e||(M.saveRange(),M.clear()),Ne.blur(),e?Ne.setWysiwygEditorValue(Ne.getSourceEditorValue()):Ne.setSourceEditorValue(Ne.getWysiwygEditorValue()),N=null,k.toggle(),x.toggle(),b.toggleClass("wysiwygMode",e).toggleClass("sourceMode",!e),fe(),pe())},he=function(){return S.focus(),void 0!==S.selectionStart?S.value.substring(S.selectionStart,S.selectionEnd):d.selection.createRange().text},$=function(e,t){Ne.inSourceMode()?t.txtExec&&(o.isArray(t.txtExec)?Ne.sourceEditorInsertText.apply(Ne,t.txtExec):t.txtExec.call(Ne,e,he())):t.exec&&(o.isFunction(t.exec)?t.exec.call(Ne,e):Ne.execCommand(t.exec,t.hasOwnProperty("execParam")?t.execParam:null))},Q=function(){h&&(N=M.selectedRange())},Ne.execCommand=function(e,t){var n=!1,i=Ne.commands[e],r=o(M.parentNode());if(Ne.focus(),!r.is("code")&&0===r.parents("code").length){try{n=E[0].execCommand(e,!1,t)}catch(e){}!n&&i&&i.errorMessage&&alert(Ne._(i.errorMessage)),pe()}},ge=function(){function e(){if(M&&!M.compare(F)){if((F=M.cloneSelected())&&F.collapsed){var e=F.startContainer,n=F.startOffset;for(n&&3!==e.nodeType&&(e=e.childNodes[n]);e&&e.parentNode!==C;)e=e.parentNode;e&&a.isInline(e,!0)&&(M.saveRange(),t(C,E),M.restoreRange())}b.trigger(o.Event("selectionchanged"))}z=!1}z||(z=!0,"onselectionchange"in E?e():setTimeout(e,100))},ve=function(){var e,t=M.parentNode();R!==t&&(e=R,R=t,H=M.getFirstBlockParent(t),b.trigger(o.Event("nodechanged",{oldNode:e,newNode:R})))},Ne.currentNode=function(){return R},Ne.currentBlockNode=function(){return H},pe=function(e){var t,n,o=E[0],i=Ne.sourceMode();if(Ne.readOnly())y.find("active").removeClass("active");else{i||(n=e?e.newNode:M.parentNode(),t=M.getFirstBlockParent(n));for(var r=0;r<Me.length;r++){var a=0,s=He[Me[r].name],l=Me[r].state,c=i&&!s.data("sceditor-txtmode")||!i&&!s.data("sceditor-wysiwygmode");if("string"==typeof l){if(!i)try{(a=o.queryCommandEnabled(l)?0:-1)>-1&&(a=o.queryCommandState(l)?1:0)}catch(e){}}else c||(a=l.call(Ne,n,t));s.toggleClass("disabled",c||a<0).toggleClass("active",a>0)}}},re=function(e){if(!e.originalEvent.defaultPrevented&&(Ne.closeDropDown(),13===e.which)){var t=o(H);if(t.length&&!t.is("li,ul,ol")){N=null;var n=E[0].createElement("br");if(M.insertNode(n),!m){var i=n.parentNode,r=i.lastChild;r&&3===r.nodeType&&""===r.nodeValue&&(i.removeChild(r),r=i.lastChild),!a.isInline(i,!0)&&r===n&&a.isInline(n.previousSibling)&&M.insertHTML("<br>")}e.preventDefault()}}},me=function(){var e,t=C[0];a.rTraverse(t,function(n){if(e=n.nodeName.toLowerCase(),1===n.nodeType&&!/inline/.test(a.getStyle(n,"display"))&&o(n).hasClass("sceditor-nlf")&&a.hasStyling(n)){var i=E[0].createElement("p");return i.className="sceditor-nlf",i.innerHTML=m?"":"<br />",t.appendChild(i),!1}if(3===n.nodeType&&!/^\s*$/.test(n.nodeValue)||"br"===e)return!1})},ae=function(){Ne.val(Be.val())},se=function(){Ne.closeDropDown(),N=null},de=function(){var e=n.height,t=n.width;Ne.maximize()?Ne.dimensions("100%","100%",!1):(e&&e.toString().indexOf("%")>-1||t&&t.toString().indexOf("%")>-1)&&Ne.dimensions(t,e)},Ne._=function(){var e=arguments;return O&&O[e[0]]&&(e[0]=O[e[0]]),e[0].replace(/\{(\d+)\}/g,function(t,n){return void 0!==e[n-0+1]?e[n-0+1]:"{"+n+"}"})},ce=function(e){I.call(e.type+"Event",e,Ne);var t=e.target===S?"scesrc":"scewys",n=o.Event(e);n.type=t+e.type,b.trigger(n,Ne)},Ne.bind=function(e,t,n,i){for(var r=(e=e.split(" ")).length;r--;)o.isFunction(t)&&(n||b.on("scewys"+e[r],t),i||b.on("scesrc"+e[r],t),"valuechanged"===e[r]&&(Ce.hasHandler=!0));return Ne},Ne.unbind=function(e,t,n,i){for(var r=(e=e.split(" ")).length;r--;)o.isFunction(t)&&(n||b.off("scewys"+e[r],t),i||b.off("scesrc"+e[r],t));return Ne},Ne.blur=function(e,t,n){return o.isFunction(e)?Ne.bind("blur",e,t,n):Ne.sourceMode()?k.blur():C.blur(),Ne},Ne.focus=function(e,t,n){if(o.isFunction(e))Ne.bind("focus",e,t,n);else if(Ne.inSourceMode())S.focus();else{var i,r=M.selectedRange();F||be(),!m&&r&&1===r.endOffset&&r.collapsed&&(i=r.endContainer)&&1===i.childNodes.length&&o(i.firstChild).is("br")&&(r.setStartBefore(i.firstChild),r.collapse(!0),M.selectRange(r)),w.contentWindow.focus(),C[0].focus(),N&&(M.selectRange(N),N=null)}return pe(),Ne},Ne.keyDown=function(e,t,n){return Ne.bind("keydown",e,t,n)},Ne.keyPress=function(e,t,n){return Ne.bind("keypress",e,t,n)},Ne.keyUp=function(e,t,n){return Ne.bind("keyup",e,t,n)},Ne.nodeChanged=function(e){return Ne.bind("nodechanged",e,!1,!0)},Ne.selectionChanged=function(e){return Ne.bind("selectionchanged",e,!1,!0)},Ne.valueChanged=function(e,t,n){return Ne.bind("valuechanged",e,t,n)},ye=function(e){var t,i=0,r=Ne.emoticonsCache,a=String.fromCharCode(e.which);if(!o(H).is("code")&&!o(H).parents("code").length)return r||(r=[],o.each(o.extend({},n.emoticons.more,n.emoticons.dropdown,n.emoticons.hidden),function(e,t){r[i++]=[e,c("emoticon",{key:e,url:t.url||t,tooltip:t.tooltip||e})]}),r.sort(function(e,t){return e[0].length-t[0].length}),Ne.emoticonsCache=r,Ne.longestEmoticonCode=r[r.length-1][0].length),t=M.replaceKeyword(Ne.emoticonsCache,!0,!0,Ne.longestEmoticonCode,n.emoticonsCompat,a),t&&n.emoticonsCompat?(Re=C.find("img[data-sceditor-emoticon]"),/^\s$/.test(a)):!t},xe=function(){if(Re.length){var e,t,n,i,r,a,s=Ne.currentBlockNode(),l=!1,c=/[^\s\xA0\u2002\u2003\u2009\u00a0]+/;Re=o.map(Re,function(u){return u&&u.parentNode?o.contains(s,u)?(e=u.previousSibling,t=u.nextSibling,null===(r=e.nodeValue)&&(r=e.innerText||""),e&&c.test(e.nodeValue.slice(-1))||t&&c.test((t.nodeValue||"")[0])?(n=u.parentNode,i=M.cloneSelected(),a=i.startContainer,r+=o(u).data("sceditor-emoticon"),a===t?l=r.length+i.startOffset:a===s&&s.childNodes[i.startOffset]===t?l=r.length:a===e&&(l=i.startOffset),t&&3===t.nodeType||(t=n.insertBefore(n.ownerDocument.createTextNode(""),t)),t.insertData(0,r),n.removeChild(e),n.removeChild(u),!1!==l&&(i.setStart(t,l),i.collapse(!0),M.selectRange(i)),null):u):u:null})}},Ne.emoticons=function(e){return e||!1===e?(n.emoticonsEnabled=e,e?(C.keypress(ye),Ne.sourceMode()||(M.saveRange(),V(C[0]),Re=C.find("img[data-sceditor-emoticon]"),Ce(!1),M.restoreRange())):(C.find("img[data-sceditor-emoticon]").replaceWith(function(){return o(this).data("sceditor-emoticon")}),Re=[],C.off("keypress",ye),Ce()),Ne):n.emoticonsEnabled},Ne.css=function(e){return A||(A=o('<style id="#inline" />',E[0]).appendTo(E.find("head"))[0]),"string"!=typeof e?A.styleSheet?A.styleSheet.cssText:A.innerHTML:(A.styleSheet?A.styleSheet.cssText=e:A.innerHTML=e,Ne)},oe=function(e){var t=[],n={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|","[":"{","]":"}"},o={8:"backspace",9:"tab",13:"enter",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",91:"win",92:"win",93:"select",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},i={109:"-",110:"del",111:"/",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9"},r=e.which,a=o[r]||String.fromCharCode(r).toLowerCase();if((e.ctrlKey||e.metaKey)&&t.push("ctrl"),e.altKey&&t.push("alt"),e.shiftKey&&(t.push("shift"),i[r]?a=i[r]:n[a]&&(a=n[a])),a&&(r<16||r>18)&&t.push(a),t=t.join("+"),Ie[t])return Ie[t].call(Ne)},Ne.addShortcut=function(e,t){return e=e.toLowerCase(),Ie[e]="string"==typeof t?function(){return $(He[t],Ne.commands[t]),!1}:t,Ne},Ne.removeShortcut=function(e){return delete Ie[e.toLowerCase()],Ne},ie=function(e){var t,i,r,a,s;if(!n.disableBlockRemove&&8===e.which&&(a=M.selectedRange())&&(u.getSelection?(t=a.startContainer,i=a.startOffset):(t=a.parentElement(),(r=E[0].selection.createRange()).moveToElementText(t),r.setEndPoint("EndToStart",a),i=r.text.length),0===i&&(s=we()))){for(;t!==s;){for(;t.previousSibling;)if(3!==(t=t.previousSibling).nodeType||t.nodeValue)return;if(!(t=t.parentNode))return}if(s&&!o(s).is("body"))return Ne.clearBlockFormatting(s),!1}},we=function(){for(var e=H;!a.hasStyling(e)||a.isInline(e,!0);)if(!(e=e.parentNode)||o(e).is("body"))return;return e},Ne.clearBlockFormatting=function(e){return!(e=e||we())||o(e).is("body")?Ne:(M.saveRange(),e.className="",N=null,o(e).attr("style",""),o(e).is("p,div,td")||a.convertElement(e,"p"),M.restoreRange(),Ne)},Ce=function(e){if(I&&(I.hasHandler("valuechangedEvent")||Ce.hasHandler)){var t,n=Ne.sourceMode(),i=!n&&M.hasSelection();D=!1,e=!1!==e&&!E[0].getElementById("sceditor-start-marker"),B&&(clearTimeout(B),B=!1),i&&e&&M.saveRange(),(t=n?k.val():C.html())!==Ce.lastVal&&(Ce.lastVal=t,b.trigger(o.Event("valuechanged",{rawValue:n?Ne.val():t}))),i&&e&&M.removeMarkers()}},Ee=function(){B&&Ce()},ke=function(e){var t=e.which,n=ke.lastChar,o=13===n||32===n,i=8===n||46===n;ke.lastChar=t,D||(13===t||32===t?o?ke.triggerNext=!0:Ce():8===t||46===t?i?ke.triggerNext=!0:Ce():ke.triggerNext&&(Ce(),ke.triggerNext=!1),B&&clearTimeout(B),B=setTimeout(function(){D||Ce()},1500))},le=function(e){(D=/start/i.test(e.type))||Ce()},Se=function(){Ne.updateOriginal()},q()};return v.locale={},v.command={get:function(e){return v.commands[e]||null},set:function(e,t){return!(!e||!t)&&(t=o.extend(v.commands[e]||{},t),t.remove=function(){v.command.remove(e)},v.commands[e]=t,this)},remove:function(e){return v.commands[e]&&delete v.commands[e],this}},v}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(){"use strict";var e={},t=function(t){var n=this,o=[],i=function(e){return"signal"+e.charAt(0).toUpperCase()+e.slice(1)},r=function(e,n){e=[].slice.call(e);var r,a,s=i(e.shift());for(r=0;r<o.length;r++)if(s in o[r]&&(a=o[r][s].apply(t,e),n))return a};n.call=function(){r(arguments,!1)},n.callOnlyFirst=function(){return r(arguments,!0)},n.hasHandler=function(e){var t=o.length;for(e=i(e);t--;)if(e in o[t])return!0;return!1},n.exists=function(t){return t in e&&"function"==typeof(t=e[t])&&"object"==typeof t.prototype},n.isRegistered=function(t){if(n.exists(t))for(var i=o.length;i--;)if(o[i]instanceof e[t])return!0;return!1},n.register=function(i){return!(!n.exists(i)||n.isRegistered(i)||(i=new e[i],o.push(i),"init"in i&&i.init.call(t),0))},n.deregister=function(i){var r,a=o.length,s=!1;if(!n.isRegistered(i))return s;for(;a--;)o[a]instanceof e[i]&&(s=!0,"destroy"in(r=o.splice(a,1)[0])&&r.destroy.call(t));return s},n.destroy=function(){for(var e=o.length;e--;)"destroy"in o[e]&&o[e].destroy.call(t);o=[],t=null}};return t.plugins=e,t}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){"use strict";var t=n(1),o=n(5),i=n(6),r=n(7).ie,a=r&&r<11,s=function(e,t,n){var o,i,r,a,s,l="",c=e.startContainer,u=e.startOffset;for(c&&3!==c.nodeType&&(c=c.childNodes[u],u=0),r=a=u;n>l.length&&c&&3===c.nodeType;)o=c.nodeValue,i=n-l.length,s&&(a=o.length,r=0),s=c,t?(u=r=Math.max(a-i,0),l=o.substr(r,a-r)+l,c=s.previousSibling):(u=r+(a=Math.min(i,o.length)),l+=o.substr(r,a),c=s.nextSibling);return{node:s||c,offset:u,text:l}};return function(e,n){var r,l,c=n||e.contentDocument||e.document,u="sceditor-start-marker",d="sceditor-end-marker",f=this;f.insertHTML=function(e,t){var n,o;if(!f.selectedRange())return!1;for(t&&(e+=f.selectedHtml()+t),o=c.createElement("p"),n=c.createDocumentFragment(),o.innerHTML=e;o.firstChild;)n.appendChild(o.firstChild);f.insertNode(n)},l=function(e,n,i){var a,s,l=c.createElement("div"),p=t(l);if("string"==typeof e?(n&&(e+=f.selectedHtml()+n),p.html(e)):(p.append(e),n&&p.append(f.selectedRange().extractContents()).append(n)),a=l.lastChild){for(;!o.isInline(a.lastChild,!0);)a=a.lastChild;return o.canHaveChildren(a)&&(s=t(a),a.lastChild||s.append("​")),f.removeMarkers(),(s||p).append(r(u)).append(r(d)),i?p.html():t(c.createDocumentFragment()).append(p.contents())[0]}},f.insertNode=function(e,t){var n=l(e,t),i=f.selectedRange(),r=i.commonAncestorContainer;if(!n)return!1;i.deleteContents(),r&&3!==r.nodeType&&!o.canHaveChildren(r)?r.parentNode.insertBefore(n,r):i.insertNode(n),f.restoreRange()},f.cloneSelected=function(){var e=f.selectedRange();if(e)return e.cloneRange()},f.selectedRange=function(){var t,n,o=e.getSelection();if(o){if(o.getRangeAt&&o.rangeCount<=0){for(n=c.body;n.firstChild;)n=n.firstChild;(t=c.createRange()).setStartBefore(n),o.addRange(t)}return o.rangeCount>0&&(t=o.getRangeAt(0)),t}},f.hasSelection=function(){var t=e.getSelection();return t&&t.rangeCount>0},f.selectedHtml=function(){var e,t=f.selectedRange();return t?((e=c.createElement("p")).appendChild(t.cloneContents()),e.innerHTML):""},f.parentNode=function(){var e=f.selectedRange();if(e)return e.parentElement?e.parentElement():e.commonAncestorContainer},f.getFirstBlockParent=function(e){var t=function(e){return o.isInline(e,!0)?(e=e?e.parentNode:null,e?t(e):e):e};return t(e||f.parentNode())},f.insertNodeAt=function(e,t){var n=f.selectedRange(),o=f.cloneSelected();if(!o)return!1;o.collapse(e),o.insertNode(t),f.selectRange(n)},r=function(e){f.removeMarker(e);var t=c.createElement("span");return t.id=e,t.style.lineHeight="0",t.style.display="none",t.className="sceditor-selection sceditor-ignore",t.innerHTML=" ",t},f.insertMarkers=function(){var e=f.selectedRange();f.insertNodeAt(!0,r(u)),e&&e.collapsed?t(f.getMarker(u)).after(r(d)):f.insertNodeAt(!1,r(d))},f.getMarker=function(e){return c.getElementById(e)},f.removeMarker=function(e){var t=f.getMarker(e);t&&t.parentNode.removeChild(t)},f.removeMarkers=function(){f.removeMarker(u),f.removeMarker(d)},f.saveRange=function(){f.insertMarkers()},f.selectRange=function(n){var i,r=e.getSelection(),s=n.endContainer;if(!a&&n.collapsed&&s&&!o.isInline(s,!0)){for(i=s.lastChild;i&&t(i).is(".sceditor-ignore");)i=i.previousSibling;if(t(i).is("br")){var l=c.createRange();l.setEndAfter(i),l.collapse(!1),f.compare(n,l)&&(n.setStartBefore(i),n.collapse(!0))}}r&&(f.clear(),r.addRange(n))},f.restoreRange=function(){var e,t=f.selectedRange(),n=f.getMarker(u),o=f.getMarker(d);if(!n||!o||!t)return!1;e=n.nextSibling===o,(t=c.createRange()).setStartBefore(n),t.setEndAfter(o),e&&t.collapse(!0),f.selectRange(t),f.removeMarkers()},f.selectOuterText=function(e,t){var n,o,i=f.cloneSelected();if(!i)return!1;i.collapse(!1),n=s(i,!0,e),o=s(i,!1,t),i.setStart(n.node,n.offset),i.setEnd(o.node,o.offset),f.selectRange(i)},f.getOuterText=function(e,t){var n=f.cloneSelected();return n?(n.collapse(!e),s(n,e,t).text):""},f.replaceKeyword=function(e,t,n,o,r,a){n||e.sort(function(e,t){return e[0].length-t[0].length});var s,l,c,u,d,p,h,m,g=e.length,v=r?1:0,b=o||e[g-1][0].length;for(r&&b++,a=a||"",d=(s=f.getOuterText(!0,b)).length,s+=a,t&&(s+=f.getOuterText(!1,b));g--;)if(h=e[g][0],m=h.length,u=Math.max(0,d-m-v),c=-1,r?(l=s.substr(u).match(new RegExp("(^|[\\s    ])"+i.regex(h)+"(^|[\\s    ])")))&&(c=l.index+u+l[1].length):c=s.indexOf(h,u),c>-1&&c<=d&&c+m+v>=d)return p=d-c,f.selectOuterText(p,m-p-(/^\S/.test(a)?1:0)),f.insertHTML(e[g][1]),!0;return!1},f.compare=function(e,t){return t||(t=f.selectedRange()),e&&t?0===e.compareBoundaryPoints(Range.END_TO_END,t)&&0===e.compareBoundaryPoints(Range.START_TO_START,t):!e&&!t},f.clear=function(){var t=e.getSelection();t&&(t.removeAllRanges?t.removeAllRanges():t.empty&&t.empty())}}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){"use strict";var t=n(1),o={},i={traverse:function(e,t,n,o,r){if(e)for(e=r?e.lastChild:e.firstChild;e;){var a=r?e.previousSibling:e.nextSibling;if(!n&&!1===t(e)||!o&&!1===i.traverse(e,t,n,o,r)||n&&!1===t(e))return!1;e=a}},rTraverse:function(e,t,n,o){this.traverse(e,t,n,o,!0)},parseHTML:function(e,n){var o=[],i=(n||document).createElement("div");return i.innerHTML=e,t.merge(o,i.childNodes),o},hasStyling:function(e){var n=t(e);return e&&(!n.is("p,div")||e.className||n.attr("style")||!t.isEmptyObject(n.data()))},convertElement:function(e,t){for(var n,o,i=e.attributes,r=i.length,a=e.ownerDocument.createElement(t);r--;){o=i[r];try{a.setAttribute(o.name,o.value)}catch(e){}}for(;n=e.firstChild;)a.appendChild(n);return e.parentNode.replaceChild(a,e),a},blockLevelList:"|body|hr|p|div|h1|h2|h3|h4|h5|h6|address|pre|form|table|tbody|thead|tfoot|th|tr|td|li|ol|ul|blockquote|center|",canHaveChildren:function(e){return!!/11?|9/.test(e.nodeType)&&"|iframe|area|base|basefont|br|col|frame|hr|img|input|wbr|isindex|link|meta|param|command|embed|keygen|source|track|object|".indexOf("|"+e.nodeName.toLowerCase()+"|")<0},isInline:function(e,t){var n,o=(e||{}).nodeType||3;return 1!==o?3===o:(n=e.tagName.toLowerCase(),"code"===n?!t:i.blockLevelList.indexOf("|"+n+"|")<0)},copyCSS:function(e,t){t.style.cssText=e.style.cssText+t.style.cssText},fixNesting:function(e){var n=function(e){for(;i.isInline(e.parentNode,!0);)e=e.parentNode;return e};i.traverse(e,function(e){var o=!i.isInline(e,!0),r=t(e);if(o&&i.isInline(e.parentNode,!0)){var a=n(e),s=a.parentNode,l=i.extractContents(a,e),c=e;i.copyCSS(a,c),s.insertBefore(l,a),s.insertBefore(c,a)}if(o&&r.is("ul,ol")&&r.parent().is("ul,ol")){var u=r.prev("li");u.length?u.append(r):r.wrap("<li />")}})},findCommonAncestor:function(e,n){return t(e).parents().has(t(n)).first()},getSibling:function(e,t){return e?(t?e.previousSibling:e.nextSibling)||i.getSibling(e.parentNode,t):null},removeWhiteSpace:function(e,n){for(var o,r,a,s,l,c,u,d,f=i.getSibling,p=i.isInline,h=e.firstChild;h;){if(u=h.nextSibling,o=h.nodeValue,1===(r=h.nodeType)&&h.firstChild&&(c=t(h).css("whiteSpace"),/pre(\-wrap)?$/i.test(c)||i.removeWhiteSpace(h,/line$/i.test(c))),3===r){for(a=f(h),s=f(h,!0),d=!1;t(s).hasClass("sceditor-ignore");)s=f(s,!0);if(p(h)&&s){for(l=s;l.lastChild;)l=l.lastChild;d=3===l.nodeType?/[\t\n\r ]$/.test(l.nodeValue):!p(l)}o=o.replace(/\u200B/g,""),s&&p(s)&&!d||(o=o.replace(n?/^[\t ]+/:/^[\t\n\r ]+/,"")),a&&p(a)||(o=o.replace(n?/[\t ]+$/:/[\t\n\r ]+$/,"")),o.length?h.nodeValue=o.replace(n?/[\t ]+/g:/[\t\n\r ]+/g," "):e.removeChild(h)}h=u}},extractContents:function(e,n){var o,r=i.findCommonAncestor(e,n).get(0),a=!1,s=!1;return(o=function(r){var l,c=e.ownerDocument.createDocumentFragment();return i.traverse(r,function(i){if(s||i===n)return s=!0,!1;i===e&&(a=!0),t.contains(i,e)||a&&t.contains(i,n)?((l=i.cloneNode(!1)).appendChild(o(i)),c.appendChild(l)):a&&!t.contains(c,i)&&c.appendChild(i)},!1),c})(r)},getOffset:function(e){for(var t=0,n=0;e;)t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;return{left:t,top:n}},getStyle:function(e,n){var i,r,a,s=e.style;if(!s)return"";if(o[n]||(o[n]=t.camelCase(n)),n=o[n],a=s[n],"textAlign"===n){if(i=t(e),r=s.direction,a=a||i.css(n),i.parent().css(n)===a||"block"!==i.css("display")||i.is("hr")||i.is("th"))return"";if(/right/i.test(a)&&"rtl"===r||/left/i.test(a)&&"ltr"===r)return""}return a},hasStyle:function(e,n,o){var r=i.getStyle(e,n);return!!r&&(!o||r===o||t.isArray(o)&&t.inArray(r,o)>-1)}};return i}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e,t){"use strict";var n=/^(https?|s?ftp|mailto|spotify|skype|ssh|teamspeak|tel):|(\/\/)|data:image\/(png|bmp|gif|p?jpe?g);/i;t.regex=function(e){return e.replace(/([\-.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")},t.entities=function(e,t){if(!e)return e;var n={"&":"&amp;","<":"&lt;",">":"&gt;","  ":"&nbsp; ","\r\n":"<br />","\r":"<br />","\n":"<br />"};return!1!==t&&(n['"']="&#34;",n["'"]="&#39;",n["`"]="&#96;"),e=e.replace(/ {2}|\r\n|[&<>\r\n'"`]/g,function(e){return n[e]||e})},t.uriScheme=function(e){var t,o=/^[^\/]*:/i,i=window.location;return e&&o.test(e)&&!n.test(e)?((t=i.pathname.split("/")).pop(),i.protocol+"//"+i.host+t.join("/")+"/"+e):e}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e,t){"use strict";var o=n(1),i=navigator.userAgent;t.ie=function(){var e=3,t=document,n=t.createElement("div"),o=n.getElementsByTagName("i");do{n.innerHTML="\x3c!--[if gt IE "+ ++e+"]><i></i><![endif]--\x3e"}while(o[0]);return t.documentMode&&t.all&&window.atob&&(e=10),4===e&&t.documentMode&&(e=11),e>4?e:void 0}(),t.edge="-ms-ime-align"in document.documentElement.style,t.ios=/iPhone|iPod|iPad| wosbrowser\//i.test(i),t.isWysiwygSupported=function(){var e,n,r=o('<p contenteditable="true">')[0].contentEditable;return void 0!==r&&"inherit"!==r&&(n=/Opera Mobi|Opera Mini/i.test(i),/Android/i.test(i)&&(n=!0,/Safari/.test(i)&&(n=!(e=/Safari\/(\d+)/.exec(i))||!e[1]||e[1]<534)),/ Silk\//i.test(i)&&(n=!(e=/AppleWebKit\/(\d+)/.exec(i))||!e[1]||e[1]<534),t.ios&&(n=/OS [0-4](_\d)+ like Mac/i.test(i)),/Firefox/i.test(i)&&(n=!1),/OneBrowser/i.test(i)&&(n=!1),"UCWEB"===navigator.vendor&&(n=!1),t.ie<9&&(n=!0),!n)}()}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){"use strict";var t=n(1),o={html:'<!DOCTYPE html><html{attrs}><head><style>.ie * {min-height: auto !important} .ie table td {height:15px} @supports (-ms-ime-align:auto) { * { min-height: auto !important; } }</style><meta http-equiv="Content-Type" content="text/html;charset={charset}" /><link rel="stylesheet" type="text/css" href="{style}" /></head><body contenteditable="true" {spellcheck}><p></p></body></html>',toolbarButton:'<a class="sceditor-button sceditor-button-{name}" data-sceditor-command="{name}" unselectable="on"><div unselectable="on">{dispName}</div></a>',emoticon:'<img src="{url}" data-sceditor-emoticon="{key}" alt="{key}" title="{tooltip}" />',fontOpt:'<a class="sceditor-font-option" href="#" data-font="{font}"><font face="{font}">{font}</font></a>',sizeOpt:'<a class="sceditor-fontsize-option" data-size="{size}" href="#"><font size="{size}">{size}</font></a>',pastetext:'<div><label for="txt">{label}</label> <textarea cols="20" rows="7" id="txt"></textarea></div><div><input type="button" class="button" value="{insert}" /></div>',table:'<div><label for="rows">{rows}</label><input type="text" id="rows" value="2" /></div><div><label for="cols">{cols}</label><input type="text" id="cols" value="2" /></div><div><input type="button" class="button" value="{insert}" /></div>',image:'<div><label for="link">{url}</label> <input type="text" id="image" placeholder="https://" /></div><div><label for="width">{width}</label> <input type="text" id="width" size="2" /></div><div><label for="height">{height}</label> <input type="text" id="height" size="2" /></div><div><input type="button" class="button" value="{insert}" /></div>',email:'<div><label for="email">{label}</label> <input type="text" id="email" /></div><div><label for="des">{desc}</label> <input type="text" id="des" /></div><div><input type="button" class="button" value="{insert}" /></div>',link:'<div><label for="link">{url}</label> <input type="text" id="link" placeholder="https://" /></div><div><label for="des">{desc}</label> <input type="text" id="des" /></div><div><input type="button" class="button" value="{ins}" /></div>',youtubeMenu:'<div><label for="link">{label}</label> <input type="text" id="link" placeholder="https://" /></div><div><input type="button" class="button" value="{insert}" /></div>',youtube:'<iframe width="560" height="315" frameborder="0" allowfullscreensrc="https://www.youtube.com/embed/{id}?wmode=opaque&start={time}" data-youtube-id="{id}"></iframe>'};return function(e,n,i){var r=o[e];return t.each(n,function(e,t){r=r.replace(new RegExp("\\{"+e+"\\}","g"),t)}),i&&(r=t(r)),r}}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){"use strict";function t(e){if("mozHidden"in document)for(var t,n=e.getBody()[0];n;){if((t=n).firstChild)t=t.firstChild;else{for(;t&&!t.nextSibling;)t=t.parentNode;t&&(t=t.nextSibling)}3===n.nodeType&&/[\n\r\t]+/.test(n.nodeValue)&&(/^pre/.test(o(n.parentNode).css("white-space"))||o(n).remove()),n=t}}var o=n(1),i=n(7).ie,r=n(8),a=i&&i<11,s={bold:{exec:"bold",tooltip:"Bold",shortcut:"Ctrl+B"},italic:{exec:"italic",tooltip:"Italic",shortcut:"Ctrl+I"},underline:{exec:"underline",tooltip:"Underline",shortcut:"Ctrl+U"},strike:{exec:"strikethrough",tooltip:"Strikethrough"},subscript:{exec:"subscript",tooltip:"Subscript"},superscript:{exec:"superscript",tooltip:"Superscript"},left:{exec:"justifyleft",tooltip:"Align left"},center:{exec:"justifycenter",tooltip:"Center"},right:{exec:"justifyright",tooltip:"Align right"},justify:{exec:"justifyfull",tooltip:"Justify"},font:{_dropDown:function(e,t,n){for(var i=0,a=e.opts.fonts.split(","),s=o("<div />"),l=function(){return n(o(this).data("font")),e.closeDropDown(!0),!1};i<a.length;i++)s.append(r("fontOpt",{font:a[i]},!0).click(l));e.createDropDown(t,"font-picker",s)},exec:function(e){var t=this;s.font._dropDown(t,e,function(e){t.execCommand("fontname",e)})},tooltip:"Font Name"},size:{_dropDown:function(e,t,n){for(var i=o("<div />"),a=function(t){n(o(this).data("size")),e.closeDropDown(!0),t.preventDefault()},s=1;s<=7;s++)i.append(r("sizeOpt",{size:s},!0).click(a));e.createDropDown(t,"fontsize-picker",i)},exec:function(e){var t=this;s.size._dropDown(t,e,function(e){t.execCommand("fontsize",e)})},tooltip:"Font Size"},color:{_dropDown:function(e,t,n){var i=o("<div />"),r="",a=s.color;a._htmlCache||(e.opts.colors.split("|").forEach(function(e){r+='<div class="sceditor-color-column">',e.split(",").forEach(function(e){r+='<a href="#" class="sceditor-color-option" style="background-color: '+e+'" data-color="'+e+'"></a>'}),r+="</div>"}),a._htmlCache=r),i.html(a._htmlCache).find("a").click(function(t){n(o(this).attr("data-color")),e.closeDropDown(!0),t.preventDefault()}),e.createDropDown(t,"color-picker",i)},exec:function(e){var t=this;s.color._dropDown(t,e,function(e){t.execCommand("forecolor",e)})},tooltip:"Font Color"},removeformat:{exec:"removeformat",tooltip:"Remove Formatting"},cut:{exec:"cut",tooltip:"Cut",errorMessage:"Your browser does not allow the cut command. Please use the keyboard shortcut Ctrl/Cmd-X"},copy:{exec:"copy",tooltip:"Copy",errorMessage:"Your browser does not allow the copy command. Please use the keyboard shortcut Ctrl/Cmd-C"},paste:{exec:"paste",tooltip:"Paste",errorMessage:"Your browser does not allow the paste command. Please use the keyboard shortcut Ctrl/Cmd-V"},pastetext:{exec:function(e){var t,n,o=this;(n=r("pastetext",{label:o._("Paste your text inside the following box:"),insert:o._("Insert")},!0)).find(".button").click(function(e){(t=n.find("#txt").val())&&o.wysiwygEditorInsertText(t),o.closeDropDown(!0),e.preventDefault()}),o.createDropDown(e,"pastetext",n)},tooltip:"Paste Text"},bulletlist:{exec:function(){t(this),this.execCommand("insertunorderedlist")},tooltip:"Bullet list"},orderedlist:{exec:function(){t(this),this.execCommand("insertorderedlist")},tooltip:"Numbered list"},indent:{state:function(e,t){var n,i,r,a=o(t),s=a.parents("ul,ol,menu"),l=s.first();if(s.length>1||l.children().length>1)return 0;if(a.is("ul,ol,menu")){if(n=this.getRangeHelper().selectedRange(),!(window.Range&&n instanceof Range))return a.is("li,ul,ol,menu")?0:-1;if(i=n.startContainer.parentNode,r=n.endContainer.parentNode,i!==i.parentNode.firstElementChild||o(r).is("li")&&r!==r.parentNode.lastElementChild)return 0}return-1},exec:function(){var e=this,t=o(e.getRangeHelper().getFirstBlockParent());e.focus(),t.parents("ul,ol,menu")&&e.execCommand("indent")},tooltip:"Add indent"},outdent:{state:function(e,t){return o(t).is("ul,ol,menu")||o(t).parents("ul,ol,menu").length>0?0:-1},exec:function(){var e=this;o(e.getRangeHelper().getFirstBlockParent()).parents("ul,ol,menu")&&e.execCommand("outdent")},tooltip:"Remove one indent"},table:{exec:function(e){var t=this,n=r("table",{rows:t._("Rows:"),cols:t._("Cols:"),insert:t._("Insert")},!0);n.find(".button").click(function(e){var o,i,r=n.find("#rows").val()-0,s=n.find("#cols").val()-0,l="<table>";if(!(r<1||s<1)){for(o=0;o<r;o++){for(l+="<tr>",i=0;i<s;i++)l+="<td>"+(a?"":"<br />")+"</td>";l+="</tr>"}l+="</table>",t.wysiwygEditorInsertHtml(l),t.closeDropDown(!0),e.preventDefault()}}),t.createDropDown(e,"inserttable",n)},tooltip:"Insert a table"},horizontalrule:{exec:"inserthorizontalrule",tooltip:"Insert a horizontal rule"},code:{exec:function(){this.wysiwygEditorInsertHtml("<code>",(a?"":"<br />")+"</code>")},tooltip:"Code"},image:{_dropDown:function(e,t,n){var o=r("image",{url:e._("URL:"),width:e._("Width (optional):"),height:e._("Height (optional):"),insert:e._("Insert")},!0),i=o.find("#image");o.find(".button").click(function(t){i.val()&&n(i.val(),o.find("#width").val(),o.find("#height").val()),e.closeDropDown(!0),t.preventDefault()}),e.createDropDown(t,"insertimage",o)},exec:function(e){var t=this;s.image._dropDown(t,e,function(e,n,o){var i="";n&&(i+=' width="'+n+'"'),o&&(i+=' height="'+o+'"'),t.wysiwygEditorInsertHtml("<img"+i+' src="'+e+'" />')})},tooltip:"Insert an image"},email:{_dropDown:function(e,t,n){function o(t){a.val()&&n(a.val(),i.find("#des").val()),e.closeDropDown(!0),t.preventDefault()}var i=r("email",{label:e._("E-mail:"),desc:e._("Description (optional):"),insert:e._("Insert")},!0),a=i.find("#email");i.find(".button").click(o),a.add(i.find("#des")).keypress(function(e){13===e.which&&a.val()&&o(e)}),e.createDropDown(t,"insertemail",i)},exec:function(e){var t=this;s.email._dropDown(t,e,function(e,n){t.focus(),!t.getRangeHelper().selectedHtml()||n?t.wysiwygEditorInsertHtml('<a href="mailto:'+e+'">'+(n||e)+"</a>"):t.execCommand("createlink","mailto:"+e)})},tooltip:"Insert an email"},link:{_dropDown:function(e,t,n){function o(t){a.val()&&n(a.val(),i.find("#des").val()),e.closeDropDown(!0),t.preventDefault()}var i=r("link",{url:e._("URL:"),desc:e._("Description (optional):"),ins:e._("Insert")},!0),a=i.find("#link");i.find(".button").click(o),a.add(i.find("#des")).keypress(function(e){13===e.which&&a.val()&&o(e)}),e.createDropDown(t,"insertlink",i)},exec:function(e){var t=this;s.link._dropDown(t,e,function(e,n){t.focus(),!t.getRangeHelper().selectedHtml()||n?(n=n||e,t.wysiwygEditorInsertHtml('<a href="'+e+'">'+n+"</a>")):t.execCommand("createlink",e)})},tooltip:"Insert a link"},unlink:{state:function(){var e=o(this.currentNode());return e.is("a")||e.parents("a").length>0?0:-1},exec:function(){var e=o(this.currentNode()),t=e.is("a")?e:e.parents("a").first();t.length&&t.replaceWith(t.contents())},tooltip:"Unlink"},quote:{exec:function(e,t,n){var o="<blockquote>",i="</blockquote>";t?(o=o+(n=n?"<cite>"+n+"</cite>":"")+t+i,i=null):""===this.getRangeHelper().selectedHtml()&&(i=(a?"":"<br />")+i),this.wysiwygEditorInsertHtml(o,i)},tooltip:"Insert a Quote"},emoticon:{exec:function(e){var t=this,n=function(i){var r,a=t.opts.emoticonsCompat,s=t.getRangeHelper(),l=a&&" "!==s.getOuterText(!0,1)?" ":"",c=a&&" "!==s.getOuterText(!1,1)?" ":"",u=o("<div />"),d=o("<div />").appendTo(u),f=0,p=o.extend({},t.opts.emoticons.dropdown,i?t.opts.emoticons.more:{});return o.each(p,function(){f++}),f=Math.sqrt(f),o.each(p,function(e,n){d.append(o("<img />").attr({src:n.url||n,alt:e,title:n.tooltip||e}).click(function(){return t.insert(l+o(this).attr("alt")+c,null,!1).closeDropDown(!0),!1})),d.children().length>=f&&(d=o("<div />").appendTo(u))}),!i&&t.opts.emoticons.more&&(r=o('<a class="sceditor-more">'+t._("More")+"</a>").click(function(){return t.createDropDown(e,"more-emoticons",n(!0)),!1}),u.append(r)),u};t.createDropDown(e,"emoticons",n(!1))},txtExec:function(e){s.emoticon.exec.call(this,e)},tooltip:"Insert an emoticon"},youtube:{_dropDown:function(e,t,n){var i=r("youtubeMenu",{label:e._("Video URL:"),insert:e._("Insert")},!0);i.find(".button").click(function(t){var r=i.find(i,"#link").val(),a=r.match(/(?:v=|v\/|embed\/|youtu.be\/)(.{11})/),s=r.match(/[&|?](?:star)?t=((\d+[hms]?){1,3})/),l=0;s&&o.each(s[1].split(/[hms]/),function(e,t){""!==t&&(l=60*l+Number(t))}),a&&/^[a-zA-Z0-9_\-]{11}$/.test(a[1])&&n(a[1],l),e.closeDropDown(!0),t.preventDefault()}),e.createDropDown(t,"insertlink",i)},exec:function(e){var t=this;s.youtube._dropDown(t,e,function(e){t.wysiwygEditorInsertHtml(r("youtube",{id:e}))})},tooltip:"Insert a YouTube video"},date:{_date:function(e){var t=new Date,n=t.getYear(),o=t.getMonth()+1,i=t.getDate();return n<2e3&&(n=1900+n),o<10&&(o="0"+o),i<10&&(i="0"+i),e.opts.dateFormat.replace(/year/i,n).replace(/month/i,o).replace(/day/i,i)},exec:function(){this.insertText(s.date._date(this))},txtExec:function(){this.insertText(s.date._date(this))},tooltip:"Insert current date"},time:{_time:function(){var e=new Date,t=e.getHours(),n=e.getMinutes(),o=e.getSeconds();return t<10&&(t="0"+t),n<10&&(n="0"+n),o<10&&(o="0"+o),t+":"+n+":"+o},exec:function(){this.insertText(s.time._time())},txtExec:function(){this.insertText(s.time._time())},tooltip:"Insert current time"},ltr:{state:function(e,t){return t&&"ltr"===t.style.direction},exec:function(){var e=this,t=e.getRangeHelper().getFirstBlockParent(),n=o(t);e.focus(),(t&&!n.is("body")||(e.execCommand("formatBlock","p"),t=e.getRangeHelper().getFirstBlockParent(),n=o(t),t&&!n.is("body")))&&("ltr"===n.css("direction")?n.css("direction",""):n.css("direction","ltr"))},tooltip:"Left-to-Right"},rtl:{state:function(e,t){return t&&"rtl"===t.style.direction},exec:function(){var e=this,t=e.getRangeHelper().getFirstBlockParent(),n=o(t);e.focus(),(t&&!n.is("body")||(e.execCommand("formatBlock","p"),t=e.getRangeHelper().getFirstBlockParent(),n=o(t),t&&!n.is("body")))&&("rtl"===n.css("direction")?n.css("direction",""):n.css("direction","rtl"))},tooltip:"Right-to-Left"},print:{exec:"print",tooltip:"Print"},maximize:{state:function(){return this.maximize()},exec:function(){this.maximize(!this.maximize())},txtExec:function(){this.maximize(!this.maximize())},tooltip:"Maximize",shortcut:"Ctrl+Shift+M"},source:{state:function(){return this.sourceMode()},exec:function(){this.toggleSourceMode()},txtExec:function(){this.toggleSourceMode()},tooltip:"View source",shortcut:"Ctrl+Shift+S"},ignore:{}};return s}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){var o;void 0!==(o=function(e){"use strict";return{toolbar:"bold,italic,underline,strike,subscript,superscript|left,center,right,justify|font,size,color,removeformat|cut,copy,paste,pastetext|bulletlist,orderedlist,indent,outdent|table|code,quote|horizontalrule,image,email,link,unlink|emoticon,youtube,date,time|ltr,rtl|print,maximize,source",toolbarExclude:null,style:"jquery.sceditor.default.css",fonts:"Arial,Arial Black,Comic Sans MS,Courier New,Georgia,Impact,Sans-serif,Serif,Times New Roman,Trebuchet MS,Verdana",colors:"#000,#44B8FF,#1E92F7,#0074D9,#005DC2,#00369B,#b3d5f4|#444,#C3FFFF,#9DF9FF,#7FDBFF,#68C4E8,#419DC1,#d9f4ff|#666,#72FF84,#4CEA5E,#2ECC40,#17B529,#008E02,#c0f0c6|#888,#FFFF44,#FFFA1E,#FFDC00,#E8C500,#C19E00,#fff5b3|#aaa,#FFC95F,#FFA339,#FF851B,#E86E04,#C14700,#ffdbbb|#ccc,#FF857A,#FF5F54,#FF4136,#E82A1F,#C10300,#ffc6c3|#eee,#FF56FF,#FF30DC,#F012BE,#D900A7,#B20080,#fbb8ec|#fff,#F551FF,#CF2BE7,#B10DC9,#9A00B2,#9A00B2,#e8b6ef",locale:n(1)("html").attr("lang")||"en",charset:"utf-8",emoticonsCompat:!1,emoticonsEnabled:!0,emoticonsRoot:"",emoticons:{dropdown:{":)":"emoticons/smile.png",":angel:":"emoticons/angel.png",":angry:":"emoticons/angry.png","8-)":"emoticons/cool.png",":'(":"emoticons/cwy.png",":ermm:":"emoticons/ermm.png",":D":"emoticons/grin.png","<3":"emoticons/heart.png",":(":"emoticons/sad.png",":O":"emoticons/shocked.png",":P":"emoticons/tongue.png",";)":"emoticons/wink.png"},more:{":alien:":"emoticons/alien.png",":blink:":"emoticons/blink.png",":blush:":"emoticons/blush.png",":cheerful:":"emoticons/cheerful.png",":devil:":"emoticons/devil.png",":dizzy:":"emoticons/dizzy.png",":getlost:":"emoticons/getlost.png",":happy:":"emoticons/happy.png",":kissing:":"emoticons/kissing.png",":ninja:":"emoticons/ninja.png",":pinch:":"emoticons/pinch.png",":pouty:":"emoticons/pouty.png",":sick:":"emoticons/sick.png",":sideways:":"emoticons/sideways.png",":silly:":"emoticons/silly.png",":sleeping:":"emoticons/sleeping.png",":unsure:":"emoticons/unsure.png",":woot:":"emoticons/w00t.png",":wassat:":"emoticons/wassat.png"},hidden:{":whistling:":"emoticons/whistling.png",":love:":"emoticons/wub.png"}},width:null,height:null,resizeEnabled:!0,resizeMinWidth:null,resizeMinHeight:null,resizeMaxHeight:null,resizeMaxWidth:null,resizeHeight:!0,resizeWidth:!0,dateFormat:"year-month-day",toolbarContainer:null,enablePasteFiltering:!1,disablePasting:!1,readOnly:!1,rtl:!1,autofocus:!1,autofocusEnd:!0,autoExpand:!1,autoUpdate:!1,spellcheck:!0,runWithoutWysiwygSupport:!1,startInSourceMode:!1,id:null,plugins:"",zIndex:null,bbcodeTrim:!1,disableBlockRemove:!1,parserOptions:{},dropDownCss:{}}}.call(t,n,t,e))&&(e.exports=o)}]),function(e,t,n){"use strict";var o=e.sceditor,i=o.plugins,r=o.escapeEntities,a=o.escapeUriScheme,s=o.ie,l=s&&s<11,c=o.command.get,u={bold:{txtExec:["[b]","[/b]"]},italic:{txtExec:["[i]","[/i]"]},underline:{txtExec:["[u]","[/u]"]},strike:{txtExec:["[s]","[/s]"]},subscript:{txtExec:["[sub]","[/sub]"]},superscript:{txtExec:["[sup]","[/sup]"]},left:{txtExec:["[left]","[/left]"]},center:{txtExec:["[center]","[/center]"]},right:{txtExec:["[right]","[/right]"]},justify:{txtExec:["[justify]","[/justify]"]},font:{txtExec:function(e){var t=this;c("font")._dropDown(t,e,function(e){t.insertText("[font="+e+"]","[/font]")})}},size:{txtExec:function(e){var t=this;c("size")._dropDown(t,e,function(e){t.insertText("[size="+e+"]","[/size]")})}},color:{txtExec:function(e){var t=this;c("color")._dropDown(t,e,function(e){t.insertText("[color="+e+"]","[/color]")})}},bulletlist:{txtExec:function(t,n){var o="";e.each(n.split(/\r?\n/),function(){o+=(o?"\n":"")+"[li]"+this+"[/li]"}),this.insertText("[ul]\n"+o+"\n[/ul]")}},orderedlist:{txtExec:function(t,n){var o="";e.each(n.split(/\r?\n/),function(){o+=(o?"\n":"")+"[li]"+this+"[/li]"}),i.bbcode.bbcode.get(""),this.insertText("[ol]\n"+o+"\n[/ol]")}},table:{txtExec:["[table][tr][td]","[/td][/tr][/table]"]},horizontalrule:{txtExec:["[hr]"]},code:{txtExec:["[code]","[/code]"]},image:{txtExec:function(e){var t=this;c("image")._dropDown(t,e,function(e,n,o){var i="";n&&(i+=" width="+n),o&&(i+=" height="+o),t.insertText("[img"+i+"]"+e+"[/img]")})}},email:{txtExec:function(e,t){var n=this;c("email")._dropDown(n,e,function(e,o){n.insertText("[email="+e+"]"+(o||t||e)+"[/email]")})}},link:{txtExec:function(e,t){var n=this;c("link")._dropDown(n,e,function(e,o){n.insertText("[url="+e+"]"+(o||t||e)+"[/url]")})}},quote:{txtExec:["[quote]","[/quote]"]},youtube:{txtExec:function(e){var t=this;c("youtube")._dropDown(t,e,function(e){t.insertText("[youtube]"+e+"[/youtube]")})}},rtl:{txtExec:["[rtl]","[/rtl]"]},ltr:{txtExec:["[ltr]","[/ltr]"]}},d=function(e){return e?e.replace(/\\(.)/g,"$1").replace(/^(["'])(.*?)\1$/,"$2"):e},f=function(){var e=arguments;return e[0].replace(/\{(\d+)\}/g,function(t,n){return void 0!==e[n-0+1]?e[n-0+1]:"{"+n+"}"})},p={OPEN:"open",CONTENT:"content",NEWLINE:"newline",CLOSE:"close"},h=function(t,n,o,i,r,a){var s=this;s.type=t,s.name=n,s.val=o,s.attrs=e.extend({},i),s.children=r||[],s.closing=a||null};h.prototype={clone:function(){var e=this;return new h(e.type,e.name,e.val,e.attrs,[],e.closing?e.closing.clone():null)},splitAt:function(e){var t,n=this,o=n.clone(),i=n.children.indexOf(e);return i>-1&&(t=n.children.length-i,o.children=n.children.splice(i,t)),o}};var m=function(t){if(!(this instanceof m))return new m(t);var n,o,a,s,c,u,f,g,v,b,y,x,w,C,E=this;n=function(){E.bbcodes=i.bbcode.bbcodes,E.opts=e.extend({},m.defaults,t)},E.tokenize=function(e){var t,n,i,r=[],a=[{type:p.CLOSE,regex:/^\[\/[^\[\]]+\]/},{type:p.OPEN,regex:/^\[[^\[\]]+\]/},{type:p.NEWLINE,regex:/^(\r\n|\r|\n)/},{type:p.CONTENT,regex:/^([^\[\r\n]+|\[)/}];a.reverse();e:for(;e.length;){for(i=a.length;i--;)if(n=a[i].type,(t=e.match(a[i].regex))&&t[0]){r.push(o(n,t[0])),e=e.substr(t[0].length);continue e}e.length&&r.push(o(p.CONTENT,e)),e=""}return r},o=function(t,n){var o,r,s,l=/\[([^\]\s=]+)(?:([^\]]+))?\]/,c=/\[\/([^\[\]]+)\]/;return t===p.OPEN&&(o=n.match(l))&&(s=w(o[1]),o[2]&&(o[2]=e.trim(o[2]))&&(r=a(o[2]))),t===p.CLOSE&&(o=n.match(c))&&(s=w(o[1])),t===p.NEWLINE&&(s="#newline"),s&&(t!==p.OPEN&&t!==p.CLOSE||i.bbcode.bbcodes[s])||(t=p.CONTENT,s="#"),new h(t,s,n,r)},a=function(e){var t,n=/([^\s=]+)=(?:(?:(["'])((?:\\\2|[^\2])*?)\2)|((?:.(?!\s\S+=))*.))/g,o={};if("="===e.charAt(0)&&e.indexOf("=",1)<0)o.defaultattr=d(e.substr(1));else for("="===e.charAt(0)&&(e="defaultattr"+e);t=n.exec(e);)o[w(t[1])]=d(t[3])||t[4];return o},E.parse=function(e,t){var n=s(E.tokenize(e)),o=E.opts;return o.fixInvalidNesting&&u(n),c(n,null,t),o.removeEmptyTags&&g(n),n},y=function(e,t,n){for(var o=n.length;o--;)if(n[o].type===t&&n[o].name===e)return!0;return!1},f=function(t,n){var o=(t?E.bbcodes[t.name]:{}).allowedChildren;return!E.opts.fixInvalidChildren||!o||e.inArray(n.name||"#",o)>-1},s=function(t){for(var n,o,i,r,a,s,l=[],c=[],u=[],d=function(){return C(u)},h=function(e){d()?d().children.push(e):c.push(e)},m=function(t){return d()&&(o=E.bbcodes[d().name])&&o.closedBy&&e.inArray(t,o.closedBy)>-1};n=t.shift();)switch(s=t[0],f(d(),n)||n.type===p.CLOSE&&d()&&n.name===d().name||(n.name="#",n.type=p.CONTENT),n.type){case p.OPEN:m(n.name)&&u.pop(),h(n),(o=E.bbcodes[n.name])&&!o.isSelfClosing&&(o.closedBy||y(n.name,p.CLOSE,t))?u.push(n):o&&o.isSelfClosing||(n.type=p.CONTENT);break;case p.CLOSE:if(d()&&n.name!==d().name&&m("/"+n.name)&&u.pop(),d()&&n.name===d().name)d().closing=n,u.pop();else if(y(n.name,p.OPEN,u)){for(;i=u.pop();){if(i.name===n.name){i.closing=n;break}r=i.clone(),l.length>1&&r.children.push(C(l)),l.push(r)}for(s&&s.type===p.NEWLINE&&(o=E.bbcodes[n.name])&&!1===o.isInline&&(h(s),t.shift()),h(C(l)),a=l.length;a--;)u.push(l[a]);l.length=0}else n.type=p.CONTENT,h(n);break;case p.NEWLINE:d()&&s&&m((s.type===p.CLOSE?"/":"")+s.name)&&(s.type===p.CLOSE&&s.name===d().name||((o=E.bbcodes[d().name])&&o.breakAfter?u.pop():o&&!1===o.isInline&&E.opts.breakAfterBlock&&!1!==o.breakAfter&&u.pop())),h(n);break;default:h(n)}return c},c=function(e,t,n){var o,i,r,a,s,l,u,d,f=e.length;t&&(a=E.bbcodes[t.name]);for(var h=f;h--;)if(o=e[h])if(o.type===p.NEWLINE){if(i=h>0?e[h-1]:null,r=h<f-1?e[h+1]:null,d=!1,!n&&a&&!0!==a.isSelfClosing&&(i?l||r||(!1===a.isInline&&E.opts.breakEndBlock&&!1!==a.breakEnd&&(d=!0),a.breakEnd&&(d=!0),l=d):(!1===a.isInline&&E.opts.breakStartBlock&&!1!==a.breakStart&&(d=!0),a.breakStart&&(d=!0))),i&&i.type===p.OPEN&&(s=E.bbcodes[i.name])&&(n?!1===s.isInline&&(d=!0):(!1===s.isInline&&E.opts.breakAfterBlock&&!1!==s.breakAfter&&(d=!0),s.breakAfter&&(d=!0))),!n&&!u&&r&&r.type===p.OPEN&&(s=E.bbcodes[r.name])&&(!1===s.isInline&&E.opts.breakBeforeBlock&&!1!==s.breakBefore&&(d=!0),s.breakBefore&&(d=!0),u=d,d)){e.splice(h,1);continue}d&&e.splice(h,1),u=!1}else o.type===p.OPEN&&c(o.children,o,n)},u=function(t,n,o,i){var r,a,s,l,c,d,h=function(e){var t=E.bbcodes[e.name];return!t||!1!==t.isInline};for(n=n||[],i=i||t,a=0;a<t.length;a++)if((r=t[a])&&r.type===p.OPEN){if(o&&!h(r)){if(s=C(n),d=s.splitAt(r),c=n.length>1?n[n.length-2].children:i,f(r,s)){var m=s.clone();m.children=r.children,r.children=[m]}if((l=e.inArray(s,c))>-1){d.children.splice(0,1),c.splice(l+1,0,r,d);var g=d.children[0];return void(g&&g.type===p.NEWLINE&&(h(r)||(d.children.splice(0,1),c.splice(l+2,0,g))))}}n.push(r),u(r.children,n,o||h(r),i),n.pop(r)}},g=function(t){for(var n,o,i=t.length;i--;)(n=t[i])&&n.type===p.OPEN&&(o=E.bbcodes[n.name],g(n.children),function(e){for(var t=e.length;t--;){var n=e[t].type;if(n===p.OPEN||n===p.CLOSE)return!1;if(n===p.CONTENT&&/\S|\u00A0/.test(e[t].val))return!1}return!0}(n.children)&&o&&!o.isSelfClosing&&!o.allowsEmpty&&t.splice.apply(t,e.merge([i,1],n.children)))},E.toHTML=function(e,t){return v(E.parse(e,t),!0)},v=function(t,n){var o,a,s,c,u,d,f,h,m=[];for(f=function(e){return!1!==(!e||(void 0!==e.isHtmlInline?e.isHtmlInline:e.isInline))};t.length>0;)if(o=t.shift()){if(o.type===p.OPEN)h=o.children[o.children.length-1]||{},a=E.bbcodes[o.name],u=n&&f(a),s=v(o.children,!1),a&&a.html?(f(a)||!f(E.bbcodes[h.name])||a.isPreFormatted||a.skipLastLineBreak||l||(s+="<br />"),e.isFunction(a.html)?c=a.html.call(E,o,o.attrs,s):(o.attrs[0]=s,c=i.bbcode.formatBBCodeString(a.html,o.attrs))):c=o.val+s+(o.closing?o.closing.val:"");else{if(o.type===p.NEWLINE){if(!n){m.push("<br />");continue}d||m.push("<div>"),l||m.push("<br />"),t.length||m.push("<br />"),m.push("</div>\n"),d=!1;continue}u=n,c=r(o.val,!0)}u&&!d?(m.push("<div>"),d=!0):!u&&d&&(m.push("</div>\n"),d=!1),m.push(c)}return d&&m.push("</div>\n"),m.join("")},E.toBBCode=function(e,t){return b(E.parse(e,t))},b=function(e){for(var t,n,o,i,r,a,s,l,c,u,d=[];e.length>0;)if(t=e.shift())if(o=E.bbcodes[t.name],i=!(!o||!1!==o.isInline),r=o&&o.isSelfClosing,s=i&&E.opts.breakBeforeBlock&&!1!==o.breakBefore||o&&o.breakBefore,l=i&&!r&&E.opts.breakStartBlock&&!1!==o.breakStart||o&&o.breakStart,c=i&&E.opts.breakEndBlock&&!1!==o.breakEnd||o&&o.breakEnd,u=i&&E.opts.breakAfterBlock&&!1!==o.breakAfter||o&&o.breakAfter,a=(o?o.quoteType:null)||E.opts.quoteType||m.QuoteType.auto,o||t.type!==p.OPEN)if(t.type===p.OPEN){if(s&&d.push("\n"),d.push("["+t.name),t.attrs){t.attrs.defaultattr&&(d.push("=",x(t.attrs.defaultattr,a,"defaultattr")),delete t.attrs.defaultattr);for(n in t.attrs)t.attrs.hasOwnProperty(n)&&d.push(" ",n,"=",x(t.attrs[n],a,n))}d.push("]"),l&&d.push("\n"),t.children&&d.push(b(t.children)),r||o.excludeClosing||(c&&d.push("\n"),d.push("[/"+t.name+"]")),u&&d.push("\n"),t.closing&&r&&d.push(t.closing.val)}else d.push(t.val);else d.push(t.val),t.children&&d.push(b(t.children)),t.closing&&d.push(t.closing.val);return d.join("")},x=function(t,n,o){var i=m.QuoteType,r=/\s|=/.test(t);return e.isFunction(n)?n(t,o):n===i.never||n===i.auto&&!r?t:'"'+t.replace("\\","\\\\").replace('"','\\"')+'"'},C=function(e){return e.length?e[e.length-1]:null},w=function(e){return e.toLowerCase()},n()};m.QuoteType={always:1,never:2,auto:3},m.defaults={breakBeforeBlock:!1,breakStartBlock:!1,breakEndBlock:!1,breakAfterBlock:!0,removeEmptyTags:!0,fixInvalidNesting:!0,fixInvalidChildren:!0,quoteType:m.QuoteType.auto},e.sceditorBBCodePlugin=i.bbcode=function(){var t,r,a,s,c=this;c.bbcodes=i.bbcode.bbcodes,c.stripQuotes=d;var p={},h={},g={ul:["li","ol","ul"],ol:["li","ol","ul"],table:["tr"],tr:["td","th"],code:["br","p","div"]};c.init=function(){c.opts=this.opts,t(),this.commands=e.extend(!0,{},u,this.commands),this.toBBCode=c.signalToSource,this.fromBBCode=c.signalToWysiwyg},t=function(){e.each(c.bbcodes,function(t){var n,o=c.bbcodes[t].tags,i=c.bbcodes[t].styles;o&&e.each(o,function(e,o){n=!1===c.bbcodes[t].isInline,p[e]=p[e]||{},p[e][n]=p[e][n]||{},p[e][n][t]=o}),i&&e.each(i,function(e,o){n=!1===c.bbcodes[t].isInline,h[n]=h[n]||{},h[n][e]=h[n][e]||{},h[n][e][t]=o})})},r=function(t,n,i){var r,a,s=o.dom.getStyle;return i=!!i,h[i]?(e.each(h[i],function(o,i){(r=s(t[0],o))&&s(t.parent()[0],o)!==r&&e.each(i,function(o,i){(!i||e.inArray(r.toString(),i)>-1)&&(a=c.bbcodes[o].format,n=e.isFunction(a)?a.call(c,t,n):f(a,n))})}),n):n},a=function(t,n,i){var r,a,s=t[0],u=s.nodeName.toLowerCase();i=!!i,p[u]&&p[u][i]&&e.each(p[u][i],function(o,i){i&&(r=!1,e.each(i,function(n,o){if(t.attr(n)&&!(o&&e.inArray(t.attr(n),o)<0))return r=!0,!1}),!r)||(a=c.bbcodes[o].format,n=e.isFunction(a)?a.call(c,t,n):f(a,n))});var d=o.dom.isInline;if(i&&(!d(s,!0)||"br"===u)){for(var h,m,g=s.previousSibling;g&&1===g.nodeType&&!e(g).is("br")&&d(g,!0)&&!g.firstChild;)g=g.previousSibling;do{h=(m=s.parentNode).lastChild===s,s=m}while(m&&h&&d(m,!0));(!h||"li"===u||"br"===u&&l)&&(n+="\n"),"br"!==u&&g&&!e(g).is("br")&&d(g,!0)&&(n="\n"+n)}return n},c.signalToSource=function(t,i){var r,a,s=new m(c.opts.parserOptions);return i||(i="string"==typeof t?r=e("<div />").css("visibility","hidden").appendTo(n.body).html(t):e(t)),i&&i.jquery?(o.dom.removeWhiteSpace(i[0]),e(".sceditor-ignore",i).remove(),a=c.elementToBbcode(i),r&&r.remove(),a=s.toBBCode(a,!0),c.opts.bbcodeTrim&&(a=e.trim(a)),a):""},c.elementToBbcode=function(t){var n=function(t,i){var s="";return o.dom.traverse(t,function(t){var o=e(t),c="",u=t.nodeType,d=t.nodeName.toLowerCase(),f=g[d],p=t.firstChild,h=!0;if("object"==typeof i&&(h=e.inArray(d,i)>-1,o.is("img")&&o.data("sceditor-emoticon")&&(h=!0),h||(f=i)),3===u||1===u)if(1===u){if(o.hasClass("sceditor-nlf")&&(!p||!l&&1===t.childNodes.length&&/br/i.test(p.nodeName)))return;"iframe"!==d&&(c=n(t,f)),h?("code"!==d&&(c=r(o,c),c=a(o,c),c=r(o,c,!0)),s+=a(o,c,!0)):s+=c}else s+=t.nodeValue},!1,!0),s};return n(t[0])},c.signalToWysiwyg=function(t,n){var o=new m(c.opts.parserOptions).toHTML(c.opts.bbcodeTrim?e.trim(t):t);return n?s(o):o},s=function(t){var i,r,a,s=e("<div />").hide().appendTo(n.body),c=s[0];return a=function(t,i){if(!o.dom.hasStyling(t)){if(l||1!==t.childNodes.length||!e(t.firstChild).is("br"))for(;r=t.firstChild;)c.insertBefore(r,t);if(i){var a=c.lastChild;t!==a&&e(a).is("div")&&t.nextSibling===a&&c.insertBefore(n.createElement("br"),t)}c.removeChild(t)}},c.innerHTML=t.replace(/<\/div>\n/g,"</div>"),(i=c.firstChild)&&e(i).is("div")&&a(i,!0),(i=c.lastChild)&&e(i).is("div")&&a(i),c=c.innerHTML,s.remove(),c}},i.bbcode.formatBBCodeString=function(e,t){return e.replace(/\{([^}]+)\}/g,function(e,n){var o=!0;return"!"===n.charAt(0)&&(o=!1,n=n.substring(1)),"0"===n&&(o=!1),void 0===t[n]?e:o?r(t[n],!0):t[n]})};var g=function(e){return e=parseInt(e,10),isNaN(e)?"00":(e=Math.max(0,Math.min(e,255)).toString(16),e.length<2?"0"+e:e)},v=function(e){var t;return e=e||"#000",(t=e.match(/rgb\((\d{1,3}),\s*?(\d{1,3}),\s*?(\d{1,3})\)/i))?"#"+g(t[1])+g(t[2]-0)+g(t[3]-0):(t=e.match(/#([0-f])([0-f])([0-f])\s*?$/i))?"#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]:e},b={b:{tags:{b:null,strong:null},styles:{"font-weight":["bold","bolder","401","700","800","900"]},format:"[b]{0}[/b]",html:"<strong>{0}</strong>"},i:{tags:{i:null,em:null},styles:{"font-style":["italic","oblique"]},format:"[i]{0}[/i]",html:"<em>{0}</em>"},u:{tags:{u:null},styles:{"text-decoration":["underline"]},format:"[u]{0}[/u]",html:"<u>{0}</u>"},s:{tags:{s:null,strike:null},styles:{"text-decoration":["line-through"]},format:"[s]{0}[/s]",html:"<s>{0}</s>"},sub:{tags:{sub:null},format:"[sub]{0}[/sub]",html:"<sub>{0}</sub>"},sup:{tags:{sup:null},format:"[sup]{0}[/sup]",html:"<sup>{0}</sup>"},font:{tags:{font:{face:null}},styles:{"font-family":null},quoteType:m.QuoteType.never,format:function(e,t){var n;return e.is("font")&&(n=e.attr("face"))||(n=e.css("font-family")),"[font="+d(n)+"]"+t+"[/font]"},html:'<font face="{defaultattr}">{0}</font>'},size:{tags:{font:{size:null}},styles:{"font-size":null},format:function(e,t){var n=e.attr("size"),o=2;return n||(n=e.css("fontSize")),n.indexOf("px")>-1?((n=n.replace("px","")-0)<12&&(o=1),n>15&&(o=3),n>17&&(o=4),n>23&&(o=5),n>31&&(o=6),n>47&&(o=7)):o=n,"[size="+o+"]"+t+"[/size]"},html:'<font size="{defaultattr}">{!0}</font>'},color:{tags:{font:{color:null}},styles:{color:null},quoteType:m.QuoteType.never,format:function(e,t){var n;return e.is("font")&&(n=e.attr("color"))||(n=e[0].style.color||e.css("color")),"[color="+v(n)+"]"+t+"[/color]"},html:function(e,t,n){return'<font color="'+r(v(t.defaultattr),!0)+'">'+n+"</font>"}},ul:{tags:{ul:null},breakStart:!0,isInline:!1,skipLastLineBreak:!0,format:"[ul]{0}[/ul]",html:"<ul>{0}</ul>"},list:{breakStart:!0,isInline:!1,skipLastLineBreak:!0,html:"<ul>{0}</ul>"},ol:{tags:{ol:null},breakStart:!0,isInline:!1,skipLastLineBreak:!0,format:"[ol]{0}[/ol]",html:"<ol>{0}</ol>"},li:{tags:{li:null},isInline:!1,closedBy:["/ul","/ol","/list","*","li"],format:"[li]{0}[/li]",html:"<li>{0}</li>"},"*":{isInline:!1,closedBy:["/ul","/ol","/list","*","li"],html:"<li>{0}</li>"},table:{tags:{table:null},isInline:!1,isHtmlInline:!0,skipLastLineBreak:!0,format:"[table]{0}[/table]",html:"<table>{0}</table>"},tr:{tags:{tr:null},isInline:!1,skipLastLineBreak:!0,format:"[tr]{0}[/tr]",html:"<tr>{0}</tr>"},th:{tags:{th:null},allowsEmpty:!0,isInline:!1,format:"[th]{0}[/th]",html:"<th>{0}</th>"},td:{tags:{td:null},allowsEmpty:!0,isInline:!1,format:"[td]{0}[/td]",html:"<td>{0}</td>"},emoticon:{allowsEmpty:!0,tags:{img:{src:null,"data-sceditor-emoticon":null}},format:function(e,t){return e.data("sceditor-emoticon")+t},html:"{0}"},hr:{tags:{hr:null},allowsEmpty:!0,isSelfClosing:!0,isInline:!1,format:"[hr]{0}",html:"<hr />"},img:{allowsEmpty:!0,tags:{img:{src:null}},allowedChildren:["#"],quoteType:m.QuoteType.never,format:function(e,t){var n,o,i="",r=e[0],a=function(e){return r.style?r.style[e]:null};return e.attr("data-sceditor-emoticon")?t:(n=e.attr("width")||a("width"),o=e.attr("height")||a("height"),(r.complete&&(n||o)||n&&o)&&(i="="+e.width()+"x"+e.height()),"[img"+i+"]"+e.attr("src")+"[/img]")},html:function(e,t,n){var o,i,s,l="";return o=t.width,i=t.height,t.defaultattr&&(o=(s=t.defaultattr.split(/x/i))[0],i=2===s.length?s[1]:s[0]),void 0!==o&&(l+=' width="'+r(o,!0)+'"'),void 0!==i&&(l+=' height="'+r(i,!0)+'"'),"<img"+l+' src="'+a(n)+'" />'}},url:{allowsEmpty:!0,tags:{a:{href:null}},quoteType:m.QuoteType.never,format:function(e,t){var n=e.attr("href");return"mailto:"===n.substr(0,7)?'[email="'+n.substr(7)+'"]'+t+"[/email]":"[url="+n+"]"+t+"[/url]"},html:function(e,t,n){return t.defaultattr=r(t.defaultattr,!0)||n,'<a href="'+a(t.defaultattr)+'">'+n+"</a>"}},email:{quoteType:m.QuoteType.never,html:function(e,t,n){return'<a href="mailto:'+(r(t.defaultattr,!0)||n)+'">'+n+"</a>"}},quote:{tags:{blockquote:null},isInline:!1,quoteType:m.QuoteType.never,format:function(t,n){var o="",i=e(t),r=i.children("cite").first();return(1===r.length||i.data("author"))&&(o=r.text()||i.data("author"),i.data("author",o),r.remove(),n=this.elementToBbcode(e(t)),o="="+o.replace(/(^\s+|\s+$)/g,""),i.prepend(r)),"[quote"+o+"]"+n+"[/quote]"},html:function(e,t,n){return t.defaultattr&&(n="<cite>"+r(t.defaultattr)+"</cite>"+n),"<blockquote>"+n+"</blockquote>"}},code:{tags:{code:null},isInline:!1,allowedChildren:["#","#newline"],format:"[code]{0}[/code]",html:"<code>{0}</code>"},left:{styles:{"text-align":["left","-webkit-left","-moz-left","-khtml-left"]},isInline:!1,format:"[left]{0}[/left]",html:'<div align="left">{0}</div>'},center:{styles:{"text-align":["center","-webkit-center","-moz-center","-khtml-center"]},isInline:!1,format:"[center]{0}[/center]",html:'<div align="center">{0}</div>'},right:{styles:{"text-align":["right","-webkit-right","-moz-right","-khtml-right"]},isInline:!1,format:"[right]{0}[/right]",html:'<div align="right">{0}</div>'},justify:{styles:{"text-align":["justify","-webkit-justify","-moz-justify","-khtml-justify"]},isInline:!1,format:"[justify]{0}[/justify]",html:'<div align="justify">{0}</div>'},youtube:{allowsEmpty:!0,tags:{iframe:{"data-youtube-id":null}},format:function(e,t){return e=e.attr("data-youtube-id"),e?"[youtube]"+e+"[/youtube]":t},html:'<iframe width="560" height="315" frameborder="0" src="https://www.youtube.com/embed/{0}?wmode=opaque" data-youtube-id="{0}" allowfullscreen></iframe>'},rtl:{styles:{direction:["rtl"]},format:"[rtl]{0}[/rtl]",html:'<div style="direction: rtl">{0}</div>'},ltr:{styles:{direction:["ltr"]},format:"[ltr]{0}[/ltr]",html:'<div style="direction: ltr">{0}</div>'},ignore:{}};i.bbcode.bbcode={get:function(e){return b[e]||null},set:function(t,n){return!(!t||!n)&&(n=e.extend(b[t]||{},n),n.remove=function(){delete b[t]},b[t]=n,this)},rename:function(e,t){return e in b&&(b[t]=b[e],delete b[e],this)},remove:function(e){return e in b&&delete b[e],this}},e.fn.sceditorBBCodePlugin=function(t){return t=t||{},e.isPlainObject(t)&&(t.plugins=(t.plugins||"")+"bbcode"),this.sceditor(t)},i.bbcode.normaliseColour=v,i.bbcode.formatString=f,i.bbcode.stripQuotes=d,i.bbcode.bbcodes=b,o.BBCodeParser=m}(jQuery,window,document);