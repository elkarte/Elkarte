/* SCEditor v1.4.5 | (C) 2011-2013, Sam Clarke | sceditor.com/license */
!function(a,b,c){"use strict";var d={html:'<!DOCTYPE html><html><head><style>.ie * {min-height: auto !important} .ie table td {height:15px}</style><meta http-equiv="Content-Type" content="text/html;charset={charset}" /><link rel="stylesheet" type="text/css" href="{style}" /></head><body contenteditable="true" {spellcheck}></body></html>',toolbarButton:'<a class="sceditor-unselectable sceditor-button sceditor-button-{name}" data-sceditor-command="{name}" unselectable="on"><div class="sceditor-unselectable" unselectable="on">{dispName}</div></a>',emoticon:'<img src="{url}" data-sceditor-emoticon="{key}" alt="{key}" title="{tooltip}" />',fontOpt:'<a class="sceditor-font-option" href="#" data-font="{font}"><font face="{font}">{font}</font></a>',sizeOpt:'<a class="sceditor-fontsize-option" data-size="{size}" href="#"><font size="{size}">{size}</font></a>',pastetext:'<div><label for="txt">{label}</label> <textarea cols="20" rows="7" id="txt"></textarea></div><div><input type="button" class="button" value="{insert}" /></div>',table:'<div><label for="rows">{rows}</label><input type="text" id="rows" value="2" /></div><div><label for="cols">{cols}</label><input type="text" id="cols" value="2" /></div><div><input type="button" class="button" value="{insert}" /></div>',image:'<div><label for="link">{url}</label> <input type="text" id="image" placeholder="http://" /></div><div><label for="width">{width}</label> <input type="text" id="width" size="2" /></div><div><label for="height">{height}</label> <input type="text" id="height" size="2" /></div><div><input type="button" class="button" value="{insert}" /></div>',email:'<div><label for="email">{label}</label><input type="text" id="email" /></div><div><label for="des">{desc}</label><input type="text" id="des" /></div><div><input type="button" class="button" value="{insert}" /></div>',link:'<div><label for="link">{url}</label> <input type="text" id="link" placeholder="http://" /></div><div><label for="des">{desc}</label> <input type="text" id="des" /></div><div><input type="button" class="button" value="{ins}" /></div>',youtubeMenu:'<div><label for="link">{label}</label> <input type="text" id="link" placeholder="http://" /></div><div><input type="button" class="button" value="{insert}" /></div>',youtube:'<iframe width="560" height="315" src="http://www.youtube.com/embed/{id}?wmode=opaque" data-youtube-id="{id}" frameborder="0" allowfullscreen></iframe>'},e=function(b,c,e){var f=d[b];return a.each(c,function(a,b){f=f.replace(new RegExp("\\{"+a+"\\}","g"),b)}),e&&(f=a(f)),f};a.sceditor=function(d,f){var l,m,n,o,p,q,r,s,t,u,v,w,y,B,C,D,E,F,G,H,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,g=a.sceditor.ie,h=g&&11>g,i=this,j=d.get?d.get(0):d,k=a(j),x=[],z=[],A=[],I={},J=[];i.commands=a.extend(!0,{},f.commands||a.sceditor.commands),i.opts=f=a.extend({},a.sceditor.defaultOptions,f),K=function(){k.data("sceditor",i),a.each(f,function(b,c){a.isPlainObject(c)&&(f[b]=a.extend(!0,{},c))}),f.locale&&"en"!==f.locale&&Q(),l=a('<div class="sceditor-container" />').insertAfter(k).css("z-index",f.zIndex),g&&l.addClass("ie ie"+g),G=!!k.attr("required"),k.removeAttr("required"),P(),W(),R(),O(),U(),S(),T(),a.sceditor.isWysiwygSupported||i.toggleSourceMode(),hb();var d=function(){a(b).unbind("load",d),f.autofocus&&mb(),f.autoExpand&&i.expandToContent(),fb(),B.call("ready")};a(b).load(d),c.readyState&&"complete"===c.readyState&&d()},P=function(){var b=f.plugins;b=b?b.toString().split(","):[],B=new a.sceditor.PluginManager(i),a.each(b,function(b,c){B.register(a.trim(c))})},Q=function(){var b;w=a.sceditor.locale[f.locale],w||(b=f.locale.split("-"),w=a.sceditor.locale[b[0]]),w&&w.dateFormat&&(f.dateFormat=w.dateFormat)},O=function(){var c,d;s=a("<textarea></textarea>").hide(),o=a('<iframe frameborder="0" allowfullscreen="true"></iframe>'),f.spellcheck||s.attr("spellcheck","false"),"https:"===b.location.protocol&&o.attr("src","javascript:false"),l.append(o).append(s),p=o[0],t=s[0],i.dimensions(f.width||k.width(),f.height||k.height()),c=X(),c.open(),c.write(e("html",{spellcheck:f.spellcheck?"":'spellcheck="false"',charset:f.charset,style:f.style})),c.close(),r=a(c),q=a(c.body),i.readOnly(!!f.readOnly),g&&r.find("html").addClass("ie ie"+g),(a.sceditor.ios||g)&&(q.height("100%"),g||q.bind("touchend",i.focus)),y=new a.sceditor.rangeHelper(p.contentWindow),i.val(k.hide().val()),d=k.attr("tabindex"),s.attr("tabindex",d),o.attr("tabindex",d)},S=function(){f.autoUpdate&&(q.bind("blur",tb),s.bind("blur",tb)),null===f.rtl&&(f.rtl="rtl"===s.css("direction")),i.rtl(!!f.rtl),f.autoExpand&&r.bind("keyup",i.expandToContent),f.resizeEnabled&&V(),l.attr("id",f.id),i.emoticons(f.emoticonsEnabled)},T=function(){a(c).click(eb),a(j.form).bind("reset",bb).submit(i.updateOriginal),a(b).bind("resize orientationChanged",fb),q.keypress(ab).keydown($).keydown(_).keyup(jb).bind("blur",rb).keyup(sb).bind("paste",Y).bind(g?"selectionchange":"keyup focus blur contextmenu mouseup touchend click",kb).bind("keydown keyup keypress focus blur contextmenu",db),f.emoticonsCompat&&b.getSelection&&q.keyup(ob),s.bind("blur",rb).keyup(sb).bind("keydown keyup keypress focus blur contextmenu",db).keydown($),r.mousedown(cb).bind("blur",rb).bind(g?"selectionchange":"focus blur contextmenu mouseup click",kb).bind("beforedeactivate keyup",N).keyup(jb).focus(function(){v=null}),l.bind("selectionchanged",lb).bind("selectionchanged",hb).bind("selectionchanged valuechanged nodechanged",db)},R=function(){var b,c,d,h=i.commands,j=(f.toolbarExclude||"").split(","),k=f.toolbar.split("|");m=a('<div class="sceditor-unselectable sceditor-toolbar" unselectable="on" />'),a.each(k,function(f,k){b=a('<div class="sceditor-group" />'),a.each(k.split(","),function(f,k){!h[k]||a.inArray(k,j)>-1||(d=h[k].shortcut?" ("+h[k].shortcut+")":"",c=e("toolbarButton",{name:k,dispName:i._(h[k].tooltip||k)+d},!0),c.data("sceditor-txtmode",!!h[k].txtExec),c.data("sceditor-wysiwygmode",!!h[k].exec),c.mousedown(function(a){(!g||9>g)&&(n=!0),a.preventDefault()}),c.click(function(){var b=a(this);return b.hasClass("disabled")||(M(b,h[k]),t.blur(),t.focus()),hb(),!1}),h[k].tooltip&&c.attr("title",i._(h[k].tooltip)),h[k].exec||c.addClass("disabled"),h[k].shortcut&&(i.addShortcut(h[k].shortcut,k),c.attr("title",c.attr("title")+d)),b.append(c))}),b[0].firstChild&&m.append(b)}),a(f.toolbarContainer||l).append(m)},U=function(){a.each(i.commands,function(b,c){c.forceNewLineAfter&&a.isArray(c.forceNewLineAfter)&&(z=a.merge(z,c.forceNewLineAfter)),c.state?A.push({name:b,state:c.state}):"string"==typeof c.exec&&A.push({name:b,state:c.exec})}),jb()},V=function(){var d,e,h,j,k,m,n=a('<div class="sceditor-grip" />'),o=a('<div class="sceditor-resize-cover" />'),p=0,q=0,r=0,s=0,t=0,u=0,v=l.width(),w=l.height(),x=!1,y=i.rtl();d=f.resizeMinHeight||w/1.5,e=f.resizeMaxHeight||2.5*w,h=f.resizeMinWidth||v/1.25,j=f.resizeMaxWidth||1.25*v,k=function(a){"touchmove"===a.type?(a=b.event,r=a.changedTouches[0].pageX,s=a.changedTouches[0].pageY):(r=a.pageX,s=a.pageY);var c=u+(s-q),k=y?t-(r-p):t+(r-p);j>0&&k>j&&(k=j),e>0&&c>e&&(c=e),(!f.resizeWidth||h>k||j>0&&k>j)&&(k=!1),(!f.resizeHeight||d>c||e>0&&c>e)&&(c=!1),(k||c)&&(i.dimensions(k,c),7>g&&l.height(c)),a.preventDefault()},m=function(b){x&&(x=!1,o.hide(),l.removeClass("resizing").height("auto"),a(c).unbind("touchmove mousemove",k),a(c).unbind("touchcancel touchend mouseup",m),b.preventDefault())},l.append(n),l.append(o.hide()),n.bind("touchstart mousedown",function(d){"touchstart"===d.type?(d=b.event,p=d.touches[0].pageX,q=d.touches[0].pageY):(p=d.pageX,q=d.pageY),t=l.width(),u=l.height(),x=!0,l.addClass("resizing"),o.show(),a(c).bind("touchmove mousemove",k),a(c).bind("touchcancel touchend mouseup",m),7>g&&l.height(u),d.preventDefault()})},W=function(){var b,d=f.emoticons,e=f.emoticonsRoot;a.isPlainObject(d)&&f.emoticonsEnabled&&a.each(d,function(f,g){a.each(g,function(a,g){e&&(g={url:e+(g.url||g),tooltip:g.tooltip||a},d[f][a]=g),b=c.createElement("img"),b.src=g.url||g,x.push(b)})})},mb=function(){var b,c,d,e=r[0],g=q[0],h=!!f.autofocusEnd;if(l.is(":visible")){if(i.sourceMode())d=t.value.length,t.setSelectionRange?t.setSelectionRange(d,d):t.createTextRange&&(b=t.createTextRange(),b.moveEnd("character",d),b.moveStart("character",d),y.selectRange(b));else{if(a.sceditor.dom.removeWhiteSpace(g),h)for((c=g.lastChild)||q.append(c=e.createElement("div"));c.lastChild;)c=c.lastChild,/br/i.test(c.nodeName)&&c.previousSibling&&(c=c.previousSibling);else c=g.firstChild;e.createRange?(b=e.createRange(),/br/i.test(c.nodeName)?b.setStartBefore(c):b.selectNodeContents(c),b.collapse(!1)):(b=g.createTextRange(),b.moveToElementText(3!==c.nodeType?c:c.parentNode),b.collapse(!1)),y.selectRange(b),h&&(r.scrollTop(g.scrollHeight),q.scrollTop(g.scrollHeight))}i.focus()}},i.readOnly=function(a){return"boolean"!=typeof a?"readonly"===s.attr("readonly"):(q[0].contentEditable=!a,a?s.attr("readonly","readonly"):s.removeAttr("readonly"),gb(a),this)},i.rtl=function(a){var b=a?"rtl":"ltr";return"boolean"!=typeof a?"rtl"===s.attr("dir"):(q.attr("dir",b),s.attr("dir",b),l.removeClass("rtl").removeClass("ltr").addClass(b),this)},gb=function(b){var c=i.inSourceMode();m.find(".sceditor-button").removeClass("disabled").each(function(){var d=a(this);b===!0||c&&!d.data("sceditor-txtmode")?d.addClass("disabled"):c||d.data("sceditor-wysiwygmode")||d.addClass("disabled")})},i.width=function(a,b){return a||0===a?(i.dimensions(a,null,b),this):l.width()},i.dimensions=function(b,d,e){var h=8>g||c.documentMode<8?2:0;return b=b||0===b?b:!1,d=d||0===d?d:!1,b===!1&&d===!1?{width:i.width(),height:i.height()}:("undefined"==typeof o.data("outerWidthOffset")&&i.updateStyleCache(),b!==!1&&(e!==!1&&(f.width=b),d===!1&&(d=l.height(),e=!1),l.width(b),b&&b.toString().indexOf("%")>-1&&(b=l.width()),o.width(b-o.data("outerWidthOffset")),s.width(b-s.data("outerWidthOffset")),a.sceditor.ios&&q&&q.width(b-o.data("outerWidthOffset")-(q.outerWidth(!0)-q.width()))),d!==!1&&(e!==!1&&(f.height=d),d&&d.toString().indexOf("%")>-1&&(d=l.height(d).height(),l.height("auto")),d-=f.toolbarContainer?0:m.outerHeight(!0),o.height(d-o.data("outerHeightOffset")),s.height(d-h-s.data("outerHeightOffset"))),this)},i.updateStyleCache=function(){o.data("outerWidthOffset",o.outerWidth(!0)-o.width()),s.data("outerWidthOffset",s.outerWidth(!0)-s.width()),o.data("outerHeightOffset",o.outerHeight(!0)-o.height()),s.data("outerHeightOffset",s.outerHeight(!0)-s.height())},i.height=function(a,b){return a||0===a?(i.dimensions(null,a,b),this):l.height()},i.maximize=function(b){return"undefined"==typeof b?l.is(".sceditor-maximize"):(b=!!b,7>g&&a("html, body").toggleClass("sceditor-maximize",b),l.toggleClass("sceditor-maximize",b),i.width(b?"100%":f.width,!1),i.height(b?"100%":f.height,!1),this)},i.expandToContent=function(a){var b=l.height(),c=q[0].scrollHeight||r[0].documentElement.scrollHeight,d=b-o.height(),e=f.resizeMaxHeight||2*(f.height||k.height());c+=d,a!==!0&&c>e&&(c=e),c>b&&i.height(c)},i.destroy=function(){B&&(B.destroy(),y=null,v=null,B=null,a(c).unbind("click",eb),a(b).unbind("resize orientationChanged",fb),a(j.form).unbind("reset",bb).unbind("submit",i.updateOriginal),q.unbind(),r.unbind().find("*").remove(),s.unbind().remove(),m.remove(),l.unbind().find("*").unbind().remove(),l.remove(),k.removeData("sceditor").removeData("sceditorbbcode").show(),G&&k.attr("required","required"))},i.createDropDown=function(b,c,d,e){var g,h=u&&u.is(".sceditor-"+c);i.closeDropDown(),h||(e!==!1&&a(d).find(":not(input,textarea)").filter(function(){return 1===this.nodeType}).attr("unselectable","on"),g={top:b.offset().top,left:b.offset().left,marginTop:b.outerHeight()},a.extend(g,f.dropDownCss),u=a('<div class="sceditor-dropdown sceditor-'+c+'" />').css(g).append(d).appendTo(a("body")).on("click focusin",function(a){a.stopPropagation()}),u.find("input,textarea").first().focus())},eb=function(a){3!==a.which&&u&&(tb(),i.closeDropDown())},Y=function(a){var b,d,e,g=q[0],h=r[0],j=0,k=c.createElement("div"),l=h.createDocumentFragment();if(f.disablePasting)return!1;if(f.enablePasteFiltering){if(y.saveRange(),c.body.appendChild(k),a&&a.clipboardData&&a.clipboardData.getData&&((b=a.clipboardData.getData("text/html"))||(b=a.clipboardData.getData("text/plain"))))return k.innerHTML=b,Z(g,k),!1;for(e=q.scrollTop()||r.scrollTop();g.firstChild;)l.appendChild(g.firstChild);return d=function(a,b){if(a.childNodes.length>0||j>25){for(;a.firstChild;)b.appendChild(a.firstChild);for(;l.firstChild;)a.appendChild(l.firstChild);q.scrollTop(e),r.scrollTop(e),b.childNodes.length>0?Z(a,b):y.restoreRange()}else j++,setTimeout(function(){d(a,b)},20)},d(g,k),i.focus(),!0}},Z=function(b,c){a.sceditor.dom.fixNesting(c);var d=c.innerHTML;B.hasHandler("toSource")&&(d=B.callOnlyFirst("toSource",d,a(c))),c.parentNode.removeChild(c),B.hasHandler("toWysiwyg")&&(d=B.callOnlyFirst("toWysiwyg",d,!0)),y.restoreRange(),i.wysiwygEditorInsertHtml(d,null,!0)},i.closeDropDown=function(a){u&&(u.unbind().remove(),u=null),a===!0&&i.focus()},X=function(){return p.contentDocument?p.contentDocument:p.contentWindow&&p.contentWindow.document?p.contentWindow.document:p.document?p.document:null},i.wysiwygEditorInsertHtml=function(b,c,d){var e,f,g,h=o.height();i.focus(),(d||!a(D).is("code")&&0===a(D).parents("code").length)&&(y.insertHTML(b,c),y.saveRange(),L(q[0]),e=q.find("#sceditor-end-marker").show(),f=q.scrollTop()||r.scrollTop(),g=a.sceditor.dom.getOffset(e[0]).top+1.5*e.outerHeight(!0)-h,e.hide(),(g>f||f>g+h)&&(q.scrollTop(g),r.scrollTop(g)),qb(!1),y.restoreRange(),jb())},i.wysiwygEditorInsertText=function(b,c){i.wysiwygEditorInsertHtml(a.sceditor.escapeEntities(b),a.sceditor.escapeEntities(c))},i.insertText=function(a,b){return i.inSourceMode()?i.sourceEditorInsertText(a,b):i.wysiwygEditorInsertText(a,b),this},i.sourceEditorInsertText=function(a,b){var d,e,f,g,h;h=t.scrollTop,t.focus(),"undefined"!=typeof t.selectionStart?(e=t.selectionStart,f=t.selectionEnd,g=a.length,b&&(a+=t.value.substring(e,f)+b),t.value=t.value.substring(0,e)+a+t.value.substring(f,t.value.length),t.selectionStart=e+a.length-(b?b.length:0),t.selectionEnd=t.selectionStart):"undefined"!=typeof c.selection.createRange?(d=c.selection.createRange(),b&&(a+=d.text+b),d.text=a,b&&d.moveEnd("character",0-b.length),d.moveStart("character",d.End-d.Start),d.select()):t.value+=a+b,t.scrollTop=h,t.focus(),qb()},i.getRangeHelper=function(){return y},i.sourceEditorCaret=function(a){var b={};return"undefined"!=typeof t.selectionStart?a?(t.selectionStart=a.start,t.selectionEnd=a.end):(b.start=t.selectionStart,b.end=t.selectionEnd):(range=c.selection.createRange(),a?(range.moveStart("character",a.start),range.moveEnd("character",a.end),range.select()):(b.start=range.Start,b.end=range.End)),a?this:b},i.val=function(a,b){return"string"==typeof a?(i.inSourceMode()?i.setSourceEditorValue(a):(b!==!1&&B.hasHandler("toWysiwyg")&&(a=B.callOnlyFirst("toWysiwyg",a)),i.setWysiwygEditorValue(a)),this):i.inSourceMode()?i.getSourceEditorValue(!1):i.getWysiwygEditorValue()},i.insert=function(b,c,d,e,f){if(i.inSourceMode())i.sourceEditorInsertText(b,c);else{if(c){var g=i.getRangeHelper().selectedHtml(),h=a("<div>").appendTo(a("body")).hide().html(g);d!==!1&&B.hasHandler("toSource")&&(g=B.callOnlyFirst("toSource",g,h)),h.remove(),b+=g+c}d!==!1&&B.hasHandler("toWysiwyg")&&(b=B.callOnlyFirst("toWysiwyg",b,!0)),d!==!1&&f===!0&&(b=b.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")),i.wysiwygEditorInsertHtml(b)}return this},i.getWysiwygEditorValue=function(b){var c,d,e=y.hasSelection();return e?y.saveRange():v&&v.getBookmark&&(d=v.getBookmark()),a.sceditor.dom.fixNesting(q[0]),c=q.html(),b!==!1&&B.hasHandler("toSource")&&(c=B.callOnlyFirst("toSource",c,q)),e?(y.restoreRange(),v=null):d&&(v.moveToBookmark(d),v=null),c},i.getBody=function(){return q},i.getContentAreaContainer=function(){return o},i.getSourceEditorValue=function(a){var b=s.val();return a!==!1&&B.hasHandler("toWysiwyg")&&(b=B.callOnlyFirst("toWysiwyg",b)),b},i.setWysiwygEditorValue=function(a){a||(a="<p>"+(g?"":"<br />")+"</p>"),q[0].innerHTML=a,L(q[0]),jb(),qb()},i.setSourceEditorValue=function(a){s.val(a),qb()},i.updateOriginal=function(){k.val(i.val())},L=function(b){if(f.emoticonsEnabled&&!a(b).parents("code").length){var c=b.ownerDocument,d=[],g=[],h=a.extend({},f.emoticons.more,f.emoticons.dropdown,f.emoticons.hidden);a.each(h,function(b){f.emoticonsCompat&&(g[b]=new RegExp("(>|^|\\s|\xa0|\u2002|\u2003|\u2009|&nbsp;)"+a.sceditor.regexEscape(b)+"(\\s|$|<|\xa0|\u2002|\u2003|\u2009|&nbsp;)")),d.push(b)}),function i(b){for(b=b.firstChild;null!=b;){var j,k,l,m,n,o,p,q=b.parentNode,r=b.nodeValue;if(3!==b.nodeType)a(b).is("code")||i(b);else if(r)for(n=d.length;n--;)k=d[n],p=f.emoticonsCompat?r.search(g[k]):r.indexOf(k),p>-1&&(o=b.nextSibling,l=h[k],j=r.substr(p).split(k),r=r.substr(0,p)+j.shift(),b.nodeValue=r,m=a.sceditor.dom.parseHTML(e("emoticon",{key:k,url:l.url||l,tooltip:l.tooltip||k}),c),q.insertBefore(m[0],o),q.insertBefore(c.createTextNode(j.join(k)),o));b=b.nextSibling}}(b),f.emoticonsCompat&&(J=q.find("img[data-sceditor-emoticon]"))}},i.inSourceMode=function(){return l.hasClass("sourceMode")},i.sourceMode=function(a){return"boolean"!=typeof a?i.inSourceMode():((i.inSourceMode()&&!a||!i.inSourceMode()&&a)&&i.toggleSourceMode(),this)},i.toggleSourceMode=function(){var b=i.inSourceMode();(a.sceditor.isWysiwygSupported||!b)&&(b||(y.saveRange(),y.clear()),i.blur(),b?i.setWysiwygEditorValue(i.getSourceEditorValue()):i.setSourceEditorValue(i.getWysiwygEditorValue()),v=null,s.toggle(),o.toggle(),l.toggleClass("wysiwygMode",b).toggleClass("sourceMode",!b),gb(),hb())},ib=function(){return t.focus(),null!=t.selectionStart?t.value.substring(t.selectionStart,t.selectionEnd):c.selection.createRange?c.selection.createRange().text:void 0},M=function(b,c){return i.inSourceMode()?(c.txtExec&&(a.isArray(c.txtExec)?i.sourceEditorInsertText.apply(i,c.txtExec):c.txtExec.call(i,b,ib())),void 0):(c.exec&&(a.isFunction(c.exec)?c.exec.call(i,b):i.execCommand(c.exec,c.hasOwnProperty("execParam")?c.execParam:null)),void 0)},N=function(){g&&(v=y.selectedRange())},i.execCommand=function(b,c){var d=!1,e=a(y.parentNode());if(i.focus(),!e.is("code")&&0===e.parents("code").length){try{d=r[0].execCommand(b,!1,c)}catch(f){}!d&&i.commands[b]&&i.commands[b].errorMessage&&alert(i._(i.commands[b].errorMessage)),hb()}},kb=function(){var b=function(){y&&!y.compare(E)&&(E=y.cloneSelected(),l.trigger(a.Event("selectionchanged"))),F=!1};F||(F=!0,g?b():setTimeout(b,100))},lb=function(){var b,c=y.parentNode();C!==c&&(b=C,C=c,D=y.getFirstBlockParent(c),l.trigger(a.Event("nodechanged",{oldNode:b,newNode:C})))},i.currentNode=function(){return C},i.currentBlockNode=function(){return D},hb=function(a){var b,c,d,e,f,g=r[0],h=A.length,j=i.sourceMode();if(i.sourceMode()||i.readOnly())m.find(".sceditor-button").removeClass("active");else for(j||(f=a?a.newNode:y.parentNode(),d=y.getFirstBlockParent(f));h--;)if(b=0,c=A[h],e=m.find(".sceditor-button-"+c.name),j&&!e.data("sceditor-txtmode"))e.addClass("disabled");else if(j||e.data("sceditor-wysiwygmode")){if("string"==typeof c.state)try{b=g.queryCommandEnabled(c.state)?0:-1,b>-1&&(b=g.queryCommandState(c.state)?1:0)}catch(k){}else b=c.state.call(i,f,d);0>b?e.addClass("disabled"):e.removeClass("disabled"),b>0?e.addClass("active"):e.removeClass("active")}else e.addClass("disabled")},ab=function(b){var c,d,e,f,g="code,blockquote,pre",j="li,ul,ol";return b.originalEvent.defaultPrevented?void 0:(i.closeDropDown(),c=a(C).closest(g+","+j).first(),13===b.which&&c.length&&!c.is(j)?(v=null,d=r[0].createElement("br"),y.insertNode(d),h||(e=d.parentNode,f=e.lastChild,f&&3===f.nodeType&&""===f.nodeValue&&(e.removeChild(f),f=e.lastChild),!a.sceditor.dom.isInline(e,!0)&&f===d&&a.sceditor.dom.isInline(d.previousSibling)&&y.insertHTML("<br>")),!1):void 0)},jb=function(){var b,c,d;a.sceditor.dom.rTraverse(q[0],function(e){return b=e.nodeName.toLowerCase(),a.inArray(b,z)>-1&&(c=!0),3===e.nodeType&&!/^\s*$/.test(e.nodeValue)||"br"===b||h&&!e.firstChild&&!a.sceditor.dom.isInline(e,!1)?(c&&(d=q[0].ownerDocument.createElement("div"),d.className="sceditor-nlf",d.innerHTML=h?"":"<br />",q[0].appendChild(d)),!1):void 0})},bb=function(){i.val(k.val())},cb=function(){i.closeDropDown(),v=null},fb=function(){var a=f.height,b=f.width;i.maximize()?i.dimensions("100%","100%",!1):(a&&a.toString().indexOf("%")>-1||b&&b.toString().indexOf("%")>-1)&&i.dimensions(b,a)},i._=function(){var a,b=arguments;return w&&w[b[0]]&&(b[0]=w[b[0]]),b[0].replace(/\{(\d+)\}/g,function(c,d){return b[d-0+1]!==a?b[d-0+1]:"{"+d+"}"})},db=function(b){var c,d=a.extend({},b);B.call(d.type+"Event",b,i),delete d.type,c=a.Event((b.target===t?"scesrc":"scewys")+b.type,d),l.trigger(c,i),c.isDefaultPrevented()&&b.preventDefault(),c.isImmediatePropagationStopped()&&c.stopImmediatePropagation(),c.isPropagationStopped()&&c.stopPropagation()},i.bind=function(b,c,d,e){b=b.split(" ");for(var f=b.length;f--;)a.isFunction(c)&&(d||l.bind("scewys"+b[f],c),e||l.bind("scesrc"+b[f],c),"valuechanged"===b[f]&&(qb.hasHandler=!0));return this},i.unbind=function(b,c,d,e){b=b.split(" ");for(var f=b.length;f--;)a.isFunction(c)&&(d||l.unbind("scewys"+b[f],c),e||l.unbind("scesrc"+b[f],c));return this},i.blur=function(b,c,d){return a.isFunction(b)?i.bind("blur",b,c,d):i.sourceMode()?q.blur():s.blur(),this},i.focus=function(b,c,d){if(a.isFunction(b))i.bind("focus",b,c,d);else if(i.inSourceMode())t.focus();else{var e,f=y.selectedRange();!h&&f&&1===f.endOffset&&f.collapsed&&(e=f.endContainer,e&&1===e.childNodes.length&&a(e.firstChild).is("br")&&(f.setStartBefore(e.firstChild),f.collapse(!0),y.selectRange(f))),p.contentWindow.focus(),q[0].focus(),v&&(y.selectRange(v),v=null)}return this},i.keyDown=function(a,b,c){return i.bind("keydown",a,b,c)},i.keyPress=function(a,b,c){return i.bind("keypress",a,b,c)},i.keyUp=function(a,b,c){return i.bind("keyup",a,b,c)},i.nodeChanged=function(a){return i.bind("nodechanged",a,!1,!0)},i.selectionChanged=function(a){return i.bind("selectionchanged",a,!1,!0)},i.valueChanged=function(a,b,c){return i.bind("valuechanged",a,b,c)},nb=function(b){var c=0,d=String.fromCharCode(b.which);if(!a(D).is("code")&&!a(D).parents("code").length)return i.emoticonsCache||(i.emoticonsCache=[],a.each(a.extend({},f.emoticons.more,f.emoticons.dropdown,f.emoticons.hidden),function(a,b){i.emoticonsCache[c++]=[a,e("emoticon",{key:a,url:b.url||b,tooltip:b.tooltip||a})]}),i.emoticonsCache.sort(function(a,b){return a[0].length-b[0].length}),i.longestEmoticonCode=i.emoticonsCache[i.emoticonsCache.length-1][0].length),i.getRangeHelper().raplaceKeyword(i.emoticonsCache,!0,!0,i.longestEmoticonCode,f.emoticonsCompat,d)?(f.emoticonsCompat&&(J=q.find("img[data-sceditor-emoticon]")),/^\s$/.test(d)&&f.emoticonsCompat):void 0},ob=function(){if(J.length){var b,c,d,e,f,g,h=i.currentBlockNode(),j=!1,k=/[^\s\xA0\u2002\u2003\u2009\u00a0]+/;J=a.map(J,function(i){return i&&i.parentNode?a.contains(h,i)?(b=i.previousSibling,c=i.nextSibling,f=b.nodeValue,null===f&&(f=b.innerText||""),b&&k.test(b.nodeValue.slice(-1))||c&&k.test((c.nodeValue||"")[0])?(d=i.parentNode,e=y.cloneSelected(),g=e.startContainer,f+=a(i).data("sceditor-emoticon"),g===c?j=f.length+e.startOffset:g===h&&h.childNodes[e.startOffset]===c?j=f.length:g===b&&(j=e.startOffset),c&&3===c.nodeType||(c=d.insertBefore(d.ownerDocument.createTextNode(""),c)),c.insertData(0,f),d.removeChild(b),d.removeChild(i),j!==!1&&(e.setStart(c,j),e.collapse(!0),y.selectRange(e)),null):i):i:null})}},i.emoticons=function(b){return b||b===!1?(f.emoticonsEnabled=b,b?(q.keypress(nb),i.sourceMode()||(y.saveRange(),L(q[0]),J=q.find("img[data-sceditor-emoticon]"),qb(!1),y.restoreRange())):(q.find("img[data-sceditor-emoticon]").replaceWith(function(){return a(this).data("sceditor-emoticon")}),J=[],q.unbind("keypress",nb),qb()),this):f.emoticonsEnabled},i.css=function(b){return H||(H=a('<style id="#inline" />').appendTo(r.find("head"))[0]),"string"!=typeof b?H.styleSheet?H.styleSheet.cssText:H.innerHTML:(H.styleSheet?H.styleSheet.cssText=b:H.innerHTML=b,this)},$=function(a){var b=[],c={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|","[":"{","]":"}"},d={8:"backspace",9:"tab",13:"enter",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",91:"win",92:"win",93:"select",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},e={109:"-",110:"del",111:"/",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9"},f=a.which,g=d[f]||String.fromCharCode(f).toLowerCase();return a.ctrlKey&&b.push("ctrl"),a.altKey&&b.push("alt"),a.shiftKey&&(b.push("shift"),e[f]?g=e[f]:c[g]&&(g=c[g])),g&&(16>f||f>18)&&b.push(g),b=b.join("+"),I[b]?I[b].call(i):void 0},i.addShortcut=function(a,b){return a=a.toLowerCase(),I[a]="string"==typeof b?function(){return M(m.find(".sceditor-button-"+b),i.commands[b]),!1}:b,this},i.removeShortcut=function(a){return delete I[a.toLowerCase()],this},_=function(c){var d,e,g,h,j;if(!f.disableBlockRemove&&8===c.which&&(h=y.selectedRange())&&(b.getSelection?(d=h.startContainer,e=h.startOffset):(d=h.parentElement(),g=r[0].selection.createRange(),g.moveToElementText(d),g.setEndPoint("EndToStart",h),e=g.text.length),0===e&&(j=pb()))){for(;d!==j;){for(;d.previousSibling;)if(d=d.previousSibling,3!==d.nodeType||d.nodeValue)return;if(!(d=d.parentNode))return}if(j&&!a(j).is("body"))return i.clearBlockFormatting(j),!1}},pb=function(){for(var b=D;!a.sceditor.dom.hasStyling(b)||a.sceditor.dom.isInline(b,!0);)if(!(b=b.parentNode)||a(b).is("body"))return;return b},i.clearBlockFormatting=function(b){return b=b||pb(),!b||a(b).is("body")?this:(y.saveRange(),v=null,b.className="",a(b).attr("style",""),a(b).is("p,div,td")||a.sceditor.dom.convertElement(b,"p"),y.restoreRange(),this)},qb=function(b){if(B.hasHandler("valuechangedEvent")||qb.hasHandler){var c,d=i.sourceMode(),e=!d&&y.hasSelection();b=b!==!1&&!r[0].getElementById("sceditor-start-marker"),sb.timer&&(clearTimeout(sb.timer),sb.timer=!1),e&&b&&y.saveRange(),c=q.html(),c!==qb.lastHtmlValue&&(qb.lastHtmlValue=c,l.trigger(a.Event("valuechanged",{rawValue:d?i.val():c}))),e&&b&&y.removeMarkers()}},rb=function(){sb.timer&&qb()},sb=function(a){var b=a.which,c=sb.lastChar,d=13===c||32===c,e=8===c||46===c;sb.lastChar=b,13===b||32===b?d?sb.triggerNextChar=!0:qb():8===b||46===b?e?sb.triggerNextChar=!0:qb():sb.triggerNextChar&&(qb(),sb.triggerNextChar=!1),sb.timer&&clearTimeout(sb.timer),sb.timer=setTimeout(function(){qb()},1500)},tb=function(){n||i.updateOriginal(),n=!1},K()},a.sceditor.ie=function(){var a,d=3,e=c.createElement("div"),f=e.getElementsByTagName("i");do e.innerHTML="<!--[if gt IE "+ ++d+"]><i></i><![endif]-->";while(f[0]);return c.documentMode&&c.all&&b.atob&&(d=10),4===d&&c.documentMode&&(d=11),d>4?d:a}(),a.sceditor.ios=/iPhone|iPod|iPad| wosbrowser\//i.test(navigator.userAgent),a.sceditor.isWysiwygSupported=function(){var b,c,d=a('<div contenteditable="true">')[0].contentEditable,e="undefined"!=typeof d&&"inherit"!==d,f=navigator.userAgent;return e?(c=/Opera Mobi|Opera Mini/i.test(f),/Android/i.test(f)&&(c=!0,/Safari/.test(f)&&(b=/Safari\/(\d+)/.exec(f),c=b&&b[1]?b[1]<534:!0)),/ Silk\//i.test(f)&&(b=/AppleWebKit\/(\d+)/.exec(f),c=b&&b[1]?b[1]<534:!0),a.sceditor.ios&&(c=!/OS [5-9](_\d)+ like Mac OS X/i.test(f)),/Firefox/i.test(f)&&(c=!1),/OneBrowser/i.test(f)&&(c=!1),"UCWEB"===navigator.vendor&&(c=!1),!c):!1}(),a.sceditor.regexEscape=function(a){return a.replace(/([\-.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")},a.sceditor.escapeEntities=function(a,b){if(!a)return a;var c={"&":"&amp;","<":"&lt;",">":"&gt;","  ":"&nbsp; ","\r\n":"\n","\r":"\n","\n":"<br />"};return b&&(c['"']="&#34;",c["'"]="&#39;",c["`"]="&#96;"),a=a.replace(/ {2}|\r\n|[&<>\r\n'"`]/g,function(a){return c[a]||a})},a.sceditor.escapeUriScheme=function(a){var c,d=/^(?:https?|s?ftp|mailto|spotify|skype|ssh|teamspeak|tel):|(?:\/\/)/i,e=/^[^\/]*:/i,f=b.location;return a&&e.test(a)&&!d.test(a)?(c=f.pathname.split("/"),c.pop(),f.protocol+"://"+f.host+c.join("/")+"/"+a):a},a.sceditor.locale={},a.sceditor.commands={bold:{exec:"bold",tooltip:"Bold",shortcut:"ctrl+b"},italic:{exec:"italic",tooltip:"Italic",shortcut:"ctrl+i"},underline:{exec:"underline",tooltip:"Underline",shortcut:"ctrl+u"},strike:{exec:"strikethrough",tooltip:"Strikethrough"},subscript:{exec:"subscript",tooltip:"Subscript"},superscript:{exec:"superscript",tooltip:"Superscript"},left:{exec:"justifyleft",tooltip:"Align left"},center:{exec:"justifycenter",tooltip:"Center"},right:{exec:"justifyright",tooltip:"Align right"},justify:{exec:"justifyfull",tooltip:"Justify"},font:{_dropDown:function(b,c,d){for(var f=b.opts.fonts.split(","),g=a("<div />"),h=function(){return d(a(this).data("font")),b.closeDropDown(!0),!1},i=0;i<f.length;i++)g.append(e("fontOpt",{font:f[i]},!0).click(h));b.createDropDown(c,"font-picker",g)},exec:function(b){var c=this;a.sceditor.command.get("font")._dropDown(c,b,function(a){c.execCommand("fontname",a)})},tooltip:"Font Name"},size:{_dropDown:function(b,c,d){for(var f=a("<div />"),g=function(c){d(a(this).data("size")),b.closeDropDown(!0),c.preventDefault()},h=1;7>=h;h++)f.append(e("sizeOpt",{size:h},!0).click(g));b.createDropDown(c,"fontsize-picker",f)},exec:function(b){var c=this;a.sceditor.command.get("size")._dropDown(c,b,function(a){c.execCommand("fontsize",a)})},tooltip:"Font Size"},color:{_dropDown:function(b,c,d){var e,f,g,h,i={r:255,g:255,b:255},j=a("<div />"),k=b.opts.colors?b.opts.colors.split("|"):new Array(21),l=[],m=a.sceditor.command.get("color");if(!m._htmlCache){for(e=0;e<k.length;++e){for(h=k[e]?k[e].split(","):new Array(21),l.push('<div class="sceditor-color-column">'),f=0;f<h.length;++f)g=h[f]||"#"+i.r.toString(16)+i.g.toString(16)+i.b.toString(16),l.push('<a href="#" class="sceditor-color-option" style="background-color: '+g+'" data-color="'+g+'"></a>'),0===f%5?(i.g-=51,i.b=255):i.b-=51;l.push("</div>"),0===e%5?(i.r-=51,i.g=255,i.b=255):(i.g=255,i.b=255)}m._htmlCache=l.join("")}j.append(m._htmlCache).find("a").click(function(c){d(a(this).attr("data-color")),b.closeDropDown(!0),c.preventDefault()}),b.createDropDown(c,"color-picker",j)},exec:function(b){var c=this;a.sceditor.command.get("color")._dropDown(c,b,function(a){c.execCommand("forecolor",a)})},tooltip:"Font Color"},removeformat:{exec:"removeformat",tooltip:"Remove Formatting"},cut:{exec:"cut",tooltip:"Cut",errorMessage:"Your browser does not allow the cut command. Please use the keyboard shortcut Ctrl/Cmd-X"},copy:{exec:"copy",tooltip:"Copy",errorMessage:"Your browser does not allow the copy command. Please use the keyboard shortcut Ctrl/Cmd-C"},paste:{exec:"paste",tooltip:"Paste",errorMessage:"Your browser does not allow the paste command. Please use the keyboard shortcut Ctrl/Cmd-V"},pastetext:{exec:function(a){var b,c=this,d=e("pastetext",{label:c._("Paste your text inside the following box:"),insert:c._("Insert")},!0);d.find(".button").click(function(a){b=d.find("#txt").val(),b&&c.wysiwygEditorInsertText(b),c.closeDropDown(!0),a.preventDefault()}),c.createDropDown(a,"pastetext",d)},tooltip:"Paste Text"},bulletlist:{exec:"insertunorderedlist",tooltip:"Bullet list"},orderedlist:{exec:"insertorderedlist",tooltip:"Numbered list"},indent:{state:function(c,d){var e,f,g,h=a(d),i=h.parents("ul,ol,menu"),j=i.first();if(i.length>1||j.children().length>1)return 0;if(h.is("ul,ol,menu")){if(e=this.getRangeHelper().selectedRange(),!(b.Range&&e instanceof Range))return h.is("li,ul,ol,menu")?0:-1;if(f=e.startContainer.parentNode,g=e.endContainer.parentNode,f!==f.parentNode.firstElementChild||a(g).is("li")&&g!==g.parentNode.lastElementChild)return 0
}return-1},exec:function(){var b=this,c=a(b.getRangeHelper().getFirstBlockParent());b.focus(),c.parents("ul,ol,menu")&&b.execCommand("indent")},tooltip:"Add indent"},outdent:{state:function(b,c){return a(c).is("ul,ol,menu")||a(c).parents("ul,ol,menu").length>0?0:-1},exec:function(){var b=this,c=a(b.getRangeHelper().getFirstBlockParent());c.parents("ul,ol,menu")&&b.execCommand("outdent")},tooltip:"Remove one indent"},table:{exec:function(b){var c=this,d=e("table",{rows:c._("Rows:"),cols:c._("Cols:"),insert:c._("Insert")},!0);d.find(".button").click(function(b){var e=a.sceditor.ie,f=d.find("#rows").val()-0,g=d.find("#cols").val()-0,h="<table>";if(!(1>f||1>g)){for(var i=0;f>i;i++){h+="<tr>";for(var j=0;g>j;j++)h+="<td>"+(e&&11>e?"":"<br />")+"</td>";h+="</tr>"}h+="</table>",a.sceditor.ie&&(h+="<br />"),c.wysiwygEditorInsertHtml(h),c.closeDropDown(!0),b.preventDefault()}}),c.createDropDown(b,"inserttable",d)},tooltip:"Insert a table"},horizontalrule:{exec:"inserthorizontalrule",tooltip:"Insert a horizontal rule"},code:{forceNewLineAfter:["code"],exec:function(){var b=a.sceditor.ie,c=b&&11>b;this.wysiwygEditorInsertHtml("<code>",(c?"":"<br />")+"</code>")},tooltip:"Code"},image:{exec:function(a){var b=this,c=e("image",{url:b._("URL:"),width:b._("Width (optional):"),height:b._("Height (optional):"),insert:b._("Insert")},!0);c.find(".button").click(function(a){var d=c.find("#image").val(),e=c.find("#width").val(),f=c.find("#height").val(),g="";e&&(g+=' width="'+e+'"'),f&&(g+=' height="'+f+'"'),d&&b.wysiwygEditorInsertHtml("<img"+g+' src="'+d+'" />'),b.closeDropDown(!0),a.preventDefault()}),b.createDropDown(a,"insertimage",c)},tooltip:"Insert an image"},email:{exec:function(a){var b=this,c=e("email",{label:b._("E-mail:"),desc:b._("Description (optional):"),insert:b._("Insert")},!0);c.find(".button").click(function(a){var d=c.find("#email").val(),e=c.find("#des").val();d&&(b.focus(),!b.getRangeHelper().selectedHtml()||e?(e=e||d,b.wysiwygEditorInsertHtml('<a href="mailto:'+d+'">'+e+"</a>")):b.execCommand("createlink","mailto:"+d)),b.closeDropDown(!0),a.preventDefault()}),b.createDropDown(a,"insertemail",c)},tooltip:"Insert an email"},link:{exec:function(a){var b=this,c=e("link",{url:b._("URL:"),desc:b._("Description (optional):"),ins:b._("Insert")},!0);c.find(".button").click(function(a){var d=c.find("#link").val(),e=c.find("#des").val();d&&(b.focus(),!b.getRangeHelper().selectedHtml()||e?(e||(e=d),b.wysiwygEditorInsertHtml('<a href="'+d+'">'+e+"</a>")):b.execCommand("createlink",d)),b.closeDropDown(!0),a.preventDefault()}),b.createDropDown(a,"insertlink",c)},tooltip:"Insert a link"},unlink:{state:function(){var b=a(this.currentNode());return b.is("a")||b.parents("a").length>0?0:-1},exec:function(){var b=a(this.currentNode()),c=b.is("a")?b:b.parents("a").first();c.length&&c.replaceWith(c.contents())},tooltip:"Unlink"},quote:{forceNewLineAfter:["blockquote"],exec:function(b,c,d){var e=a.sceditor.ie,f="<blockquote>",g="</blockquote>",h=e&&11>e;c?(d=d?"<cite>"+d+"</cite>":"",f=f+d+c+g,g=null):""===this.getRangeHelper().selectedHtml()&&(g=(h?"":"<br />")+g),this.wysiwygEditorInsertHtml(f,g)},tooltip:"Insert a Quote"},emoticon:{exec:function(b){var c=this,d=function(e){var f=c.opts.emoticonsCompat,g=c.getRangeHelper(),h=f&&" "!==g.getOuterText(!0,1)?" ":"",i=f&&" "!==g.getOuterText(!1,1)?" ":"",j=a("<div />"),k=a("<div />").appendTo(j),l=a.extend({},c.opts.emoticons.dropdown,e?c.opts.emoticons.more:{}),m=0;return a.each(l,function(){m++}),m=Math.sqrt(m),a.each(l,function(b,d){k.append(a("<img />").attr({src:d.url||d,alt:b,title:d.tooltip||b}).click(function(){return c.insert(h+a(this).attr("alt")+i,null,!1).closeDropDown(!0),!1})),k.children().length>=m&&(k=a("<div />").appendTo(j))}),e||j.append(a(c._('<a class="sceditor-more">{0}</a>',c._("More"))).click(function(){return c.createDropDown(b,"more-emoticons",d(!0)),!1})),j};c.createDropDown(b,"emoticons",d(!1))},txtExec:function(b){a.sceditor.command.get("emoticon").exec.call(this,b)},tooltip:"Insert an emoticon"},youtube:{_dropDown:function(a,b,c){var d,f=e("youtubeMenu",{label:a._("Video URL:"),insert:a._("Insert")},!0);f.find(".button").click(function(b){var e=f.find("#link").val();e&&(d=e.match(/(?:v=|v\/|embed\/|youtu.be\/)(.{11})/),d&&(e=d[1]),/^[a-zA-Z0-9_\-]{11}$/.test(e)?c(e):alert("Invalid YouTube video")),a.closeDropDown(!0),b.preventDefault()}),a.createDropDown(b,"insertlink",f)},exec:function(b){var c=this;a.sceditor.command.get("youtube")._dropDown(c,b,function(a){c.wysiwygEditorInsertHtml(e("youtube",{id:a}))})},tooltip:"Insert a YouTube video"},date:{_date:function(a){var b=new Date,c=b.getYear(),d=b.getMonth()+1,e=b.getDate();return 2e3>c&&(c=1900+c),10>d&&(d="0"+d),10>e&&(e="0"+e),a.opts.dateFormat.replace(/year/i,c).replace(/month/i,d).replace(/day/i,e)},exec:function(){this.insertText(a.sceditor.command.get("date")._date(this))},txtExec:function(){this.insertText(a.sceditor.command.get("date")._date(this))},tooltip:"Insert current date"},time:{_time:function(){var a=new Date,b=a.getHours(),c=a.getMinutes(),d=a.getSeconds();return 10>b&&(b="0"+b),10>c&&(c="0"+c),10>d&&(d="0"+d),b+":"+c+":"+d},exec:function(){this.insertText(a.sceditor.command.get("time")._time())},txtExec:function(){this.insertText(a.sceditor.command.get("time")._time())},tooltip:"Insert current time"},ltr:{state:function(a,b){return b&&"ltr"===b.style.direction},exec:function(){var b=this,c=b.getRangeHelper().getFirstBlockParent(),d=a(c);b.focus(),(c&&!d.is("body")||(b.execCommand("formatBlock","p"),c=b.getRangeHelper().getFirstBlockParent(),d=a(c),c&&!d.is("body")))&&("ltr"===d.css("direction")?d.css("direction",""):d.css("direction","ltr"))},tooltip:"Left-to-Right"},rtl:{state:function(a,b){return b&&"rtl"===b.style.direction},exec:function(){var b=this,c=b.getRangeHelper().getFirstBlockParent(),d=a(c);b.focus(),(c&&!d.is("body")||(b.execCommand("formatBlock","p"),c=b.getRangeHelper().getFirstBlockParent(),d=a(c),c&&!d.is("body")))&&("rtl"===d.css("direction")?d.css("direction",""):d.css("direction","rtl"))},tooltip:"Right-to-Left"},print:{exec:"print",tooltip:"Print"},maximize:{state:function(){return this.maximize()},exec:function(){this.maximize(!this.maximize())},txtExec:function(){this.maximize(!this.maximize())},tooltip:"Maximize",shortcut:"ctrl+shift+m"},source:{exec:function(){this.toggleSourceMode()},txtExec:function(){this.toggleSourceMode()},tooltip:"View source",shortcut:"ctrl+shift+s"},ignore:{}},a.sceditor.rangeHelper=function(b,c){var d,e,f,g=c||b.contentDocument||b.document,h=b,i=!!b.getSelection,j="sceditor-start-marker",k="sceditor-end-marker",l="character",m=this,n=a.sceditor.ie,o=n&&11>n;m.insertHTML=function(a,b){var c,d,e=m.selectedRange();if(i){for(b&&(a+=m.selectedHtml()+b),d=g.createElement("p"),c=g.createDocumentFragment(),d.innerHTML=a;d.firstChild;)c.appendChild(d.firstChild);m.insertNode(c)}else{if(!e)return!1;e.pasteHTML(f(a,b,!0))}},f=function(b,c,e){var f,h,i,l,n=g.createElement("div"),o=a(n);if("string"==typeof b?(c&&(b+=m.selectedHtml()+c),n.innerHTML=b):(o.append(b),c&&(o.append(range.extractContents()),o.append(c))),f=n.lastChild){if(m.removeMarkers(),h=a(f),a.sceditor.dom.canHaveChildren(f)?(f.lastChild||h.append(g.createTextNode("\u200b")),l=h):l=o,l.append(d(j)).append(d(k)),e)return n.innerHTML;for(i=g.createDocumentFragment();n.firstChild;)i.appendChild(n.firstChild);return i}},m.insertNode=function(a,b){if(i){var c=f(a,b),d=m.selectedRange(),e=d.commonAncestorContainer;if(!c)return!1;d.deleteContents(),e&&/^(br|hr)$/i.test(e.nodeName)?e.parentNode.insertBefore(c,e):d.insertNode(c),m.restoreRange()}else m.insertHTML(a.outerHTML,b?b.outerHTML:null)},m.cloneSelected=function(){var a=m.selectedRange();return a?i?a.cloneRange():a.duplicate():void 0},m.selectedRange=function(){var a,b,c=i?h.getSelection():g.selection;if(c){if(c.getRangeAt&&c.rangeCount<=0){for(b=g.body;b.firstChild;)b=b.firstChild;a=g.createRange(),a.setStart(b,0),c.addRange(a)}return i&&(a=c.getRangeAt(0)),i||"Control"===c.type||(a=c.createRange()),e(a)?a:null}},e=function(a){var b;return a&&a.parentElement&&(b=a.parentElement())?b.ownerDocument===g:!0},m.hasSelection=function(){var a,b=i?h.getSelection():g.selection;return i||!b?b&&b.rangeCount>0:(a=b.createRange(),a&&e(a))},m.selectedHtml=function(){var a,b=m.selectedRange();return b?!i&&""!==b.text&&b.htmlText?b.htmlText:i?(a=g.createElement("div"),a.appendChild(b.cloneContents()),a.innerHTML):"":""},m.parentNode=function(){var a=m.selectedRange();return a?a.parentElement?a.parentElement():a.commonAncestorContainer:void 0},m.getFirstBlockParent=function(b){var c=function(b){return a.sceditor.dom.isInline(b,!0)?(b=b?b.parentNode:null,b?c(b):null):b};return c(b||m.parentNode())},m.insertNodeAt=function(a,b){var c=m.selectedRange(),d=m.cloneSelected();return d?(d.collapse(a),d.insertNode?d.insertNode(b):d.pasteHTML(b.outerHTML),m.selectRange(c),void 0):!1},d=function(a){m.removeMarker(a);var b=g.createElement("span");return b.id=a,b.style.lineHeight="0",b.style.display="none",b.className="sceditor-selection sceditor-ignore",b.innerHTML=" ",b},m.insertMarkers=function(){m.insertNodeAt(!0,d(j)),m.insertNodeAt(!1,d(k))},m.getMarker=function(a){return g.getElementById(a)},m.removeMarker=function(a){var b=m.getMarker(a);b&&b.parentNode.removeChild(b)},m.removeMarkers=function(){m.removeMarker(j),m.removeMarker(k)},m.saveRange=function(){m.insertMarkers()},m.selectRange=function(b){if(i){var c,d=h.getSelection(),e=b.endContainer;if(!o&&b.collapsed&&e&&!a.sceditor.dom.isInline(e,!0)){for(c=e.lastChild;c&&a(c).is(".sceditor-ignore");)c=c.previousSibling;if(a(c).is("br")){var f=g.createRange();f.setEndAfter(c),f.collapse(!1),m.compare(b,f)&&(b.setStartBefore(c),b.collapse(!0))}}d&&(m.clear(),d.addRange(b))}else b.select()},m.restoreRange=function(){var a,b=m.selectedRange(),c=m.getMarker(j),d=m.getMarker(k);return c&&d&&b?(i?(b=g.createRange(),b.setStartBefore(c),b.setEndAfter(d)):(b=g.body.createTextRange(),a=g.body.createTextRange(),a.moveToElementText(c),b.setEndPoint("StartToStart",a),b.moveStart(l,0),a.moveToElementText(d),b.setEndPoint("EndToStart",a),b.moveEnd(l,0)),m.selectRange(b),m.removeMarkers(),void 0):!1},m.selectOuterText=function(a,b){var c=m.cloneSelected();return c?(c.collapse(!1),i?(c.setStart(c.startContainer,c.startOffset-a),c.setEnd(c.endContainer,c.endOffset+b)):(c.moveStart(l,0-a),c.moveEnd(l,b)),m.selectRange(c),void 0):!1},m.getOuterText=function(a,b){var c="",d=m.cloneSelected();return d?(d.collapse(!1),a?i?(c=d.startContainer.textContent.substr(0,d.startOffset),c=c.substr(Math.max(0,c.length-b))):(d.moveStart(l,0-b),c=d.text):i?c=d.startContainer.textContent.substr(d.startOffset,b):(d.moveEnd(l,b),c=d.text),c):""},m.raplaceKeyword=function(b,c,d,e,f,g){d||b.sort(function(a,b){return a.length-b.length});var h,j,k,l,n,o,p,q=b.length,r=e||b[q-1][0].length;if(f){if(!i)return!1;++r}for(h=m.getOuterText(!0,r),j=h+(null!=g?g:""),c&&(j+=m.getOuterText(!1,r));q--;)if(p=b[q][0],n=new RegExp("(?:[\\s\xa0\u2002\u2003\u2009])"+a.sceditor.regexEscape(p)+"(?=[\\s\xa0\u2002\u2003\u2009])"),o=h.length-1-p.length,f&&--o,o=Math.max(0,o),(k=f?j.substr(o).search(n):j.indexOf(p,o))>-1){if(f&&(k+=o+1),k>h.length||k+p.length+(f?1:0)<h.length)continue;return l=h.length-k,m.selectOuterText(l,p.length-l-(null!=g&&/^\S/.test(g)?1:0)),m.insertHTML(b[q][1]),!0}return!1},m.compare=function(a,b){return b||(b=m.selectedRange()),a&&b?i?0===a.compareBoundaryPoints(Range.END_TO_END,b)&&0===a.compareBoundaryPoints(Range.START_TO_START,b):e(a)&&e(b)&&0===a.compareEndPoints("EndToEnd",b)&&0===a.compareEndPoints("StartToStart",b):!a&&!b},m.clear=function(){var a=i?h.getSelection():g.selection;a&&(a.removeAllRanges?a.removeAllRanges():a.empty&&a.empty())}},a.sceditor.dom={traverse:function(a,b,c,d,e){if(a)for(a=e?a.lastChild:a.firstChild;null!=a;){var f=e?a.previousSibling:a.nextSibling;if(!c&&b(a)===!1)return!1;if(!d&&this.traverse(a,b,c,d,e)===!1)return!1;if(c&&b(a)===!1)return!1;a=f}},rTraverse:function(a,b,c,d){this.traverse(a,b,c,d,!0)},parseHTML:function(b,d){var e=[],f=(d||c).createElement("div");return f.innerHTML=b,a.merge(e,f.childNodes),e},hasStyling:function(b){var c=a(b);return b&&(!c.is("p,div")||b.className||c.attr("style")||!a.isEmptyObject(c.data()))},convertElement:function(b,c){for(var d,e,f=b.attributes.length,g=b.ownerDocument.createElement(c);f--;)e=b.attributes[f],(!a.sceditor.ie||e.specified)&&(a.sceditor.ie<8&&/style/i.test(e.name)?b.style.cssText=b.style.cssText:g.setAttribute(e.name,e.value));for(;d=b.firstChild;)g.appendChild(d);return b.parentNode.replaceChild(g,b),g},blockLevelList:"|body|hr|p|div|h1|h2|h3|h4|h5|h6|address|pre|form|table|tbody|thead|tfoot|th|tr|td|li|ol|ul|blockquote|center|",canHaveChildren:function(a){return/11?|9/.test(a.nodeType)?"hr,br,img,input,meta,link,iframe,".indexOf(a.nodeName.toLowerCase()+",")<0:!1},isInline:function(b,c){return b&&1===b.nodeType?(b=b.tagName.toLowerCase(),"code"===b?!c:a.sceditor.dom.blockLevelList.indexOf("|"+b+"|")<0):!0},copyCSS:function(a,b){b.style.cssText=a.style.cssText+b.style.cssText},fixNesting:function(a){var b=this,c=function(a){for(;b.isInline(a.parentNode,!0);)a=a.parentNode;return a};b.traverse(a,function(a){if(1===a.nodeType&&!b.isInline(a,!0)&&b.isInline(a.parentNode,!0)){var d=c(a),e=d.parentNode,f=b.extractContents(d,a),g=a;b.copyCSS(d,g),e.insertBefore(f,d),e.insertBefore(g,d)}})},findCommonAncestor:function(b,c){return a(b).parents().has(a(c)).first()},getSibling:function(b,c){var d;return b?(d=b[c?"previousSibling":"nextSibling"])?d:a.sceditor.dom.getSibling(b.parentNode,c):null},removeWhiteSpace:function(b,c){for(var d,e,f,g,h,i,j,k,l=a.sceditor.dom.getSibling,m=a.sceditor.dom.isInline,n=b.firstChild,o=/[\t ]+/g,p=/[\t\n\r ]+/g;n;){if(i=n.nextSibling,d=n.nodeValue,e=n.nodeType,1===e&&n.firstChild&&(h=a(n).css("whiteSpace"),/pre(?:\-wrap)?$/i.test(h)||a.sceditor.dom.removeWhiteSpace(n,/line$/i.test(h))),3===e&&d){for(f=l(n),g=l(n,!0),k=g,j=!1;a(k).hasClass("sceditor-ignore");)k=l(k,!0);if(m(n)&&k){for(;k.lastChild;)k=k.lastChild;j=3===k.nodeType?/[\t\n\r ]$/.test(k.nodeValue):!m(k)}m(n)&&g&&m(g)&&!j||(d=d.replace(/^[\t\n\r ]+/,"")),m(n)&&f&&m(f)||(d=d.replace(/[\t\n\r ]+$/,"")),d=d.replace(/\u200B/g,""),d.length?n.nodeValue=d.replace(c?o:p," "):b.removeChild(n)}n=i}},extractContents:function(a,b){var c=this,d=c.findCommonAncestor(a,b),e=d?d[0]:null,f=!1,g=!1;return function h(d){var e=a.ownerDocument.createDocumentFragment();return c.traverse(d,function(c){if(g||c===b&&f)return g=!0,!1;c===a&&(f=!0);var d,i;f?jQuery.contains(c,b)&&1===c.nodeType?(d=h(c),i=c.cloneNode(!1),i.appendChild(d),e.appendChild(i)):e.appendChild(c):jQuery.contains(c,a)&&1===c.nodeType&&(d=h(c),i=c.cloneNode(!1),i.appendChild(d),e.appendChild(i))},!1),e}(e)},getOffset:function(a){for(var b=0,c=0;a;)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent;return{left:b,top:c}},getStyle:function(b,c){var d,e,f,g,h=b.style;if(!h)return null;if(a.sceditor.dom._propertyCache||(a.sceditor.dom._propertyCache={}),f=a.sceditor.dom._propertyCache,f[c]||(f[c]=a.camelCase(c)),c=f[c],g=h[c],"textAlign"===c){if(d=a(b),e=h.direction,g=g||d.css(c),d.parent().css(c)===g||"block"!==d.css("display")||d.is("hr")||d.is("th"))return null;if(e&&g&&(/right/i.test(g)&&"rtl"===e||/left/i.test(g)&&"ltr"===e))return null}return g},hasStyle:function(b,c,d){var e=a.sceditor.dom.getStyle(b,c);return e?!1:!d||e===d||a.isArray(d)&&a.inArray(e,d)>-1}},a.sceditor.plugins={},a.sceditor.PluginManager=function(b){var c=this,d=[],e=b,f=function(a){return"signal"+a.charAt(0).toUpperCase()+a.slice(1)},g=function(a,b){a=[].slice.call(a);for(var c=d.length,g=f(a.shift());c--;)if(g in d[c]){if(b)return d[c][g].apply(e,a);d[c][g].apply(e,a)}};c.call=function(){g(arguments,!1)},c.callOnlyFirst=function(){return g(arguments,!0)},c.iter=function(a){return a=f(a),function(){var b=d.length;return{callNext:function(c){for(;b--;)if(d[b]&&a in d[b])return d[b].apply(e,c)},hasNext:function(){for(var c=b;c--;)if(d[c]&&a in d[c])return!0;return!1}}}()},c.hasHandler=function(a){var b=d.length;for(a=f(a);b--;)if(a in d[b])return!0;return!1},c.exists=function(b){return b in a.sceditor.plugins?(b=a.sceditor.plugins[b],"function"==typeof b&&"object"==typeof b.prototype):!1},c.isRegistered=function(b){var e=d.length;if(!c.exists(b))return!1;for(;e--;)if(d[e]instanceof a.sceditor.plugins[b])return!0;return!1},c.register=function(b){return c.exists(b)?(b=new a.sceditor.plugins[b],d.push(b),"init"in b&&b.init.apply(e),!0):!1},c.deregister=function(b){var f,g=d.length,h=!1;if(!c.isRegistered(b))return!1;for(;g--;)d[g]instanceof a.sceditor.plugins[b]&&(f=d.splice(g,1)[0],h=!0,"destroy"in f&&f.destroy.apply(e));return h},c.destroy=function(){for(var a=d.length;a--;)"destroy"in d[a]&&d[a].destroy.apply(e);d=null,e=null}},a.sceditor.command={get:function(b){return a.sceditor.commands[b]||null},set:function(b,c){return b&&c?(c=a.extend(a.sceditor.commands[b]||{},c),c.remove=function(){a.sceditor.command.remove(b)},a.sceditor.commands[b]=c,this):!1},remove:function(b){return a.sceditor.commands[b]&&delete a.sceditor.commands[b],this}},a.sceditor.defaultOptions={toolbar:"bold,italic,underline,strike,subscript,superscript|left,center,right,justify|font,size,color,removeformat|cut,copy,paste,pastetext|bulletlist,orderedlist,indent,outdent|table|code,quote|horizontalrule,image,email,link,unlink|emoticon,youtube,date,time|ltr,rtl|print,maximize,source",toolbarExclude:null,style:"jquery.sceditor.default.css",fonts:"Arial,Arial Black,Comic Sans MS,Courier New,Georgia,Impact,Sans-serif,Serif,Times New Roman,Trebuchet MS,Verdana",colors:null,locale:a("html").attr("lang")||"en",charset:"utf-8",emoticonsCompat:!1,emoticonsEnabled:!0,emoticonsRoot:"",emoticons:{dropdown:{":)":"emoticons/smile.png",":angel:":"emoticons/angel.png",":angry:":"emoticons/angry.png","8-)":"emoticons/cool.png",":'(":"emoticons/cwy.png",":ermm:":"emoticons/ermm.png",":D":"emoticons/grin.png","<3":"emoticons/heart.png",":(":"emoticons/sad.png",":O":"emoticons/shocked.png",":P":"emoticons/tongue.png",";)":"emoticons/wink.png"},more:{":alien:":"emoticons/alien.png",":blink:":"emoticons/blink.png",":blush:":"emoticons/blush.png",":cheerful:":"emoticons/cheerful.png",":devil:":"emoticons/devil.png",":dizzy:":"emoticons/dizzy.png",":getlost:":"emoticons/getlost.png",":happy:":"emoticons/happy.png",":kissing:":"emoticons/kissing.png",":ninja:":"emoticons/ninja.png",":pinch:":"emoticons/pinch.png",":pouty:":"emoticons/pouty.png",":sick:":"emoticons/sick.png",":sideways:":"emoticons/sideways.png",":silly:":"emoticons/silly.png",":sleeping:":"emoticons/sleeping.png",":unsure:":"emoticons/unsure.png",":woot:":"emoticons/w00t.png",":wassat:":"emoticons/wassat.png"},hidden:{":whistling:":"emoticons/whistling.png",":love:":"emoticons/wub.png"}},width:null,height:null,resizeEnabled:!0,resizeMinWidth:null,resizeMinHeight:null,resizeMaxHeight:null,resizeMaxWidth:null,resizeHeight:!0,resizeWidth:!0,getHtmlHandler:null,getTextHandler:null,dateFormat:"year-month-day",toolbarContainer:null,enablePasteFiltering:!1,disablePasting:!1,readOnly:!1,rtl:!1,autofocus:!1,autofocusEnd:!0,autoExpand:!1,autoUpdate:!1,spellcheck:!0,runWithoutWysiwygSupport:!1,id:null,plugins:"",zIndex:null,bbcodeTrim:!1,disableBlockRemove:!1,parserOptions:{},dropDownCss:{}},a.fn.sceditor=function(b){var c,d=[];return b=b||{},b.runWithoutWysiwygSupport||a.sceditor.isWysiwygSupported?(this.each(function(){c=this.jquery?this:a(this),c.parents(".sceditor-container").length>0||("state"===b?d.push(!!c.data("sceditor")):"instance"===b?d.push(c.data("sceditor")):c.data("sceditor")||new a.sceditor(this,b))}),d.length?1===d.length?d[0]:a(d):this):void 0}}(jQuery,window,document);