// http://localhost/elkarte/themes/default/elk_jquery_plugins.js script.js script_elk.js theme.js jquery.sceditor.js jquery.sceditor.bbcode.js jquery.sceditor.elkarte.js post.js splittag.plugin.js drafts.plugin.js jquery.atwho.js jquery.caret.js mentioning.plugin.js fader.js
(function($){$.fn.hoverIntent=function(handlerIn,handlerOut,selector){var cfg={interval:50,sensitivity:8,timeout:1};if(typeof handlerIn==="object"){cfg=$.extend(cfg,handlerIn)}else if($.isFunction(handlerOut)){cfg=$.extend(cfg,{over:handlerIn,out:handlerOut,selector:selector})}else cfg=$.extend(cfg,{over:handlerIn,out:handlerIn,selector:handlerOut});var cX,cY,pX,pY,track=function(ev){cX=ev.pageX;cY=ev.pageY},compare=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);if((Math.abs(pX-cX)+Math.abs(pY-cY))<cfg.sensitivity){$(ob).off("mousemove.hoverIntent",track);ob.hoverIntent_s=1;return cfg.over.apply(ob,[ev])}else{pX=cX;pY=cY;ob.hoverIntent_t=setTimeout(function(){compare(ev,ob)},cfg.interval)}},delay=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);ob.hoverIntent_s=0;return cfg.out.apply(ob,[ev])},handleHover=function(e){var ev=jQuery.extend({},e),ob=this;if(ob.hoverIntent_t)ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);if(e.type=="mouseenter"){pX=ev.pageX;pY=ev.pageY;$(ob).on("mousemove.hoverIntent",track);if(ob.hoverIntent_s!=1)ob.hoverIntent_t=setTimeout(function(){compare(ev,ob)},cfg.interval)}else{$(ob).off("mousemove.hoverIntent",track);if(ob.hoverIntent_s==1)ob.hoverIntent_t=setTimeout(function(){delay(ev,ob)},cfg.timeout)}};return this.on({'mouseenter.hoverIntent':handleHover,'mouseleave.hoverIntent':handleHover},cfg.selector)}})(jQuery);(function($){"use strict";var methods=(function(){var c={bcClass:'sf-breadcrumb',menuClass:'sf-js-enabled',anchorClass:'sf-with-ul',menuArrowClass:'sf-arrows'},ios=(function(){var ios=/iPhone|iPad|iPod/i.test(navigator.userAgent);if(ios)$(window).load(function(){$('body').children().on('click',$.noop)});return ios})(),wp7=(function(){var style=document.documentElement.style;return('behavior'in style&&'fill'in style&&/iemobile/i.test(navigator.userAgent))})(),toggleMenuClasses=function($menu,o){var classes=c.menuClass;if(o.cssArrows)classes+=' '+c.menuArrowClass;$menu.toggleClass(classes)},setPathToCurrent=function($menu,o){return $menu.find('li.'+o.pathClass).slice(0,o.pathLevels).addClass(o.hoverClass+' '+c.bcClass).filter(function(){return($(this).children('ul').hide().show().length)}).removeClass(o.pathClass)},toggleAnchorClass=function($li){$li.children('a').toggleClass(c.anchorClass)},toggleTouchAction=function($menu){var touchAction=$menu.css('ms-touch-action');touchAction=(touchAction==='pan-y')?'auto':'pan-y';$menu.css('ms-touch-action',touchAction)},applyHandlers=function($menu,o){var targets='li:has(ul)';if($.fn.hoverIntent&&!o.disableHI){$menu.hoverIntent(over,out,targets)}else $menu.on('mouseenter.superfish',targets,over).on('mouseleave.superfish',targets,out);var touchevent='MSPointerDown.superfish';if(!ios)touchevent+=' touchend.superfish';if(wp7)touchevent+=' mousedown.superfish';$menu.on('focusin.superfish','li',over).on('focusout.superfish','li',out).on(touchevent,'a',touchHandler)},touchHandler=function(e){var $this=$(this),$ul=$this.siblings('ul');if($ul.length>0&&$ul.is(':hidden')){$this.one('click.superfish',false);if(e.type==='MSPointerDown'){$this.trigger('focus')}else $.proxy(over,$this.parent('li'))()}},over=function(){var $this=$(this),o=getOptions($this);clearTimeout(o.sfTimer);$this.siblings().superfish('hide').end().superfish('show')},out=function(){var $this=$(this),o=getOptions($this);if(ios){$.proxy(close,$this,o)()}else{clearTimeout(o.sfTimer);o.sfTimer=setTimeout($.proxy(close,$this,o),o.delay)}},close=function(o){o.retainPath=($.inArray(this[0],o.$path)>-1);this.superfish('hide');if(!this.parents('.'+o.hoverClass).length){o.onIdle.call(getMenu(this));if(o.$path.length)$.proxy(over,o.$path)()}},getMenu=function($el){return $el.closest('.'+c.menuClass)},getOptions=function($el){return getMenu($el).data('sf-options')};return{hide:function(instant){if(this.length){var $this=this,o=getOptions($this);if(!o)return this;var not=(o.retainPath===true)?o.$path:'',$ul=$this.find('li.'+o.hoverClass).add(this).not(not).removeClass(o.hoverClass).children('ul'),speed=o.speedOut;if(instant){$ul.show();speed=0};o.retainPath=false;o.onBeforeHide.call($ul);$ul.stop(true,true).animate(o.animationOut,speed,function(){var $this=$(this);o.onHide.call($this)})};return this},show:function(){var o=getOptions(this);if(!o)return this;var $this=this.addClass(o.hoverClass),$ul=$this.children('ul');o.onBeforeShow.call($ul);$ul.stop(true,true).animate(o.animation,o.speed,function(){o.onShow.call($ul)});return this},destroy:function(){return this.each(function(){var $this=$(this),o=$this.data('sf-options'),$liHasUl=$this.find('li:has(ul)');if(!o)return false;clearTimeout(o.sfTimer);toggleMenuClasses($this,o);toggleAnchorClass($liHasUl);toggleTouchAction($this);$this.off('.superfish').off('.hoverIntent');$liHasUl.children('ul').attr('style',function(i,style){return style.replace(/display[^;]+;?/g,'')});o.$path.removeClass(o.hoverClass+' '+c.bcClass).addClass(o.pathClass);$this.find('.'+o.hoverClass).removeClass(o.hoverClass);o.onDestroy.call($this);$this.removeData('sf-options')})},init:function(op){return this.each(function(){var $this=$(this);if($this.data('sf-options'))return false;var o=$.extend({},$.fn.superfish.defaults,op),$liHasUl=$this.find('li:has(ul)');o.$path=setPathToCurrent($this,o);$this.data('sf-options',o);toggleMenuClasses($this,o);toggleAnchorClass($liHasUl);toggleTouchAction($this);applyHandlers($this,o);$liHasUl.not('.'+c.bcClass).superfish('hide',true);o.onInit.call(this)})}}})();$.fn.superfish=function(method,args){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments)}else return $.error('Method '+method+' does not exist on jQuery.fn.superfish')};$.fn.superfish.defaults={hoverClass:'sfhover',pathClass:'overrideThisToUse',pathLevels:1,delay:800,animation:{opacity:'show',height:'show',width:'show'},animationOut:{opacity:'hide'},speed:'normal',speedOut:'fast',cssArrows:false,disableHI:false,onInit:$.noop,onBeforeShow:$.noop,onShow:$.noop,onBeforeHide:$.noop,onHide:$.noop,onIdle:$.noop,onDestroy:$.noop};$.fn.extend({hideSuperfishUl:methods.hide,showSuperfishUl:methods.show})})(jQuery);(function($){var methods=(function(){var c={bcClass:'sf-breadcrumb',menuClass:'sf-js-enabled',anchorClass:'sf-with-ul',menuArrowClass:'sf-arrows'},outerClick=(function(){$(window).load(function(){$('body').children().on('click.superclick',function(){var $allMenus=$('.sf-js-enabled');$allMenus.superclick('reset')})})})(),toggleMenuClasses=function($menu,o){var classes=c.menuClass;if(o.cssArrows)classes+=' '+c.menuArrowClass;$menu.toggleClass(classes)},setPathToCurrent=function($menu,o){return $menu.find('li.'+o.pathClass).slice(0,o.pathLevels).addClass(o.activeClass+' '+c.bcClass).filter(function(){return($(this).children('ul').hide().show().length)}).removeClass(o.pathClass)},toggleAnchorClass=function($li){$li.children('a').toggleClass(c.anchorClass)},toggleTouchAction=function($menu){var touchAction=$menu.css('ms-touch-action');touchAction=(touchAction==='pan-y')?'auto':'pan-y';$menu.css('ms-touch-action',touchAction)},clickHandler=function(e){var $this=$(this),$ul=$this.siblings('ul'),func;if($ul.length){func=($ul.is(':hidden'))?over:out;$.proxy(func,$this.parent('li'))();return false}},over=function(){var $this=$(this),o=getOptions($this);$this.siblings().superclick('hide').end().superclick('show')},out=function(){var $this=$(this),o=getOptions($this);$.proxy(close,$this,o)()},close=function(o){o.retainPath=($.inArray(this[0],o.$path)>-1);this.superclick('hide');if(!this.parents('.'+o.activeClass).length){o.onIdle.call(getMenu(this));if(o.$path.length)$.proxy(over,o.$path)()}},getMenu=function($el){return $el.closest('.'+c.menuClass)},getOptions=function($el){return getMenu($el).data('sf-options')};return{hide:function(instant){if(this.length){var $this=this,o=getOptions($this);if(!o)return this;var not=(o.retainPath===true)?o.$path:'',$ul=$this.find('li.'+o.activeClass).add(this).not(not).removeClass(o.activeClass).children('ul'),speed=o.speedOut;if(instant){$ul.show();speed=0};o.retainPath=false;o.onBeforeHide.call($ul);$ul.stop(true,true).animate(o.animationOut,speed,function(){var $this=$(this);o.onHide.call($this)})};return this},show:function(){var o=getOptions(this);if(!o)return this;var $this=this.addClass(o.activeClass),$ul=$this.children('ul');o.onBeforeShow.call($ul);$ul.stop(true,true).animate(o.animation,o.speed,function(){o.onShow.call($ul)});return this},destroy:function(){return this.each(function(){var $this=$(this),o=$this.data('sf-options'),$liHasUl=$this.find('li:has(ul)');if(!o)return false;toggleMenuClasses($this,o);toggleAnchorClass($liHasUl);toggleTouchAction($this);$this.off('.superclick');$liHasUl.children('ul').attr('style',function(i,style){return style.replace(/display[^;]+;?/g,'')});o.$path.removeClass(o.activeClass+' '+c.bcClass).addClass(o.pathClass);$this.find('.'+o.activeClass).removeClass(o.activeClass);o.onDestroy.call($this);$this.removeData('sf-options')})},reset:function(){return this.each(function(){var $menu=$(this),o=getOptions($menu),$openLis=$($menu.find('.'+o.activeClass).toArray().reverse());$openLis.children('a').trigger('click')})},init:function(op){return this.each(function(){var $this=$(this);if($this.data('sf-options'))return false;var o=$.extend({},$.fn.superclick.defaults,op),$liHasUl=$this.find('li:has(ul)');o.$path=setPathToCurrent($this,o);$this.data('sf-options',o);toggleMenuClasses($this,o);toggleAnchorClass($liHasUl);toggleTouchAction($this);$this.on('click.superclick','a',clickHandler);$liHasUl.not('.'+c.bcClass).superclick('hide',true);o.onInit.call(this)})}}})();$.fn.superclick=function(method,args){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments)}else return $.error('Method '+method+' does not exist on jQuery.fn.superclick')};$.fn.superclick.defaults={activeClass:'sfhover',pathClass:'overrideThisToUse',pathLevels:1,animation:{opacity:'show'},animationOut:{opacity:'hide'},speed:'normal',speedOut:'fast',cssArrows:false,onInit:$.noop,onBeforeShow:$.noop,onShow:$.noop,onBeforeHide:$.noop,onHide:$.noop,onIdle:$.noop,onDestroy:$.noop}})(jQuery);var elk_formSubmitted=false,lastKeepAliveCheck=new Date().getTime(),ajax_indicator_ele=null,ua=navigator.userAgent.toLowerCase(),is_opera=!!window.opera,is_ff=typeof InstallTrigger!=='undefined'||((ua.indexOf('iceweasel')!==-1||ua.indexOf('icecat')!==-1||ua.indexOf('shiretoko')!==-1||ua.indexOf('minefield')!==-1)&&!is_opera),is_safari=Object.prototype.toString.call(window.HTMLElement).indexOf('Constructor')>0,is_chrome=!!window.chrome,is_ie=!!document.documentMode,is_webkit=ua.indexOf('applewebkit')!==-1;if(!('getElementsByClassName'in document))document.getElementsByClassName=function(className){return $('.'+className)}
function getXMLDocument(sUrl,funcCallback){var oMyDoc=new XMLHttpRequest(),bAsync=typeof funcCallback!=='undefined',oCaller=this;if(bAsync)oMyDoc.onreadystatechange=function(){if(oMyDoc.readyState!==4)return;if(oMyDoc.responseXML!==null&&oMyDoc.status===200){funcCallback.call(oCaller,oMyDoc.responseXML)}else funcCallback.call(oCaller,false)};oMyDoc.open('GET',sUrl,bAsync);oMyDoc.send(null);return oMyDoc}
function sendXMLDocument(sUrl,sContent,funcCallback){var oSendDoc=new window.XMLHttpRequest(),oCaller=this;if(typeof funcCallback!=='undefined')oSendDoc.onreadystatechange=function(){if(oSendDoc.readyState!==4)return;if(oSendDoc.responseXML!==null&&oSendDoc.status===200){funcCallback.call(oCaller,oSendDoc.responseXML)}else funcCallback.call(oCaller,false)};oSendDoc.open('POST',sUrl,true);if('setRequestHeader'in oSendDoc)oSendDoc.setRequestHeader('Content-Type','application/x-www-form-urlencoded');oSendDoc.send(sContent);return true};String.prototype.oCharsetConversion={from:'',to:''};String.prototype.php_to8bit=function(){var n,sReturn='';for(var i=0,iTextLen=this.length;i<iTextLen;i++){n=this.charCodeAt(i);if(n<128){sReturn+=String.fromCharCode(n)}else if(n<2048){sReturn+=String.fromCharCode(192|n>>6)+String.fromCharCode(128|n&63)}else if(n<65536){sReturn+=String.fromCharCode(224|n>>12)+String.fromCharCode(128|n>>6&63)+String.fromCharCode(128|n&63)}else sReturn+=String.fromCharCode(240|n>>18)+String.fromCharCode(128|n>>12&63)+String.fromCharCode(128|n>>6&63)+String.fromCharCode(128|n&63)};return sReturn};String.prototype.php_strtr=function(sFrom,sTo){return this.replace(new RegExp('['+sFrom+']','g'),function(sMatch){return sTo.charAt(sFrom.indexOf(sMatch))})};String.prototype.php_strtolower=function(){return typeof elk_iso_case_folding==='boolean'&&elk_iso_case_folding===true?this.php_strtr('ABCDEFGHIJKLMNOPQRSTUVWXYZ\x8a\x8c\x8e\x9f\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde','abcdefghijklmnopqrstuvwxyz\x9a\x9c\x9e\xff\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe'):this.php_strtr('ABCDEFGHIJKLMNOPQRSTUVWXYZ','abcdefghijklmnopqrstuvwxyz')};String.prototype.php_urlencode=function(){return escape(this).replace(/\+/g,'%2b').replace('*','%2a').replace('/','%2f').replace('@','%40')};String.prototype.php_htmlspecialchars=function(){return this.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;')};String.prototype.php_unhtmlspecialchars=function(){return this.replace(/&quot;/g,'"').replace(/&gt;/g,'>').replace(/&lt;/g,'<').replace(/&amp;/g,'&')};String.prototype.php_addslashes=function(){return this.replace(/\\/g,'\\\\').replace(/'/g,'\\\'')};String.prototype._replaceEntities=function(sInput,sDummy,sNum){return String.fromCharCode(parseInt(sNum))};String.prototype.removeEntities=function(){return this.replace(/&(amp;)?#(\d+);/g,this._replaceEntities)};String.prototype.easyReplace=function(oReplacements){var sResult=this;for(var sSearch in oReplacements)sResult=sResult.replace(new RegExp('%'+sSearch+'%','g'),oReplacements[sSearch]);return sResult}
function php_str_repeat(sString,iTime){if(iTime<1){return''}else return sString+php_str_repeat(sString,iTime-1)}
function reqWin(desktopURL,alternateWidth,alternateHeight,noScrollbars){if((alternateWidth&&self.screen.availWidth*0.8<alternateWidth)||(alternateHeight&&self.screen.availHeight*0.8<alternateHeight)){noScrollbars=false;alternateWidth=Math.min(alternateWidth,self.screen.availWidth*0.8);alternateHeight=Math.min(alternateHeight,self.screen.availHeight*0.8)}else noScrollbars=typeof noScrollbars==='boolean'&&noScrollbars===true;window.open(desktopURL,'requested_popup','toolbar=no,location=no,status=no,menubar=no,scrollbars='+(noScrollbars?'no':'yes')+',width='+(alternateWidth?alternateWidth:480)+',height='+(alternateHeight?alternateHeight:220)+',resizable=no');return false}
function reqOverlayDiv(desktopURL,sHeader,sIcon){var sAjax_indicator='<div class="centertext"><img src="'+elk_images_url+'/loading.gif" ></div>';sIcon=elk_images_url+'/'+(typeof sIcon==='string'?sIcon:'helptopics.png'),sHeader=typeof sHeader==='string'?sHeader:help_popup_heading_text;var oContainer=new smc_Popup({heading:sHeader,content:sAjax_indicator,icon:sIcon}),oPopup_body=$('#'+oContainer.popup_id).find('.popup_content');$.ajax({url:desktopURL,type:"GET",dataType:"html"}).done(function(data,textStatus,xhr){var help_content=$('<div id="temp_help">').html(data).find('a[href$="self.close();"]').hide().prev('br').hide().parent().html();oPopup_body.html(help_content)}).fail(function(xhr,textStatus,errorThrown){oPopup_body.html(textStatus)});return false}
function smc_Popup(oOptions){this.opt=oOptions;this.popup_id=this.opt.custom_id?this.opt.custom_id:'elk_popup';this.show()};smc_Popup.prototype.show=function(){popup_class='popup_window '+(this.opt.custom_class?this.opt.custom_class:'description');icon=this.opt.icon?'<img src="'+this.opt.icon+'" class="icon" alt="" /> ':'';$('body').append('<div id="'+this.popup_id+'" class="popup_container"><div class="'+popup_class+'" style="max-height: none;"><h3 class="popup_heading"><a href="javascript:void(0);" class="hide_popup" title="Close"></a>'+icon+this.opt.heading+'</h3><div class="popup_content">'+this.opt.content+'</div></div></div>');this.popup_body=$('#'+this.popup_id).children('.popup_window');this.popup_body.parent().fadeIn(300);var popup_instance=this;$(document).mouseup(function(e){if($('#'+popup_instance.popup_id).has(e.target).length===0)popup_instance.hide()}).keyup(function(e){if(e.keyCode===27)popup_instance.hide()});$('#'+this.popup_id).find('.hide_popup').click(function(){return popup_instance.hide()});return false};smc_Popup.prototype.hide=function(){$('#'+this.popup_id).fadeOut(300,function(){$(this).remove()});return false}
function replaceText(text,oTextHandle){if('selectionStart'in oTextHandle){var begin=oTextHandle.value.substr(0,oTextHandle.selectionStart),end=oTextHandle.value.substr(oTextHandle.selectionEnd),scrollPos=oTextHandle.scrollTop,goForward=0;oTextHandle.value=begin+text+end;if(oTextHandle.setSelectionRange){oTextHandle.focus();if(is_opera&&text.match(/\n/g)!==null)goForward=text.match(/\n/g).length;oTextHandle.setSelectionRange(begin.length+text.length+goForward,begin.length+text.length+goForward)};oTextHandle.scrollTop=scrollPos}else{oTextHandle.value+=text;oTextHandle.focus(oTextHandle.value.length-1)}}
function isEmptyText(theField){var theValue;if(typeof theField==='string'){theValue=theField}else theValue=theField.value;while(theValue.length>0&&(theValue.charAt(0)===' '||theValue.charAt(0)==='\t'))theValue=theValue.substring(1,theValue.length);while(theValue.length>0&&(theValue.charAt(theValue.length-1)===' '||theValue.charAt(theValue.length-1)==='\t'))theValue=theValue.substring(0,theValue.length-1);if(theValue===''){return true}else return false}
function submitonce(theform){elk_formSubmitted=true}
function submitThisOnce(oControl){var oForm='form'in oControl?oControl.form:oControl,aTextareas=oForm.getElementsByTagName('textarea');for(var i=0,n=aTextareas.length;i<n;i++)aTextareas[i].readOnly=true;return!elk_formSubmitted}
function setInnerHTML(oElement,sToValue){if(oElement)oElement.innerHTML=sToValue}
function getInnerHTML(oElement){if(oElement)return oElement.innerHTML}
function setOuterHTML(oElement,sToValue){if('outerHTML'in oElement){oElement.outerHTML=sToValue}else{var range=document.createRange();range.setStartBefore(oElement);oElement.parentNode.replaceChild(range.createContextualFragment(sToValue),oElement)}}
function in_array(variable,theArray){for(var i in theArray)if(theArray[i]==variable)return true;return false}
function array_search(variable,theArray){for(var i in theArray)if(theArray[i]==variable)return i;return null}
function selectRadioByName(oRadioGroup,sName){if(!('length'in oRadioGroup))return oRadioGroup.checked=true;for(var i=0,n=oRadioGroup.length;i<n;i++)if(oRadioGroup[i].value===sName)return oRadioGroup[i].checked=true;return false}
function selectAllRadio(oInvertCheckbox,oForm,sMask,sValue){for(var i=0;i<oForm.length;i++)if(oForm[i].name!==undefined&&oForm[i].name.substr(0,sMask.length)==sMask&&oForm[i].value==sValue)oForm[i].checked=true}
function invertAll(oInvertCheckbox,oForm,sMask,bIgnoreDisabled){for(var i=0;i<oForm.length;i++){if(!('name'in oForm[i])||(typeof sMask==='string'&&oForm[i].name.substr(0,sMask.length)!==sMask&&oForm[i].id.substr(0,sMask.length)!==sMask))continue;if(!oForm[i].disabled||(typeof bIgnoreDisabled==='boolean'&&bIgnoreDisabled))oForm[i].checked=oInvertCheckbox.checked}};var lastKeepAliveCheck=new Date().getTime()
function elk_sessionKeepAlive(){var curTime=new Date().getTime();if(elk_scripturl&&curTime-lastKeepAliveCheck>9e5){var tempImage=new Image();tempImage.src=elk_prepareScriptUrl(elk_scripturl)+'action=keepalive;time='+curTime;lastKeepAliveCheck=curTime};window.setTimeout('elk_sessionKeepAlive();',12e5)};window.setTimeout('elk_sessionKeepAlive();',12e5)
function elk_setThemeOption(option,value,theme,cur_session_id,cur_session_var,additional_vars){if(cur_session_id===null)cur_session_id=elk_session_id;if(typeof cur_session_var==='undefined')cur_session_var='sesc';if(additional_vars===null)additional_vars='';var tempImage=new Image();tempImage.src=elk_prepareScriptUrl(elk_scripturl)+'action=jsoption;var='+option+';val='+value+';'+cur_session_var+'='+cur_session_id+additional_vars+(theme===null?'':'&th='+theme)+';time='+(new Date().getTime())}
function elk_avatarResize(){var possibleAvatars=document.getElementsByTagName('img');for(var i=0;i<possibleAvatars.length;i++){var tempAvatars=[];j=0;if(possibleAvatars[i].className!=='avatar')continue;tempAvatars[j]=new Image();tempAvatars[j].avatar=possibleAvatars[i];tempAvatars[j].onload=function(){this.avatar.width=this.width;this.avatar.height=this.height;if(elk_avatarMaxWidth!==0&&this.width>elk_avatarMaxWidth){this.avatar.height=(elk_avatarMaxWidth*this.height)/this.width;this.avatar.width=elk_avatarMaxWidth};if(elk_avatarMaxHeight!==0&&this.avatar.height>elk_avatarMaxHeight){this.avatar.width=(elk_avatarMaxHeight*this.avatar.width)/this.avatar.height;this.avatar.height=elk_avatarMaxHeight}};tempAvatars[j].src=possibleAvatars[i].src;j++};if(typeof window_oldAvatarOnload!=='undefined'&&window_oldAvatarOnload){window_oldAvatarOnload();window_oldAvatarOnload=null}}
function hashLoginPassword(doForm,cur_session_id,token){if(cur_session_id===null)cur_session_id=elk_session_id;if(typeof hex_sha1==='undefined')return;if(doForm.user.value.indexOf('@')!==-1)return;if(!('opera'in window))doForm.passwrd.autocomplete='off';doForm.hash_passwrd.value=hex_sha1(hex_sha1(doForm.user.value.php_to8bit().php_strtolower()+doForm.passwrd.value.php_to8bit())+cur_session_id+token);if(is_ff!==-1){doForm.passwrd.value=''}else doForm.passwrd.value=doForm.passwrd.value.replace(/./g,'*')}
function hashAdminPassword(doForm,username,cur_session_id,token){if(typeof hex_sha1==='undefined')return;doForm.admin_hash_pass.value=hex_sha1(hex_sha1(username.php_to8bit().php_strtolower()+doForm.admin_pass.value.php_to8bit())+cur_session_id+token);doForm.admin_pass.value=doForm.admin_pass.value.replace(/./g,'*')}
function hashModeratePassword(doForm,username,cur_session_id,token){if(typeof hex_sha1==='undefined')return;doForm.moderate_hash_pass.value=hex_sha1(hex_sha1(username.php_to8bit().php_strtolower()+doForm.moderate_pass.value.php_to8bit())+cur_session_id+token);doForm.moderate_pass.value=doForm.moderate_pass.value.replace(/./g,'*')}
function expandPages(spanNode,baseURL,firstPage,lastPage,perPage){var replacement='',i=0,oldLastPage=0,perPageLimit=50;if((lastPage-firstPage)/perPage>perPageLimit){oldLastPage=lastPage;lastPage=firstPage+perPageLimit*perPage};for(i=firstPage;i<lastPage;i+=perPage)replacement+='<a class="navPages" href="'+baseURL.replace(/%1\$d/,i).replace(/%%/g,'%')+'">'+(1+i/perPage)+'</a> ';if(oldLastPage>0)replacement+='<span class="expand_pages" role="menuitem" onclick="expandPages(this, \''+baseURL+'\', '+lastPage+', '+oldLastPage+', '+perPage+');"> ... </span> ';setOuterHTML(spanNode,replacement)}
function smc_preCacheImage(sSrc){if(!('smc_aCachedImages'in window))window.smc_aCachedImages=[];if(!in_array(sSrc,window.smc_aCachedImages)){var oImage=new Image();oImage.src=sSrc}}
function smc_Cookie(oOptions){this.opt=oOptions;this.oCookies={};this.init()};smc_Cookie.prototype.init=function(){if('cookie'in document&&document.cookie!==''){var aCookieList=document.cookie.split(';');for(var i=0,n=aCookieList.length;i<n;i++){var aNameValuePair=aCookieList[i].split('=');this.oCookies[aNameValuePair[0].replace(/^\s+|\s+$/g,'')]=decodeURIComponent(aNameValuePair[1])}}};smc_Cookie.prototype.get=function(sKey){return sKey in this.oCookies?this.oCookies[sKey]:null};smc_Cookie.prototype.set=function(sKey,sValue){document.cookie=sKey+'='+encodeURIComponent(sValue)}
function elk_Toggle(oOptions){this.opt=oOptions;this.bCollapsed=false;this.oCookie=null;this.init()};elk_Toggle.prototype.init=function(){var i=0,n=0;if('bToggleEnabled'in this.opt&&!this.opt.bToggleEnabled)return;if('oCookieOptions'in this.opt&&this.opt.oCookieOptions.bUseCookie){this.oCookie=new smc_Cookie({});var cookieValue=this.oCookie.get(this.opt.oCookieOptions.sCookieName);if(cookieValue!==null)this.opt.bCurrentlyCollapsed=cookieValue==='1'};if(this.opt.bCurrentlyCollapsed)this.changeState(true,true);if('aSwapImages'in this.opt){for(i=0,n=this.opt.aSwapImages.length;i<n;i++){var oImage=document.getElementById(this.opt.aSwapImages[i].sId);if(typeof oImage==='object'&&oImage!==null){if(oImage.style.display==='none')oImage.style.display='';oImage.instanceRef=this;oImage.onclick=function(){this.instanceRef.toggle();this.blur()};oImage.style.cursor='pointer';smc_preCacheImage(this.opt.aSwapImages[i].srcCollapsed)}}}else if('aSwapClasses'in this.opt)for(i=0,n=this.opt.aSwapClasses.length;i<n;i++){var oContainer=document.getElementById(this.opt.aSwapClasses[i].sId);if(typeof oContainer==='object'&&oContainer!==null){if(oContainer.style.display==='none')oContainer.style.display='';oContainer.instanceRef=this;oContainer.onclick=function(){this.instanceRef.toggle();this.blur()};oContainer.style.cursor='pointer'}};if('aSwapLinks'in this.opt)for(i=0,n=this.opt.aSwapLinks.length;i<n;i++){var oLink=document.getElementById(this.opt.aSwapLinks[i].sId);if(typeof oLink==='object'&&oLink!==null){if(oLink.style.display==='none')oLink.style.display='';oLink.instanceRef=this;oLink.onclick=function(){this.instanceRef.toggle();this.blur();return false}}}};elk_Toggle.prototype.changeState=function(bCollapse,bInit){var i=0,n=0,oContainer;bInit=typeof bInit==='undefined'?false:true;if(!bInit&&bCollapse&&'funcOnBeforeCollapse'in this.opt){this.tmpMethod=this.opt.funcOnBeforeCollapse;this.tmpMethod();delete this.tmpMethod}else if(!bInit&&!bCollapse&&'funcOnBeforeExpand'in this.opt){this.tmpMethod=this.opt.funcOnBeforeExpand;this.tmpMethod();delete this.tmpMethod};if('aSwapImages'in this.opt){for(i=0,n=this.opt.aSwapImages.length;i<n;i++){var oImage=document.getElementById(this.opt.aSwapImages[i].sId);if(typeof oImage==='object'&&oImage!==null){var sTargetSource=bCollapse?this.opt.aSwapImages[i].srcCollapsed:this.opt.aSwapImages[i].srcExpanded;if(oImage.src!=sTargetSource)oImage.src=sTargetSource;oImage.alt=oImage.title=bCollapse?this.opt.aSwapImages[i].altCollapsed:this.opt.aSwapImages[i].altExpanded}}}else if('aSwapClasses'in this.opt)for(i=0,n=this.opt.aSwapClasses.length;i<n;i++){oContainer=document.getElementById(this.opt.aSwapClasses[i].sId);if(typeof oContainer==='object'&&oContainer!==null){var sTargetClass=bCollapse?this.opt.aSwapClasses[i].classCollapsed:this.opt.aSwapClasses[i].classExpanded;if(oContainer.className!==sTargetClass)oContainer.className=sTargetClass;oContainer.title=oContainer.title=bCollapse?this.opt.aSwapClasses[i].titleCollapsed:this.opt.aSwapClasses[i].titleExpanded}};if('aSwapLinks'in this.opt)for(i=0,n=this.opt.aSwapLinks.length;i<n;i++){var oLink=document.getElementById(this.opt.aSwapLinks[i].sId);if(typeof oLink==='object'&&oLink!==null)oLink.innerHTML=bCollapse?this.opt.aSwapLinks[i].msgCollapsed:this.opt.aSwapLinks[i].msgExpanded};for(i=0,n=this.opt.aSwappableContainers.length;i<n;i++){if(this.opt.aSwappableContainers[i]===null)continue;oContainer=document.getElementById(this.opt.aSwappableContainers[i]);if(typeof oContainer==='object'&&oContainer!==null)if(bCollapse){$(oContainer).slideUp()}else $(oContainer).slideDown()};this.bCollapsed=bCollapse;if('oCookieOptions'in this.opt&&this.opt.oCookieOptions.bUseCookie)this.oCookie.set(this.opt.oCookieOptions.sCookieName,this.bCollapsed?'1':'0');if(!bInit&&'oThemeOptions'in this.opt&&this.opt.oThemeOptions.bUseThemeSettings)elk_setThemeOption(this.opt.oThemeOptions.sOptionName,this.bCollapsed?'1':'0','sThemeId'in this.opt.oThemeOptions?this.opt.oThemeOptions.sThemeId:null,elk_session_id,elk_session_var,'sAdditionalVars'in this.opt.oThemeOptions?this.opt.oThemeOptions.sAdditionalVars:null)};elk_Toggle.prototype.toggle=function(){this.changeState(!this.bCollapsed)}
function ajax_indicator(turn_on){if(ajax_indicator_ele===null){ajax_indicator_ele=document.getElementById('ajax_in_progress');if(ajax_indicator_ele===null&&typeof ajax_notification_text!==null)create_ajax_indicator_ele()};if(ajax_indicator_ele!==null)ajax_indicator_ele.style.display=turn_on?'block':'none'}
function create_ajax_indicator_ele(){ajax_indicator_ele=document.createElement('div');ajax_indicator_ele.id='ajax_in_progress';var cancel_link=document.createElement('a');cancel_link.href='javascript:ajax_indicator(false)';var cancel_img=document.createElement('img');cancel_img.src=elk_images_url+'/icons/quick_remove.png';if(typeof ajax_notification_cancel_text!=='undefined'){cancel_img.alt=ajax_notification_cancel_text;cancel_img.title=ajax_notification_cancel_text};cancel_link.appendChild(cancel_img);ajax_indicator_ele.appendChild(cancel_link);ajax_indicator_ele.innerHTML+=ajax_notification_text;document.body.appendChild(ajax_indicator_ele)}
function createEventListener(oTarget){if(!('addEventListener'in oTarget))if(oTarget.attachEvent){oTarget.addEventListener=function(sEvent,funcHandler,bCapture){oTarget.attachEvent('on'+sEvent,funcHandler)};oTarget.removeEventListener=function(sEvent,funcHandler,bCapture){oTarget.detachEvent('on'+sEvent,funcHandler)}}else{oTarget.addEventListener=function(sEvent,funcHandler,bCapture){oTarget['on'+sEvent]=funcHandler};oTarget.removeEventListener=function(sEvent,funcHandler,bCapture){oTarget['on'+sEvent]=null}}}
function grabJumpToContent(elem){var oXMLDoc=getXMLDocument(elk_prepareScriptUrl(elk_scripturl)+'action=xmlhttp;sa=jumpto;xml'),aBoardsAndCategories=[],i=0,n=0;if(oXMLDoc.responseXML){var items=oXMLDoc.responseXML.getElementsByTagName('elk')[0].getElementsByTagName('item');for(i=0,n=items.length;i<n;i++)aBoardsAndCategories[aBoardsAndCategories.length]={id:parseInt(items[i].getAttribute('id')),isCategory:items[i].getAttribute('type')==='category',name:items[i].firstChild.nodeValue.removeEntities(),is_current:false,childLevel:parseInt(items[i].getAttribute('childlevel'))}};for(i=0,n=aJumpTo.length;i<n;i++)aJumpTo[i].fillSelect(aBoardsAndCategories);elem.style.width='auto';elem.focus()};var aJumpTo=[]
function JumpTo(oJumpToOptions){this.opt=oJumpToOptions;this.dropdownList=null;this.showSelect()};JumpTo.prototype.showSelect=function(){var sChildLevelPrefix='';for(var i=this.opt.iCurBoardChildLevel;i>0;i--)sChildLevelPrefix+=this.opt.sBoardChildLevelIndicator;if(sChildLevelPrefix!='')sChildLevelPrefix=sChildLevelPrefix+this.opt.sBoardPrefix;document.getElementById(this.opt.sContainerId).innerHTML=this.opt.sJumpToTemplate.replace(/%select_id%/,this.opt.sContainerId+'_select').replace(/%dropdown_list%/,'<select '+(this.opt.bDisabled===true?'disabled="disabled" ':0)+(this.opt.sClassName!==undefined?'class="'+this.opt.sClassName+'" ':'')+'name="'+(this.opt.sCustomName!==undefined?this.opt.sCustomName:this.opt.sContainerId+'_select')+'" id="'+this.opt.sContainerId+'_select" '+('implementation'in document?'':'onmouseover="grabJumpToContent(this);" ')+('onbeforeactivate'in document?'onbeforeactivate':'onfocus')+'="grabJumpToContent(this);"><option value="'+(this.opt.bNoRedirect!==undefined&&this.opt.bNoRedirect===true?this.opt.iCurBoardId:'?board='+this.opt.iCurBoardId+'.0')+'">'+sChildLevelPrefix+this.opt.sCurBoardName.removeEntities()+'</option></select>&nbsp;'+(this.opt.sGoButtonLabel!==undefined?'<input type="button" class="button_submit" value="'+this.opt.sGoButtonLabel+'" onclick="window.location.href = \''+elk_prepareScriptUrl(elk_scripturl)+'board='+this.opt.iCurBoardId+'.0\';" />':''));this.dropdownList=document.getElementById(this.opt.sContainerId+'_select')};JumpTo.prototype.fillSelect=function(aBoardsAndCategories){if('onbeforeactivate'in document){this.dropdownList.onbeforeactivate=null}else this.dropdownList.onfocus=null;if(this.opt.bNoRedirect)this.dropdownList.options[0].disabled='disabled';var oListFragment=document.createDocumentFragment(),oOptgroupFragment=document.createElement('optgroup');for(var i=0,n=aBoardsAndCategories.length;i<n;i++){var j,sChildLevelPrefix='',oOption,oText;if(!aBoardsAndCategories[i].isCategory&&aBoardsAndCategories[i].id===this.opt.iCurBoardId){this.dropdownList.insertBefore(oOptgroupFragment,this.dropdownList.options[0]);continue};if(aBoardsAndCategories[i].isCategory){oOptgroupFragment=document.createElement('optgroup');oOptgroupFragment.label=aBoardsAndCategories[i].name;oListFragment.appendChild(oOptgroupFragment);continue}else{for(j=aBoardsAndCategories[i].childLevel,sChildLevelPrefix='';j>0;j--)sChildLevelPrefix+=this.opt.sBoardChildLevelIndicator;if(sChildLevelPrefix!='')sChildLevelPrefix=sChildLevelPrefix+this.opt.sBoardPrefix};oOption=document.createElement('option');oText=document.createElement('span');oText.innerHTML=(aBoardsAndCategories[i].isCategory?this.opt.sCatPrefix:sChildLevelPrefix)+aBoardsAndCategories[i].name;if(aBoardsAndCategories[i].isCategory&&this.opt.sCatClass)oOption.className=this.opt.sCatClass;oOption.appendChild(oText);if(!this.opt.bNoRedirect){oOption.value=aBoardsAndCategories[i].isCategory?'#c'+aBoardsAndCategories[i].id:'?board='+aBoardsAndCategories[i].id+'.0'}else if(aBoardsAndCategories[i].isCategory){oOption.disabled='disabled'}else oOption.value=aBoardsAndCategories[i].id;oOptgroupFragment.appendChild(oOption)};this.dropdownList.appendChild(oListFragment);if(!this.opt.bNoRedirect)this.dropdownList.onchange=function(){if(this.selectedIndex>0&&this.options[this.selectedIndex].value)window.location.href=elk_scripturl+this.options[this.selectedIndex].value.substr(elk_scripturl.indexOf('?')===-1||this.options[this.selectedIndex].value.substr(0,1)!=='?'?0:1)}};var aIconLists=[]
function IconList(oOptions){this.opt=oOptions;this.bListLoaded=false;this.oContainerDiv=null;this.funcMousedownHandler=null;this.funcParent=this;this.iCurMessageId=0;this.iCurTimeout=0;if(!('sSessionVar'in this.opt))this.opt.sSessionVar='sesc';if(!('sAction'in this.opt)||this.opt.sAction===null)this.opt.sAction='messageicons;board='+this.opt.iBoardId;this.initIcons()};IconList.prototype.initIcons=function(){for(var i=document.images.length-1,iPrefixLength=this.opt.sIconIdPrefix.length;i>=0;i--)if(document.images[i].id.substr(0,iPrefixLength)===this.opt.sIconIdPrefix)setOuterHTML(document.images[i],'<div title="'+this.opt.sLabelIconList+'" onclick="'+this.opt.sBackReference+'.openPopup(this, '+document.images[i].id.substr(iPrefixLength)+')" onmouseover="'+this.opt.sBackReference+'.onBoxHover(this, true)" onmouseout="'+this.opt.sBackReference+'.onBoxHover(this, false)" style="background: '+this.opt.sBoxBackground+'; cursor: pointer; padding: 0 2px; margin: 0 auto; vertical-align: top"><img src="'+document.images[i].src+'" alt="'+document.images[i].alt+'" id="'+document.images[i].id+'" style="vertical-align: top; margin: 0 auto; padding: '+(is_ie?'0 2px':'0 2px')+';" /></div>')};IconList.prototype.onBoxHover=function(oDiv,bMouseOver){oDiv.style.border=bMouseOver?this.opt.iBoxBorderWidthHover+'px solid '+this.opt.sBoxBorderColorHover:'';oDiv.style.background=bMouseOver?this.opt.sBoxBackgroundHover:this.opt.sBoxBackground;oDiv.style.padding=bMouseOver?(2-this.opt.iBoxBorderWidthHover)+'px':'2px'};IconList.prototype.openPopup=function(oDiv,iMessageId){this.iCurMessageId=iMessageId;if(!this.bListLoaded&&this.oContainerDiv===null){this.oContainerDiv=document.createElement('div');this.oContainerDiv.id='iconList';this.oContainerDiv.style.display='none';this.oContainerDiv.style.cursor='pointer';this.oContainerDiv.style.position='absolute';this.oContainerDiv.style.background=this.opt.sContainerBackground;this.oContainerDiv.style.border=this.opt.sContainerBorder;this.oContainerDiv.style.padding='6px 0px';document.body.appendChild(this.oContainerDiv);ajax_indicator(true);sendXMLDocument.call(this,elk_prepareScriptUrl(elk_scripturl)+'action=xmlhttp;sa='+this.opt.sAction+';xml','',this.onIconsReceived);createEventListener(document.body)};var aPos=elk_itemPos(oDiv);this.oContainerDiv.style.top=(aPos[1]+oDiv.offsetHeight)+'px';this.oContainerDiv.style.left=(aPos[0]-1)+'px';this.oClickedIcon=oDiv;if(this.bListLoaded)this.oContainerDiv.style.display='block';document.body.addEventListener('mousedown',this.onWindowMouseDown,false)};IconList.prototype.onIconsReceived=function(oXMLDoc){var icons=oXMLDoc.getElementsByTagName('elk')[0].getElementsByTagName('icon'),sItems='';for(var i=0,n=icons.length;i<n;i++)sItems+='<span onmouseover="'+this.opt.sBackReference+'.onItemHover(this, true)" onmouseout="'+this.opt.sBackReference+'.onItemHover(this, false);" onmousedown="'+this.opt.sBackReference+'.onItemMouseDown(this, \''+icons[i].getAttribute('value')+'\');" style="padding: 2px 3px; line-height: 20px; border: '+this.opt.sItemBorder+'; background: '+this.opt.sItemBackground+'"><img src="'+icons[i].getAttribute('url')+'" alt="'+icons[i].getAttribute('name')+'" title="'+icons[i].firstChild.nodeValue+'" style="vertical-align: middle" /></span>';this.oContainerDiv.innerHTML=sItems;this.oContainerDiv.style.display='block';this.bListLoaded=true;if(is_ie)this.oContainerDiv.style.width=this.oContainerDiv.clientWidth+'px';ajax_indicator(false)};IconList.prototype.onItemHover=function(oDiv,bMouseOver){oDiv.style.background=bMouseOver?this.opt.sItemBackgroundHover:this.opt.sItemBackground;oDiv.style.border=bMouseOver?this.opt.sItemBorderHover:this.opt.sItemBorder;if(this.iCurTimeout!==0)window.clearTimeout(this.iCurTimeout);if(bMouseOver){this.onBoxHover(this.oClickedIcon,true)}else this.iCurTimeout=window.setTimeout(this.opt.sBackReference+'.collapseList();',500)};IconList.prototype.onItemMouseDown=function(oDiv,sNewIcon){if(this.iCurMessageId!==0){ajax_indicator(true);this.tmpMethod=getXMLDocument;var oXMLDoc=this.tmpMethod(elk_prepareScriptUrl(elk_scripturl)+'action=jsmodify;topic='+this.opt.iTopicId+';msg='+this.iCurMessageId+';'+elk_session_var+'='+elk_session_id+';icon='+sNewIcon+';xml');delete this.tmpMethod;ajax_indicator(false);var oMessage=oXMLDoc.responseXML.getElementsByTagName('elk')[0].getElementsByTagName('message')[0];if(oMessage.getElementsByTagName('error').length===0){if((this.opt.bShowModify&&oMessage.getElementsByTagName('modified').length!==0)&&(document.getElementById('modified_'+this.iCurMessageId)!==null))document.getElementById('modified_'+this.iCurMessageId).innerHTML=oMessage.getElementsByTagName('modified')[0].childNodes[0].nodeValue;this.oClickedIcon.getElementsByTagName('img')[0].src=oDiv.getElementsByTagName('img')[0].src}}else{this.oClickedIcon.getElementsByTagName('img')[0].src=oDiv.getElementsByTagName('img')[0].src;if('sLabelIconBox'in this.opt)document.getElementById(this.opt.sLabelIconBox).value=sNewIcon}};IconList.prototype.onWindowMouseDown=function(){for(var i=aIconLists.length-1;i>=0;i--){aIconLists[i].funcParent.tmpMethod=aIconLists[i].collapseList;aIconLists[i].funcParent.tmpMethod();delete aIconLists[i].funcParent.tmpMethod}};IconList.prototype.collapseList=function(){this.onBoxHover(this.oClickedIcon,false);this.oContainerDiv.style.display='none';this.iCurMessageId=0;document.body.removeEventListener('mousedown',this.onWindowMouseDown,false)}
function elk_itemPos(itemHandle){var itemX=0,itemY=0;if('offsetParent'in itemHandle){itemX=itemHandle.offsetLeft;itemY=itemHandle.offsetTop;while(itemHandle.offsetParent&&typeof(itemHandle.offsetParent)==='object'){itemHandle=itemHandle.offsetParent;itemX+=itemHandle.offsetLeft;itemY+=itemHandle.offsetTop}}else if('x'in itemHandle){itemX=itemHandle.x;itemY=itemHandle.y};return[itemX,itemY]}
function elk_prepareScriptUrl(sUrl){return sUrl.indexOf('?')===-1?sUrl+'?':sUrl+(sUrl.charAt(sUrl.length-1)==='?'||sUrl.charAt(sUrl.length-1)==='&'||sUrl.charAt(sUrl.length-1)===';'?'':';')};var aOnloadEvents=[]
function addLoadEvent(fNewOnload){if(typeof fNewOnload==='function'&&(!('onload'in window)||typeof(window.onload)!=='function')){window.onload=fNewOnload}else if(aOnloadEvents.length===0){aOnloadEvents[0]=window.onload;aOnloadEvents[1]=fNewOnload;window.onload=function(){for(var i=0,n=aOnloadEvents.length;i<n;i++)if(typeof(aOnloadEvents[i])==='function'){aOnloadEvents[i]()}else if(typeof(aOnloadEvents[i])==='string')eval(aOnloadEvents[i])}}else aOnloadEvents[aOnloadEvents.length]=fNewOnload}
function elkSelectText(oCurElement,bActOnElement){var oCodeArea=null;if(typeof bActOnElement==='boolean'&&bActOnElement){oCodeArea=document.getElementById(oCurElement)}else oCodeArea=oCurElement.parentNode.nextSibling;if(typeof oCodeArea!=='object'||oCodeArea===null)return false;if('createTextRange'in document.body){var oCurRange=document.body.createTextRange();oCurRange.moveToElementText(oCodeArea);oCurRange.select()}else if(window.getSelection){var oCurSelection=window.getSelection();if(oCurSelection.setBaseAndExtent){var oLastChild=oCodeArea.lastChild;oCurSelection.setBaseAndExtent(oCodeArea,0,oLastChild,'innerText'in oLastChild?oLastChild.innerText.length:oLastChild.textContent.length)}else{var curRange=document.createRange();curRange.selectNodeContents(oCodeArea);oCurSelection.removeAllRanges();oCurSelection.addRange(curRange)}};return false}
function smc_saveEntities(sFormName,aElementNames,sMask){var i=0,n=0;if(typeof sMask==='string')for(i=0,n=document.forms[sFormName].elements.length;i<n;i++)if(document.forms[sFormName].elements[i].id.substr(0,sMask.length)==sMask)aElementNames[aElementNames.length]=document.forms[sFormName].elements[i].name;for(i=0,n=aElementNames.length;i<n;i++)if(aElementNames[i]in document.forms[sFormName])document.forms[sFormName][aElementNames[i]].value=document.forms[sFormName][aElementNames[i]].value.replace(/&#/g,'&#38;#')}
function applyWindowClasses(oList){var bAlternate=false;oListItems=oList.getElementsByTagName("li");for(i=0;i<oListItems.length;i++){if(oListItems[i].id==="")continue;oListItems[i].className="windowbg"+(bAlternate?"2":"");bAlternate=!bAlternate}}
function pollOptions(){var expire_time=document.getElementById('poll_expire');if(isEmptyText(expire_time)||expire_time.value===0){document.forms[form_name].poll_hide[2].disabled=true;if(document.forms[form_name].poll_hide[2].checked)document.forms[form_name].poll_hide[1].checked=true}else document.forms[form_name].poll_hide[2].disabled=false}
function generateDays(offset){offset=typeof offset!=='undefined'?offset:'';var days=0,selected=0,dayElement=document.getElementById("day"+offset),yearElement=document.getElementById("year"+offset),monthElement=document.getElementById("month"+offset),monthLength=[31,28,31,30,31,30,31,31,30,31,30,31];monthLength[1]=28;if(yearElement.options[yearElement.selectedIndex].value%4===0)monthLength[1]=29;selected=dayElement.selectedIndex;while(dayElement.options.length)dayElement.options[0]=null;days=monthLength[monthElement.value-1];for(i=1;i<=days;i++)dayElement.options[dayElement.length]=new Option(i,i);if(selected<days)dayElement.selectedIndex=selected}
function toggleLinked(form){form.board.disabled=!form.link_to_board.checked}
function initSearch(){if(document.forms.searchform.search.value.indexOf("%u")!==-1)document.forms.searchform.search.value=decodeURI(document.forms.searchform.search.value)}
function selectBoards(ids,aFormID){var toggle=true,aForm=document.getElementById(aFormID);for(i=0;i<ids.length;i++)toggle=toggle&&aForm["brd"+ids[i]].checked;for(i=0;i<ids.length;i++)aForm["brd"+ids[i]].checked=!toggle}
function expandCollapse(id,icon,speed){var oId=$('#'+id);icon=icon||false;speed=speed||300;if(icon)$('#'+icon).attr("src",elk_images_url+(oId.is(":hidden")!==true?"/selected.png":"/selected_open.png"));oId.slideToggle(speed)}
function updateRuleDef(optNum){if(document.getElementById("ruletype"+optNum).value==="gid"){document.getElementById("defdiv"+optNum).style.display="none";document.getElementById("defseldiv"+optNum).style.display=""}else if(document.getElementById("ruletype"+optNum).value==="bud"||document.getElementById("ruletype"+optNum).value===""){document.getElementById("defdiv"+optNum).style.display="none";document.getElementById("defseldiv"+optNum).style.display="none"}else{document.getElementById("defdiv"+optNum).style.display="";document.getElementById("defseldiv"+optNum).style.display="none"}}
function highlightSelected(box){if(prevClass!=="")prevDiv.className=prevClass;prevDiv=document.getElementById(box);prevClass=prevDiv.className;prevDiv.className="highlight2"}
function doAutoSubmit(){var formID=typeof formName!=='undefined'?formName:"autoSubmit";if(countdown===0){document.forms[formID].submit()}else if(countdown===-1)return;document.forms[formID].cont.value=txt_message+' ('+countdown+')';countdown--;setTimeout("doAutoSubmit();",1e3)}
function elk_codefix(){$('.bbc_code').each(function(){$(this).height("auto");if($(this).height()>200)$(this).css('height','20em')})}
function toggleButtonAJAX(btn,confirmation_msg_variable){$.ajax({type:'GET',url:btn.href+';xml;api',context:document.body,beforeSend:ajax_indicator(true)}).done(function(request){if(request==='')return;var oElement=$(request).find('elk')[0];if(oElement.getElementsByTagName('error').length===0){var text=oElement.getElementsByTagName('text'),url=oElement.getElementsByTagName('url'),confirm_elem=oElement.getElementsByTagName('confirm');if(confirm_elem.length===1)var confirm_text=confirm_elem[0].firstChild.nodeValue.removeEntities();$('.'+btn.className.replace(/(list|link)level\d/g,'').trim()).each(function(){if(text.length===1)$(this).html('<span>'+text[0].firstChild.nodeValue.removeEntities()+'</span>');if(url.length===1)$(this).attr('href',url[0].firstChild.nodeValue.removeEntities());if(typeof confirm_text!=='undefined')eval(confirmation_msg_variable+'= \''+confirm_text.replace(/[\\']/g,'\\$&')+'\'')})}else{if(oElement.getElementsByTagName('text').length!==0)alert(oElement.getElementsByTagName('text')[0].firstChild.nodeValue.removeEntities());if(oElement.getElementsByTagName('url').length!==0)window.location.href=oElement.getElementsByTagName('url')[0].firstChild.nodeValue}}).fail(function(){}).always(function(){ajax_indicator(false)});return false}
function toggleHeaderAJAX(btn,container_id){ajax_indicator(true);var text_template='<h3 class="category_header centertext">{text}</h3>';$.ajax({type:'GET',url:btn.href+';xml;api',context:document.body,beforeSend:ajax_indicator(true)}).done(function(request){var oElement=$(request).find('elk')[0];if(oElement.getElementsByTagName('error').length===0){var text=oElement.getElementsByTagName('text')[0].firstChild.nodeValue.removeEntities();$('#'+container_id+' .pagesection').remove();$('#'+container_id+' .category_header').remove();$('#'+container_id+' .topic_listing').remove();$(text_template.replace('{text}',text)).insertBefore('#topic_icons')}}).fail(function(){}).always(function(){ajax_indicator(false)})}
function notifyButton(btn){if(typeof notification_topic_notice!=='undefined'&&!confirm(notification_topic_notice))return false;return toggleButtonAJAX(btn,'notification_topic_notice')}
function notifyboardButton(btn){if(typeof notification_board_notice!=='undefined'&&!confirm(notification_board_notice))return false;toggleButtonAJAX(btn,'notification_board_notice');return false}
function unwatchButton(btn){toggleButtonAJAX(btn);return false}
function markboardreadButton(btn){toggleButtonAJAX(btn);$('.new_posts').remove();return false}
function markallreadButton(btn){toggleButtonAJAX(btn);$('.new_posts').remove();$('.board_icon').each(function(){$(this).removeClass('on_board on2_board').addClass('off_board')});$('.board_new_posts').removeClass('board_new_posts');return false}
function markunreadButton(btn){toggleHeaderAJAX(btn,'main_content_section');return false};var relative_time_refresh=0
function updateRelativeTime(){relative_time_refresh=36e5;$('time').each(function(){var oRelativeTime=new relativeTime($(this).data('timestamp')),time_text='';if(oRelativeTime.seconds()){$(this).text(oRttime.now);relative_time_refresh=Math.min(relative_time_refresh,1e4)}else if(oRelativeTime.minutes()){time_text=oRelativeTime.deltaTime>1?oRttime.minutes:oRttime.minute;$(this).text(time_text.replace('%s',oRelativeTime.deltaTime));relative_time_refresh=Math.min(relative_time_refresh,6e4)}else if(oRelativeTime.hours()){time_text=oRelativeTime.deltaTime>1?oRttime.hours:oRttime.hour;$(this).text(time_text.replace('%s',oRelativeTime.deltaTime));relative_time_refresh=Math.min(relative_time_refresh,36e5)}else if(oRelativeTime.days()){time_text=oRelativeTime.deltaTime>1?oRttime.days:oRttime.day;$(this).text(time_text.replace('%s',oRelativeTime.deltaTime));relative_time_refresh=Math.min(relative_time_refresh,36e5)}else if(oRelativeTime.weeks()){time_text=oRelativeTime.deltaTime>1?oRttime.weeks:oRttime.week;$(this).text(time_text.replace('%s',oRelativeTime.deltaTime));relative_time_refresh=Math.min(relative_time_refresh,36e5)}else if(oRelativeTime.months()){time_text=oRelativeTime.deltaTime>1?oRttime.months:oRttime.month;$(this).text(time_text.replace('%s',oRelativeTime.deltaTime));relative_time_refresh=Math.min(relative_time_refresh,36e5)}else if(oRelativeTime.years()){time_text=oRelativeTime.deltaTime>1?oRttime.years:oRttime.year;$(this).text(time_text.replace('%s',oRelativeTime.deltaTime));relative_time_refresh=Math.min(relative_time_refresh,36e5)}});setTimeout('updateRelativeTime()',relative_time_refresh)}
function relativeTime(sFrom,sTo){if(typeof sTo==='undefined'){if(typeof oRttime.currentTime==='undefined'){this.dateTo=new Date()}else this.dateTo=new Date(oRttime.currentTime*1e3)}else if(parseInt(sTo)=='NaN'){sToSplit=sTo.split(/\D/);this.dateTo=new Date(sToSplit[0],--sToSplit[1],sToSplit[2],sToSplit[3],sToSplit[4])}else this.dateTo=new Date(sTo*1e3);if(parseInt(sFrom)=='NaN'){sFromSplit=sFrom.split(/\D/);this.dateFrom=new Date(sFromSplit[0],--sFromSplit[1],sFromSplit[2],sFromSplit[3],sFromSplit[4])}else this.dateFrom=new Date(sFrom*1e3);this.time_text='';this.past_time=(this.dateTo-this.dateFrom)/1e3;this.deltaTime=0};relativeTime.prototype.seconds=function(){if(this.past_time<60){this.deltaTime=this.past_time;return true};return false};relativeTime.prototype.minutes=function(){if(this.past_time>=60&&Math.round(this.past_time/60)<60){this.deltaTime=Math.round(this.past_time/60);return true};return false};relativeTime.prototype.hours=function(){if(Math.round(this.past_time/60)>=60&&Math.round(this.past_time/3600)<24){this.deltaTime=Math.round(this.past_time/3600);return true};return false};relativeTime.prototype.days=function(){if(Math.round(this.past_time/3600)>=24&&Math.round(this.past_time/(24*3600))<7){this.deltaTime=Math.round(this.past_time/(24*3600));return true};return false};relativeTime.prototype.weeks=function(){if(Math.round(this.past_time/(24*3600))>=7&&Math.round(this.past_time/(24*3600))<30){this.deltaTime=Math.round(this.past_time/(24*3600)/7);return true};return false};relativeTime.prototype.months=function(){if(Math.round(this.past_time/(24*3600))>=30&&Math.round(this.past_time/(30*24*3600))<12){this.deltaTime=Math.round(this.past_time/(30*24*3600));return true};return false};relativeTime.prototype.years=function(){if(Math.round(this.past_time/(30*24*3600))>=12){this.deltaTime=this.dateTo.getFullYear()-this.dateFrom.getFullYear();return true};return false}
function revalidateMentions(sForm,sInput){var cached_names,cached_queries,body,mentions,pos=-1,boundaries_pattern=/[ \.,;!\?'-\\\/="]/i;for(var i=0,count=all_elk_mentions.length;i<count;i++)if(all_elk_mentions[i].selector===sInput||all_elk_mentions[i].selector==='#'+sInput){if(all_elk_mentions[i].oOptions.isPlugin){var $editor=$('#'+all_elk_mentions[i].selector).data("sceditor");cached_names=$editor.opts.mentionOptions.cache.names;cached_queries=$editor.opts.mentionOptions.cache.queries;body=$editor.getText().replace(/[\u00a0\r\n]/g,' ');mentions=$($editor.opts.mentionOptions.cache.mentions)}else{cached_names=all_elk_mentions[i].oMention.cached_names;cached_queries=all_elk_mentions[i].oMention.cached_queries;body=document.forms[sForm][sInput].value.replace(/[\u00a0\r\n]/g,' ');mentions=$(all_elk_mentions[i].oMention.mentions)};body=' '+body+' ';$(mentions).find('input').each(function(idx,elem){var name=$(elem).data('name'),next_char,prev_char,index=body.indexOf(name);if(typeof name!=='undefined')if(index===-1){$(elem).remove()}else{next_char=body.charAt(index+name.length);prev_char=body.charAt(index-1);if(next_char!==''&&next_char.search(boundaries_pattern)!==0){$(elem).remove()}else if(prev_char!==''&&prev_char.search(boundaries_pattern)!==0)$(elem).remove()}});for(var k=0,ccount=cached_queries.length;k<ccount;k++){names=cached_names[cached_queries[k]];for(var l=0,ncount=names.length;l<ncount;l++){pos=body.indexOf(' @'+names[l].name);if(pos!==-1&&body.charAt(pos+2+names[l].name.length+1).search(boundaries_pattern)===0)mentions.append($('<input type="hidden" name="uid[]" />').val(names[l].id))}}}};var all_elk_mentions=[]
function add_elk_mention(selector,oOptions){if(all_elk_mentions.hasOwnProperty(selector))return;if(typeof oOptions==='undefined')oOptions={};oOptions.selector=selector;all_elk_mentions[all_elk_mentions.length]={selector:selector,oOptions:oOptions}};(function($){'use strict';$.fn.elkSortable=function(oInstanceSettings){$.fn.elkSortable.oDefaultsSettings={opacity:0.7,cursor:'move',axis:'y',scroll:true,containment:'parent',delay:150,href:'',tolerance:'intersect',setorder:'serialize',placeholder:'',preprocess:'',tag:'#table_grid_sortable',connect:'',sa:'',title:'',error:'',token:''};var oSettings=$.extend({},$.fn.elkSortable.oDefaultsSettings,oInstanceSettings||{}),ajax_infobar=document.createElement('div'),ajax_errorbox=document.createElement('div');$(ajax_infobar).css({position:'fixed',top:'0',left:'0',width:'100%'});$("body").append(ajax_infobar);$(ajax_infobar).slideUp();$(ajax_errorbox).css({display:'none'});$("body").append(ajax_errorbox).attr('id','errorContainer');$(oSettings.tag).sortable({opacity:oSettings.opacity,cursor:oSettings.cursor,axis:oSettings.axis,containment:oSettings.containment,connectWith:oSettings.connect,placeholder:oSettings.placeholder,tolerance:oSettings.tolerance,delay:oSettings.delay,scroll:oSettings.scroll,helper:function(e,ui){var $originals=ui.children(),$helper=ui.clone(),$clone;$helper.children().each(function(){$(this).replaceWith(function(){return $("<span />",{html:$(this).html()})})});$helper.children().each(function(index){return $(this).width($originals.eq(index).width()).css('display','inline-block')});$('body').append('<div id="clone" class="'+oSettings.placeholder+'">'+$helper.html()+'</div>');$clone=$('#clone');$clone.hide();setTimeout(function(){$clone.appendTo(ui.parent());$clone.show()},1);return $clone},update:function(e,ui){var postdata='',moved=ui.item.attr('id'),order=[],receiver=ui.item.parent().attr('id');if(oSettings.preprocess!=='')window[oSettings.preprocess]();if(oSettings.setorder==='inorder'){$(oSettings.tag).find('li').each(function(){var aid=$(this).attr('id').split('_');order.push({name:aid[0]+'[]',value:aid[1]})});postdata=$.param(order)}else $(oSettings.tag).each(function(){if(postdata===""){postdata+=$(this).sortable(oSettings.setorder)}else postdata+="&"+$(this).sortable(oSettings.setorder)});postdata+='&'+elk_session_var+'='+elk_session_id;postdata+='&order=reorder';postdata+='&moved='+moved;postdata+='&received='+receiver;if(oSettings.token!=='')postdata+='&'+oSettings.token['token_var']+'='+oSettings.token['token_id'];$.ajax({type:"POST",url:elk_scripturl+"?action=xmlhttp;sa="+oSettings.sa+";xml",dataType:"xml",data:postdata}).fail(function(jqXHR,textStatus,errorThrown){$(ajax_infobar).attr('class','errorbox');$(ajax_infobar).html(textStatus).slideDown('fast');setTimeout(function(){$(ajax_infobar).slideUp()},3500);if(oSettings.href!=='')setTimeout(function(){window.location.href=elk_scripturl+oSettings.href},1e3)}).done(function(data,textStatus,jqXHR){if($(data).find("error").length!==0){$('#errorContainer').append('<p id="errorContent"></p>');$('#errorContent').html($(data).find("error").text());$('#errorContent').dialog({autoOpen:true,title:oSettings.title,modal:true,close:function(event,ui){if(oSettings.href!=='')window.location.href=elk_scripturl+oSettings.href}})}else if($(data).find("elk").length!==0){$(ajax_infobar).attr('class','infobox');$(ajax_infobar).html($(data).find('elk > orders > order').text()).slideDown('fast');setTimeout(function(){$(ajax_infobar).slideUp()},3500)}else{$('#errorContainer').append('<p id="errorContent"></p>');$('#errorContent').html(oSettings.error+' : '+textStatus);$('#errorContent').dialog({autoOpen:true,title:oSettings.title,modal:true})}}).always(function(data,textStatus,jqXHR){if(textStatus==='success'&&$(data).find("elk > tokens > token").length!==0){oSettings.token['token_id']=$(data).find("tokens").find('[type="token"]').text();oSettings.token['token_var']=$(data).find("tokens").find('[type="token_var"]').text()}})}})}})(jQuery)
function setBoardIds(){$("[id^=category_]").each(function(){var cat=$(this).attr('id').split('category_'),uls=$(this).find("ul");if(uls.length===1){if($(uls).find("li").length===0){$(uls).append('<li id="cbp_'+cat+',-1,-1"></li>')}else $(uls).find("li:not(:has(ul))").append('<ul class="nolist"></ul>')}else $(uls).find("li:not(:has(ul))").append('<ul class="nolist"></ul>');$(this).find('ul:parent').each(function(i,ul){var parentList=$(this).parent('li').attr('id'),pli=0;if(typeof parentList!=="undefined"){pli=parentList.split(",");pli=pli[1]};$(this).find('li').each(function(i,el){var currentList=$(el).attr('id'),myid=currentList.split(",");$(el).removeAttr("id");myid="cbp_"+cat[1]+","+myid[1]+","+pli;$(el).attr('id',myid)})})})};(function($){$.fn.expand_pages=function(){var $container,lastPositions=new Array()
function hover_expand($element){var $expanded_pages_li=$element,baseurl=eval($element.data('baseurl')),perpage=$element.data('perpage'),firstpage=$element.data('firstpage'),lastpage=$element.data('lastpage'),$exp_pages=$('<li id="expanded_pages" />'),pages=0,container_width=$element.outerWidth()*2,width_elements=3,$scroll_left=null,$scroll_right=null,aModel=$element.closest('.linavPages').prev().find('a').clone();if(typeof(lastPositions[firstpage])==='undefined')lastPositions[firstpage]=0;$container=$('<ul id="expanded_pages_container">');for(var i=firstpage;i<lastpage;i+=perpage){pages++;var bElem=aModel.clone();bElem.attr('href',baseurl.replace('%1$d',i)).text(i/perpage+1);$exp_pages.append(bElem)};if(pages>width_elements)$container.append($('<li />').append(aModel.clone().attr('id','pages_scroll_left').attr('href','#').text('<').click(function(ev){ev.stopPropagation();ev.preventDefault()}).hover(function(){$exp_pages.animate({'margin-left':0},200*pages)},function(){$exp_pages.stop();lastPositions[firstpage]=$exp_pages.css('margin-left')})));$container.append($exp_pages);$element.parent().superfish({delay:300,speed:175,speedOut:50,onHide:function(){$container.remove()}});$element.append($container);if(pages>width_elements)$container.append($('<li />').append(aModel.clone().attr('id','pages_scroll_right').attr('href','#').text('>').click(function(ev){ev.stopPropagation();ev.preventDefault()}).hover(function(){var $pages=$exp_pages.find('a'),move=0;for(var i=0,count=$exp_pages.find('a').length;i<count;i++)move+=$($pages[i]).outerWidth();move=(move+$container.find('#pages_scroll_left').outerWidth())-($container.outerWidth()-$container.find('#pages_scroll_right').outerWidth());$exp_pages.animate({'margin-left':-move},200*pages)},function(){$exp_pages.stop();lastPositions[firstpage]=$exp_pages.css('margin-left')})));$exp_pages.find('a').each(function(){if(width_elements>-1)container_width+=$element.outerWidth();if(width_elements<=0||pages>=width_elements)$container.css({'margin-left':-container_width/2}).width(container_width);if(width_elements<0)return false;width_elements--}).click(function(ev){$expanded_pages_li.attr('onclick','').off('click')});$exp_pages.css({height:$element.outerHeight(),'padding-left':$container.find('#pages_scroll_left').outerWidth(),'margin-left':lastPositions[firstpage]})}
function expand_pages($element){var $baseAppend=$($element.closest('.linavPages')),boxModel=$baseAppend.prev().clone(),aModel=boxModel.find('a').clone(),expandModel=$element.clone(),perPage=$element.data('perpage'),firstPage=$element.data('firstpage'),lastPage=$element.data('lastpage'),rawBaseurl=$element.data('baseurl'),baseurl=eval($element.data('baseurl')),first,i=0,oldLastPage=0,perPageLimit=10;if((lastPage-firstPage)/perPage>perPageLimit){oldLastPage=lastPage;lastPage=firstPage+perPageLimit*perPage};for(i=lastPage;i>firstPage;i-=perPage){var bElem=aModel.clone(),boxModelClone=boxModel.clone();bElem.attr('href',baseurl.replace('%1$d',i-perPage)).text(i/perPage);boxModelClone.find('a').each(function(){$(this).replaceWith(bElem[0])});$baseAppend.after(boxModelClone);if(typeof first==='undefined')first=boxModelClone};$baseAppend.remove();if(oldLastPage>0){expandModel.find('#expanded_pages_container').each(function(){$(this).remove()});expandModel.click(function(e){var $zhis=$(this);e.preventDefault();expand_pages($zhis);$zhis.off('mouseenter focus')}).on('mouseenter focus',function(){hover_expand($(this))}).data('perpage',perPage).data('firstpage',lastPage).data('lastpage',oldLastPage).data('baseurl',rawBaseurl);first.after(expandModel)}};this.attr('tabindex',0).click(function(e){var $zhis=$(this);e.preventDefault();expand_pages($zhis);$zhis.off('mouseenter focus')}).on('mouseenter focus',function(){hover_expand($(this))})}})(jQuery);(function($){'use strict';$.fn.SiteTooltip=function(oInstanceSettings){$.fn.SiteTooltip.oDefaultsSettings={followMouse:1,hoverIntent:{sensitivity:10,interval:750,timeout:50},positionTop:12,positionLeft:12,tooltipID:'site_tooltip',tooltipTextID:'site_tooltipText',tooltipClass:'tooltip',tooltipSwapClass:'site_swaptip',tooltipContent:'html'};var oSettings=$.extend({},$.fn.SiteTooltip.oDefaultsSettings,oInstanceSettings||{});$(this).each(function(){var sTitle=$('<span class="'+oSettings.tooltipSwapClass+'">'+htmlspecialchars(this.title)+'</span>').hide();$(this).append(sTitle).attr('title','')});var positionTooltip=function(event){var iPosx=0,iPosy=0;if(!event)event=window.event;if(event.pageX||event.pageY){iPosx=event.pageX;iPosy=event.pageY}else if(event.clientX||event.clientY){iPosx=event.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;iPosy=event.clientY+document.body.scrollTop+document.documentElement.scrollTop};var oPosition={x:iPosx+oSettings.positionLeft,y:iPosy+oSettings.positionTop,w:$('#'+oSettings.tooltipID).width(),h:$('#'+oSettings.tooltipID).height()},oLimits={x:$(window).scrollLeft(),y:$(window).scrollTop(),w:$(window).width()-24,h:$(window).height()-24};if((oPosition.y+oPosition.h>oLimits.y+oLimits.h)&&(oPosition.x+oPosition.w>oLimits.x+oLimits.w)){oPosition.x=(oPosition.x-oPosition.w)-45;oPosition.y=(oPosition.y-oPosition.h)-45}else if((oPosition.x+oPosition.w)>(oLimits.x+oLimits.w)){oPosition.x=oPosition.x-(((oPosition.x+oPosition.w)-(oLimits.x+oLimits.w))+24)}else if(oPosition.y+oPosition.h>oLimits.y+oLimits.h)oPosition.y=oPosition.y-(((oPosition.y+oPosition.h)-(oLimits.y+oLimits.h))+24);$('#'+oSettings.tooltipID).css({left:oPosition.x+'px',top:oPosition.y+'px'})},showTooltip=function(){$('#'+oSettings.tooltipID+' #'+oSettings.tooltipTextID).show()},hideTooltip=function(){$('#'+oSettings.tooltipID).fadeOut('slow').trigger("unload").remove()}
function htmlspecialchars(string){return $('<span>').text(string).html()};return this.each(function(){if($.fn.hoverIntent){$(this).hoverIntent({sensitivity:oSettings.hoverIntent.sensitivity,interval:oSettings.hoverIntent.interval,over:site_tooltip_on,timeout:oSettings.hoverIntent.timeout,out:site_tooltip_off})}else $(this).hover(site_tooltip_on,site_tooltip_off)
function site_tooltip_on(event){if($(this).children('.'+oSettings.tooltipSwapClass).text()){$('body').append('<div id="'+oSettings.tooltipID+'" class="'+oSettings.tooltipClass+'"><div id="'+oSettings.tooltipTextID+'" style="display:none;"></div></div>');var tt=$('#'+oSettings.tooltipID),ttContent=$('#'+oSettings.tooltipID+' #'+oSettings.tooltipTextID);if(oSettings.tooltipContent==='html'){ttContent.html($(this).children('.'+oSettings.tooltipSwapClass).html())}else ttContent.text($(this).children('.'+oSettings.tooltipSwapClass).text());tt.show();showTooltip();positionTooltip(event)};return false}
function site_tooltip_off(event){hideTooltip(this);return false};if(oSettings.followMouse)$(this).on("mousemove",function(event){positionTooltip(event);return false});$(this).on("click",function(){hideTooltip(this);return true})})}})(jQuery);var error_txts={}
function errorbox_handler(oOptions){this.opt=oOptions;this.oError_box=null;this.oErrorHandle=window;this.evaluate=false;this.init()};errorbox_handler.prototype.init=function(){if(this.opt.check_id!==undefined){this.oChecks_on=$(document.getElementById(this.opt.check_id))}else if(this.opt.selector!==undefined){this.oChecks_on=this.opt.selector}else if(this.opt.editor!==undefined){this.oChecks_on=eval(this.opt.editor);this.evaluate=true};this.oErrorHandle.instanceRef=this;if(this.oError_box===null)this.oError_box=$(document.getElementById(this.opt.error_box_id));if(this.evaluate===false){this.oChecks_on.attr('onblur',this.opt.self+'.checkErrors()');this.oChecks_on.attr('onkeyup',this.opt.self+'.checkErrors()')}else{var current_error_handler=this.opt.self;$(document).ready(function(){var current_error=eval(current_error_handler);$('#'+current_error.opt.editor_id).data("sceditor").addEvent(current_error.opt.editor_id,'keyup',function(){current_error.checkErrors()})})}};errorbox_handler.prototype.boxVal=function(){if(this.evaluate===false){return this.oChecks_on.val()}else return this.oChecks_on()};errorbox_handler.prototype.checkErrors=function(){var num=this.opt.error_checks.length;if(num!==0){for(var i=0;i<num;i++){var $elem=$(document.getElementById(this.opt.error_box_id+"_"+this.opt.error_checks[i].code));if(this.opt.error_checks[i].efunction(this.boxVal())){this.addError($elem,this.opt.error_checks[i].code)}else this.removeError(this.oError_box,$elem)};this.oError_box.attr("class","noticebox")};if(this.oError_box.find("li").length===0){this.oError_box.slideUp()}else this.oError_box.slideDown()};errorbox_handler.prototype.addError=function(error_elem,error_code){if(error_elem.length===0){if($.trim(this.oError_box.children("#"+this.opt.error_box_id+"_list").html())==='')this.oError_box.append("<ul id='"+this.opt.error_box_id+"_list'></ul>");$(document.getElementById(this.opt.error_box_id+"_list")).append("<li style=\"display:none\" id='"+this.opt.error_box_id+"_"+error_code+"' class='error'>"+error_txts[error_code]+"</li>");$(document.getElementById(this.opt.error_box_id+"_"+error_code)).slideDown()}};errorbox_handler.prototype.removeError=function(error_box,error_elem){if(error_elem.length!==0)error_elem.slideUp(function(){error_elem.remove();if(error_box.find("li").length===0)error_box.slideUp()})}
function addAnotherOption(parent,oDtName,oDdName,oData){oDtName.type=oDtName.type||'text';oDtName['class']=oDtName['class']||'input_text';oDtName.size=oDtName.size||'20';oDdName.type=oDdName.type||'text';oDdName['class']=oDdName['class']||'input_text';oDdName.size=oDdName.size||'20';oData=oData||'';var newDT=document.createElement('dt'),newInput=document.createElement('input');newInput.name=oDtName.name;newInput.type=oDtName.type;newInput.setAttribute('class',oDtName['class']);newInput.size=oDtName.size;newDT.appendChild(newInput);var newDD=document.createElement('dd');if(oData===''){newInput=document.createElement('input')}else newInput=document.createElement('select');newInput.name=oDdName.name;newInput.type=oDdName.type;newInput.size=oDdName.size;newInput.setAttribute('class',oDdName['class']);newDD.appendChild(newInput);if(oData!==''){var opt=null,key=null,obj={};for(key in oData){obj=oData[key];opt=document.createElement("option");opt.name="option";opt.value=obj.id;opt.innerHTML=obj.name;newInput.appendChild(opt)}};var placeHolder=document.getElementById(parent);placeHolder.parentNode.insertBefore(newDT,placeHolder);placeHolder.parentNode.insertBefore(newDD,placeHolder)};$(document).ready(function(){if(use_click_menu){$('#main_menu, ul.admin_menu, ul.sidebar_menu, ul.poster, ul.quickbuttons, #sort_by').superclick({speed:150,animation:{opacity:'show',height:'toggle'}})}else $('#main_menu, ul.admin_menu, ul.sidebar_menu, ul.poster, ul.quickbuttons, #sort_by').superfish({delay:300,speed:175});$("a[href=#top]").on("click",function(e){e.preventDefault();$("html,body").animate({scrollTop:0},1200)});$("a[href=#bot]").on("click",function(e){e.preventDefault();var link=$('#bot'),link_y=link.height();$("html,body").animate({scrollTop:link.offset().top+link_y-$(window).height()},1200)});$('.preview').SiteTooltip({hoverIntent:{sensitivity:10,interval:750,timeout:50}});$('a.bbc_link img.bbc_img').parent().css('border','0');if(typeof elk_codefix==='function')elk_codefix();$('.expand_pages').expand_pages();$('legend').click(function(){$(this).siblings().slideToggle("fast");$(this).parent().toggleClass("collapsed")}).each(function(){if($(this).data('collapsed')){$(this).siblings().css({display:"none"});$(this).parent().toggleClass("collapsed")}});$('.spoilerheader').click(function(){$(this).next().children().slideToggle("fast")});$('img').each(function(){if($(this).hasClass('bbc_img resized')===false)return true;$(this).css({cursor:'pointer'});$(this).click(function(){var $this=$(this);if($.isEmptyObject($this.data())){$this.data("bbc_img",{width:$this.css('width'),height:$this.css('height')});$this.css({width:$this.css('width')==='auto'?null:'auto'});$this.css({height:$this.css('width')==='auto'?null:'auto'})}else{$this.css({width:$this.data("bbc_img").width});$this.css({height:$this.data("bbc_img").height});$this.removeData()}})})})
function elk_addButton(sButtonStripId,bUseImage,oOptions){var oButtonStrip=document.getElementById(sButtonStripId),aItems=oButtonStrip.getElementsByTagName('span');if(aItems.length>0){var oLastSpan=aItems[aItems.length-1];oLastSpan.className=oLastSpan.className.replace(/\s*last/,'position_holder')};var oButtonStripList=oButtonStrip.getElementsByTagName('ul')[0],oNewButton=document.createElement('li'),oRole=document.createAttribute('role');oRole.value='menuitem';oNewButton.setAttributeNode(oRole);if('sId'in oOptions)oNewButton.id=oOptions.sId;oNewButton.innerHTML='<a class="linklevel1" href="'+oOptions.sUrl+'" '+('sCustom'in oOptions?oOptions.sCustom:'')+'><span class="last"'+('sId'in oOptions?' id="'+oOptions.sId+'_text"':'')+'>'+oOptions.sText+'</span></a>';oButtonStripList.appendChild(oNewButton)}
function loadAddNewPoll(button,id_board,form_name){if(typeof id_board=='undefined')return true;var $form=$('#post_header').closest("form");if($(button).val()==poll_add){$(button).val(poll_remove);if($('#icon').val()=='xx')$('#icon').val('poll').change();$form.attr('action',$form.attr('action')+';poll');if($('#poll_main').length>0){$('#poll_main, #poll_options').find('input').each(function(){if($(this).data('required')=='required')$(this).attr('required','required')});$('#poll_main, #poll_options').toggle();return false}}else{if($('#icon').val()=='poll')$('#icon').val('xx').change();$form.attr('action',$form.attr('action').replace(';poll',''));$('#poll_main, #poll_options').hide().find('input').each(function(){if($(this).attr('required')=='required'){$(this).data('required','required');$(this).removeAttr('required')}});$(button).val(poll_add);return false};$.ajax({url:elk_scripturl+'?action=poll;sa=interface;xml;board='+id_board,type:"GET",dataType:"html",beforeSend:ajax_indicator(true)}).done(function(data,textStatus,xhr){var max_tabIndex=0;for(var i=0,n=document.forms[form_name].elements.length;i<n;i++)max_tabIndex=Math.max(max_tabIndex,document.forms[form_name].elements[i].tabIndex);$('#post_header').after(data);$('#poll_main input, #poll_options input').each(function(){$(this).attr('tabindex',++max_tabIndex)});$('#poll_main legend, #poll_options legend').click(function(){$(this).siblings().slideToggle("fast");$(this).parent().toggleClass("collapsed")}).each(function(){if($(this).data('collapsed')){$(this).siblings().css({display:"none"});$(this).parent().toggleClass("collapsed")}})}).always(function(){ajax_indicator(false)});return false};!function(a,b,c){"use strict";var d={html:'<!DOCTYPE html><html><head><style>.ie * {min-height: auto !important}</style><meta http-equiv="Content-Type" content="text/html;charset={charset}" /><link rel="stylesheet" type="text/css" href="{style}" /></head><body contenteditable="true" {spellcheck}></body></html>',toolbarButton:'<a class="sceditor-button sceditor-button-{name}" data-sceditor-command="{name}" unselectable="on"><div unselectable="on">{dispName}</div></a>',emoticon:'<img src="{url}" data-sceditor-emoticon="{key}" alt="{key}" title="{tooltip}" />',fontOpt:'<a class="sceditor-font-option" href="#" data-font="{font}"><font face="{font}">{font}</font></a>',sizeOpt:'<a class="sceditor-fontsize-option" data-size="{size}" href="#"><font size="{size}">{size}</font></a>',pastetext:'<div><label for="txt">{label}</label> <textarea cols="20" rows="7" id="txt"></textarea></div><div><input type="button" class="button" value="{insert}" /></div>',table:'<div><label for="rows">{rows}</label><input type="text" id="rows" value="2" /></div><div><label for="cols">{cols}</label><input type="text" id="cols" value="2" /></div><div><input type="button" class="button" value="{insert}" /></div>',image:'<div><label for="link">{url}</label> <input type="text" id="image" value="http://" /></div><div><label for="width">{width}</label> <input type="text" id="width" size="2" /></div><div><label for="height">{height}</label> <input type="text" id="height" size="2" /></div><div><input type="button" class="button" value="{insert}" /></div>',email:'<div><label for="email">{label}</label> <input type="text" id="email" /></div><div><input type="button" class="button" value="{insert}" /></div>',link:'<div><label for="link">{url}</label> <input type="text" id="link" value="http://" /></div><div><label for="des">{desc}</label> <input type="text" id="des" /></div><div><input type="button" class="button" value="{ins}" /></div>',youtubeMenu:'<div><label for="link">{label}</label> <input type="text" id="link" value="http://" /></div><div><input type="button" class="button" value="{insert}" /></div>',youtube:'<iframe width="560" height="315" src="http://www.youtube.com/embed/{id}?wmode=opaque" data-youtube-id="{id}" frameborder="0" allowfullscreen></iframe>'},e=function(b,c,e){var f=d[b];return a.each(c,function(a,b){f=f.replace(new RegExp("\\{"+a+"\\}","g"),b)}),e&&(f=a(f)),f};a.sceditor=function(d,f){var j,k,l,m,n,o,p,q,r,t,u,w,z,A,B,C,D,E,F,G,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,g=this,h=d.get?d.get(0):d,i=a(h),s=[],v=[],x=[],y=[],H={},I=[];g.commands=a.extend(!0,{},f.commands||a.sceditor.commands),g.opts=f=a.extend({},a.sceditor.defaultOptions,f),J=function(){i.data("sceditor",g),a.each(f,function(b,c){a.isPlainObject(c)&&(f[b]=a.extend(!0,{},c))}),f.locale&&"en"!==f.locale&&P(),j=a('<div class="sceditor-container" />').insertAfter(i).css("z-index",f.zIndex),a.sceditor.ie&&j.addClass("ie ie"+a.sceditor.ie),F=!!i.attr("required"),i.removeAttr("required"),O(),V(),Q(),N(),T(),R(),S(),a.sceditor.isWysiwygSupported||g.toggleSourceMode(),gb();var d=function(){a(b).unbind("load",d),f.autofocus&&lb(),f.autoExpand&&g.expandToContent(),eb(),A.call("ready")};a(b).load(d),c.readyState&&"complete"===c.readyState&&d()},O=function(){var b=f.plugins;b=b?b.toString().split(","):[],A=new a.sceditor.PluginManager(g),a.each(b,function(b,c){A.register(a.trim(c))})},P=function(){var b;u=a.sceditor.locale[f.locale],u||(b=f.locale.split("-"),u=a.sceditor.locale[b[0]]),u&&u.dateFormat&&(f.dateFormat=u.dateFormat)},N=function(){var c,d;p=a("<textarea></textarea>").hide(),l=a('<iframe frameborder="0"></iframe>'),f.spellcheck||p.attr("spellcheck","false"),"https:"===b.location.protocol&&l.attr("src","javascript:false"),j.append(l).append(p),m=l[0],q=p[0],g.dimensions(f.width||i.width(),f.height||i.height()),c=W(),c.open(),c.write(e("html",{spellcheck:f.spellcheck?"":'spellcheck="false"',charset:f.charset,style:f.style})),c.close(),o=a(c),n=a(c.body),g.readOnly(!!f.readOnly),a.sceditor.ie&&o.find("html").addClass("ie ie"+a.sceditor.ie),(a.sceditor.ios||a.sceditor.ie)&&(n.height("100%"),a.sceditor.ie||n.bind("touchend",g.focus)),w=new a.sceditor.rangeHelper(m.contentWindow),g.val(i.hide().val()),d=i.attr("tabindex"),p.attr("tabindex",d),l.attr("tabindex",d)},R=function(){f.autoUpdate&&(n.bind("blur",g.updateOriginal),p.bind("blur",g.updateOriginal)),null===f.rtl&&(f.rtl="rtl"===p.css("direction")),g.rtl(!!f.rtl),f.autoExpand&&o.bind("keyup",g.expandToContent),f.resizeEnabled&&U(),j.attr("id",f.id),g.emoticons(f.emoticonsEnabled)},S=function(){a(c).click(db),a(h.form).bind("reset",ab).submit(g.updateOriginal),a(b).bind("resize orientationChanged",eb),n.keypress(_).keydown(Z).keydown($).keyup(ib).bind("blur",qb).keyup(rb).bind("paste",X).bind(a.sceditor.ie?"selectionchange":"keyup focus blur contextmenu mouseup touchend click",jb).bind("keydown keyup keypress focus blur contextmenu",cb),f.emoticonsCompat&&b.getSelection&&n.keyup(nb),p.bind("blur",qb).keyup(rb).bind("keydown keyup keypress focus blur contextmenu",cb).keydown(Z),o.mousedown(bb).bind("blur",qb).bind(a.sceditor.ie?"selectionchange":"focus blur contextmenu mouseup click",jb).bind("beforedeactivate keyup",M).keyup(ib).focus(function(){t=null}),j.bind("selectionchanged",kb).bind("selectionchanged",gb).bind("selectionchanged valuechanged",cb).bind("nodechanged",cb)},Q=function(){var b,c,d,h=g.commands,i=(f.toolbarExclude||"").split(","),l=f.toolbar.split("|");k=a('<div class="sceditor-toolbar" unselectable="on" />'),a.each(l,function(f,j){b=a('<div class="sceditor-group" />'),a.each(j.split(","),function(f,j){!h[j]||a.inArray(j,i)>-1||(d=h[j].shortcut?" ("+h[j].shortcut+")":"",c=e("toolbarButton",{name:j,dispName:g._(h[j].tooltip||j)+d},!0),c.data("sceditor-txtmode",!!h[j].txtExec),c.data("sceditor-wysiwygmode",!!h[j].exec),c.click(function(){var b=a(this);return b.hasClass("disabled")||L(b,h[j]),gb(),!1}),h[j].tooltip&&c.attr("title",g._(h[j].tooltip)),h[j].exec||c.addClass("disabled"),h[j].shortcut&&(g.addShortcut(h[j].shortcut,j),c.attr("title",c.attr("title")+d)),b.append(c))}),b[0].firstChild&&k.append(b)}),a(f.toolbarContainer||j).append(k)},T=function(){a.each(g.commands,function(b,c){c.keyPress&&s.push(c.keyPress),c.forceNewLineAfter&&a.isArray(c.forceNewLineAfter)&&(x=a.merge(x,c.forceNewLineAfter)),c.state?y.push({name:b,state:c.state}):"string"==typeof c.exec&&y.push({name:b,state:c.exec})}),ib()},U=function(){var d,e,h,i,k,l,m=a('<div class="sceditor-grip" />'),n=a('<div class="sceditor-resize-cover" />'),o=0,p=0,q=0,r=0,s=j.width(),t=j.height(),u=!1,v=g.rtl();d=f.resizeMinHeight||t/1.5,e=f.resizeMaxHeight||2.5*t,h=f.resizeMinWidth||s/1.25,i=f.resizeMaxWidth||1.25*s,k=function(c){"touchmove"===c.type&&(c=b.event);var k=r+(c.pageY-p),l=v?q-(c.pageX-o):q+(c.pageX-o);i>0&&l>i&&(l=i),e>0&&k>e&&(k=e),(!f.resizeWidth||h>l||i>0&&l>i)&&(l=!1),(!f.resizeHeight||d>k||e>0&&k>e)&&(k=!1),(l||k)&&(g.dimensions(l,k),a.sceditor.ie<7&&j.height(k)),c.preventDefault()},l=function(b){u&&(u=!1,n.hide(),j.removeClass("resizing").height("auto"),a(c).unbind("touchmove mousemove",k),a(c).unbind("touchend mouseup",l),b.preventDefault())},j.append(m),j.append(n.hide()),m.bind("touchstart mousedown",function(d){"touchstart"===d.type&&(d=b.event),o=d.pageX,p=d.pageY,q=j.width(),r=j.height(),u=!0,j.addClass("resizing"),n.show(),a(c).bind("touchmove mousemove",k),a(c).bind("touchend mouseup",l),a.sceditor.ie<7&&j.height(r),d.preventDefault()})},V=function(){var b,d=f.emoticons,e=f.emoticonsRoot;a.isPlainObject(d)&&f.emoticonsEnabled&&a.each(d,function(f,g){a.each(g,function(a,g){e&&(g={url:e+(g.url||g),tooltip:g.tooltip||a},d[f][a]=g),b=c.createElement("img"),b.src=g.url||g,v.push(b)})})},lb=function(){var b,c,d,e=o[0],h=n[0],i=!!f.autofocusEnd;if(j.is(":visible")){if(g.sourceMode()){d=q.value.length,q.setSelectionRange?q.setSelectionRange(d,d):q.createTextRange&&(b=q.createTextRange(),b.moveEnd("character",d),b.moveStart("character",d),w.selectRange(b))}else{if(a.sceditor.dom.removeWhiteSpace(h),i){for((c=h.lastChild)||n.append(c=e.createElement("div"));c.lastChild;)c=c.lastChild,/br/i.test(c.nodeName)&&c.previousSibling&&(c=c.previousSibling)}else c=h.firstChild;e.createRange?(b=e.createRange(),/br/i.test(c.nodeName)?b.setStartBefore(c):b.selectNodeContents(c),b.collapse(!1)):(b=h.createTextRange(),b.moveToElementText(3!==c.nodeType?c:c.parentNode),b.collapse(!1)),w.selectRange(b),i&&(o.scrollTop(h.scrollHeight),n.scrollTop(h.scrollHeight))};g.focus()}},g.readOnly=function(a){return"boolean"!=typeof a?"readonly"===p.attr("readonly"):(n[0].contentEditable=!a,a?p.attr("readonly","readonly"):p.removeAttr("readonly"),fb(a),this)},g.rtl=function(a){var b=a?"rtl":"ltr";return"boolean"!=typeof a?"rtl"===p.attr("dir"):(n.attr("dir",b),p.attr("dir",b),j.removeClass("rtl").removeClass("ltr").addClass(b),this)},fb=function(b){var c=g.inSourceMode();k.find(".sceditor-button").removeClass("disabled").each(function(){var d=a(this);b===!0||c&&!d.data("sceditor-txtmode")?d.addClass("disabled"):c||d.data("sceditor-wysiwygmode")||d.addClass("disabled")})},g.width=function(a,b){return a||0===a?(g.dimensions(a,null,b),this):j.width()},g.dimensions=function(b,d,e){var h=a.sceditor.ie<8||c.documentMode<8?2:0;return b=b||0===b?b:!1,d=d||0===d?d:!1,b===!1&&d===!1?{width:g.width(),height:g.height()}:("undefined"==typeof l.data("outerWidthOffset")&&g.updateStyleCache(),b!==!1&&(e!==!1&&(f.width=b),d===!1&&(d=j.height(),e=!1),j.width(b),b&&b.toString().indexOf("%")>-1&&(b=j.width()),l.width(b-l.data("outerWidthOffset")),p.width(b-p.data("outerWidthOffset")),a.sceditor.ios&&n&&n.width(b-l.data("outerWidthOffset")-(n.outerWidth(!0)-n.width()))),d!==!1&&(e!==!1&&(f.height=d),d&&d.toString().indexOf("%")>-1&&(d=j.height(d).height(),j.height("auto")),d-=f.toolbarContainer?0:k.outerHeight(!0),l.height(d-l.data("outerHeightOffset")),p.height(d-h-p.data("outerHeightOffset"))),this)},g.updateStyleCache=function(){l.data("outerWidthOffset",l.outerWidth(!0)-l.width()),p.data("outerWidthOffset",p.outerWidth(!0)-p.width()),l.data("outerHeightOffset",l.outerHeight(!0)-l.height()),p.data("outerHeightOffset",p.outerHeight(!0)-p.height())},g.height=function(a,b){return a||0===a?(g.dimensions(null,a,b),this):j.height()},g.maximize=function(b){return"undefined"==typeof b?j.is(".sceditor-maximize"):(b=!!b,a.sceditor.ie<7&&a("html, body").toggleClass("sceditor-maximize",b),j.toggleClass("sceditor-maximize",b),g.width(b?"100%":f.width,!1),g.height(b?"100%":f.height,!1),this)},g.expandToContent=function(a){var b=j.height(),c=n[0].scrollHeight||o[0].documentElement.scrollHeight,d=b-l.height(),e=f.resizeMaxHeight||2*(f.height||i.height());c+=d,a!==!0&&c>e&&(c=e),c>b&&g.height(c)},g.destroy=function(){A&&(A.destroy(),w=null,t=null,A=null,a(c).unbind("click",db),a(b).unbind("resize orientationChanged",eb),a(h.form).unbind("reset",ab).unbind("submit",g.updateOriginal),n.unbind(),o.unbind().find("*").remove(),p.unbind().remove(),k.remove(),j.unbind().find("*").unbind().remove(),j.remove(),i.removeData("sceditor").removeData("sceditorbbcode").show(),F&&i.attr("required","required"))},g.createDropDown=function(b,c,d,e){var h,i=r&&r.is(".sceditor-"+c);g.closeDropDown(),i||(e!==!1&&a(d).find(":not(input,textarea)").filter(function(){return 1===this.nodeType}).attr("unselectable","on"),h={top:b.offset().top,left:b.offset().left,marginTop:b.outerHeight()},a.extend(h,f.dropDownCss),r=a('<div class="sceditor-dropdown sceditor-'+c+'" />').css(h).append(d).appendTo(a("body")).on("click focusin",function(a){a.stopPropagation()}))},db=function(a){3!==a.which&&g.closeDropDown()},X=function(a){var b,d,e,h=n[0],i=o[0],j=0,k=c.createElement("div"),l=i.createDocumentFragment();if(f.disablePasting)return!1;if(f.enablePasteFiltering){if(w.saveRange(),c.body.appendChild(k),a&&a.clipboardData&&a.clipboardData.getData&&((b=a.clipboardData.getData("text/html"))||(b=a.clipboardData.getData("text/plain"))))return k.innerHTML=b,Y(h,k),!1;for(e=n.scrollTop()||o.scrollTop();h.firstChild;)l.appendChild(h.firstChild);return d=function(a,b){if(a.childNodes.length>0||j>25){for(;a.firstChild;)b.appendChild(a.firstChild);for(;l.firstChild;)a.appendChild(l.firstChild);n.scrollTop(e),o.scrollTop(e),b.childNodes.length>0?Y(a,b):w.restoreRange()}else j++,setTimeout(function(){d(a,b)},20)},d(h,k),g.focus(),!0}},Y=function(b,c){a.sceditor.dom.fixNesting(c);var d=c.innerHTML;A.hasHandler("toSource")&&(d=A.callOnlyFirst("toSource",d,a(c))),c.parentNode.removeChild(c),A.hasHandler("toWysiwyg")&&(d=A.callOnlyFirst("toWysiwyg",d,!0)),w.restoreRange(),g.wysiwygEditorInsertHtml(d,null,!0)},g.closeDropDown=function(a){r&&(r.unbind().remove(),r=null),a===!0&&g.focus()},W=function(){return m.contentDocument?m.contentDocument:m.contentWindow&&m.contentWindow.document?m.contentWindow.document:m.document?m.document:null},g.wysiwygEditorInsertHtml=function(b,c,d){var e,f,h,i=l.height();g.focus(),(d||!a(C).is("code")&&0===a(C).parents("code").length)&&(w.insertHTML(b,c),w.saveRange(),K(n[0]),e=n.find("#sceditor-end-marker").show(),f=n.scrollTop()||o.scrollTop(),h=a.sceditor.dom.getOffset(e[0]).top+1.5*e.outerHeight(!0)-i,e.hide(),(h>f||f>h+i)&&(n.scrollTop(h),o.scrollTop(h)),pb(!1),w.restoreRange(),ib())},g.wysiwygEditorInsertText=function(b,c){g.wysiwygEditorInsertHtml(a.sceditor.escapeEntities(b),a.sceditor.escapeEntities(c))},g.insertText=function(a,b){return g.inSourceMode()?g.sourceEditorInsertText(a,b):g.wysiwygEditorInsertText(a,b),this},g.sourceEditorInsertText=function(a,b){var d,e,f,g,h;h=q.scrollTop,q.focus(),"undefined"!=typeof q.selectionStart?(e=q.selectionStart,f=q.selectionEnd,g=a.length,b&&(a+=q.value.substring(e,f)+b),q.value=q.value.substring(0,e)+a+q.value.substring(f,q.value.length),q.selectionStart=e+a.length-(b?b.length:0),q.selectionEnd=q.selectionStart):"undefined"!=typeof c.selection.createRange?(d=c.selection.createRange(),b&&(a+=d.text+b),d.text=a,b&&d.moveEnd("character",0-b.length),d.moveStart("character",d.End-d.Start),d.select()):q.value+=a+b,q.scrollTop=h,q.focus(),pb()},g.getRangeHelper=function(){return w},g.sourceEditorCaret=function(a){var b={};return"undefined"!=typeof q.selectionStart?a?(q.selectionStart=a.start,q.selectionEnd=a.end):(b.start=q.selectionStart,b.end=q.selectionEnd):(range=c.selection.createRange(),a?(range.moveStart("character",a.start),range.moveEnd("character",a.end),range.select()):(b.start=range.Start,b.end=range.End)),a?this:b},g.val=function(a,b){return"string"==typeof a?(g.inSourceMode()?g.setSourceEditorValue(a):(b!==!1&&A.hasHandler("toWysiwyg")&&(a=A.callOnlyFirst("toWysiwyg",a)),g.setWysiwygEditorValue(a)),this):g.inSourceMode()?g.getSourceEditorValue(!1):g.getWysiwygEditorValue()},g.insert=function(b,c,d,e,f){if(g.inSourceMode()){g.sourceEditorInsertText(b,c)}else{if(c){var h=g.getRangeHelper().selectedHtml(),i=a("<div>").appendTo(a("body")).hide().html(h);d!==!1&&A.hasHandler("toSource")&&(h=A.callOnlyFirst("toSource",h,i)),i.remove(),b+=h+c};d!==!1&&A.hasHandler("toWysiwyg")&&(b=A.callOnlyFirst("toWysiwyg",b,!0)),d!==!1&&f===!0&&(b=b.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")),g.wysiwygEditorInsertHtml(b)};return this},g.getWysiwygEditorValue=function(b){var c,d,e=w.hasSelection();return e?w.saveRange():t&&t.getBookmark&&(d=t.getBookmark()),a.sceditor.dom.fixNesting(n[0]),c=n.html(),b!==!1&&A.hasHandler("toSource")&&(c=A.callOnlyFirst("toSource",c,n)),e?(w.restoreRange(),t=null):d&&(t.moveToBookmark(d),t=null),c},g.getBody=function(){return n},g.getContentAreaContainer=function(){return l},g.getSourceEditorValue=function(a){var b=p.val();return a!==!1&&A.hasHandler("toWysiwyg")&&(b=A.callOnlyFirst("toWysiwyg",b)),b},g.setWysiwygEditorValue=function(b){b||(b="<p>"+(a.sceditor.ie?"":"<br />")+"</p>"),n[0].innerHTML=b,K(n[0]),ib(),pb()},g.setSourceEditorValue=function(a){p.val(a),pb()},g.updateOriginal=function(){i.val(g.val())},K=function(b){if(f.emoticonsEnabled&&!a(b).parents("code").length){var c=b.ownerDocument,d=[],g=[],h=a.extend({},f.emoticons.more,f.emoticons.dropdown,f.emoticons.hidden);a.each(h,function(b){f.emoticonsCompat&&(g[b]=new RegExp("(>|^|\\s|\xa0|\u2002|\u2003|\u2009|&nbsp;)"+a.sceditor.regexEscape(b)+"(\\s|$|<|\xa0|\u2002|\u2003|\u2009|&nbsp;)")),d.push(b)}),function i(b){for(b=b.firstChild;null!=b;){var j,k,l,m,n,o,p,q=b.parentNode,r=b.nodeValue;if(3!==b.nodeType){a(b).is("code")||i(b)}else if(r)for(n=d.length;n--;)k=d[n],p=f.emoticonsCompat?r.search(g[k]):r.indexOf(k),p>-1&&(o=b.nextSibling,l=h[k],j=r.substr(p).split(k),r=r.substr(0,p)+j.shift(),b.nodeValue=r,m=a.sceditor.dom.parseHTML(e("emoticon",{key:k,url:l.url||l,tooltip:l.tooltip||k}),c),q.insertBefore(m[0],o),q.insertBefore(c.createTextNode(j.join(k)),o));b=b.nextSibling}}(b),f.emoticonsCompat&&(I=n.find("img[data-sceditor-emoticon]"))}},g.inSourceMode=function(){return j.hasClass("sourceMode")},g.sourceMode=function(a){return"boolean"!=typeof a?g.inSourceMode():((g.inSourceMode()&&!a||!g.inSourceMode()&&a)&&g.toggleSourceMode(),this)},g.toggleSourceMode=function(){(a.sceditor.isWysiwygSupported||!g.inSourceMode())&&(g.blur(),g.inSourceMode()?g.setWysiwygEditorValue(g.getSourceEditorValue()):g.setSourceEditorValue(g.getWysiwygEditorValue()),t=null,p.toggle(),l.toggle(),g.inSourceMode()?j.removeClass("sourceMode").addClass("wysiwygMode"):j.removeClass("wysiwygMode").addClass("sourceMode"),fb(),gb())},hb=function(){return q.focus(),null!=q.selectionStart?q.value.substring(q.selectionStart,q.selectionEnd):c.selection.createRange?c.selection.createRange().text:void(0)},L=function(b,c){return g.inSourceMode()?(c.txtExec&&(a.isArray(c.txtExec)?g.sourceEditorInsertText.apply(g,c.txtExec):c.txtExec.call(g,b,hb())),void(0)):(c.exec&&(a.isFunction(c.exec)?c.exec.call(g,b):g.execCommand(c.exec,c.hasOwnProperty("execParam")?c.execParam:null)),void(0))},M=function(){a.sceditor.ie&&(t=w.selectedRange())},g.execCommand=function(b,c){var d=!1,e=a(w.parentNode());if(g.focus(),!e.is("code")&&0===e.parents("code").length){try{d=o[0].execCommand(b,!1,c)}catch(f){};!d&&g.commands[b]&&g.commands[b].errorMessage&&alert(g._(g.commands[b].errorMessage))}},jb=function(){var b=function(){w&&!w.compare(D)&&(D=w.cloneSelected(),j.trigger(a.Event("selectionchanged"))),E=!1};E||(E=!0,a.sceditor.ie?b():setTimeout(b,100))},kb=function(){var b,c=w.parentNode();B!==c&&(b=B,B=c,C=w.getFirstBlockParent(c),j.trigger(a.Event("nodechanged",{oldNode:b,newNode:B})))},g.currentNode=function(){return B},g.currentBlockNode=function(){return C},gb=function(a){var b,c,d,e,f,h=o[0],i=y.length,j=g.sourceMode();if(g.sourceMode()||g.readOnly()){k.find(".sceditor-button").removeClass("active")}else for(f=a?a.newNode:w.parentNode(),d=w.getFirstBlockParent(f);i--;)if(b=0,c=y[i],e=k.find(".sceditor-button-"+c.name),j&&!e.data("sceditor-txtmode")){e.addClass("disabled")}else if(j||e.data("sceditor-wysiwygmode")){if("string"==typeof c.state){try{b=h.queryCommandEnabled(c.state)?0:-1,b>-1&&(b=h.queryCommandState(c.state)?1:0)}catch(l){}}else b=c.state.call(g,f,d);0>b?e.addClass("disabled"):e.removeClass("disabled"),b>0?e.addClass("active"):e.removeClass("active")}else e.addClass("disabled")},_=function(b){var c,d;if(!b.originalEvent.defaultPrevented){if(g.closeDropDown(),c=a(B),13===b.which&&(c.is("code,blockquote,pre")||0!==c.parents("code,blockquote,pre").length))return t=null,g.wysiwygEditorInsertHtml("<br />",null,!0),!1;if(!c.is("code")&&0===c.parents("code").length)for(d=s.length;d--;)s[d].call(g,b,m,p)}},ib=function(){var b,c,d;a.sceditor.dom.rTraverse(n[0],function(e){return b=e.nodeName.toLowerCase(),a.inArray(b,x)>-1&&(c=!0),3===e.nodeType&&!/^\s*$/.test(e.nodeValue)||"br"===b||a.sceditor.ie&&!e.firstChild&&!a.sceditor.dom.isInline(e,!1)?(c&&(d=n[0].ownerDocument.createElement("div"),d.className="sceditor-nlf",d.innerHTML=a.sceditor.ie?"":"<br />",n[0].appendChild(d)),!1):void(0)})},ab=function(){g.val(i.val())},bb=function(){g.closeDropDown(),t=null},eb=function(){var a=f.height,b=f.width;g.maximize()?g.dimensions("100%","100%",!1):(a&&a.toString().indexOf("%")>-1||b&&b.toString().indexOf("%")>-1)&&g.dimensions(b,a)},g._=function(){var a=arguments;return u&&u[a[0]]&&(a[0]=u[a[0]]),a[0].replace(/\{(\d+)\}/g,function(b,c){return"undefined"!=typeof a[c-0+1]?a[c-0+1]:"{"+c+"}"})},cb=function(b){var c,d=a.extend({},b);A.call(d.type+"Event",b,g),delete d.type,c=a.Event((b.target===q?"scesrc":"scewys")+b.type,d),j.trigger(c,g),c.isDefaultPrevented()&&b.preventDefault(),c.isImmediatePropagationStopped()&&c.stopImmediatePropagation(),c.isPropagationStopped()&&c.stopPropagation()},g.bind=function(b,c,d,e){b=b.split(" ");for(var f=b.length;f--;)a.isFunction(c)&&(d||j.bind("scewys"+b[f],c),e||j.bind("scesrc"+b[f],c),"valuechanged"===b[f]&&(pb.hasHandler=!0));return this},g.unbind=function(b,c,d,e){b=b.split(" ");for(var f=b.length;f--;)a.isFunction(c)&&(d||j.unbind("scewys"+b[f],c),e||j.unbind("scesrc"+b[f],c));return this},g.blur=function(b,c,d){return a.isFunction(b)?g.bind("blur",b,c,d):g.sourceMode()?p.blur():z?z.removeAttr("disabled").show().focus().blur().hide().attr("disabled","disabled"):(z=a('<input style="position:absolute;width:0;height:0;opacity:0;border:0;padding:0;filter:alpha(opacity=0)" type="text" />').appendTo(j),z.removeAttr("disabled").show().triggerHandler("focus"),z.blur().hide().attr("disabled","disabled")),this},g.focus=function(b,c,d){return a.isFunction(b)?g.bind("focus",b,c,d):g.inSourceMode()?q.focus():(m.contentWindow.focus(),n[0].focus(),t&&(w.selectRange(t),t=null)),this},g.keyDown=function(a,b,c){return g.bind("keydown",a,b,c)},g.keyPress=function(a,b,c){return g.bind("keypress",a,b,c)},g.keyUp=function(a,b,c){return g.bind("keyup",a,b,c)},g.nodeChanged=function(a){return g.bind("nodechanged",a,!1,!0)},g.selectionChanged=function(a){return g.bind("selectionchanged",a,!1,!0)},g.valueChanged=function(a,b,c){return g.bind("valuechanged",a,b,c)},mb=function(b){var c=0,d=String.fromCharCode(b.which);if(!a(C).is("code")&&!a(C).parents("code").length)return g.emoticonsCache||(g.emoticonsCache=[],a.each(a.extend({},f.emoticons.more,f.emoticons.dropdown,f.emoticons.hidden),function(a,b){g.emoticonsCache[c++]=[a,e("emoticon",{key:a,url:b.url||b,tooltip:b.tooltip||a})]}),g.emoticonsCache.sort(function(a,b){return a[0].length-b[0].length}),g.longestEmoticonCode=g.emoticonsCache[g.emoticonsCache.length-1][0].length),g.getRangeHelper().raplaceKeyword(g.emoticonsCache,!0,!0,g.longestEmoticonCode,f.emoticonsCompat,d)?(f.emoticonsCompat&&(I=n.find("img[data-sceditor-emoticon]")),/^\s$/.test(d)&&f.emoticonsCompat):void(0)},nb=function(){if(I.length){var b,c,d,e,f,h,i=g.currentBlockNode(),j=!1,k=/[^\s\xA0\u2002\u2003\u2009\u00a0]+/;I=a.map(I,function(g){return g&&g.parentNode?a.contains(i,g)?(b=g.previousSibling,c=g.nextSibling,f=b.nodeValue,null===f&&(f=b.innerText||""),b&&k.test(b.nodeValue.slice(-1))||c&&k.test((c.nodeValue||"")[0])?(d=g.parentNode,e=w.cloneSelected(),h=e.startContainer,f+=a(g).data("sceditor-emoticon"),h===c?j=f.length+e.startOffset:h===i&&i.childNodes[e.startOffset]===c?j=f.length:h===b&&(j=e.startOffset),c&&3===c.nodeType||(c=d.insertBefore(d.ownerDocument.createTextNode(""),c)),c.insertData(0,f),d.removeChild(b),d.removeChild(g),j!==!1&&(e.setStart(c,j),e.collapse(!0),w.selectRange(e)),null):g):g:null})}},g.emoticons=function(b){return b||b===!1?(f.emoticonsEnabled=b,b?(n.keypress(mb),g.sourceMode()||(w.saveRange(),K(n[0]),I=n.find("img[data-sceditor-emoticon]"),pb(!1),w.restoreRange())):(n.find("img[data-sceditor-emoticon]").replaceWith(function(){return a(this).data("sceditor-emoticon")}),I=[],n.unbind("keypress",mb),pb()),this):f.emoticonsEnabled},g.css=function(b){return G||(G=a('<style id="#inline" />').appendTo(o.find("head"))[0]),"string"!=typeof b?G.styleSheet?G.styleSheet.cssText:G.innerHTML:(G.styleSheet?G.styleSheet.cssText=b:G.innerHTML=b,this)},Z=function(a){var b=[],c={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|","[":"{","]":"}"},d={8:"backspace",9:"tab",13:"enter",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",91:"win",92:"win",93:"select",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},e={109:"-",110:"del",111:"/",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9"},f=a.which,h=d[f]||String.fromCharCode(f).toLowerCase();return a.ctrlKey&&b.push("ctrl"),a.altKey&&b.push("alt"),a.shiftKey&&(b.push("shift"),e[f]?h=e[f]:c[h]&&(h=c[h])),h&&(16>f||f>18)&&b.push(h),b=b.join("+"),H[b]?H[b].call(g):void(0)},g.addShortcut=function(a,b){return a=a.toLowerCase(),H[a]="string"==typeof b?function(){return L(k.find(".sceditor-button-"+b),g.commands[b]),!1}:b,this},g.removeShortcut=function(a){return delete H[a.toLowerCase()],this},$=function(c){var d,e,h,i,j;if(!a.sceditor.ie&&!f.disableBlockRemove&&8===c.which&&(i=w.selectedRange())&&(b.getSelection?(d=i.startContainer,e=i.startOffset):(d=i.parentElement(),h=o[0].selection.createRange(),h.moveToElementText(d),h.setEndPoint("EndToStart",i),e=h.text.length),0===e&&(j=ob()))){for(;d!==j;){for(;d.previousSibling;)if(d=d.previousSibling,3!==d.nodeType||d.nodeValue)return;if(!(d=d.parentNode))return};if(j&&!a(j).is("body"))return g.clearBlockFormatting(j),!1}},ob=function(){for(var b=C;!a.sceditor.dom.hasStyling(b);)if(!(b=b.parentNode)||a(b).is("body"))return;return b},g.clearBlockFormatting=function(b){return b=b||ob(),!b||a(b).is("body")?this:(w.saveRange(),t=null,b.className="",a(b).attr("style",""),a(b).is("p,div")||a.sceditor.dom.convertElement(b,"p"),w.restoreRange(),this)},pb=function(b){if(A.hasHandler("valuechangedEvent")||pb.hasHandler){var c,d=g.sourceMode(),e=!d&&w.hasSelection();b=b!==!1&&!o[0].getElementById("sceditor-start-marker"),rb.timer&&(clearTimeout(rb.timer),rb.timer=!1),e&&b&&w.saveRange(),c=n.html(),c===pb.lastHtmlValue&&(pb.lastHtmlValue=c,j.trigger(a.Event("valuechanged",{rawValue:d?g.val():c}))),e&&b&&w.removeMarkers()}},qb=function(){rb.timer&&pb()},rb=function(a){var b=a.which,c=rb.lastChar,d=13===c||32===c,e=8===c||46===c;rb.lastChar=b,13===b||32===b?d?rb.triggerNextChar=!0:pb():8===b||46===b?e?rb.triggerNextChar=!0:pb():rb.triggerNextChar&&(pb(),rb.triggerNextChar=!1),rb.timer&&clearTimeout(rb.timer),rb.timer=setTimeout(function(){pb()},1500)},J()},a.sceditor.ie=function(){var a,d=3,e=c.createElement("div"),f=e.getElementsByTagName("i");do{e.innerHTML="<!--[if gt IE "+ ++d+"]><i></i><![endif]-->"}while(f[0]);return c.documentMode&&c.all&&b.atob&&(d=10),4===d&&c.documentMode&&(d=11),d>4?d:a}(),a.sceditor.ios=/iPhone|iPod|iPad| wosbrowser\//i.test(navigator.userAgent),a.sceditor.isWysiwygSupported=function(){var b,c,d=a('<div contenteditable="true">')[0].contentEditable,e="undefined"!=typeof d&&"inherit"!==d,f=navigator.userAgent;return e?(c=/Opera Mobi|Opera Mini/i.test(f),/Android/i.test(f)&&(c=!0,/Safari/.test(f)&&(b=/Safari\/(\d+)/.exec(f),c=b&&b[1]?b[1]<534:!0)),/ Silk\//i.test(f)&&(b=/AppleWebKit\/(\d+)/.exec(f),c=b&&b[1]?b[1]<534:!0),a.sceditor.ios&&(c=!/OS [5-9](_\d)+ like Mac OS X/i.test(f)),/fennec/i.test(f)&&(c=!1),/OneBrowser/i.test(f)&&(c=!1),"UCWEB"===navigator.vendor&&(c=!1),!c):!1}(),a.sceditor.regexEscape=function(a){return a.replace(/([\-.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")},a.sceditor.escapeEntities=function(a){return a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ {2}/g," &nbsp;").replace(/\r\n|\r/g,"\n").replace(/\n/g,"<br />"):a},a.sceditor.locale={},a.sceditor.commands={bold:{exec:"bold",tooltip:"Bold",shortcut:"ctrl+b"},italic:{exec:"italic",tooltip:"Italic",shortcut:"ctrl+i"},underline:{exec:"underline",tooltip:"Underline",shortcut:"ctrl+u"},strike:{exec:"strikethrough",tooltip:"Strikethrough"},subscript:{exec:"subscript",tooltip:"Subscript"},superscript:{exec:"superscript",tooltip:"Superscript"},left:{exec:"justifyleft",tooltip:"Align left"},center:{exec:"justifycenter",tooltip:"Center"},right:{exec:"justifyright",tooltip:"Align right"},justify:{exec:"justifyfull",tooltip:"Justify"},font:{_dropDown:function(b,c,d){for(var f=b.opts.fonts.split(","),g=a("<div />"),h=function(){return d(a(this).data("font")),b.closeDropDown(!0),!1},i=0;i<f.length;i++)g.append(e("fontOpt",{font:f[i]},!0).click(h));b.createDropDown(c,"font-picker",g)},exec:function(b){var c=this;a.sceditor.command.get("font")._dropDown(c,b,function(a){c.execCommand("fontname",a)})},tooltip:"Font Name"},size:{_dropDown:function(b,c,d){for(var f=a("<div />"),g=function(c){d(a(this).data("size")),b.closeDropDown(!0),c.preventDefault()},h=1;7>=h;h++)f.append(e("sizeOpt",{size:h},!0).click(g));b.createDropDown(c,"fontsize-picker",f)},exec:function(b){var c=this;a.sceditor.command.get("size")._dropDown(c,b,function(a){c.execCommand("fontsize",a)})},tooltip:"Font Size"},color:{_dropDown:function(b,c,d){var e,f,g,h,i={r:255,g:255,b:255},j=a("<div />"),k=b.opts.colors?b.opts.colors.split("|"):new Array(21),l=[],m=a.sceditor.command.get("color");if(!m._htmlCache){for(e=0;e<k.length;++e){for(h=k[e]?k[e].split(","):new Array(21),l.push('<div class="sceditor-color-column">'),f=0;f<h.length;++f)g=h[f]||"#"+i.r.toString(16)+i.g.toString(16)+i.b.toString(16),l.push('<a href="#" class="sceditor-color-option" style="background-color: '+g+'" data-color="'+g+'"></a>'),0===f%5?(i.g-=51,i.b=255):i.b-=51;l.push("</div>"),0===e%5?(i.r-=51,i.g=255,i.b=255):(i.g=255,i.b=255)};m._htmlCache=l.join("")};j.append(m._htmlCache).find("a").click(function(c){d(a(this).attr("data-color")),b.closeDropDown(!0),c.preventDefault()}),b.createDropDown(c,"color-picker",j)},exec:function(b){var c=this;a.sceditor.command.get("color")._dropDown(c,b,function(a){c.execCommand("forecolor",a)})},tooltip:"Font Color"},removeformat:{exec:"removeformat",tooltip:"Remove Formatting"},cut:{exec:"cut",tooltip:"Cut",errorMessage:"Your browser does not allow the cut command. Please use the keyboard shortcut Ctrl/Cmd-X"},copy:{exec:"copy",tooltip:"Copy",errorMessage:"Your browser does not allow the copy command. Please use the keyboard shortcut Ctrl/Cmd-C"},paste:{exec:"paste",tooltip:"Paste",errorMessage:"Your browser does not allow the paste command. Please use the keyboard shortcut Ctrl/Cmd-V"},pastetext:{exec:function(a){var b,c=this,d=e("pastetext",{label:c._("Paste your text inside the following box:"),insert:c._("Insert")},!0);d.find(".button").click(function(a){b=d.find("#txt").val(),b&&c.wysiwygEditorInsertText(b),c.closeDropDown(!0),a.preventDefault()}),c.createDropDown(a,"pastetext",d)},tooltip:"Paste Text"},bulletlist:{exec:"insertunorderedlist",tooltip:"Bullet list"},orderedlist:{exec:"insertorderedlist",tooltip:"Numbered list"},indent:{state:function(b,c){var d,e,f,g=a(c),h=g.parents("ul,ol,menu").length;if(h>1||h>0&&c.parentNode.children.length>1)return 0;if(g.is("ul,ol,menu")){if(d=this.getRangeHelper().selectedRange(),!(d instanceof Range))return g.is("li")?0:-1;if(e=d.startContainer.parentNode,f=d.endContainer.parentNode,e!==e.parentNode.firstElementChild||a(f).is("li")&&f!==f.parentNode.lastElementChild)return 0};return-1},exec:function(){var b=this,c=a(b.getRangeHelper().getFirstBlockParent());b.focus(),c.parents("ul,ol,menu")&&b.execCommand("indent")},tooltip:"Add indent"},outdent:{state:function(b,c){return a(c).is("ul,ol,menu")||a(c).parents("ul,ol,menu").length>0?0:-1},exec:function(){var b=this,c=a(b.getRangeHelper().getFirstBlockParent());c.parents("ul,ol,menu")&&b.execCommand("outdent")},tooltip:"Remove one indent"},table:{exec:function(b){var c=this,d=e("table",{rows:c._("Rows:"),cols:c._("Cols:"),insert:c._("Insert")},!0);d.find(".button").click(function(b){var e=d.find("#rows").val()-0,f=d.find("#cols").val()-0,g="<table>";if(!(1>e||1>f)){for(var h=0;e>h;h++){g+="<tr>";for(var i=0;f>i;i++)g+="<td>"+(a.sceditor.ie?"":"<br />")+"</td>";g+="</tr>"};g+="</table>",c.wysiwygEditorInsertHtml(g),c.closeDropDown(!0),b.preventDefault()}}),c.createDropDown(b,"inserttable",d)},tooltip:"Insert a table"},horizontalrule:{exec:"inserthorizontalrule",tooltip:"Insert a horizontal rule"},code:{forceNewLineAfter:["code"],exec:function(){this.wysiwygEditorInsertHtml("<code>","<br /></code>")},tooltip:"Code"},image:{exec:function(a){var b=this,c=e("image",{url:b._("URL:"),width:b._("Width (optional):"),height:b._("Height (optional):"),insert:b._("Insert")},!0);c.find(".button").click(function(a){var d=c.find("#image").val(),e=c.find("#width").val(),f=c.find("#height").val(),g="";e&&(g+=' width="'+e+'"'),f&&(g+=' height="'+f+'"'),d&&"http://"!==d&&b.wysiwygEditorInsertHtml("<img"+g+' src="'+d+'" />'),b.closeDropDown(!0),a.preventDefault()}),b.createDropDown(a,"insertimage",c)},tooltip:"Insert an image"},email:{exec:function(a){var b=this,c=e("email",{label:b._("E-mail:"),insert:b._("Insert")},!0);c.find(".button").click(function(a){var d=c.find("#email").val();d&&(b.focus(),b.getRangeHelper().selectedHtml()?b.execCommand("createlink","mailto:"+d):b.wysiwygEditorInsertHtml('<a href="mailto:'+d+'">'+d+"</a>")),b.closeDropDown(!0),a.preventDefault()}),b.createDropDown(a,"insertemail",c)},tooltip:"Insert an email"},link:{exec:function(a){var b=this,c=e("link",{url:b._("URL:"),desc:b._("Description (optional):"),ins:b._("Insert")},!0);c.find(".button").click(function(a){var d=c.find("#link").val(),e=c.find("#des").val();d&&"http://"!==d&&(b.focus(),!b.getRangeHelper().selectedHtml()||e?(e||(e=d),b.wysiwygEditorInsertHtml('<a href="'+d+'">'+e+"</a>")):b.execCommand("createlink",d)),b.closeDropDown(!0),a.preventDefault()}),b.createDropDown(a,"insertlink",c)},tooltip:"Insert a link"},unlink:{state:function(){var b=a(this.currentNode());return b.is("a")||b.parents("a").length>0?0:-1},exec:function(){var b=a(this.currentNode()),c=b.is("a")?b:b.parents("a").first();c.length&&c.replaceWith(c.contents())},tooltip:"Unlink"},quote:{forceNewLineAfter:["blockquote"],exec:function(b,c,d){var e="<blockquote>",f="</blockquote>";c?(d=d?"<cite>"+d+"</cite>":"",e=e+d+c+f,f=null):""===this.getRangeHelper().selectedHtml()&&(f=a.sceditor.ie?"":"<br />"+f),this.wysiwygEditorInsertHtml(e,f)},tooltip:"Insert a Quote"},emoticon:{exec:function(b){var c=this,d=function(e){var f=c.opts.emoticonsCompat,g=c.getRangeHelper(),h=f&&" "!==g.getOuterText(!0,1)?" ":"",i=f&&" "!==g.getOuterText(!1,1)?" ":"",j=a("<div />"),k=a("<div />").appendTo(j),l=a.extend({},c.opts.emoticons.dropdown,e?c.opts.emoticons.more:{}),m=0;return a.each(l,function(){m++}),m=Math.sqrt(m),a.each(l,function(b,d){k.append(a("<img />").attr({src:d.url||d,alt:b,title:d.tooltip||b}).click(function(){return c.insert(h+a(this).attr("alt")+i,null,!1).closeDropDown(!0),!1})),k.children().length>=m&&(k=a("<div />").appendTo(j))}),e||j.append(a(c._('<a class="sceditor-more">{0}</a>',c._("More"))).click(function(){return c.createDropDown(b,"more-emoticons",d(!0)),!1})),j};c.createDropDown(b,"emoticons",d(!1))},txtExec:function(b){a.sceditor.command.get("emoticon").exec.call(this,b)},tooltip:"Insert an emoticon"},youtube:{_dropDown:function(a,b,c){var d,f=e("youtubeMenu",{label:a._("Video URL:"),insert:a._("Insert")},!0);f.find(".button").click(function(b){var e=f.find("#link").val().replace("http://","");""!==e&&(d=e.match(/(?:v=|v\/|embed\/|youtu.be\/)(.{11})/),d&&(e=d[1]),/^[a-zA-Z0-9_\-]{11}$/.test(e)?c(e):alert("Invalid YouTube video")),a.closeDropDown(!0),b.preventDefault()}),a.createDropDown(b,"insertlink",f)},exec:function(b){var c=this;a.sceditor.command.get("youtube")._dropDown(c,b,function(a){c.wysiwygEditorInsertHtml(e("youtube",{id:a}))})},tooltip:"Insert a YouTube video"},date:{_date:function(a){var b=new Date(),c=b.getYear(),d=b.getMonth()+1,e=b.getDate();return 2e3>c&&(c=1900+c),10>d&&(d="0"+d),10>e&&(e="0"+e),a.opts.dateFormat.replace(/year/i,c).replace(/month/i,d).replace(/day/i,e)},exec:function(){this.insertText(a.sceditor.command.get("date")._date(this))},txtExec:function(){this.insertText(a.sceditor.command.get("date")._date(this))},tooltip:"Insert current date"},time:{_time:function(){var a=new Date(),b=a.getHours(),c=a.getMinutes(),d=a.getSeconds();return 10>b&&(b="0"+b),10>c&&(c="0"+c),10>d&&(d="0"+d),b+":"+c+":"+d},exec:function(){this.insertText(a.sceditor.command.get("time")._time())},txtExec:function(){this.insertText(a.sceditor.command.get("time")._time())},tooltip:"Insert current time"},ltr:{state:function(a,b){return b&&"ltr"===b.style.direction},exec:function(){var b=this,c=b.getRangeHelper().getFirstBlockParent(),d=a(c);b.focus(),(c&&!d.is("body")||(b.execCommand("formatBlock","p"),c=b.getRangeHelper().getFirstBlockParent(),d=a(c),c&&!d.is("body")))&&("ltr"===d.css("direction")?d.css("direction",""):d.css("direction","ltr"))},tooltip:"Left-to-Right"},rtl:{state:function(a,b){return b&&"rtl"===b.style.direction},exec:function(){var b=this,c=b.getRangeHelper().getFirstBlockParent(),d=a(c);b.focus(),(c&&!d.is("body")||(b.execCommand("formatBlock","p"),c=b.getRangeHelper().getFirstBlockParent(),d=a(c),c&&!d.is("body")))&&("rtl"===d.css("direction")?d.css("direction",""):d.css("direction","rtl"))},tooltip:"Right-to-Left"},print:{exec:"print",tooltip:"Print"},maximize:{state:function(){return this.maximize()},exec:function(){this.maximize(!this.maximize())},txtExec:function(){this.maximize(!this.maximize())},tooltip:"Maximize",shortcut:"ctrl+shift+m"},source:{exec:function(){this.toggleSourceMode()},txtExec:function(){this.toggleSourceMode()},tooltip:"View source",shortcut:"ctrl+shift+s"},ignore:{}},a.sceditor.rangeHelper=function(b,c){var d,e,f,g=c||b.contentDocument||b.document,h=b,i=!!b.getSelection,j="sceditor-start-marker",k="sceditor-end-marker",l="character",m=this;m.insertHTML=function(a,b){var c,d,e=m.selectedRange();if(i){for(b&&(a+=m.selectedHtml()+b),d=g.createElement("div"),c=g.createDocumentFragment(),d.innerHTML=a;d.firstChild;)c.appendChild(d.firstChild);m.insertNode(c)}else{if(!e)return!1;e.pasteHTML(f(a,b,!0))}},f=function(b,c,e){var f,h,i,l=g.createElement("div");if("string"==typeof b?(c&&(b+=m.selectedHtml()+c),l.innerHTML=b):(l.appendChild(b),c&&(l.appendChild(range.extractContents()),l.appendChild(c))),f=l.lastChild){if(m.removeMarkers(),h=a(f),1===f.nodeType?(f.lastChild||h.append(g.createTextNode("\u200b")),h.append(d(k)).append(d(j))):h.after(d(j)).after(d(k)),e)return l.innerHTML;for(i=g.createDocumentFragment();l.firstChild;)i.appendChild(l.firstChild);return i}},m.insertNode=function(a,b){if(i){var c=f(a,b),d=m.selectedRange(),e=d.commonAncestorContainer;if(!c)return!1;d.deleteContents(),e&&/^(br|hr)$/i.test(e.nodeName)?e.parentNode.insertBefore(c,e):d.insertNode(c),m.restoreRange()}else m.insertHTML(a.outerHTML,b?b.outerHTML:null)},m.cloneSelected=function(){var a=m.selectedRange();return a?i?a.cloneRange():a.duplicate():void(0)},m.selectedRange=function(){var a,b,c=i?h.getSelection():g.selection;if(c){if(c.getRangeAt&&c.rangeCount<=0){for(b=g.body;b.firstChild;)b=b.firstChild;a=g.createRange(),a.setStart(b,0),c.addRange(a)};return i&&(a=c.getRangeAt(0)),i||"Control"===c.type||(a=c.createRange()),e(a)?a:null}},e=function(a){var b;return a&&a.parentElement&&(b=a.parentElement())?b.ownerDocument===g:!0},m.hasSelection=function(){var a,b=i?h.getSelection():g.selection;return i||!b?b&&b.rangeCount>0:(a=b.createRange(),a&&e(a))},m.selectedHtml=function(){var a,b=m.selectedRange();return b?!i&&""!==b.text&&b.htmlText?b.htmlText:i?(a=g.createElement("div"),a.appendChild(b.cloneContents()),a.innerHTML):"":""},m.parentNode=function(){var a=m.selectedRange();return a?a.parentElement?a.parentElement():a.commonAncestorContainer:void(0)},m.getFirstBlockParent=function(b){var c=function(b){return a.sceditor.dom.isInline(b,!0)?(b=b?b.parentNode:null,b?c(b):null):b};return c(b||m.parentNode())},m.insertNodeAt=function(a,b){var c=m.selectedRange(),d=m.cloneSelected();return d?(d.collapse(a),d.insertNode?d.insertNode(b):d.pasteHTML(b.outerHTML),m.selectRange(c),void(0)):!1},d=function(a){m.removeMarker(a);var b=g.createElement("span");return b.id=a,b.style.lineHeight="0",b.style.display="none",b.className="sceditor-selection sceditor-ignore",b.innerHTML=" ",b},m.insertMarkers=function(){m.insertNodeAt(!0,d(j)),m.insertNodeAt(!1,d(k))},m.getMarker=function(a){return g.getElementById(a)},m.removeMarker=function(a){var b=m.getMarker(a);b&&b.parentNode.removeChild(b)},m.removeMarkers=function(){m.removeMarker(j),m.removeMarker(k)},m.saveRange=function(){m.insertMarkers()},m.selectRange=function(a){i?(h.getSelection().removeAllRanges(),h.getSelection().addRange(a)):a.select()},m.restoreRange=function(){var a,b=m.selectedRange(),c=m.getMarker(j),d=m.getMarker(k);return c&&d&&b?(i?(b=g.createRange(),b.setStartBefore(c),b.setEndAfter(d)):(b=g.body.createTextRange(),a=g.body.createTextRange(),a.moveToElementText(c),b.setEndPoint("StartToStart",a),b.moveStart(l,0),a.moveToElementText(d),b.setEndPoint("EndToStart",a),b.moveEnd(l,0)),m.selectRange(b),m.removeMarkers(),void(0)):!1},m.selectOuterText=function(a,b){var c=m.cloneSelected();return c?(c.collapse(!1),i?(c.setStart(c.startContainer,c.startOffset-a),c.setEnd(c.endContainer,c.endOffset+b)):(c.moveStart(l,0-a),c.moveEnd(l,b)),m.selectRange(c),void(0)):!1},m.getOuterText=function(a,b){var c="",d=m.cloneSelected();return d?(d.collapse(!1),a?i?(c=d.startContainer.textContent.substr(0,d.startOffset),c=c.substr(Math.max(0,c.length-b))):(d.moveStart(l,0-b),c=d.text):i?c=d.startContainer.textContent.substr(d.startOffset,b):(d.moveEnd(l,b),c=d.text),c):""},m.raplaceKeyword=function(b,c,d,e,f,g){d||b.sort(function(a,b){return a.length-b.length});var h,j,k,l,n,o,p,q=b.length,r=e||b[q-1][0].length;if(f){if(!i)return!1;++r};for(h=m.getOuterText(!0,r),j=h+(null!=g?g:""),c&&(j+=m.getOuterText(!1,r));q--;)if(p=b[q][0],n=new RegExp("(?:[\\s\xa0\u2002\u2003\u2009])"+a.sceditor.regexEscape(p)+"(?=[\\s\xa0\u2002\u2003\u2009])"),o=h.length-1-p.length,f&&--o,o=Math.max(0,o),(k=f?j.substr(o).search(n):j.indexOf(p,o))>-1){if(f&&(k+=o+1),k>h.length||k+p.length+(f?1:0)<h.length)continue;return l=h.length-k,m.selectOuterText(l,p.length-l-(null!=g&&/^\S/.test(g)?1:0)),m.insertHTML(b[q][1]),!0};return!1},m.compare=function(a,b){return b||(b=m.selectedRange()),a&&b?i?0===a.compareBoundaryPoints(Range.END_TO_END,b)&&0===a.compareBoundaryPoints(Range.START_TO_START,b):e(a)&&e(b)&&0===a.compareEndPoints("EndToEnd",b)&&0===a.compareEndPoints("StartToStart",b):!a&&!b}},a.sceditor.dom={traverse:function(a,b,c,d,e){if(a)for(a=e?a.lastChild:a.firstChild;null!=a;){var f=e?a.previousSibling:a.nextSibling;if(!c&&b(a)===!1)return!1;if(!d&&this.traverse(a,b,c,d,e)===!1)return!1;if(c&&b(a)===!1)return!1;a=f}},rTraverse:function(a,b,c,d){this.traverse(a,b,c,d,!0)},parseHTML:function(b,d){var e=[],f=(d||c).createElement("div");return f.innerHTML=b,a.merge(e,f.childNodes),e},hasStyling:function(b){var c=a(b);return b&&(!c.is("p,div")||b.className||c.attr("style")||!a.isEmptyObject(c.data()))},convertElement:function(b,c){for(var d,e,f=b.attributes.length,g=b.ownerDocument.createElement(c);f--;)e=b.attributes[f],(!a.sceditor.ie||e.specified)&&(a.sceditor.ie<8&&/style/i.test(e.name)?b.style.cssText=b.style.cssText:g.setAttribute(e.name,e.value));for(;d=b.firstChild;)g.appendChild(d);return b.parentNode.replaceChild(g,b),g},blockLevelList:"|body|hr|p|div|h1|h2|h3|h4|h5|h6|address|pre|form|table|tbody|thead|tfoot|th|tr|td|li|ol|ul|blockquote|center|",isInline:function(b,c){return b&&1===b.nodeType?(b=b.tagName.toLowerCase(),"code"===b?!c:a.sceditor.dom.blockLevelList.indexOf("|"+b+"|")<0):!0},copyCSS:function(a,b){b.style.cssText=a.style.cssText+b.style.cssText},fixNesting:function(a){var b=this,c=function(a){for(;b.isInline(a.parentNode,!0);)a=a.parentNode;return a};b.traverse(a,function(a){if(1===a.nodeType&&!b.isInline(a,!0)&&b.isInline(a.parentNode,!0)){var d=c(a),e=d.parentNode,f=b.extractContents(d,a),g=a;b.copyCSS(d,g),e.insertBefore(f,d),e.insertBefore(g,d)}})},findCommonAncestor:function(b,c){return a(b).parents().has(a(c)).first()},getSibling:function(b,c){var d;return b?(d=b[c?"previousSibling":"nextSibling"])?d:a.sceditor.dom.getSibling(b.parentNode,c):null},removeWhiteSpace:function(b,c){for(var d,e,f,g,h,i,j,k,l=a.sceditor.dom.getSibling,m=a.sceditor.dom.isInline,n=b.firstChild,o=/[\t ]+/g,p=/[\t\n\r ]+/g;n;){if(i=n.nextSibling,d=n.nodeValue,e=n.nodeType,1===e&&n.firstChild&&(h=a(n).css("whiteSpace"),/pre(?:\-wrap)?$/i.test(h)||a.sceditor.dom.removeWhiteSpace(n,/line$/i.test(h))),3===e&&d){for(f=l(n),g=l(n,!0),k=g,j=!1;a(k).hasClass("sceditor-ignore");)k=l(k,!0);if(m(n)&&k){for(;k.lastChild;)k=k.lastChild;j=3===k.nodeType?/[\t\n\r ]$/.test(k.nodeValue):!m(k)};m(n)&&g&&m(g)&&!j||(d=d.replace(/^[\t\n\r ]+/,"")),m(n)&&f&&m(f)||(d=d.replace(/[\t\n\r ]+$/,"")),d=d.replace(/\u200B/g,""),d.length?n.nodeValue=d.replace(c?o:p," "):b.removeChild(n)};n=i}},extractContents:function(a,b){var c=this,d=c.findCommonAncestor(a,b),e=d?d[0]:null,f=!1,g=!1;return function h(d){var e=a.ownerDocument.createDocumentFragment();return c.traverse(d,function(c){if(g||c===b&&f)return g=!0,!1;c===a&&(f=!0);var d,i;f?jQuery.contains(c,b)&&1===c.nodeType?(d=h(c),i=c.cloneNode(!1),i.appendChild(d),e.appendChild(i)):e.appendChild(c):jQuery.contains(c,a)&&1===c.nodeType&&(d=h(c),i=c.cloneNode(!1),i.appendChild(d),e.appendChild(i))},!1),e}(e)},getOffset:function(a){for(var b=0,c=0;a;)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent;return{left:b,top:c}}},a.sceditor.plugins={},a.sceditor.PluginManager=function(b){var c=this,d=[],e=b,f=function(a){return"signal"+a.charAt(0).toUpperCase()+a.slice(1)},g=function(a,b){a=[].slice.call(a);for(var c=d.length,g=f(a.shift());c--;)if(g in d[c]){if(b)return d[c][g].apply(e,a);d[c][g].apply(e,a)}};c.call=function(){g(arguments,!1)},c.callOnlyFirst=function(){return g(arguments,!0)},c.iter=function(a){return a=f(a),function(){var b=d.length;return{callNext:function(c){for(;b--;)if(d[b]&&a in d[b])return d[b].apply(e,c)},hasNext:function(){for(var c=b;c--;)if(d[c]&&a in d[c])return!0;return!1}}}()},c.hasHandler=function(a){var b=d.length;for(a=f(a);b--;)if(a in d[b])return!0;return!1},c.exsists=function(b){return b in a.sceditor.plugins?(b=a.sceditor.plugins[b],"function"==typeof b&&"object"==typeof b.prototype):!1},c.isRegistered=function(b){var e=d.length;if(!c.exsists(b))return!1;for(;e--;)if(d[e]instanceof a.sceditor.plugins[b])return!0;return!1},c.register=function(b){return c.exsists(b)?(b=new a.sceditor.plugins[b](),d.push(b),"init"in b&&b.init.apply(e),!0):!1},c.deregister=function(b){var f,g=d.length,h=!1;if(!c.isRegistered(b))return!1;for(;g--;)d[g]instanceof a.sceditor.plugins[b]&&(f=d.splice(g,1)[0],h=!0,"destroy"in f&&f.destroy.apply(e));return h},c.destroy=function(){for(var a=d.length;a--;)"destroy"in d[a]&&d[a].destroy.apply(e);d=null,e=null}},a.sceditor.command={get:function(b){return a.sceditor.commands[b]||null},set:function(b,c){return b&&c?(c=a.extend(a.sceditor.commands[b]||{},c),c.remove=function(){a.sceditor.command.remove(b)},a.sceditor.commands[b]=c,this):!1},remove:function(b){return a.sceditor.commands[b]&&delete a.sceditor.commands[b],this}},a.sceditor.defaultOptions={toolbar:"bold,italic,underline,strike,subscript,superscript|left,center,right,justify|font,size,color,removeformat|cut,copy,paste,pastetext|bulletlist,orderedlist,indent,outdent|table|code,quote|horizontalrule,image,email,link,unlink|emoticon,youtube,date,time|ltr,rtl|print,maximize,source",toolbarExclude:null,style:"jquery.sceditor.default.css",fonts:"Arial,Arial Black,Comic Sans MS,Courier New,Georgia,Impact,Sans-serif,Serif,Times New Roman,Trebuchet MS,Verdana",colors:null,locale:"en",charset:"utf-8",emoticonsCompat:!1,emoticonsEnabled:!0,emoticonsRoot:"",emoticons:{dropdown:{":)":"emoticons/smile.png",":angel:":"emoticons/angel.png",":angry:":"emoticons/angry.png","8-)":"emoticons/cool.png",":'(":"emoticons/cwy.png",":ermm:":"emoticons/ermm.png",":D":"emoticons/grin.png","<3":"emoticons/heart.png",":(":"emoticons/sad.png",":O":"emoticons/shocked.png",":P":"emoticons/tongue.png",";)":"emoticons/wink.png"},more:{":alien:":"emoticons/alien.png",":blink:":"emoticons/blink.png",":blush:":"emoticons/blush.png",":cheerful:":"emoticons/cheerful.png",":devil:":"emoticons/devil.png",":dizzy:":"emoticons/dizzy.png",":getlost:":"emoticons/getlost.png",":happy:":"emoticons/happy.png",":kissing:":"emoticons/kissing.png",":ninja:":"emoticons/ninja.png",":pinch:":"emoticons/pinch.png",":pouty:":"emoticons/pouty.png",":sick:":"emoticons/sick.png",":sideways:":"emoticons/sideways.png",":silly:":"emoticons/silly.png",":sleeping:":"emoticons/sleeping.png",":unsure:":"emoticons/unsure.png",":woot:":"emoticons/w00t.png",":wassat:":"emoticons/wassat.png"},hidden:{":whistling:":"emoticons/whistling.png",":love:":"emoticons/wub.png"}},width:null,height:null,resizeEnabled:!0,resizeMinWidth:null,resizeMinHeight:null,resizeMaxHeight:null,resizeMaxWidth:null,resizeHeight:!0,resizeWidth:!0,getHtmlHandler:null,getTextHandler:null,dateFormat:"year-month-day",toolbarContainer:null,enablePasteFiltering:!1,disablePasting:!1,readOnly:!1,rtl:!1,autofocus:!1,autofocusEnd:!0,autoExpand:!1,autoUpdate:!1,spellcheck:!0,runWithoutWysiwygSupport:!1,id:null,plugins:"",zIndex:null,bbcodeTrim:!1,disableBlockRemove:!1,parserOptions:{},dropDownCss:{}},a.fn.sceditor=function(b){var c,d=[];return b=b||{},b.runWithoutWysiwygSupport||a.sceditor.isWysiwygSupported?(this.each(function(){c=this.jquery?this:a(this),c.parents(".sceditor-container").length>0||("state"===b?d.push(!!c.data("sceditor")):"instance"===b?d.push(c.data("sceditor")):c.data("sceditor")||new a.sceditor(this,b))}),d.length?1===d.length?d[0]:a(d):this):void(0)}}(jQuery,window,document);!function(a,b,c){"use strict";a.sceditor.BBCodeParser=function(b){if(!(this instanceof a.sceditor.BBCodeParser))return new a.sceditor.BBCodeParser(b);var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=this,t={open:"open",content:"content",newline:"newline",close:"close"},u=function(a,b,c,d,e,f){var g=this;g.type=a,g.name=b,g.val=c,g.attrs=d||{},g.children=e||[],g.closing=f||null};u.prototype={clone:function(a){var b=this;return new u(b.type,b.name,b.val,b.attrs,a?b.children:[],b.closing?b.closing.clone():null)},splitAt:function(b){var c,d=this,e=0,f=d.children.length;if("number"!=typeof object&&(b=a.inArray(b,d.children)),0>b||b>f)return null;for(;f--;)f>=b?e++:f=0;return c=d.clone(),c.children=d.children.splice(b,e),c}},d=function(){s.opts=a.extend({},a.sceditor.BBCodeParser.defaults,b),s.bbcodes=a.sceditor.plugins.bbcode.bbcodes},s.tokenize=function(a){var b,c,d,f=[],g=[{type:"close",regex:/^\[\/[^\[\]]+\]/},{type:"open",regex:/^\[[^\[\]]+\]/},{type:"newline",regex:/^(\r\n|\r|\n)/},{type:"content",regex:/^([^\[\r\n]+|\[)/}];g.reverse();a:for(;a.length;){for(d=g.length;d--;)if(c=g[d].type,(b=a.match(g[d].regex))&&b[0]){f.push(e(c,b[0])),a=a.substr(b[0].length);continue a};a.length&&f.push(e(t.content,a)),a=""};return f},e=function(b,c){var d,e,g;return"open"===b&&(d=c.match(/\[([^\]\s=]+)(?:([^\]]+))?\]/))?(g=q(d[1]),d[2]&&(d[2]=a.trim(d[2]))&&(e=f(d[2]))):"close"===b&&(d=c.match(/\[\/([^\[\]]+)\]/))?g=q(d[1]):"newline"===b&&(g="#newline"),g&&("open"!==b&&"close"!==b||a.sceditor.plugins.bbcode.bbcodes[g])||(b="content",g="#"),new u(b,g,c,e)},f=function(b){var c,d=/([^\s=]+)=(?:(?:(["'])((?:\\\2|[^\2])*?)\2)|((?:.(?!\s\S+=))*.))/g,e=a.sceditor.plugins.bbcode.stripQuotes,f={};if("="===b.charAt(0)&&b.indexOf("=",1)<0){f.defaultattr=e(b.substr(1))}else for("="===b.charAt(0)&&(b="defaultattr"+b);c=d.exec(b);)f[q(c[1])]=e(c[3])||c[4];return f},s.parse=function(a,b){var c=g(s.tokenize(a));return s.opts.fixInvalidChildren&&l(c),s.opts.removeEmptyTags&&k(c),s.opts.fixInvalidNesting&&i(c),h(c,null,b),s.opts.removeEmptyTags&&k(c),c},o=function(a,b,c){for(var d=c.length;d--;)if(c[d].type===b&&c[d].name===a)return!0;return!1},j=function(b,c){var d=b?s.bbcodes[b.name]:null,e=d?d.allowedChildren:null;return s.opts.fixInvalidChildren&&e?e&&a.inArray(c.name||"#",e)<0?!1:!0:!0},g=function(b){for(var c,d,e,f,g,h,i,j=[],k=[],l=[],m=function(){return r(l)},n=function(a){m()?m().children.push(a):k.push(a)},p=function(b){return m()&&(d=s.bbcodes[m().name])&&d.closedBy&&a.inArray(b,d.closedBy)>-1};c=b.shift();){switch(i=b[0],c.type){case t.open:p(c.name)&&l.pop(),n(c),d=s.bbcodes[c.name],d&&d.isSelfClosing||!d.closedBy&&!o(c.name,t.close,b)?d&&d.isSelfClosing||(c.type=t.content):l.push(c);break;case t.close:if(m()&&c.name!==m().name&&p("/"+c.name)&&l.pop(),m()&&c.name===m().name){m().closing=c,l.pop()}else if(o(c.name,t.open,l)){for(;e=l.pop();){if(e.name===c.name){e.closing=c;break};f=e.clone(),j.length>1&&f.children.push(r(j)),j.push(f)};for(n(r(j)),g=j.length;g--;)l.push(j[g]);j.length=0}else c.type=t.content,n(c);break;case t.newline:m()&&i&&p((i.type===t.close?"/":"")+i.name)&&(i.type!==t.close||i.name!==m().name)&&(d=s.bbcodes[m().name],d&&d.breakAfter?l.pop():d&&d.isInline===!1&&s.opts.breakAfterBlock&&d.breakAfter!==!1&&l.pop()),n(c);break;default:n(c)};h=c};return k},h=function(a,b,c){var d,e,f,g,i,j,k,l,m=a.length,n=m;for(b&&(g=s.bbcodes[b.name]);n--;)if(d=a[n])if(d.type===t.newline){if(e=n>0?a[n-1]:null,f=m-1>n?a[n+1]:null,l=!1,!c&&g&&g.isSelfClosing!==!0&&(e?j||f||(g.isInline===!1&&s.opts.breakEndBlock&&g.breakEnd!==!1&&(l=!0),g.breakEnd&&(l=!0),j=l):(g.isInline===!1&&s.opts.breakStartBlock&&g.breakStart!==!1&&(l=!0),g.breakStart&&(l=!0))),e&&e.type===t.open&&(i=s.bbcodes[e.name])&&(c?i.isInline===!1&&(l=!0):(i.isInline===!1&&s.opts.breakAfterBlock&&i.breakAfter!==!1&&(l=!0),i.breakAfter&&(l=!0))),!c&&!k&&f&&f.type===t.open&&(i=s.bbcodes[f.name])&&(i.isInline===!1&&s.opts.breakBeforeBlock&&i.breakBefore!==!1&&(l=!0),i.breakBefore&&(l=!0),k=l,l)){a.splice(n,1);continue};l&&a.splice(n,1),k=!1}else d.type===t.open&&h(d.children,d,c)},i=function(b,c,d,e){var f,g,h,j,k,l,m=function(a){var b=s.bbcodes[a.name];return!b||b.isInline!==!1};for(c=c||[],e=e||b,g=0;g<b.length;g++)if((f=b[g])&&f.type===t.open){if(!m(f)&&d&&(h=r(c),l=h.splitAt(f),k=c.length>1?c[c.length-2].children:e,(j=a.inArray(h,k))>-1))return l.children.splice(a.inArray(f,l.children),1),k.splice(j+1,0,f,l),void(0);c.push(f),i(f.children,c,d||m(f),e),c.pop(f)}},l=function(a,b){for(var c,d,e=a.length;e--;)(c=a[e])&&(j(b,c)||(c.name=null,c.type=t.content,j(b,c)?(d=[e+1,0].concat(c.children),c.closing&&(c.closing.name=null,c.closing.type=t.content,d.push(c.closing)),e+=d.length-1,Array.prototype.splice.apply(a,d)):b.children.splice(e,1)),c.type===t.open&&l(c.children,c))},k=function(b){var c,d,e,f=b.length;for(e=function(a){for(var b=a.length;b--;){if(a[b].type===t.open)return!1;if(a[b].type===t.close)return!1;if(a[b].type===t.content&&a[b].val&&/\S|\u00A0/.test(a[b].val))return!1};return!0};f--;)(c=b[f])&&c.type===t.open&&(d=s.bbcodes[c.name],k(c.children),e(c.children)&&d&&!d.isSelfClosing&&!d.allowsEmpty&&b.splice.apply(b,a.merge([f,1],c.children)))},s.toHTML=function(a,b){return m(s.parse(a,b),!0)},m=function(b,d){var e,f,g,h,i,j,k,l,n=[];for(k=function(a){return(!a||("undefined"!=typeof a.isHtmlInline?a.isHtmlInline:a.isInline))!==!1};b.length>0;)if(e=b.shift()){if(e.type===t.open){l=e.children[e.children.length-1]||{},f=s.bbcodes[e.name],i=d&&k(f),g=m(e.children,!1),f&&f.html?(k(f)||!k(s.bbcodes[l.name])||f.isPreFormatted||f.skipLastLineBreak||a.sceditor.ie||(g+="<br />"),h=a.isFunction(f.html)?f.html.call(s,e,e.attrs,g):a.sceditor.plugins.bbcode.formatString(f.html,g)):h=e.val+g+(e.closing?e.closing.val:"")}else{if(e.type===t.newline){if(!d){n.push("<br />");continue};j||(n.push("<div>"),(c.documentMode&&c.documentMode<8||a.sceditor.ie<8)&&n.push("")),a.sceditor.ie||n.push("<br />"),b.length||n.push("<br />"),n.push("</div>\n"),j=!1;continue};i=d,h=a.sceditor.escapeEntities(e.val)};i&&!j?(n.push("<div>"),j=!0):!i&&j&&(n.push("</div>\n"),j=!1),n.push(h)};return j&&n.push("</div>\n"),n.join("")},s.toBBCode=function(a,b){return n(s.parse(a,b))},n=function(b){for(var c,d,e,f,g,h,i,j,k,l,m=[];b.length>0;)if(c=b.shift())if(e=s.bbcodes[c.name],f=!(!e||e.isInline!==!1),g=e&&e.isSelfClosing,i=f&&s.opts.breakBeforeBlock&&e.breakBefore!==!1||e&&e.breakBefore,j=f&&!g&&s.opts.breakStartBlock&&e.breakStart!==!1||e&&e.breakStart,k=f&&s.opts.breakEndBlock&&e.breakEnd!==!1||e&&e.breakEnd,l=f&&s.opts.breakAfterBlock&&e.breakAfter!==!1||e&&e.breakAfter,h=(e?e.quoteType:null)||s.opts.quoteType||a.sceditor.BBCodeParser.QuoteType.auto,e||c.type!==t.open){if(c.type===t.open){if(i&&m.push("\n"),m.push("["+c.name),c.attrs){c.attrs.defaultattr&&(m.push("="+p(c.attrs.defaultattr,h,"defaultattr")),delete c.attrs.defaultattr);for(d in c.attrs)c.attrs.hasOwnProperty(d)&&m.push(" "+d+"="+p(c.attrs[d],h,d))};m.push("]"),j&&m.push("\n"),c.children&&m.push(n(c.children)),g||e.excludeClosing||(k&&m.push("\n"),m.push("[/"+c.name+"]")),l&&m.push("\n"),c.closing&&g&&m.push(c.closing.val)}else m.push(c.val)}else m.push(c.val),c.children&&m.push(n(c.children)),c.closing&&m.push(c.closing.val);return m.join("")},p=function(b,c,d){var e=a.sceditor.BBCodeParser.QuoteType,f=/\s|=/.test(b);return a.isFunction(c)?c(b,d):c===e.never||c===e.auto&&!f?b:'"'+b.replace("\\","\\\\").replace('"','\\"')+'"'},r=function(a){return a.length?a[a.length-1]:null},q=function(a){return a.toLowerCase()},d()},a.sceditor.BBCodeParser.QuoteType={always:1,never:2,auto:3},a.sceditor.BBCodeParser.defaults={breakBeforeBlock:!1,breakStartBlock:!1,breakEndBlock:!1,breakAfterBlock:!0,removeEmptyTags:!0,fixInvalidNesting:!0,fixInvalidChildren:!0,quoteType:a.sceditor.BBCodeParser.QuoteType.auto},a.sceditorBBCodePlugin=a.sceditor.plugins.bbcode=function(){var b,d,e,f,g,h,i,j=this;f=a.sceditor.plugins.bbcode.formatString,j.bbcodes=a.sceditor.plugins.bbcode.bbcodes,j.stripQuotes=a.sceditor.plugins.bbcode.stripQuotes;var k={},l={},m={ul:["li","ol","ul"],ol:["li","ol","ul"],table:["tr"],tr:["td","th"],code:["br","p","div"]},n={};j.init=function(){j.opts=this.opts,b(),h(this),this.toBBCode=j.signalToSource,this.fromBBCode=j.signalToWysiwyg},h=function(b){var c=a.sceditor.command.get,d={bold:{txtExec:["[b]","[/b]"]},italic:{txtExec:["[i]","[/i]"]},underline:{txtExec:["[u]","[/u]"]},strike:{txtExec:["[s]","[/s]"]},subscript:{txtExec:["[sub]","[/sub]"]},superscript:{txtExec:["[sup]","[/sup]"]},left:{txtExec:["[left]","[/left]"]},center:{txtExec:["[center]","[/center]"]},right:{txtExec:["[right]","[/right]"]},justify:{txtExec:["[justify]","[/justify]"]},font:{txtExec:function(a){var b=this;c("font")._dropDown(b,a,function(a){b.insertText("[font="+a+"]","[/font]")})}},size:{txtExec:function(a){var b=this;c("size")._dropDown(b,a,function(a){b.insertText("[size="+a+"]","[/size]")})}},color:{txtExec:function(a){var b=this;c("color")._dropDown(b,a,function(a){b.insertText("[color="+a+"]","[/color]")})}},bulletlist:{txtExec:function(c,d){var e="";a.each(d.split(/\r?\n/),function(){e+=(e?"\n":"")+"[li]"+this+"[/li]"}),b.insertText("[ul]\n"+e+"\n[/ul]")}},orderedlist:{txtExec:function(c,d){var e="";a.each(d.split(/\r?\n/),function(){e+=(e?"\n":"")+"[li]"+this+"[/li]"}),a.sceditor.plugins.bbcode.bbcode.get(""),b.insertText("[ol]\n"+e+"\n[/ol]")}},table:{txtExec:["[table][tr][td]","[/td][/tr][/table]"]},horizontalrule:{txtExec:["[hr]"]},code:{txtExec:["[code]","[/code]"]},image:{txtExec:function(a,b){var c=prompt(this._("Enter the image URL:"),b);c&&this.insertText("[img]"+c+"[/img]")}},email:{txtExec:function(a,b){var c=b&&b.indexOf("@")>-1?null:b,d=prompt(this._("Enter the e-mail address:"),c?"":b),e=prompt(this._("Enter the displayed text:"),c||d)||d;d&&this.insertText("[email="+d+"]"+e+"[/email]")}},link:{txtExec:function(b,c){var d=/^[a-z]+:\/\//i.test(a.trim(c))?null:c,e=prompt(this._("Enter URL:"),d?"http://":a.trim(c)),f=prompt(this._("Enter the displayed text:"),d||e)||e;e&&this.insertText("[url="+e+"]"+f+"[/url]")}},quote:{txtExec:["[quote]","[/quote]"]},youtube:{txtExec:function(a){var b=this;c("youtube")._dropDown(b,a,function(a){b.insertText("[youtube]"+a+"[/youtube]")})}},rtl:{txtExec:["[rtl]","[/rtl]"]},ltr:{txtExec:["[ltr]","[/ltr]"]}};b.commands=a.extend(!0,{},d,b.commands)},b=function(){a.each(j.bbcodes,function(b){j.bbcodes[b].tags&&a.each(j.bbcodes[b].tags,function(a,c){var d=j.bbcodes[b].isInline===!1;k[a]=k[a]||{},k[a][d]=k[a][d]||{},k[a][d][b]=c}),j.bbcodes[b].styles&&a.each(j.bbcodes[b].styles,function(a,c){var d=j.bbcodes[b].isInline===!1;l[d]=l[d]||{},l[d][a]=l[d][a]||{},l[d][a][b]=c})})},g=function(b,c){var d,e,f,g,h,i=b.style;return i?(n[c]||(n[c]=a.camelCase(c)),h=n[c],"text-align"===c?(d=a(b),f=i.direction,g=i[h]||d.css(c),d.parent().css(c)===g||"block"!==d.css("display")||d.is("hr")||d.is("th")||(e=g),f&&e&&(/right/i.test(e)&&"rtl"===f||/left/i.test(e)&&"ltr"===f)?null:e):i[h]):null},d=function(b,c,d){var e;return d=!!d,l[d]?(a.each(l[d],function(d,h){e=g(b[0],d),e&&g(b.parent()[0],d)!==e&&a.each(h,function(d,g){(!g||a.inArray(e.toString(),g)>-1)&&(c=a.isFunction(j.bbcodes[d].format)?j.bbcodes[d].format.call(j,b,c):f(j.bbcodes[d].format,c))})}),c):c},e=function(b,c,d){var e,g=b[0],h=g.nodeName.toLowerCase();if(d=!!d,k[h]&&k[h][d]&&a.each(k[h][d],function(d,g){(!g||(e=!1,a.each(g,function(c,d){return!b.attr(c)||d&&a.inArray(b.attr(c),d)<0?void(0):(e=!0,!1)}),e))&&(c=a.isFunction(j.bbcodes[d].format)?j.bbcodes[d].format.call(j,b,c):f(j.bbcodes[d].format,c))}),d&&(!a.sceditor.dom.isInline(g,!0)||"br"===h)){for(var i=g.parentNode,l=i.lastChild,m=g.previousSibling,n=a.sceditor.dom.isInline(i,!0);m&&a(m).hasClass("sceditor-ignore");)m=m.previousSibling;for(;a(l).hasClass("sceditor-ignore");)l=l.previousSibling;(n||l!==g||"li"===h||"br"===h&&a.sceditor.ie)&&(c+="\n"),"br"!==h&&m&&"br"!==m.nodeName.toLowerCase()&&a.sceditor.dom.isInline(m,!0)&&(c="\n"+c)};return c},j.signalToSource=function(b,d){var e,f,g=new a.sceditor.BBCodeParser(j.opts.parserOptions);return d||("string"==typeof b?(e=a("<div />").css("visibility","hidden").appendTo(c.body).html(b),d=e):d=a(b)),d&&d.jquery?(a.sceditor.dom.removeWhiteSpace(d[0]),f=j.elementToBbcode(d),e&&e.remove(),f=g.toBBCode(f,!0),j.opts.bbcodeTrim&&(f=a.trim(f)),f):""},j.elementToBbcode=function(b){return function c(b,f){var g="";return a.sceditor.dom.traverse(b,function(b){var h=a(b),i="",j=b.nodeType,k=b.nodeName.toLowerCase(),l=m[k],n=b.firstChild,o=!0;if("object"==typeof f&&(o=a.inArray(k,f)>-1,h.is("img")&&h.data("sceditor-emoticon")&&(o=!0),o||(l=f)),3===j||1===j)if(1===j){if(h.hasClass("sceditor-ignore"))return;if(h.hasClass("sceditor-nlf")&&(!n||!a.sceditor.ie&&1===b.childNodes.length&&/br/i.test(n.nodeName)))return;"iframe"!==k&&(i=c(b,l)),o?("code"!==k&&(i=d(h,i),i=e(h,i),i=d(h,i,!0)),g+=e(h,i,!0)):g+=i}else !b.wholeText||b.previousSibling&&3===b.previousSibling.nodeType?b.wholeText||(g+=b.nodeValue):g+=0===h.parents("code").length?b.wholeText.replace(/ +/g," "):b.wholeText},!1,!0),g}(b[0])},j.signalToWysiwyg=function(b,c){var d=new a.sceditor.BBCodeParser(j.opts.parserOptions),e=d.toHTML(j.opts.bbcodeTrim?a.trim(b):b);return c?i(e):e},i=function(b){var d,e,f,g=a("<div />").hide().appendTo(c.body),h=g[0];return f=function(b,d){if(!a.sceditor.dom.hasStyling(b)){if(a.sceditor.ie||1!==b.childNodes.length||!a(b.firstChild).is("br"))for(;e=b.firstChild;)h.insertBefore(e,b);if(d){var f=h.lastChild;b!==f&&a(f).is("div")&&b.nextSibling===f&&h.insertBefore(c.createElement("br"),b)};h.removeChild(b)}},h.innerHTML=b.replace(/<\/div>\n/g,"</div>"),(d=h.firstChild)&&a(d).is("div")&&f(d,!0),(d=h.lastChild)&&a(d).is("div")&&f(d),h=h.innerHTML,g.remove(),h}},a.sceditor.plugins.bbcode.stripQuotes=function(a){return a?a.replace(/\\(.)/g,"$1").replace(/^(["'])(.*?)\1$/,"$2"):a},a.sceditor.plugins.bbcode.formatString=function(){var a=arguments;return a[0].replace(/\{(\d+)\}/g,function(b,c){return"undefined"!=typeof a[c-0+1]?a[c-0+1]:"{"+c+"}"})};var d=a.sceditor.plugins.bbcode.normaliseColour=function(a){var b,c;return c=function(a){return a=parseInt(a,10),isNaN(a)?"00":(a=Math.max(0,Math.min(a,255)).toString(16),a.length<2?"0"+a:a)},a=a||"#000",(b=a.match(/rgb\((\d{1,3}),\s*?(\d{1,3}),\s*?(\d{1,3})\)/i))?"#"+c(b[1])+c(b[2]-0)+c(b[3]-0):(b=a.match(/#([0-f])([0-f])([0-f])\s*?$/i))?"#"+b[1]+b[1]+b[2]+b[2]+b[3]+b[3]:a};a.sceditor.plugins.bbcode.bbcodes={b:{tags:{b:null,strong:null},styles:{"font-weight":["bold","bolder","401","700","800","900"]},format:"[b]{0}[/b]",html:"<strong>{0}</strong>"},i:{tags:{i:null,em:null},styles:{"font-style":["italic","oblique"]},format:"[i]{0}[/i]",html:"<em>{0}</em>"},u:{tags:{u:null},styles:{"text-decoration":["underline"]},format:"[u]{0}[/u]",html:"<u>{0}</u>"},s:{tags:{s:null,strike:null},styles:{"text-decoration":["line-through"]},format:"[s]{0}[/s]",html:"<s>{0}</s>"},sub:{tags:{sub:null},format:"[sub]{0}[/sub]",html:"<sub>{0}</sub>"},sup:{tags:{sup:null},format:"[sup]{0}[/sup]",html:"<sup>{0}</sup>"},font:{tags:{font:{face:null}},styles:{"font-family":null},quoteType:a.sceditor.BBCodeParser.QuoteType.never,format:function(a,b){var c;return"font"===a[0].nodeName.toLowerCase()&&(c=a.attr("face"))||(c=a.css("font-family")),"[font="+this.stripQuotes(c)+"]"+b+"[/font]"},html:function(a,b,c){return'<font face="'+b.defaultattr+'">'+c+"</font>"}},size:{tags:{font:{size:null}},styles:{"font-size":null},format:function(a,b){var c=a.attr("size"),d=1;return c||(c=a.css("fontSize")),c.indexOf("px")>-1?(c=c.replace("px","")-0,c>12&&(d=2),c>15&&(d=3),c>17&&(d=4),c>23&&(d=5),c>31&&(d=6),c>47&&(d=7)):d=c,"[size="+d+"]"+b+"[/size]"},html:function(a,b,c){return'<font size="'+b.defaultattr+'">'+c+"</font>"}},color:{tags:{font:{color:null}},styles:{color:null},quoteType:a.sceditor.BBCodeParser.QuoteType.never,format:function(a,b){var c,e=a[0];return"font"===e.nodeName.toLowerCase()&&(c=a.attr("color"))||(c=e.style.color||a.css("color")),"[color="+d(c)+"]"+b+"[/color]"},html:function(a,b,c){return'<font color="'+d(b.defaultattr)+'">'+c+"</font>"}},ul:{tags:{ul:null},breakStart:!0,isInline:!1,skipLastLineBreak:!0,format:"[ul]{0}[/ul]",html:"<ul>{0}</ul>"},list:{breakStart:!0,isInline:!1,skipLastLineBreak:!0,html:"<ul>{0}</ul>"},ol:{tags:{ol:null},breakStart:!0,isInline:!1,skipLastLineBreak:!0,format:"[ol]{0}[/ol]",html:"<ol>{0}</ol>"},li:{tags:{li:null},isInline:!1,closedBy:["/ul","/ol","/list","*","li"],format:"[li]{0}[/li]",html:"<li>{0}</li>"},"*":{isInline:!1,closedBy:["/ul","/ol","/list","*","li"],html:"<li>{0}</li>"},table:{tags:{table:null},isInline:!1,isHtmlInline:!0,skipLastLineBreak:!0,format:"[table]{0}[/table]",html:"<table>{0}</table>"},tr:{tags:{tr:null},isInline:!1,skipLastLineBreak:!0,format:"[tr]{0}[/tr]",html:"<tr>{0}</tr>"},th:{tags:{th:null},allowsEmpty:!0,isInline:!1,format:"[th]{0}[/th]",html:"<th>{0}</th>"},td:{tags:{td:null},allowsEmpty:!0,isInline:!1,format:"[td]{0}[/td]",html:"<td>{0}</td>"},emoticon:{allowsEmpty:!0,tags:{img:{src:null,"data-sceditor-emoticon":null}},format:function(a,b){return a.data("sceditor-emoticon")+b},html:"{0}"},hr:{tags:{hr:null},allowsEmpty:!0,isSelfClosing:!0,isInline:!1,format:"[hr]{0}",html:"<hr />"},img:{allowsEmpty:!0,tags:{img:{src:null}},quoteType:a.sceditor.BBCodeParser.QuoteType.never,format:function(a,b){var c,d,e="",f=a[0],g=function(a){return f.style?f.style[a]:null};return a.attr("data-sceditor-emoticon")?b:(c=a.attr("width")||g("width"),d=a.attr("height")||g("height"),(f.complete&&(c||d)||c&&d)&&(e="="+a.width()+"x"+a.height()),"[img"+e+"]"+a.attr("src")+"[/img]")},html:function(a,b,c){var d,e="";return"undefined"!=typeof b.width&&(e+=' width="'+b.width+'"'),"undefined"!=typeof b.height&&(e+=' height="'+b.height+'"'),b.defaultattr&&(d=b.defaultattr.split(/x/i),e=' width="'+d[0]+'" height="'+(2===d.length?d[1]:d[0])+'"'),"<img"+e+' src="'+c+'" />'}},url:{allowsEmpty:!0,tags:{a:{href:null}},quoteType:a.sceditor.BBCodeParser.QuoteType.never,format:function(a,b){var c=a.attr("href");return"mailto:"===c.substr(0,7)?'[email="'+c.substr(7)+'"]'+b+"[/email]":"[url="+decodeURI(c)+"]"+b+"[/url]"},html:function(a,b,c){return'<a href="'+encodeURI(b.defaultattr||c)+'">'+c+"</a>"}},email:{quoteType:a.sceditor.BBCodeParser.QuoteType.never,html:function(a,b,c){return'<a href="mailto:'+(b.defaultattr||c)+'">'+c+"</a>"}},quote:{tags:{blockquote:null},isInline:!1,quoteType:a.sceditor.BBCodeParser.QuoteType.never,format:function(b,c){var d="",e=a(b),f=e.children("cite").first();return(1===f.length||e.data("author"))&&(d=f.text()||e.data("author"),e.data("author",d),f.remove(),c=this.elementToBbcode(a(b)),d="="+d,e.prepend(f)),"[quote"+d+"]"+c+"[/quote]"},html:function(a,b,c){return b.defaultattr&&(c="<cite>"+b.defaultattr+"</cite>"+c),"<blockquote>"+c+"</blockquote>"}},code:{tags:{code:null},isInline:!1,allowedChildren:["#","#newline"],format:"[code]{0}[/code]",html:"<code>{0}</code>"},left:{styles:{"text-align":["left","-webkit-left","-moz-left","-khtml-left"]},isInline:!1,format:"[left]{0}[/left]",html:'<div align="left">{0}</div>'},center:{styles:{"text-align":["center","-webkit-center","-moz-center","-khtml-center"]},isInline:!1,format:"[center]{0}[/center]",html:'<div align="center">{0}</div>'},right:{styles:{"text-align":["right","-webkit-right","-moz-right","-khtml-right"]},isInline:!1,format:"[right]{0}[/right]",html:'<div align="right">{0}</div>'},justify:{styles:{"text-align":["justify","-webkit-justify","-moz-justify","-khtml-justify"]},isInline:!1,format:"[justify]{0}[/justify]",html:'<div align="justify">{0}</div>'},youtube:{allowsEmpty:!0,tags:{iframe:{"data-youtube-id":null}},format:function(a,b){return a=a.attr("data-youtube-id"),a?"[youtube]"+a+"[/youtube]":b},html:'<iframe width="560" height="315" src="http://www.youtube.com/embed/{0}?wmode=opaque" data-youtube-id="{0}" frameborder="0" allowfullscreen></iframe>'},rtl:{styles:{direction:["rtl"]},format:"[rtl]{0}[/rtl]",html:'<div style="direction: rtl">{0}</div>'},ltr:{styles:{direction:["ltr"]},format:"[ltr]{0}[/ltr]",html:'<div style="direction: ltr">{0}</div>'},ignore:{}},a.sceditor.plugins.bbcode.bbcode={get:function(b){return a.sceditor.plugins.bbcode.bbcodes[b]||null},set:function(b,c){var d=a.sceditor.plugins.bbcode.bbcodes;return b&&c?(c=a.extend(d[b]||{},c),c.remove=function(){delete d[b]},d[b]=c,this):!1},rename:function(b,c){var d=a.sceditor.plugins.bbcode.bbcodes;return b in d?(d[c]=d[b],delete d[b],this):!1},remove:function(b){var c=a.sceditor.plugins.bbcode.bbcodes;return b in c&&delete c[b],this}},a.fn.sceditorBBCodePlugin=function(b){return b=b||{},a.isPlainObject(b)&&(b.plugins=(b.plugins?b.plugins:"")+"bbcode"),this.sceditor(b)}}(jQuery,window,document);(function($){var extensionMethods={addEvent:function(id,event,func){var current_event=event;$('#'+id).parent().on(event,'textarea',func);var oIframe=$('#'+id).parent().find('iframe')[0],oIframeWindow=oIframe.contentWindow;if(oIframeWindow!==null&&oIframeWindow.document){var oIframeDoc=oIframeWindow.document,oIframeBody=oIframeDoc.body;$(oIframeBody).on(event,func)}},InsertText:function(text,bClear){var bIsSource=this.inSourceMode();if(!bIsSource)this.toggleSourceMode();var current_value=this.getSourceEditorValue(false),iEmpty=current_value.length;current_value=bClear?text+"\n":current_value+(iEmpty>0?"\n":"")+text+"\n";this.setSourceEditorValue(current_value);if(!bIsSource)this.toggleSourceMode()},getText:function(filter){var current_value='';if(this.inSourceMode()){current_value=this.getSourceEditorValue(false)}else current_value=this.getWysiwygEditorValue(filter);return current_value},appendEmoticon:function(code,emoticon){if(emoticon===''){line.append($('<br />'))}else line.append($('<img />').attr({src:emoticon.url||emoticon,alt:code,title:emoticon.tooltip||emoticon}).click(function(e){var start='',end='';if(base.opts.emoticonsCompat){start='<span> ';end=' </span>'};if(base.inSourceMode()){base.sourceEditorInsertText(' '+$(this).attr('alt')+' ')}else base.wysiwygEditorInsertHtml(start+'<img src="'+$(this).attr("src")+'" data-sceditor-emoticon="'+$(this).attr('alt')+'" />'+end);e.preventDefault()}));if(line.children().length>0)content.append(line);$(".sceditor-toolbar").append(content)},storeLastState:function(){this.wasSource=this.inSourceMode()},setTextMode:function(){if(!this.inSourceMode())this.toggleSourceMode()},createPermanentDropDown:function(){var emoticons=$.extend({},this.opts.emoticons.dropdown),popup_exists=false;base=this;content=$('<div class="sceditor-insertemoticon" />'),line=$('<div id="sceditor-smileycontainer" />');for(smiley_popup in this.opts.emoticons.popup){popup_exists=true;break};if(popup_exists){this.opts.emoticons.more=this.opts.emoticons.popup;moreButton=$('<div class="sceditor-more" />').text(this._('More')).click(function(){var popup_box=$('.sceditor-smileyPopup');if(popup_box.length>0){popup_box.fadeIn('fast')}else{var emoticons=$.extend({},base.opts.emoticons.popup),titlebar=$('<div class="category_header sceditor-popup-grip"/>');popupContent=$('<div id="sceditor-popup" />');line=$('<div id="sceditor-popup-smiley" />');popupContent.append(titlebar);$.each(emoticons,base.appendEmoticon);if(line.children().length>0)popupContent.append(line);closeButton=$('<div id="sceditor-popup-close" />').text('['+base._('Close')+']').click(function(){$(".sceditor-smileyPopup").fadeOut('fast')});if(typeof closeButton!=="undefined")popupContent.append(closeButton);if(base.ieUnselectable!==false){content=$(content);content.find(':not(input,textarea)').filter(function(){return this.nodeType===1}).attr('unselectable','on')};popupContent=$('<div class="sceditor-dropdown sceditor-smileyPopup" />').append(popupContent);$dropdown=popupContent.appendTo('body');dropdownIgnoreLastClick=true;$dropdown.css({top:$(window).height()*0.2,left:$(window).width()*0.5-($dropdown.find('#sceditor-popup-smiley').width()/2)});$('.sceditor-smileyPopup').draggable();$dropdown.click(function(e){e.stopPropagation()})}})};$.each(emoticons,base.appendEmoticon);if(typeof moreButton!=="undefined")content.append(moreButton)}};$.extend(true,$.sceditor.prototype,extensionMethods)})(jQuery);$.sceditor.command.set('spoiler',{exec:function(){this.insert('[spoiler]','[/spoiler]')},txtExec:['[spoiler]','[/spoiler]'],tooltip:'Insert Spoiler'}).set('footnote',{state:function(){var currentNode=this.currentNode();return $(currentNode).is('aside')||$(currentNode).parents('aside').length>0?1:0},exec:function(){this.insert('[footnote] ','[/footnote]',false)},txtExec:['[footnote]','[/footnote]'],tooltip:'Insert Footnote'}).set('tt',{state:function(){var currentNode=this.currentNode();return $(currentNode).is('span.tt')||$(currentNode).parents('span.tt').length>0?1:0},exec:function(){var editor=this,currentNode=this.currentNode();if(!$(currentNode).is('span.tt')&&$(currentNode).parents('span.tt').length===0){this.insert('<span class="tt">','</span>',false)}else return},txtExec:['[tt]','[/tt]'],tooltip:'Teletype'}).set('pre',{state:function(){var currentNode=this.currentNode();return $(currentNode).is('pre')||$(currentNode).parents('pre').length>0?1:0},exec:function(){var editor=this,currentNode=this.currentNode();if(!$(currentNode).is('pre')&&$(currentNode).parents('pre').length===0){this.insert('<pre>','</pre>',false)}else return},txtExec:['[pre]','[/pre]'],tooltip:'Preformatted Text'}).set('bulletlist',{txtExec:['[list]\n[li]','[/li]\n[li][/li]\n[/list]']}).set('orderedlist',{txtExec:['[list type=decimal]\n[li]','[/li]\n[li][/li]\n[/list]']}).set('table',{txtExec:['[table]\n[tr]\n[td]','[/td]\n[/tr]\n[/table]']});$.sceditor.plugins.bbcode.bbcode.set('tt',{tags:{tt:null,span:{'class':['tt']}},format:'[tt]{0}[/tt]',html:'<span class="tt">{0}</span>'}).set('pre',{tags:{pre:null},isInline:false,format:'[pre]{0}[/pre]',html:'<pre>{0}</pre>'}).set('footnote',{tags:{aside:null},format:'[footnote]{0}[/footnote]',html:'<aside>{0}</aside>'}).set('code',{tags:{code:null},isInline:false,allowedChildren:['#','#newline'],format:function(element,content){var from='';if($(element[0]).hasClass('php'))return'[php]'+content.replace('&#91;','[')+'[/php]';if($(element).children("cite:first").length===1){from=$(element).children("cite:first").text();$(element).attr({from:from.php_htmlspecialchars()});from='='+from;content='';$(element).children("cite:first").remove();content=this.elementToBbcode($(element))}else if(typeof $(element).attr('from')!=="undefined")from='='+$(element).attr('from').php_unhtmlspecialchars();return'[code'+from+']'+content.replace('&#91;','[')+'[/code]'},html:function(element,attrs,content){var from='';if(typeof attrs.defaultattr!=="undefined")from='<cite>'+attrs.defaultattr+'</cite>';return'<code>'+from+content.replace('[','&#91;')+'</code>'}}).set('quote',{tags:{blockquote:null,cite:null},isInline:false,format:function(element,content){var author='',date='',link='',$elm=$(element);if(element[0].tagName.toLowerCase()==='cite')return'';if($elm.attr('author'))author=' author='+$elm.attr('author').php_unhtmlspecialchars();if($elm.attr('date'))date=' date='+$elm.attr('date');if($elm.attr('link'))link=' link='+$elm.attr('link');return'[quote'+author+date+link+']'+content+'[/quote]'},attrs:function(){return['author','date','link']},html:function(element,attrs,content){var attr_author='',sAuthor='',attr_date='',sDate='',attr_link='',sLink='';if(typeof attrs.author!=="undefined"){attr_author=attrs.author;sAuthor=bbc_quote_from+': '+attr_author};for(var key in attrs)if(key.substr(0,4)==='link'&&attrs.hasOwnProperty(key)){attr_link=key.length>4?key.substr(5)+'='+attrs[key]:attrs[key];sLink=attr_link.substr(0,7)==='http://'?attr_link:elk_scripturl+'?'+attr_link;sAuthor=sAuthor===''?'<a href="'+sLink+'">'+bbc_quote_from+': '+sLink+'</a>':'<a href="'+sLink+'">'+sAuthor+'</a>'};if(typeof attrs.date!=="undefined"){attr_date=attrs.date;sDate='<date timestamp="'+attr_date+'">'+new Date(attrs.date*1e3)+'</date>'};if(sAuthor===''&&sDate===''){sAuthor=bbc_quote}else sAuthor+=sDate!==''?' '+bbc_search_on:'';content='<blockquote author="'+attr_author+'" link="'+attr_link+'" date="'+attr_date+'"><cite>'+sAuthor+' '+sDate+'</cite>'+content+'</blockquote>';return content}}).set('img',{tags:{img:{src:null}},allowsEmpty:true,quoteType:$.sceditor.BBCodeParser.QuoteType.never,format:function(element,content){var attribs='',style=function(name){return element.style?element.style[name]:null};if(typeof element.attr('data-sceditor-emoticon')!=="undefined")return content;if(element.attr('width')||style('width'))attribs+=" width="+$(element).width();if(element.attr('height')||style('height'))attribs+=" height="+$(element).height();return'[img'+attribs+']'+element.attr('src')+'[/img]'},html:function(token,attrs,content){var parts,attribs='';if(typeof attrs.width!=="undefined")attribs+=' width="'+attrs.width+'"';if(typeof attrs.height!=="undefined")attribs+=' height="'+attrs.height+'"';return'<img'+attribs+' src="'+content+'" />'}}).set('list',{breakStart:true,isInline:false,skipLastLineBreak:true,allowedChildren:['*','li'],html:function(element,attrs,content){var style='',code='ul';if(attrs.type)style='style="list-style-type: '+attrs.type+'"';return'<'+code+' '+style+'>'+content+'</'+code+'>'}}).set('li',{breakAfter:true}).set('ul',{tags:{ul:null},breakStart:true,format:function(element,content){if($(element[0]).css('list-style-type')==='disc'){return'[list]'+content+'[/list]'}else return'[list type='+$(element[0]).css('list-style-type')+']'+content+'[/list]'},isInline:false,skipLastLineBreak:true,html:'<ul>{0}</ul>'}).set('ol',{tags:{ol:null},breakStart:true,isInline:false,skipLastLineBreak:true,format:'[list type=decimal]{0}[/list]',html:'<ol>{0}</ol>'});var bPost
function previewControl(){bPost=false;switch(preview_area){case'pm':previewPM();break;case'news':previewNews();break;case'post':bPost=true;previewPost();break};return false}
function previewPost(){var textFields=['subject',post_box_name,elk_session_var,'icon','guestname','email','evtitle','question','topic'],numericFields=['board','topic','last_msg','eventid','calendar','year','month','day','poll_max_votes','poll_expire','poll_change_vote','poll_hide'],checkboxFields=['ns'],x=[];x=getFields(textFields,numericFields,checkboxFields,form_name);sendXMLDocument(elk_prepareScriptUrl(elk_scripturl)+'action=post2'+(current_board?';board='+current_board:'')+(make_poll?';poll':'')+';preview;'+elk_session_var+'='+elk_session_id+';xml',x.join('&'),onDocSent);document.getElementById('preview_section').style.display='';document.getElementById('preview_subject').innerHTML=txt_preview_title;document.getElementById('preview_body').innerHTML=txt_preview_fetch;return false}
function previewPM(){var textFields=['subject',post_box_name,'to','bcc'],numericFields=['recipient_to[]','recipient_bcc[]'],checkboxFields=['outbox'],x=[];x=getFields(textFields,numericFields,checkboxFields,form_name);sendXMLDocument(elk_prepareScriptUrl(elk_scripturl)+'action=pm;sa=send2;preview;xml',x.join('&'),onDocSent);document.getElementById('preview_section').style.display='';document.getElementById('preview_subject').innerHTML=txt_preview_title;document.getElementById('preview_body').innerHTML=txt_preview_fetch;return false}
function previewNews(){var textFields=['subject',post_box_name],numericFields=[],checkboxFields=['send_html','send_pm'],x=[];x=getFields(textFields,numericFields,checkboxFields,form_name);x[x.length]='item=newsletterpreview';sendXMLDocument(elk_prepareScriptUrl(elk_scripturl)+'action=xmlpreview;xml',x.join('&'),onDocSent);document.getElementById('preview_section').style.display='';document.getElementById('preview_subject').innerHTML=txt_preview_title;document.getElementById('preview_body').innerHTML=txt_preview_fetch;return false}
function getFields(textFields,numericFields,checkboxFields,form_name){var fields=[],i=0,n=0;for(i=0,n=textFields.length;i<n;i++)if(textFields[i]in document.forms[form_name])if(textFields[i]==post_box_name&&$('#'+post_box_name).data('sceditor')!==undefined){fields[fields.length]=textFields[i]+'='+$('#'+post_box_name).data('sceditor').getText().replace(/&#/g,'&#38;#').php_to8bit().php_urlencode();fields[fields.length]='message_mode='+$("#message").data("sceditor").inSourceMode()}else fields[fields.length]=textFields[i]+'='+document.forms[form_name][textFields[i]].value.replace(/&#/g,'&#38;#').php_to8bit().php_urlencode();for(i=0,n=numericFields.length;i<n;i++)if(numericFields[i]in document.forms[form_name])if('value'in document.forms[form_name][numericFields[i]]){fields[fields.length]=numericFields[i]+'='+parseInt(document.forms[form_name].elements[numericFields[i]].value)}else for(var j=0,num=document.forms[form_name][numericFields[i]].length;j<num;j++)fields[fields.length]=numericFields[i]+'='+parseInt(document.forms[form_name].elements[numericFields[i]][j].value);for(i=0,n=checkboxFields.length;i<n;i++)if(checkboxFields[i]in document.forms[form_name]&&document.forms[form_name].elements[checkboxFields[i]].checked)fields[fields.length]=checkboxFields[i]+'='+document.forms[form_name].elements[checkboxFields[i]].value;fields[fields.length]=elk_session_var+'='+elk_session_id;return fields}
function onDocSent(XMLDoc){var i=0,n=0,numErrors=0,numCaptions=0;if(!XMLDoc||!XMLDoc.getElementsByTagName('elk')[0]){document.forms[form_name].preview.onclick=function(){return true};document.forms[form_name].preview.click();return true};var preview=XMLDoc.getElementsByTagName('elk')[0].getElementsByTagName('preview')[0];document.getElementById('preview_subject').innerHTML=preview.getElementsByTagName('subject')[0].firstChild.nodeValue;var bodyText='';for(i=0,n=preview.getElementsByTagName('body')[0].childNodes.length;i<n;i++)bodyText+=preview.getElementsByTagName('body')[0].childNodes[i].nodeValue;document.getElementById('preview_body').innerHTML=bodyText;document.getElementById('preview_body').className='post';var errors=XMLDoc.getElementsByTagName('elk')[0].getElementsByTagName('errors')[0],errorList='',errorCode='',error_area='post_error',error_list=error_area+'_list';for(i=0,numErrors=errors.getElementsByTagName('error').length;i<numErrors;i++){errorCode=errors.getElementsByTagName('error')[i].attributes.getNamedItem("code").value;errorList+='<li id="'+error_area+'_'+errorCode+'" class="error">'+errors.getElementsByTagName('error')[i].firstChild.nodeValue+'</li>'};oError_box=$(document.getElementById(error_area));if($.trim(oError_box.children(error_list).html())==='')oError_box.append("<ul id='"+error_list+"'></ul>");if(numErrors===0){oError_box.css("display","none")}else{document.getElementById(error_list).innerHTML=errorList;oError_box.css("display","");oError_box.attr('class',parseInt(errors.getAttribute('serious'))===0?'warningbox':'errorbox')};if(bPost)document.getElementById('lock_warning').style.display=errors.getAttribute('topic_locked')===1?'':'none';var captions=errors.getElementsByTagName('caption');for(i=0,numCaptions=errors.getElementsByTagName('caption').length;i<numCaptions;i++)if(document.getElementById('caption_'+captions[i].getAttribute('name')))document.getElementById('caption_'+captions[i].getAttribute('name')).className=captions[i].getAttribute('class');if(errors.getElementsByTagName('post_error').length===1){document.forms[form_name][post_box_name].style.border='1px solid red'}else if(document.forms[form_name][post_box_name].style.borderColor==='red'||document.forms[form_name][post_box_name].style.borderColor==='red red red red')if('runtimeStyle'in document.forms[form_name][post_box_name]){document.forms[form_name][post_box_name].style.borderColor=''}else document.forms[form_name][post_box_name].style.border=null;if(bPost){if('last_msg'in document.forms[form_name])document.forms[form_name].last_msg.value=XMLDoc.getElementsByTagName('elk')[0].getElementsByTagName('last_msg')[0].firstChild.nodeValue;for(i=0;i<new_replies.length;i++)document.getElementById('image_new_'+new_replies[i]).style.display='none';new_replies=[];var ignored_replies=[],ignoring=null,newPosts=XMLDoc.getElementsByTagName('elk')[0].getElementsByTagName('new_posts')[0]?XMLDoc.getElementsByTagName('elk')[0].getElementsByTagName('new_posts')[0].getElementsByTagName('post'):{length:0},numNewPosts=newPosts.length;if(numNewPosts!==0){var newPostsHTML='<span id="new_replies"></span>';for(i=0;i<numNewPosts;i++){new_replies[new_replies.length]=newPosts[i].getAttribute("id");ignoring=false;if(newPosts[i].getElementsByTagName("is_ignored")[0].firstChild.nodeValue!==0)ignored_replies[ignored_replies.length]=ignoring=newPosts[i].getAttribute("id");newPostsHTML+='<div class="windowbg'+(++reply_counter%2===0?'2':'')+' core_posts"><div class="content" id="msg'+newPosts[i].getAttribute("id")+'"><div class="floatleft"><h5>'+txt_posted_by+': '+newPosts[i].getElementsByTagName("poster")[0].firstChild.nodeValue+'</h5><span class="smalltext">&#171;&nbsp;<strong>'+txt_on+':</strong> '+newPosts[i].getElementsByTagName("time")[0].firstChild.nodeValue+'&nbsp;&#187;</span> <span class="new_posts" id="image_new_'+newPosts[i].getAttribute("id")+'">'+txt_new+'</span></div>';if(can_quote)newPostsHTML+='<ul class="quickbuttons" id="msg_'+newPosts[i].getAttribute('id')+'_quote"><li class="listlevel1"><a href="#postmodify" onclick="return insertQuoteFast('+newPosts[i].getAttribute('id')+');" class="linklevel1 quote_button">'+txt_bbc_quote+'</a></li></ul>';newPostsHTML+='<br class="clear" />';if(ignoring)newPostsHTML+='<div id="msg_'+newPosts[i].getAttribute("id")+'_ignored_prompt" class="smalltext">'+txt_ignoring_user+'<a href="#" id="msg_'+newPosts[i].getAttribute("id")+'_ignored_link" style="display: none;">'+show_ignore_user_post+'</a></div>';newPostsHTML+='<div class="list_posts smalltext" id="msg_'+newPosts[i].getAttribute("id")+'_body">'+newPosts[i].getElementsByTagName("message")[0].firstChild.nodeValue+'</div></div></div>'};setOuterHTML(document.getElementById('new_replies'),newPostsHTML)};var numIgnoredReplies=ignored_replies.length;if(numIgnoredReplies!==0)for(i=0;i<numIgnoredReplies;i++)aIgnoreToggles[ignored_replies[i]]=new elk_Toggle({bToggleEnabled:true,bCurrentlyCollapsed:true,aSwappableContainers:['msg_'+ignored_replies[i]+'_body','msg_'+ignored_replies[i]+'_quote'],aSwapLinks:[{sId:'msg_'+ignored_replies[i]+'_ignored_link',msgExpanded:'',msgCollapsed:show_ignore_user_post}]})};location.hash='#preview_section';if($.isFunction($.fn.linkifyvideo))$().linkifyvideo(oEmbedtext,'preview_body');$('.spoilerheader').click(function(){$(this).next().children().slideToggle("fast")});if(typeof elk_codefix==='function')elk_codefix()}
function addPollOption(){if(pollOptionNum===0)for(var i=0,n=document.forms[form_name].elements.length;i<n;i++)if(document.forms[form_name].elements[i].id.substr(0,8)==='options-'){pollOptionNum++;pollTabIndex=document.forms[form_name].elements[i].tabIndex};pollOptionNum++;pollOptionId++;pollTabIndex++;setOuterHTML(document.getElementById('pollMoreOptions'),'<li><label for="options-'+pollOptionId+'">'+txt_option+' '+pollOptionNum+'</label>: <input type="text" name="options['+pollOptionId+']" id="options-'+pollOptionId+'" value="" size="80" maxlength="255" tabindex="'+pollTabIndex+'" class="input_text" /></li><li id="pollMoreOptions"></li>')}
function addAttachment(){allowed_attachments=allowed_attachments-1;current_attachment=current_attachment+1;if(allowed_attachments<=0)return alert(txt_more_attachments_error);setOuterHTML(document.getElementById("moreAttachments"),'<dd class="smalltext"><input type="file" size="60" name="attachment[]" id="attachment'+current_attachment+'" class="input_file" /> (<a href="javascript:void(0);" onclick="cleanFileInput(\'attachment'+current_attachment+'\');">'+txt_clean_attach+'<\/a>)<\/dd><dd class="smalltext" id="moreAttachments"><a href="#" onclick="addAttachment(); return false;">('+txt_more_attachments+')</a></dd>');return true}
function cleanFileInput(idElement){var oElement=$('#'+idElement);oElement.wrap('<form>').closest('form').get(0).reset();oElement.unwrap()}
function insertQuoteFast(messageid){getXMLDocument(elk_prepareScriptUrl(elk_scripturl)+'action=quotefast;quote='+messageid+';xml;pb='+post_box_name+';mode=0',onDocReceived);return true}
function onDocReceived(XMLDoc){var text='';for(var i=0,n=XMLDoc.getElementsByTagName('quote')[0].childNodes.length;i<n;i++)text+=XMLDoc.getElementsByTagName('quote')[0].childNodes[i].nodeValue;$('#'+post_box_name).data("sceditor").insert(text);ajax_indicator(false)}
function onReceiveOpener(text){$('#'+post_box_name).data("sceditor").insert(text)}
function showimage(){document.images.icons.src=icon_urls[document.forms.postmodify.icon.options[document.forms.postmodify.icon.selectedIndex].value]}
function reActivate(){document.forms.postmodify.message.readOnly=false};(function($,window,document){$.sceditor.plugins.splittag=function(){var base=this,oSplitTags;base.signalReady=function(){oSplitTags=new elk_SplitTags()};base.signalKeypressEvent=function(e){if(e.keyCode===13&&e.ctrlKey)oSplitTags.split()}}
function elk_SplitTags(){this.tagStack=[];this.regex=/\[(?:([a-z]+)([^\]]*)|(\/[a-z]+))\]/gi};elk_SplitTags.prototype.split=function(){if(base.inSourceMode()===false){return}else{var i=0,tagText="",contents=base.val(),editor=$(".sceditor-container").find("textarea")[0],endPos=Math.min(editor.selectionStart,contents.length);this.parseTags(contents,endPos);if(this.tagStack.length!==0){for(i=this.tagStack.length-1;i>=0;i--)tagText+='[/'+this.tagStack[i].name+"]";for(i=0;i<this.tagStack.length;i++)tagText+='\n['+this.tagStack[i].name+this.tagStack[i].attributes+"]";base.insert(tagText)}}};elk_SplitTags.prototype.parseTags=function(text,endPos){this.tagStack=[];text=text.slice(0,endPos);while(matches=this.regex.exec(text))if(matches[3]){this.tagStack.pop()}else this.tagStack.push({name:matches[1],attributes:matches[2]});return this.tagStack}})(jQuery,window,document);(function($,window,document){'use strict'
function elk_Drafts(options){this.opts=$.extend({},this.defaults,options)};elk_Drafts.prototype.draftSave=function(){if(!this.opts._bCheckDraft||elk_formSubmitted)return false;if(this.opts._bInDraftMode===true)this.draftCancel();var sPostdata=base.val();if(isEmptyText(sPostdata))return false;document.getElementById('throbber').style.display='';this.opts._bInDraftMode=true;var aSections=['topic='+parseInt(document.forms.postmodify.elements['topic'].value),'id_draft='+(('id_draft'in document.forms.postmodify.elements)?parseInt(document.forms.postmodify.elements['id_draft'].value):0),'subject='+escape(document.forms.postmodify['subject'].value.replace(/&#/g,"&#38;#").php_to8bit()).replace(/\+/g,"%2B"),'message='+escape(sPostdata.replace(/&#/g,"&#38;#").php_to8bit()).replace(/\+/g,"%2B"),'icon='+escape(document.forms.postmodify['icon'].value.replace(/&#/g,"&#38;#").php_to8bit()).replace(/\+/g,"%2B"),'save_draft=true',elk_session_var+'='+elk_session_id];if(this.opts.sType&&this.opts.sType==='post'){var oLock=document.getElementById('check_lock'),oSticky=document.getElementById('check_sticky'),oSmile=document.getElementById('check_smileys');if(oLock&&oLock.checked)aSections[aSections.length]='lock=1';if(oSticky&&oSticky.checked)aSections[aSections.length]='sticky=1';if(oSmile&&oSmile.checked)aSections[aSections.length]='ns=1'};aSections[aSections.length]='message_mode='+(base.inSourceMode()?'1':'0');sendXMLDocument.call(this,elk_prepareScriptUrl(elk_scripturl)+"action=post2;board="+this.opts.iBoard+";xml",aSections.join("&"),this.onDraftDone);this.opts._bCheckDraft=false};elk_Drafts.prototype.draftPMSave=function(){if(!this.opts._bCheckDraft||elk_formSubmitted)return false;if(this.opts._bInDraftMode===true)this.draftCancel();var sPostdata=base.val();if(isEmptyText(sPostdata))return false;document.getElementById('throbber').style.display='';this.opts._bInDraftMode=true;var aTo=this.draftGetRecipient('recipient_to[]'),aBcc=this.draftGetRecipient('recipient_bcc[]'),aSections=['replied_to='+parseInt(document.forms.pmFolder.elements['replied_to'].value),'id_pm_draft='+(('id_pm_draft'in document.forms.pmFolder.elements)?parseInt(document.forms.pmFolder.elements['id_pm_draft'].value):0),'subject='+escape(document.forms.pmFolder['subject'].value.replace(/&#/g,"&#38;#").php_to8bit()).replace(/\+/g,"%2B"),'message='+escape(sPostdata.replace(/&#/g,"&#38;#").php_to8bit()).replace(/\+/g,"%2B"),'recipient_to='+aTo,'recipient_bcc='+aBcc,'save_draft=true',elk_session_var+'='+elk_session_id];if(this.opts.sType&&this.opts.sType==='post')aSections[aSections.length]='message_mode='+(base.inSourceMode()?'1':'0');sendXMLDocument.call(this,elk_prepareScriptUrl(elk_scripturl)+"action=pm;sa=send2;xml",aSections.join("&"),this.onDraftDone);this.opts._bCheckDraft=false};elk_Drafts.prototype.draftGetRecipient=function(sField){var oRecipient=document.forms.pmFolder.elements[sField],aRecipient=[];if(typeof oRecipient!=='undefined')if('value'in oRecipient){aRecipient.push(parseInt(oRecipient.value))}else for(var i=0,n=oRecipient.length;i<n;i++)aRecipient.push(parseInt(oRecipient[i].value));return aRecipient};elk_Drafts.prototype.draftCancel=function(){this.opts._bInDraftMode=false;document.getElementById('throbber').style.display='none'};elk_Drafts.prototype.onDraftDone=function(XMLDoc){if(!XMLDoc||!XMLDoc.getElementsByTagName('draft')[0])return this.draftCancel();this.opts._sCurDraftId=XMLDoc.getElementsByTagName('draft')[0].getAttribute('id');this.opts._sLastSaved=XMLDoc.getElementsByTagName('draft')[0].childNodes[0].nodeValue;document.getElementById(this.opts.sLastID).value=this.opts._sCurDraftId;document.getElementById(this.opts.sLastNote).innerHTML=this.opts._sLastSaved;var draft_section=document.getElementById('draft_section');if(draft_section)draft_section.style.display='none';this.opts._bInDraftMode=false;document.getElementById('throbber').style.display='none'};elk_Drafts.prototype.defaults={_bInDraftMode:false,_sCurDraftId:null,_interval_id:null,_sLastSaved:null,_bCheckDraft:false};elk_Drafts.prototype.opts={};elk_Drafts.prototype.startSaver=function(){var oInstance=this;if(this.opts.bPM){this.opts._interval_id=setInterval(function(){oInstance.draftPMSave()},this.opts.iFreq)}else this.opts._interval_id=setInterval(function(){oInstance.draftSave()},this.opts.iFreq)};$.sceditor.plugins.draft=function(){var base=this,oDrafts;base.init=function(){oDrafts=new elk_Drafts(this.opts.draftOptions);oDrafts.opts.bPM=oDrafts.opts.bPM?true:false;if(oDrafts.opts.iFreq>0)oDrafts.startSaver()};base.signalFocusEvent=function(){if(oDrafts.opts._interval_id==="")oDrafts.startSaver()};base.signalBlurEvent=function(){if(oDrafts.opts.bPM){oDrafts.draftPMSave()}else oDrafts.draftSave();if(oDrafts.opts._interval_id!=="")clearInterval(oDrafts.opts._interval_id);oDrafts.opts._interval_id=""};base.signalKeypressEvent=function(){oDrafts.opts._bCheckDraft=true}}})(jQuery,window,document);(function(){var __slice=[].slice;(function(factory){if(typeof define==='function'&&define.amd){return define(['jquery'],factory)}else return factory(window.jQuery)})(function($){var $CONTAINER,Api,App,Atwho,Controller,DEFAULT_CALLBACKS,KEY_CODE,Model,View;App=(function(){function App(inputor){this.current_flag=null;this.controllers={};this.alias_maps={};this.$inputor=$(inputor);this.listen()};App.prototype.controller=function(at){return this.controllers[this.alias_maps[at]||at||this.current_flag]};App.prototype.set_context_for=function(at){this.current_flag=at;return this};App.prototype.reg=function(flag,setting){var controller,_base;controller=(_base=this.controllers)[flag]||(_base[flag]=new Controller(this,flag));if(setting.alias)this.alias_maps[setting.alias]=flag;controller.init(setting);return this};App.prototype.listen=function(){var _this=this;return this.$inputor.on('keyup.atwho',function(e){return _this.on_keyup(e)}).on('keydown.atwho',function(e){return _this.on_keydown(e)}).on('scroll.atwho',function(e){var _ref;return(_ref=_this.controller())!=null?_ref.view.hide():void(0)}).on('blur.atwho',function(e){var c;if(c=_this.controller())return c.view.hide(c.get_opt("display_timeout"))})};App.prototype.dispatch=function(){var _this=this;return $.map(this.controllers,function(c){if(c.look_up())return _this.set_context_for(c.at)})};App.prototype.on_keyup=function(e){var _ref;switch(e.keyCode){case KEY_CODE.ESC:e.preventDefault();if((_ref=this.controller())!=null)_ref.view.hide();break;case KEY_CODE.DOWN:case KEY_CODE.UP:$.noop();break;default:this.dispatch()}};App.prototype.on_keydown=function(e){var view,_ref;view=(_ref=this.controller())!=null?_ref.view:void(0);if(!(view&&view.visible()))return;switch(e.keyCode){case KEY_CODE.ESC:e.preventDefault();view.hide();break;case KEY_CODE.UP:e.preventDefault();view.prev();break;case KEY_CODE.DOWN:e.preventDefault();view.next();break;case KEY_CODE.TAB:case KEY_CODE.ENTER:if(!view.visible())return;e.preventDefault();view.choose();break;default:$.noop()}};return App})();Controller=(function(){var uuid,_uuid;_uuid=0;uuid=function(){return _uuid+=1}
function Controller(app,at){this.app=app;this.at=at;this.$inputor=this.app.$inputor;this.id=this.$inputor[0].id||uuid();this.setting=null;this.query=null;this.pos=0;this.cur_rect=null;this.range=null;$CONTAINER.append(this.$el=$("<div id='atwho-ground-"+this.id+"'></div>"));this.model=new Model(this);this.view=new View(this)};Controller.prototype.init=function(setting){this.setting=$.extend({},this.setting||$.fn.atwho["default"],setting);this.view.init();return this.model.reload(this.setting.data)};Controller.prototype.call_default=function(){var args,func_name;func_name=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[];try{return DEFAULT_CALLBACKS[func_name].apply(this,args)}catch(error){return $.error(""+error+" Or maybe At.js doesn't have function "+func_name)}};Controller.prototype.trigger=function(name,data){var alias,event_name;data.push(this);alias=this.get_opt('alias');event_name=alias?""+name+"-"+alias+".atwho":""+name+".atwho";return this.$inputor.trigger(event_name,data)};Controller.prototype.callbacks=function(func_name){return this.get_opt("callbacks")[func_name]||DEFAULT_CALLBACKS[func_name]};Controller.prototype.get_opt=function(at,default_value){try{return this.setting[at]}catch(e){return null}};Controller.prototype.content=function(){if(this.$inputor.is('textarea, input')){return this.$inputor.val()}else return this.$inputor.text()};Controller.prototype.catch_query=function(){var caret_pos,content,end,query,start,subtext;content=this.content();caret_pos=this.$inputor.caret('pos',this.setting.cWindow);subtext=content.slice(0,caret_pos);query=this.callbacks("matcher").call(this,this.at,subtext,this.get_opt('start_with_space'));if(typeof query==="string"&&query.length<=this.get_opt('max_len',20)){start=caret_pos-query.length;end=start+query.length;this.pos=start;query={text:query.toLowerCase(),head_pos:start,end_pos:end};this.trigger("matched",[this.at,query.text])}else this.view.hide();return this.query=query};Controller.prototype.rect=function(){var c,scale_bottom;if(!(c=this.$inputor.caret('offset',this.setting.cWindow,this.pos-1)))return;if(this.$inputor.attr('contentEditable')==='true')c=(this.cur_rect||(this.cur_rect=c))||c;scale_bottom=document.selection?0:2;return{left:c.left,top:c.top,bottom:c.top+c.height+scale_bottom}};Controller.prototype.reset_rect=function(){if(this.$inputor.attr('contentEditable')==='true')return this.cur_rect=null};Controller.prototype.mark_range=function(){this.range=this.get_range();return this.ie_range=this.get_ie_range()};Controller.prototype.clear_range=function(){return this.range=null};Controller.prototype.get_range=function(){var thisWin=this.setting.cWindow;return thisWin.getSelection?thisWin.getSelection().getRangeAt(0):(this.range||void(0))};Controller.prototype.get_ie_range=function(){return this.ie_range||(document.selection?document.selection.createRange():void(0))};Controller.prototype.insert_content_for=function($li){var data,data_value,tpl;data_value=$li.data('value');tpl=this.get_opt('insert_tpl');if(this.$inputor.is('textarea, input')||!tpl)return data_value;data=$.extend({},$li.data('item-data'),{'atwho-data-value':data_value,'atwho-at':this.at});return this.callbacks("tpl_eval").call(this,tpl,data)};Controller.prototype.insert=function(content,$li){var $inputor,$insert_node,class_name,content_node,insert_node,pos,range,sel,source,start_str,text,thisWin;$inputor=this.$inputor;if($inputor.attr('contentEditable')==='true'){class_name="atwho-view-flag atwho-view-flag-"+(this.get_opt('alias')||this.at);content_node=""+content+"<span contenteditable='false'>&nbsp;<span>";insert_node="<span contenteditable='false' class='"+class_name+"'>"+content_node+"</span>";$insert_node=$(insert_node).data('atwho-data-item',$li.data('item-data'));if(document.selection)$insert_node=$("<span contenteditable='true'></span>").html($insert_node)};if($inputor.is('textarea, input')){content=''+content;source=$inputor.val();start_str=source.slice(0,Math.max(this.query.head_pos-this.at.length,0));text=""+start_str+content+" "+(source.slice(this.query['end_pos']||0));$inputor.val(text);$inputor.caret('pos',this.setting.cWindow,start_str.length+content.length+1)}else if(range=this.get_range()){thisWin=this.setting.cWindow;pos=range.startOffset-(this.query.end_pos-this.query.head_pos)-this.at.length;range.setStart(range.endContainer,Math.max(pos,0));range.setEnd(range.endContainer,range.endOffset);range.deleteContents();range.insertNode($insert_node[0]);range.collapse(false);sel=thisWin.getSelection();sel.removeAllRanges();sel.addRange(range)}else if(range=this.get_ie_range()){range.moveStart('character',this.query.end_pos-this.query.head_pos-this.at.length);range.pasteHTML($insert_node[0]);range.collapse(false);range.select()};$inputor.focus();return $inputor.change()};Controller.prototype.render_view=function(data){var search_key;search_key=this.get_opt("search_key");data=this.callbacks("sorter").call(this,this.query.text,data.slice(0,1001),search_key);return this.view.render(data.slice(0,this.get_opt('limit')))};Controller.prototype.look_up=function(){var query,_callback;if(!(query=this.catch_query()))return;_callback=function(data){if(data&&data.length>0){return this.render_view(data)}else return this.view.hide()};this.model.query(query.text,$.proxy(_callback,this));return query};return Controller})();Model=(function(){function Model(context){this.context=context;this.at=this.context.at;this.storage=this.context.$inputor};Model.prototype.saved=function(){return this.fetch()>0};Model.prototype.query=function(query,callback){var data,search_key,_remote_filter;data=this.fetch();search_key=this.context.get_opt("search_key");data=this.context.callbacks('filter').call(this.context,query,data,search_key)||[];_remote_filter=this.context.callbacks('remote_filter');if(data.length>0||(!_remote_filter&&data.length===0)){return callback(data)}else return _remote_filter.call(this.context,query,callback)};Model.prototype.fetch=function(){return this.storage.data(this.at)||[]};Model.prototype.save=function(data){return this.storage.data(this.at,this.context.callbacks("before_save").call(this.context,data||[]))};Model.prototype.load=function(data){if(!(this.saved()||!data))return this._load(data)};Model.prototype.reload=function(data){return this._load(data)};Model.prototype._load=function(data){var _this=this;if(typeof data==="string"){return $.ajax(data,{dataType:"json"}).done(function(data){return _this.save(data)})}else return this.save(data)};return Model})();View=(function(){function View(context){this.context=context;this.$el=$("<div class='atwho-view'><ul class='atwho-view-ul'></ul></div>");this.timeout_id=null;this.context.$el.append(this.$el);this.bind_event()};View.prototype.init=function(){var id;id=this.context.get_opt("alias")||this.context.at.charCodeAt(0);return this.$el.attr({id:"at-view-"+id})};View.prototype.bind_event=function(){var $menu,_this=this;$menu=this.$el.find('ul');$menu.on('mouseenter.atwho-view','li',function(e){$menu.find('.cur').removeClass('cur');return $(e.currentTarget).addClass('cur')}).on('click',function(e){_this.choose();return e.preventDefault()});return this.$el.on('mouseenter.atwho-view','ul',function(e){return _this.context.mark_range()}).on('mouseleave.atwho-view','ul',function(e){return _this.context.clear_range()})};View.prototype.visible=function(){return this.$el.is(":visible")};View.prototype.choose=function(){var $li,content;$li=this.$el.find(".cur");content=this.context.insert_content_for($li);this.context.insert(this.context.callbacks("before_insert").call(this.context,content,$li),$li);this.context.trigger("inserted",[$li]);return this.hide()};View.prototype.reposition=function(rect){var offset,thisWin;thisWin=this.context.setting.cWindow;if(rect.bottom+this.$el.height()-$(thisWin).scrollTop()>$(thisWin).height())rect.bottom=rect.top-this.$el.height();offset={left:rect.left,top:rect.bottom};this.$el.offset(offset);return this.context.trigger("reposition",[offset])};View.prototype.next=function(){var cur,next;cur=this.$el.find('.cur').removeClass('cur');next=cur.next();if(!next.length)next=this.$el.find('li:first');return next.addClass('cur')};View.prototype.prev=function(){var cur,prev;cur=this.$el.find('.cur').removeClass('cur');prev=cur.prev();if(!prev.length)prev=this.$el.find('li:last');return prev.addClass('cur')};View.prototype.show=function(){var rect;if(!this.visible())this.$el.show();if(rect=this.context.rect())return this.reposition(rect)};View.prototype.hide=function(time){var callback,_this=this;if(isNaN(time&&this.visible())){this.context.reset_rect();return this.$el.hide()}else{callback=function(){return _this.hide()};clearTimeout(this.timeout_id);return this.timeout_id=setTimeout(callback,time)}};View.prototype.render=function(list){var $li,$ul,item,li,tpl,_i,_len;if(!($.isArray(list)&&list.length>0)){this.hide();return};this.$el.find('ul').empty();$ul=this.$el.find('ul');tpl=this.context.get_opt('tpl');for(_i=0,_len=list.length;_i<_len;_i++){item=list[_i];item=$.extend({},item,{'atwho-at':this.context.at});li=this.context.callbacks("tpl_eval").call(this.context,tpl,item);$li=$(this.context.callbacks("highlighter").call(this.context,li,this.context.query.text));$li.data("item-data",item);$ul.append($li)};this.show();return $ul.find("li:first").addClass("cur")};return View})();KEY_CODE={DOWN:40,UP:38,ESC:27,TAB:9,ENTER:13};DEFAULT_CALLBACKS={before_save:function(data){var item,_i,_len,_results;if(!$.isArray(data))return data;_results=[];for(_i=0,_len=data.length;_i<_len;_i++){item=data[_i];if($.isPlainObject(item)){_results.push(item)}else _results.push({name:item})};return _results},matcher:function(flag,subtext,should_start_with_space){var match,regexp;flag=flag.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");if(should_start_with_space)flag='(?:^|\\s)'+flag;regexp=new RegExp(flag+'([A-Za-z0-9_\+\-]*)$|'+flag+'([^\\x00-\\xff]*)$','gi');match=regexp.exec(subtext);if(match){return match[2]||match[1]}else return null},filter:function(query,data,search_key){var item,_i,_len,_results;_results=[];for(_i=0,_len=data.length;_i<_len;_i++){item=data[_i];if(~item[search_key].toLowerCase().indexOf(query))_results.push(item)};return _results},remote_filter:null,sorter:function(query,items,search_key){var item,_i,_len,_results;if(!query)return items;_results=[];for(_i=0,_len=items.length;_i<_len;_i++){item=items[_i];item.atwho_order=item[search_key].toLowerCase().indexOf(query);if(item.atwho_order>-1)_results.push(item)};return _results.sort(function(a,b){return a.atwho_order-b.atwho_order})},tpl_eval:function(tpl,map){try{return tpl.replace(/\$\{([^\}]*)\}/g,function(tag,key,pos){return map[key]})}catch(error){return""}},highlighter:function(li,query){var regexp;if(!query)return li;regexp=new RegExp(">\\s*(\\w*)("+query.replace("+","\\+")+")(\\w*)\\s*<",'ig');return li.replace(regexp,function(str,$1,$2,$3){return'> '+$1+'<strong>'+$2+'</strong>'+$3+' <'})},before_insert:function(value,$li){return value}};Api={load:function(at,data){var c;if(c=this.controller(at))return c.model.load(data)},getInsertedItemsWithIDs:function(at){var c,ids,items;if(!(c=this.controller(at)))return[null,null];if(at)at="-"+(c.get_opt('alias')||c.at);ids=[];items=$.map(this.$inputor.find("span.atwho-view-flag"+(at||"")),function(item){var data;data=$(item).data('atwho-data-item');if(ids.indexOf(data.id)>-1)return;if(data.id)ids.push=data.id;return data});return[ids,items]},getInsertedItems:function(at){return Api.getInsertedItemsWithIDs.apply(this,[at])[1]},getInsertedIDs:function(at){return Api.getInsertedItemsWithIDs.apply(this,[at])[0]},run:function(){return this.dispatch()}};Atwho={init:function(options){var $this,app;app=($this=$(this)).data("atwho");if(!app)$this.data('atwho',(app=new App(this)));app.reg(options.at,options);return this}};$CONTAINER=$("<div id='atwho-container'></div>");$.fn.atwho=function(method){var result,_args;_args=arguments;$('body').append($CONTAINER);result=null;this.filter('textarea, input, [contenteditable=true]').each(function(){var app;if(typeof method==='object'||!method){return Atwho.init.apply(this,_args)}else if(Api[method]){if(app=$(this).data('atwho'))return result=Api[method].apply(app,Array.prototype.slice.call(_args,1))}else return $.error("Method "+method+" does not exist on jQuery.caret")});return result||this};return $.fn.atwho["default"]={at:void(0),alias:void(0),data:null,tpl:"<li data-value='${atwho-at}${name}'>${name}</li>",insert_tpl:"<span>${atwho-data-value}</span>",callbacks:DEFAULT_CALLBACKS,search_key:"name",start_with_space:true,limit:5,max_len:20,display_timeout:300,cWindow:window}})}).call(this);(function(){(function(factory){if(typeof define==='function'&&define.amd){return define(['jquery'],factory)}else return factory(window.jQuery)})(function($){"use strict";var EditableCaret,InputCaret,Mirror,Utils,methods,pluginName,cWin;pluginName='caret';EditableCaret=(function(){function EditableCaret($inputor){this.$inputor=$inputor;this.domInputor=this.$inputor[0]};EditableCaret.prototype.setPos=function(pos){return this.domInputor};EditableCaret.prototype.getIEPosition=function(){return $.noop()};EditableCaret.prototype.getPosition=function(){return $.noop()};EditableCaret.prototype.getOldIEPos=function(){var preCaretTextRange,textRange;textRange=document.selection.createRange();preCaretTextRange=document.body.createTextRange();preCaretTextRange.moveToElementText(this.domInputor);preCaretTextRange.setEndPoint("EndToEnd",textRange);return preCaretTextRange.text.length};EditableCaret.prototype.getPos=function(){var clonedRange,pos,range;if(range=this.range()){clonedRange=range.cloneRange();clonedRange.selectNodeContents(this.domInputor);clonedRange.setEnd(range.endContainer,range.endOffset);pos=clonedRange.toString().length;clonedRange.detach();return pos}else if(document.selection)return this.getOldIEPos()};EditableCaret.prototype.getOldIEOffset=function(){var range,rect;range=document.selection.createRange().duplicate();range.moveStart("character",-1);rect=range.getBoundingClientRect();return{height:rect.bottom-rect.top,left:rect.left,top:rect.top}};EditableCaret.prototype.getOffset=function(pos){var clonedRange,offset,range,rect;if(cWin.getSelection&&(range=this.range())){if(range.endOffset-1<0)return null;clonedRange=range.cloneRange();clonedRange.setStart(range.endContainer,range.endOffset-1);clonedRange.setEnd(range.endContainer,range.endOffset);rect=clonedRange.getBoundingClientRect();offset={height:rect.height,left:rect.left+rect.width,top:rect.top};clonedRange.detach()}else if(document.selection)offset=this.getOldIEOffset();if(offset){offset.top+=$(window).scrollTop();offset.left+=$(window).scrollLeft()};return offset};EditableCaret.prototype.range=function(){var sel;if(!cWin.getSelection)return;sel=cWin.getSelection();if(sel.rangeCount>0){return sel.getRangeAt(0)}else return null};return EditableCaret})();InputCaret=(function(){function InputCaret($inputor){this.$inputor=$inputor;this.domInputor=this.$inputor[0]};InputCaret.prototype.getIEPos=function(){var endRange,inputor,len,normalizedValue,pos,range,textInputRange;inputor=this.domInputor;range=document.selection.createRange();pos=0;if(range&&range.parentElement()===inputor){normalizedValue=inputor.value.replace(/\r\n/g,"\n");len=normalizedValue.length;textInputRange=inputor.createTextRange();textInputRange.moveToBookmark(range.getBookmark());endRange=inputor.createTextRange();endRange.collapse(false);if(textInputRange.compareEndPoints("StartToEnd",endRange)>-1){pos=len}else pos=-textInputRange.moveStart("character",-len)};return pos};InputCaret.prototype.getPos=function(){if(document.selection){return this.getIEPos()}else return this.domInputor.selectionStart};InputCaret.prototype.setPos=function(pos){var inputor,range;inputor=this.domInputor;if(document.selection){range=inputor.createTextRange();range.move("character",pos);range.select()}else if(inputor.setSelectionRange)inputor.setSelectionRange(pos,pos);return inputor};InputCaret.prototype.getIEOffset=function(pos){var h,textRange,x,y;textRange=this.domInputor.createTextRange();pos||(pos=this.getPos());textRange.move('character',pos);x=textRange.boundingLeft;y=textRange.boundingTop;h=textRange.boundingHeight;return{left:x,top:y,height:h}};InputCaret.prototype.getOffset=function(pos){var $inputor,offset,position;$inputor=this.$inputor;if(document.selection){offset=this.getIEOffset(pos);offset.top+=$(window).scrollTop()+$inputor.scrollTop();offset.left+=$(window).scrollLeft()+$inputor.scrollLeft();return offset}else{offset=$inputor.offset();position=this.getPosition(pos);return offset={left:offset.left+position.left-$inputor.scrollLeft(),top:offset.top+position.top-$inputor.scrollTop(),height:position.height}}};InputCaret.prototype.getPosition=function(pos){var $inputor,at_rect,format,html,mirror,start_range;$inputor=this.$inputor;format=function(value){return value.replace(/</g,'&lt').replace(/>/g,'&gt').replace(/`/g,'&#96').replace(/"/g,'&quot').replace(/\r\n|\r|\n/g,"<br />")};if(pos===void(0))pos=this.getPos();start_range=$inputor.val().slice(0,pos);html="<span>"+format(start_range)+"</span>";html+="<span id='caret'>|</span>";mirror=new Mirror($inputor);return at_rect=mirror.create(html).rect()};InputCaret.prototype.getIEPosition=function(pos){var h,inputorOffset,offset,x,y;offset=this.getIEOffset(pos);inputorOffset=this.$inputor.offset();x=offset.left-inputorOffset.left;y=offset.top-inputorOffset.top;h=offset.height;return{left:x,top:y,height:h}};return InputCaret})();Mirror=(function(){Mirror.prototype.css_attr=["overflowY","height","width","paddingTop","paddingLeft","paddingRight","paddingBottom","marginTop","marginLeft","marginRight","marginBottom","fontFamily","borderStyle","borderWidth","wordWrap","fontSize","lineHeight","overflowX","text-align"]
function Mirror($inputor){this.$inputor=$inputor};Mirror.prototype.mirrorCss=function(){var css,_this=this;css={position:'absolute',left:-9999,top:0,zIndex:-2e4,'white-space':'pre-wrap'};$.each(this.css_attr,function(i,p){return css[p]=_this.$inputor.css(p)});return css};Mirror.prototype.create=function(html){this.$mirror=$('<div></div>');this.$mirror.css(this.mirrorCss());this.$mirror.html(html);this.$inputor.after(this.$mirror);return this};Mirror.prototype.rect=function(){var $flag,pos,rect;$flag=this.$mirror.find("#caret");pos=$flag.position();rect={left:pos.left,top:pos.top,height:$flag.height()};this.$mirror.remove();return rect};return Mirror})();Utils={adjustOffset:function(offset,$inputor){if(!offset)return;offset.top+=$(window).scrollTop();offset.left+=$(window).scrollLeft();return offset},contentEditable:function($inputor){return!!($inputor[0].contentEditable&&$inputor[0].contentEditable==='true')}};methods={pos:function(pos){if(pos){return this.setPos(pos)}else return this.getPos()},position:function(pos){if(document.selection){return this.getIEPosition(pos)}else return this.getPosition(pos)},offset:function(pos){return this.getOffset(pos)}};$.fn.caret=function(method,aWin){var caret;cWin=aWin;caret=Utils.contentEditable(this)?new EditableCaret(this):new InputCaret(this);if(methods[method]){return methods[method].apply(caret,Array.prototype.slice.call(arguments,2))}else return $.error("Method "+method+" does not exist on jQuery.caret")};$.fn.caret.EditableCaret=EditableCaret;$.fn.caret.InputCaret=InputCaret;$.fn.caret.Utils=Utils;return $.fn.caret.apis=methods})}).call(this);(function($,window,document){'use strict'
function elk_Mentions(options){this.opts=$.extend({},this.defaults,options)};elk_Mentions.prototype.attachAtWho=function(oMentions,$element,oIframeWindow){var mentioned=document.getElementById('mentioned');if(mentioned===null){$('#'+oMentions.opts.editor_id).after(oMentions.opts._mentioned)}else oMentions.opts._mentioned=$(mentioned);oMentions.opts.cache.mentions=this.opts._mentioned;$element.atwho({at:"@",limit:7,cWindow:oIframeWindow,tpl:"<li data-value='${atwho-at}${name}' data-id='${id}'>${name}</li>",callbacks:{filter:function(query,items,search_key){var current_call=parseInt(new Date().getTime()/1e3);if(query.length<2)return[];if(oMentions.opts._last_call!==0&&oMentions.opts._last_call+1>current_call)return oMentions.opts._names;if(typeof oMentions.opts.cache.names[query]!=='undefined')return oMentions.opts.cache.names[query];oMentions.opts._names=[];$.ajax({url:elk_scripturl+"?action=suggest;suggest_type=member;search="+query.php_to8bit().php_urlencode()+";"+elk_session_var+"="+elk_session_id+";xml;time="+current_call,type:"get",async:false}).done(function(request){$(request).find('item').each(function(idx,item){if(typeof oMentions.opts._names[oMentions.opts._names.length]==='undefined')oMentions.opts._names[oMentions.opts._names.length]={};oMentions.opts._names[oMentions.opts._names.length-1].id=$(item).attr('id');oMentions.opts._names[oMentions.opts._names.length-1].name=$(item).text()})});oMentions.opts._last_call=current_call;oMentions.opts.cache.names[query]=oMentions.opts._names;oMentions.opts.cache.queries[oMentions.opts.cache.queries.length]=query;return oMentions.opts._names},before_insert:function(value,$li){oMentions.addUID($li.data('id'),$li.data('value'));if(is_opera&&!base.inSourceMode())return value.replace($li.data('value'),$li.data('value').substring(1));return value},matcher:function(flag,subtext,should_start_with_space){var match,regexp;flag=flag.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");if(should_start_with_space)flag='(?:^|\\s)'+flag;regexp=new RegExp(flag+'([^ <>&"\'=\\\\\n]*)$|'+flag+'([^\\x00-\\xff]*)$','gi');match=regexp.exec(subtext.replace());if(match){return match[2]||match[1]}else return null},highlighter:function(li,query){var regexp;if(!query)return li;query=(query+'').replace(new RegExp('[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]','g'),'\\$&');regexp=new RegExp(">\\s*(\\w*)("+query.replace("+","\\+")+")(\\w*)\\s*<",'ig');return li.replace(regexp,function(str,$1,$2,$3){return'> '+$1+'<strong>'+$2+'</strong>'+$3+' <'})}}});$(oIframeWindow).on("reposition.atwho",function(event,offset){if(base.inSourceMode())return;var oIframe=$('#'+oMentions.opts.editor_id).parent().find('iframe').offset(),iLeft=oIframe.left+offset.left,iTop=oIframe.top,select_height=0;$('#at-view-64.atwho-view').each(function(index,element){if($(this).outerHeight()>0)select_height+=$(this).height()+10});var iWindowHeight=$(window).height(),iDocViewTop=$(window).scrollTop(),iSelectionPosition=iTop+offset.top-$(window).scrollTop(),iAvailableSpace=iWindowHeight-(iSelectionPosition-iDocViewTop);if(iAvailableSpace>=select_height){iTop=iTop+offset.top+select_height-$(window).scrollTop()}else iTop=iTop+offset.top-$(window).scrollTop();offset={left:iLeft,top:iTop};$('#at-view-64.atwho-view').offset(offset)})};elk_Mentions.prototype.addUID=function(user_id,name){this.opts._mentioned.append($('<input type="hidden" name="uid[]" />').val(user_id).attr('data-name',name))};elk_Mentions.prototype.defaults={_names:[],_last_call:0,_mentioned:$('<div style="display:none" />')};elk_Mentions.prototype.opts={};$.sceditor.plugins.mention=function(){var base=this,oMentions;base.signalReady=function(){oMentions=new elk_Mentions(this.opts.mentionOptions);add_elk_mention(oMentions.opts.editor_id,{isPlugin:true});oMentions.attachAtWho(oMentions,$('#'+oMentions.opts.editor_id).parent().find('textarea'));var instance=$('#'+oMentions.opts.editor_id).sceditor('instance');if(!instance.opts.runWithoutWysiwygSupport){var oIframe=$('#'+oMentions.opts.editor_id).parent().find('iframe')[0],oIframeWindow=oIframe.contentWindow,oIframeBody=$('#'+oMentions.opts.editor_id).parent().find('iframe').contents().find('body')[0];oMentions.attachAtWho(oMentions,$(oIframeBody),oIframeWindow)}}}})(jQuery,window,document)
function elk_NewsFader(oOptions){var aFaderItems=oOptions.aFaderItems||[],iFadeIndex=0,iFadeDelay=oOptions.iFadeDelay||5e3,iFadeSpeed=oOptions.iFadeSpeed||650,sItemTemplate=oOptions.sItemTemplate||'%1$s',sControlId='#'+oOptions.sFaderControlId,fadeIn=function(){iFadeIndex++;if(iFadeIndex>=aFaderItems.length)iFadeIndex=0;$(sControlId+' li').html(sItemTemplate.replace('%1$s',aFaderItems[iFadeIndex])).fadeTo(iFadeSpeed,0.99,function(){this.style.filter='';fadeOut()})},fadeOut=function(){setTimeout(function(){$(sControlId+' li').fadeTo(iFadeSpeed,0,fadeIn)},iFadeDelay)};if(!aFaderItems.length)$(sControlId+' li').each(function(){aFaderItems.push($(this).html())});$(sControlId).html('<li>'+sItemTemplate.replace('%1$s',aFaderItems[0])+'</li>');fadeOut()}