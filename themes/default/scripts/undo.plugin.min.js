/* SCEditor v1.5.4 | (C) 2017, Sam Clarke | sceditor.com/license */

!function(e){"use strict";jQuery.sceditor.plugins.undo=function(){var o,r,e=this,n=0,u=50,c=-1,a=[],d=!1,t=function(e){d=!0,r=e.value,o.sourceMode(e.sourceMode),o.val(e.value,!1),o.focus(),e.sourceMode?o.sourceEditorCaret(e.caret):o.getRangeHelper().restoreRange(),d=!1},s=function(e,t){for(;t<a.length-1;)a.pop();a.push(e),c=t+1};e.init=function(){u=(o=this).undoLimit||u,o.addShortcut("ctrl+z",e.undo),o.addShortcut("ctrl+shift+z",e.redo),o.addShortcut("ctrl+y",e.redo),o.commands.undo||(o.commands.undo={txtExec:e.undo,exec:e.undo,tooltip:"Undo"},o.commands.redo={txtExec:e.redo,exec:e.redo,tooltip:"Redo"})},e.undo=function(){var e=o.val(null,!1);return-1===c||(c===a.length-1&&s({caret:o.sourceEditorCaret(),sourceMode:o.sourceMode(),value:e},c),c=Math.max(0,c-1),t(a[c])),!1},e.redo=function(){return c===a.length-1||t(a[c+=1]),!1},e.signalReady=function(){var e,t=o.val(null,!1);""===t?e={end:0,start:0}:(e=this.sourceEditorCaret(),document.getElementById("top").scrollIntoView()),r=t,s({caret:e,sourceMode:this.sourceMode(),value:t},c)},e.signalValuechangedEvent=function(e){var t=e.rawValue;0<u&&a.length>u&&a.shift(),d||void 0===r||r===t||(n+=function(e,t){var o,r,n,u,c=e.length,a=t.length,d=Math.max(c,a);for(o=0;o<d&&e.charAt(o)===t.charAt(o);o++);for(n=c<a?a-c:0,u=a<c?c-a:0,r=d-1;0<=r&&e.charAt(r-n)===t.charAt(r-u);r--);return r-o+1}(r,t))<20||n<50&&!/\s$/g.test(e.rawValue)||(s({caret:o.sourceEditorCaret(),sourceMode:o.sourceMode(),value:t},c),n=0,r=t)}}}();